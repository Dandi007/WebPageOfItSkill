_.Module.define({path:"liveshow/widget/frsSpreadList",requires:[],sub:{initial:function(){this.wrap=$(".j_frs_spread_player"),this._bindEvents(),this._addReplyTime(),$.stats.track("\u5E16\u5B5025\u697C","\u79C0\u5427\u6A21\u5757\u5C55\u793A","","view")},_bindEvents:function(){this.wrap.find(".j_photo").on("click",function(){$.stats.track("frs-25\u697C","\u89C6\u9891feed\u6D41","frs","click")}),this.wrap.find(".j_entry_title").on("click",function(){$.stats.track("frs-25\u697C","\u89C6\u9891feed\u6D41","frs","click")}),this.wrap.find(".hover_r").hover(function(){$(this).find(".zhe1").show()},function(){$(this).find(".zhe1").hide()})},_addReplyTime:function(){var i=$(".spreadad_0001"),t=i.parent().next(".j_thread_list").find(".j_reply_data").html()||"";i.find(".j_reply_data").html(t)}}});_.Module.define({path:"frs/widget/dasense",requires:["common/widget/messenger"],sub:{initial:function(e,a){try{var t=$("#dasense_"+e);if(t.size()<1)return;this.$me=t,this.floor=e,this.adtypeid=this.$me.tbattr("data-datypeid"),this.initTrackField(),this.doneShowStat=!1,this.scrollShowTimeout,this.bindEvent(),a&&(this.loadIFrame(),this.initIFrameMessenger()),("0009"==this.adtypeid||"0015"==this.adtypeid||"0106"==this.adtypeid)&&(this.initZhixin(),window.__zhixin_hide=$.proxy(this.shutZhixin,this)),"0108"==this.adtypeid&&this.loadWangmeng(),"0200"==this.adtypeid&&this._leftFloatAd(t,this.adtypeid,a,this.ext1,this.floor)}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/dasense/dasense.js",method:"",ln:47}),i}},initTrackField:function(){var e="",a="",t="",i="",d="",n="",o=$.cookie("BAIDUID");PageData&&(e=PageData.product.toUpperCase(),PageData.forum&&(a=PageData.forum.forum_id||"",t=PageData.forum.forum_name||""),PageData.user&&(n=PageData.user.user_id||PageData.user.user_id||""),PageData.thread&&(i=PageData.thread&&PageData.thread.thread_id||""));var s=this.adtypeid,r=this.$me.data("daid"),c=this.$me.data("daname"),m=this.$me.data("dagoodid"),f=this.$me.data("dafirstname"),h=this.$me.data("dasecondname"),g=this.$me.data("dacpid"),l=this.$me.data("daabtest"),u=this.$me.data("daprice"),_=this.$me.data("daverify"),p=this.$me.data("daextinfo"),w=this.$me.data("daplanid"),y=this.$me.data("dauserid");this.forIframe=["dapage="+e,"dafid="+a,"datid="+i,"dacuid="+d,"dauid="+n,"dabaiduid="+o,"datypeid="+s,"daid="+r,"daname="+encodeURIComponent(c),"dagoodid="+m,"dafirstname="+encodeURIComponent(f),"dasecondname="+encodeURIComponent(h),"dacpid="+g,"daabtest="+l,"daprice="+u,"daverify="+_,"daextinfo="+p,"daplanid="+w,"dauserid="+y].join("&"),this.task="tbda",this.ext1={client_type:"pc_web",task:this.task,da_task:this.task,page:e.toLowerCase(),da_page:e,da_obj_id:r,fid:a,tid:i,da_good_id:m,da_ext_info:p,da_price:u,da_verify:_,cuid:d,uid:n,baiduid:o,da_obj_name:c,da_first_name:f,da_second_name:h,da_cpid:g,da_abtest:l},this.ext2={trackUrl:"/billboard/pushlog/?",da_task:this.task,da_page:e,da_client_type:"PC",da_obj_id:r,da_fid:a,da_tid:i,da_good_id:m,da_ext_info:p,da_plan_id:w,da_user_id:y,da_price:u,da_verify:_,da_cuid:d,da_uid:n,da_baiduid:o,da_cpid:g}},bindEvent:function(){var e=this;e.$me.on("click","a",function(a){try{var t=$($.event.fix(a).currentTarget),i=e.floor+"_"+t.data("locate");e.track($.extend({},e.ext1,{locate:i,da_locate:i,type:"click",da_type:"click"})),e.track($.extend({},e.ext2,{da_locate:e.floor,da_type:"click"}))}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/dasense/dasense.js",method:"",ln:179}),a}});var a=function(){e.doneShowStat||(e.track($.extend({},e.ext1,{locate:e.floor,da_locate:e.floor,type:"show",da_type:"show"})),e.track($.extend({},e.ext2,{da_locate:e.floor,da_type:"show"})),e.doneShowStat=!0)},t=function(){var a=e.$me.offset().top,t=e.$me.offset().top+e.$me.height(),i=$("body").scrollTop(),d=$(window).height()+i,n=!1;return(a>i&&d>=a||t>i&&d>=t)&&(n=!0),n};t()?a():$(window).on("scroll",function(){t()&&(clearTimeout(e.scrollShowTimeout),e.scrollShowTimeout=setTimeout(a,200))})},_leftFloatAd:function(e,a,t,i,d){var n=e.data("daid"),i=i,d=d;$img=e.find("#j_ten_years2").find(".ten_years"),$closeBtn=e.find("#j_ten_years2").find(".j_close_btn");var o=$img.data("hover"),s=$.tb.unescapeHTML($img.tbattr("src"));$img.mouseover(function(){$(this).tbprop("src",o)}).mouseout(function(){$(this).tbprop("src",s)}),$closeBtn.data("adid",n);var r=this;t||"0200"!=a||$closeBtn.on("click",function(e){try{var a=$($.event.fix(e).currentTarget),t=d+"_"+a.data("locate");r.track($.extend({},i,{locate:t,da_locate:t,type:"click",da_type:"click"}));var n=$(this).data("adid");$.ajax({type:"post",url:"/adsense/addUserMask",data:{user_id:PageData.user.user_id||"",advertid:n||""},context:this,dataType:"json",success:function(e){0===e.errno?$(this).parent().parent().hide():console.log("ERROR: send pc left float ad to server ")},error:function(){console.log("ERROR: send pc left float ad to server error")}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/dasense/dasense.js",method:"",ln:267}),e}})},loadWangmeng:function(){var e=this.$me.find(".dasense_wangmeng_placeholder"),a=e.data("wangmengid");$.JsLoadManager.use(["http://cbjs.baidu.com/js/m.js"],function(){var e=PageData.forum?PageData.forum.forum_id:0;BAIDU_CLB_addOrientation("tbid",e+""),BAIDU_CLB_fillSlotAsync(a,"dasense_wangmeng_"+a)})},loadIFrame:function(){var e=this.$me.find(".dasense_iframe"),a=e.width(),t=e.height(),i=e.data("src"),d=this.adtypeid,n=$.cookie("BAIDUID"),o=this.$me.data("barname_gbk");"0010"==d&&(i+="&barname="+window.encodeURIComponent(window.PageData.forum.forum_name)+"&barcid="+window.encodeURIComponent(window.PageData.forum.first_class+"^"+window.PageData.forum.second_class)),("0008"==d||"0105"==d||"0016"==d)&&(i+="&word="+o),("0009"==d||"0015"==d||"0106"==d)&&(i+="&query="+window.encodeURIComponent(window.PageData.forum.forum_name)),"0021"==d&&(i+="&query="+window.encodeURIComponent(window.PageData.forum.forum_name)+"&firstname="+encodeURIComponent(window.PageData.forum.first_class)+"&secondname="+encodeURIComponent(window.PageData.forum.second_class),this.initToggle()),"0013"==d&&(i+="adforumname="+window.encodeURIComponent(window.PageData.forum.forum_name)),"0020"==d&&(i+="adforumname="+window.encodeURIComponent(window.PageData.forum.forum_name)+"&word="+o),"0018"==d&&(i+="&fid="+PageData.forum.forum_id+"&firstname="+encodeURIComponent(window.PageData.forum.first_class)+"&secondname="+encodeURIComponent(window.PageData.forum.second_class)+"&query="+encodeURIComponent(window.PageData.forum.forum_name)),("0017"==d||"0109"==d)&&(i+="&daquery="+encodeURIComponent(window.PageData.forum.forum_name)),"0019"==d&&(i+="&baiduid="+n),("0022"==d||"0023"==d||"0025"==d)&&(i+="&firstname="+encodeURIComponent(window.PageData.forum.first_class)+"&secondname="+encodeURIComponent(window.PageData.forum.second_class)+"&query="+encodeURIComponent(window.PageData.forum.forum_name)),i+="&"+this.forIframe,e.append($('<iframe src="'+i+'" style="width:'+a+"px;height:"+t+'px" scrolling="no" frameborder="0"></iframe>'))},initIFrameMessenger:function(){var e=this.use("common/widget/messenger","parent","checkStatus");e.registerOrigin(this.getMessengerWhitelist()),e.registerCommand({comforum_adsense:$.proxy(this.iFrameMessengerHandler,this)})},iFrameMessengerHandler:function(e){var a=$('.dasense[data-daid="'+e.id+'"]'),t=a.find(".dasense_iframe");e.status&&"success"===e.status?(e.height&&e.height<t.height()&&a.find(".dasense_iframe, iframe").height(e.height),a.css({position:"",left:"","z-index":""}),a.show()):a.hide()},getMessengerWhitelist:function(){var e=0,a=[],t=PageUnit.load("dasense_messenger_whitelist"),i=t.length;for(e;i>e;e++)a.push(t[e][0]);return a},initZhixin:function(){var e=this,a=e.$me.find(".dasense_toggleBtn"),t=e.$me.find(".dasense_cont_main"),i="dasense_0009_closed";a.on("click",function(a){try{var d=e.$me.hasClass(i);return d?e.$me.removeClass(i):e.$me.addClass(i),t.animate({height:"toggle"}),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/dasense/dasense.js",method:"",ln:397}),a}})},initToggle:function(){var e=this,a=e.$me.find(".dasense_toggleBtn"),t=e.$me.find(".dasense_cont_main"),i="dasense_toggle_wrap_closed";a.on("click",function(a){try{var d=e.$me.hasClass(i);return d?e.$me.removeClass(i):e.$me.addClass(i),t.animate({height:"toggle"}),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/dasense/dasense.js",method:"",ln:414}),a}})},shutZhixin:function(){this.$me.hide()},track:function(e){if(document.images){var a=new Image;window["bd_pv_"+(new Date).getTime()]=a;var t="http://static.tieba.baidu.com/tb/img/track.gif?",i=[];e.hasOwnProperty("trackUrl")&&(t=e.trackUrl,delete e.trackUrl);for(var d in e)e.hasOwnProperty(d)&&i.push(d+"="+encodeURIComponent(e[d]));t+=i.join("&"),a.src=t+"&t="+(new Date).getTime(),a=null}}}});_.Module.define({path:"comforum/widget/wangmengFeedAd",sub:{initial:function(a){try{this.data=a;var e=this.data.id;$.JsLoadManager.use(["http://cbjs.baidu.com/js/m.js"],function(){var a=PageData.forum?PageData.forum.forum_id:0;BAIDU_CLB_addOrientation("tbid",a+""),BAIDU_CLB_fillSlotAsync(e,"BAIDU_CLB_AD_IFRAME_"+e)})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/wangmeng_feed_ad/wangmeng_feed_ad.js",method:"",ln:16}),t}}}});_.Module.define({path:"adsense/widget/loader",requires:["common/widget/messenger"],sub:{adStatus:{},initial:function(){this._initMessenger()},loadAD:function(e,a,t){var i=e.adData||{},n=e.className||"",d=e.asyncHTML||"",o=(e.isProxy||!1,e.isAsync||!1),s=e.isIframe||!1,r=e.needStats||!1;$.extend(i,{className:n}),"function"==typeof a&&(t=a,a={});var c=null;if(o?(c=$(d),this._renderDOM(i,c)):c=$("."+n),s){var _=$.getPageData("goods_info.0.iframe_url","",i),f=this._getIframeParams(i,a);this._loadIframe(c,_,f)}else o&&c.show();"function"==typeof t&&t(c),r&&this._clickStats(c,i),this._viewStats(c,i)},_renderDOM:function(e,a){$(e.locator).length>0?$(e.locator)[e.load_type](a):this._track(e.id+"\uFF1A\u65E0\u5B9A\u4F4D\u5143\u7D20","\u5E7F\u544A\u52A0\u8F7D\u5931\u8D25")},_getStatsParams:function(e){var a="",t=$.getPageData,i={client_type:"pc_web",task:"tbda",page:t("product",a).toLowerCase(),fid:t("forum.forum_id",a),tid:t("thread.thread_id",a),uid:t("user.user_id",a),da_task:"tbda",da_fid:t("forum.forum_id",a),da_tid:t("thread.thread_id",a),da_uid:t("user.user_id",a),da_page:t("product",a),da_type_id:e.typeid,da_obj_id:e.id,da_good_id:e.goods_info[0].id,da_obj_name:e.name,da_first_name:e.first_name,da_second_name:e.second_name,da_cpid:e.cpid,da_abtest:e.abtest,da_price:e.price,da_verify:e.verify,da_plan_id:e.plan_id,da_ext_info:e.ext_info,da_client_type:e.client_type};return i},_getIframeParams:function(e,a){var t,i,n,d="",o=$.getPageData,s={dapage:o("product",d).toUpperCase(),dafid:o("forum.forum_id",d),datid:o("thread.thread_id",d),dauid:o("user.user_id",d),datypeid:e.typeid,daid:e.id,dacssclass:e.className,dagoodid:e.goods_info[0].id,token:e.zhixin_token,daname:encodeURIComponent(e.name),dafirstname:encodeURIComponent(e.first_name),dasecondname:encodeURIComponent(e.second_name),dacpid:e.cpid,daabtest:e.abtest,daprice:e.price,daverify:e.verify,daextinfo:e.ext_info,daplanid:e.plan_id,daserid:e.user_id},r={},c={},_=e.goods_info[0].url_query;try{c=$.json.decode($.tb.unescapeHTML(_));for(t in c)if(c.hasOwnProperty(t))if("custom"!==t)for(i in c[t])c[t].hasOwnProperty(i)&&(n=c[t][i],r[n]=encodeURIComponent(o(t+"."+i)));else for(i in c[t])if(c[t].hasOwnProperty(i))switch(i){case"zhixintoken":n=c[t][i],r[n]=e.zhixintoken;break;case"forumNameGBK":n=c[t][i],r[n]=e.forumNameGBK}}catch(f){}return $.extend(!0,s,r||{},a||{}),s},_loadIframe:function(e,a,t){var i=this._addParam(a,t),n=e.find(".iframe_wrapper"),d='<iframe src="'+i+'" scrolling="no" frameborder="0"></iframe>';n.append(d)},_initMessenger:function(){var e=$.getPageData("adsense.messenger",null,window);e||(e=this.requireInstance("common/widget/messenger",["parent","checkStatus"]),e.registerOrigin(this._getMessengerWhitelist()),e.registerCommand({comforum_adsense:$.proxy(this._handleMessengerData,this)}),window.adsense={messenger:e})},_getMessengerWhitelist:function(){var e=0,a=[],t=PageUnit.load("dasense_messenger_whitelist"),i=t.length;for(e;i>e;e++)a.push(t[e][0]);return a},_handleMessengerData:function(e){var a=$('[data-daid="'+e.id+'"]'),t=a.find(".iframe_wrapper");"success"===e.status?(e.height<t.height()&&t.height(e.height),a.removeClass("hide_style").show()):a.hide()},_addParam:function(e,a){var t="",i=[],n=-1===e.indexOf("?")?"?":"&";for(var d in a)a.hasOwnProperty(d)&&i.push(d+"="+a[d]);return t=i.join("&"),e+n+t},_clickStats:function(e,a){var t=this,i=this._getStatsParams(a);e.on("click",".j_click_stats",function(){var e=a.pos_name+"_"+$(this).data("locate");t._track($.extend({},i,{locate:e,da_locate:e,type:"click",da_type:"click"})),t._track($.extend({},i,{locate:e,da_locate:e,type:"click",da_type:"click"}),"/billboard/pushlog/?")})},_viewStats:function(e,a){var t=this,i=!1,n=null,d=this._getStatsParams(a),o=function(){i||(t._track($.extend({},d,{locate:a.pos_name,da_locate:a.pos_name,type:"show",da_type:"show"})),t._track($.extend({},d,{da_locate:a.pos_name,da_type:"show"}),"/billboard/pushlog/?"),i=!0)},s=function(){var a=e.offset().top,t=e.offset().top+e.height(),i=$("body").scrollTop(),n=$(window).height()+i,d=!1;return(a>i&&n>=a||t>i&&n>=t)&&(d=!0),d};s()?o():$(window).on("scroll",function(){s()&&(clearTimeout(n),n=setTimeout(o,200))})},_track:function(e,a){if(document.images){var t=new Image;window["bd_pv_"+(new Date).getTime()]=t;var i=a||"http://static.tieba.baidu.com/tb/img/track.gif?",n=["t="+(new Date).getTime()];for(var d in e)e.hasOwnProperty(d)&&n.push(d+"="+encodeURIComponent(e[d]));t.src=i+n.join("&"),t=null}},loadCustomJS:function(e){var a=null;e.js&&(a=$.proxy(new Function("$e","PageData","window",e.js),{}))(e.dom,void 0,void 0)}}});_.Module.define({path:"pplatform/widget/InfoCollection",requires:["common/component/Placeholder"],sub:{initial:function(n){this.options=n,this.initDialogEvent()},initPlaceHolder:function(){this.requireInstanceAsync("common/component/Placeholder",[".j_info_collection_info","\u7B80\u8FF0\u60A8\u7684\u9700\u6C42..."]),this.requireInstanceAsync("common/component/Placeholder",[".j_info_collection_name","\u60A8\u7684\u59D3\u6C0F"]),this.requireInstanceAsync("common/component/Placeholder",[".j_info_collection_city","\u60A8\u7684\u57CE\u5E02"]),this.requireInstanceAsync("common/component/Placeholder",[".j_info_collection_phone","\u60A8\u7684\u624B\u673A"])},initDialogEvent:function(){var n=this;$(".info_collection_main").on("click",".j_info_collection_button, .j_info_collection_main_logo",function(){var o=baidu.template("info_collection_form",{}),i=new $.dialog({title:"",noTitle:!0,holderClassName:"info_collection_form",html:o,width:470});n.dialog=i,n.$main=$(i.getElement()),n.initCheckEvent(),n.initSubmitEvent(),n.initPlaceHolder()})},initSubmitEvent:function(){var n=this,o=n.$main;o.on("click",".j_info_collection_submit",function(i){i.preventDefault(),n.submitCheck()&&$.post("/gcf/consume/consumeCommit?ie=utf-8",{tbs:PageData.tbs,forum_name:PageData.forum.forum_name,forum_id:PageData.forum.forum_id,name:o.find(".j_info_collection_name").val(),info:o.find(".j_info_collection_info").val(),gender:o.find("input[name='gender']:checked").val(),city:o.find(".j_info_collection_city").val(),mobile_phone_number:o.find(".j_info_collection_phone").val(),start_time:n.options.start_time,end_time:n.options.end_time},function(o){if(0==o.no){var i=baidu.template("info_collection_success_dialog",{}),e=new $.dialog({title:"",noTitle:!0,holderClassName:"info_collection_success_dialog",html:i,width:410});$(e.element).on("onclose",function(){n.dialog.close()}),$(e.element).on("click",".j_success_button",function(n){n.preventDefault(),e.close()})}else 210009==o.no?n.alertInfo("\u4E0D\u662F\u5408\u6CD5\u7684\u624B\u673A\u53F7~"):2220013==o.no?n.alertInfo("\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u5019\u518D\u8BD5~"):n.alertInfo("\u64CD\u4F5C\u5F02\u5E38\uFF0C\u8BF7\u518D\u8BD5\u4E00\u4E0B~")},"json")})},submitCheck:function(){var n=this,o=n.$main.find(".j_info_collection_phone"),i=/^1\d{10}$/g,e=!0;return i.test(o.val())===!1?(o.addClass("error_hint"),o.siblings("p").css("display","block"),e=!1):(o.siblings("p").css("display","none"),o.removeClass("error_hint")),e},initCheckEvent:function(){var n=this,o=n.$main.find(".j_info_collection_phone"),i=/^1\d{10}$/g;o.on("focus",function(){$(this).removeClass("error_hint"),o.siblings("p").css("display","none")}),o.on("blur",function(){i.test(o.val())===!1&&($(this).addClass("error_hint"),o.siblings("p").css("display","block"))})},alertInfo:function(n){$.tb.alert({heading:"",message:"<h3 style='text-align:center;margin-bottom:40px'>"+n+"</h3>",noTitle:!0,buttons:[{text:"\u786E\u5B9A",callback:function(n,o){o.close()}}]})}}});_.Module.define({path:"comforum/widget/GameSpreadThread",_container:null,sub:{initial:function(t){this._container=$("#game_spread_thread_content_"+t),this._render(t),this._bindEvents(t)},_render:function(t){var e=PageUnit.load("forumListV3_game_spreads_swfs");if(e["l_"+t]&&e["l_"+t][0]){var a=e["l_"+t][0].split("|");new $.swf(a[0],{container:this._container,width:738,height:90});{$("<a />").tbattr({"class":"game_spread_anchor",href:a[1],target:"_blank"}).appendTo(this._container)}}},_bindEvents:function(t){var e=this,a=e._container.getData(),n=a.cookieId;$("#game_spread_thread_content_1").on("click",function(){$.stats.track("PB_\u7B2C\u4E00\u697C\u4E0B\u5C0F\u901A\u680F","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"})}),e._container.find("a").on("click",function(){e._stats(t,a,"\u70B9\u51FB"),n&&$.cookie(n,0,{expires:365})}),e._stats(t,a,"\u5C55\u73B0")},_stats:function(t,e,a){$.stats.track("\u4E0B"+t,"PB\u9875\u6E38\u620F\u7EDF\u8BA1","pb",a,{obj_id:e.id||"",obj_name:e.title||"",obj_url:e.pic||"",obj_type:e.type||"",obj_subtype:e.subtype||""})}}});_.Module.define({path:"comforum/widget/AdPost",sub:{initial:function(){}}});_.Module.define({path:"props/widget/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},s=null,n="",t=["1070002","1070001"],a=0;a<t.length;a++)if(s=e[t[a]],s&&s.num>0&&s.end_time>Env.server_time/1e3){n=this.options[t[a]];break}return n},showUI:function(i){var e=i.wrap,s="",n=null,t=i.key||this.getResidualKey(i);t&&(s="residual_wrap residual_wrap_"+t,n=e.find(".residual_wrap"),n[0]?n.removeClass().addClass(s):(n=$('<div class="'+s+'"></div>'),e.append(n)))}}});_.Module.define({path:"user/widget/SingleIcons",requires:["common/widget/Card"],sub:{_card:null,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;t._wrap.on("mouseenter",".j_singleforum_show",function(o){o.currentTarget===this&&t._buildCard(this)}).on("mouseleave",".j_singleforum_show",function(){return t._card&&t._card.closeCard(),t._card=null,!1})},_buildCard:function(t){var o=$(t),e=o.getData(),n=this;e&&$.post("/icon/getForumNameByForumId",{forum_id:e.forum_id,tbs:PageData.tbs,ie:"utf-8"}).success(function(t){0==t.no&&n._buildPop(o,t.data)})},_getAllForumName:function(t){var o=[];for(var e in t)t.hasOwnProperty(e)&&o.push(t[e].forum_name);return o.join(",")},_buildPop:function(t,o){var e=this,n=e._getAllForumName(o),i="\u53EA\u5728"+n+"\u5427\u5C55\u793A",r=t.offset().left-50+t.width()/2,a=t.offset().top-18-12;this._card=this.use("common/widget/Card",{content:i,card_css:{top:a,left:r,width:100},clazz:"single_icon_class",auto_positon:!1,event_target:t,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}});_.Module.define({path:"pb/widget/GameThreadRank",_container:null,sub:{initial:function(e){try{this.$wrapper=$("#game_thread_rank_wrapper"),this.$rank_banner=$("#game_thread_rank_banner"),this.$refresh_trigger=$("#game_thread_rank_refresh"),this.left_value=[0,450],this.game_id=e.thread_game_id||0,this._new_score=0,this._loadData(),this._bindEvents()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/game_thread_rank/game_thread_rank.js",method:"",ln:18}),a}},_bindEvents:function(){var e=this;this.$wrapper.on("click",".login_btn",function(){try{e.requireInstanceAsync("common/widget/LoginDialog",["","userBar"])}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/game_thread_rank/game_thread_rank.js",method:"",ln:24}),a}}).on("click",".play_btn",function(){try{e._playAgain()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/game_thread_rank/game_thread_rank.js",method:"",ln:27}),a}}),this.$rank_banner.on("click",".close_rank_banner",function(){try{e.$rank_banner.slideUp(),$.cookie("frs_game_rank_banner_hide",!0,{expires:1e3})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/game_thread_rank/game_thread_rank.js",method:"",ln:32}),a}}),this.$refresh_trigger.click($.proxy(this._loadNewData,this))},_playAgain:function(){$(".game_play .replay").click();var e=$(".game_play_wrapper").offset();$(window).scrollTop(e.top)},_loadNewData:function(){var e=this.$refresh_trigger.html();e&&(this._new_score=e,this.$refresh_trigger.html("")),this._loadData()},_loadData:function(){var e=this,a="/game/browse/playerRankList?game_id="+this.game_id+"&timestamp="+(new Date).getTime();this._new_score&&(a+="&score="+this._new_score),$.getJSON(a,function(a){var t=[],r=0;a&&"0"==a.no&&a.data&&a.data.rank_players&&a.data.rank_players.length>0&&(t=a.data.rank_players,r=a.data.my_score_percent),e._setRankContent(t),e._setScorePercent(r)})},_setRankContent:function(e){e=e||[];for(var a,t,r=this.$wrapper.find(".j_rank_player_name"),n=this.$wrapper.find(".j_game_score"),i=5,s={user_name:"----",score:"??"},_=0;i>_;_++)e[_]?(a=e[_].user_name||s.user_name,t=e[_].score||s.score):(a=s.user_name,t=s.score),$(r[_]).html(a),$(n[_]).html(t);if(e[0]&&e[0].portrait){var o="http://tb.himg.baidu.com/sys/portrait/item/"+e[0].portrait;this.$wrapper.find(".j_rank_img").tbattr("src",o)}},_setScorePercent:function(e){e=e||0,e>100?e=100:0>e&&(e=0);var a=(this.left_value[1]-this.left_value[0])*e/100+this.left_value[0];this.$wrapper.find(".my_score_wrapper").css({left:a}),this.$wrapper.find(".j_score_precent").html(e)}}});_.Module.define({path:"pb/widget/GameThreadRecommend",_container:null,sub:{_gameRecommendItemTmp:["<li>",'<a href="/p/#{thread_id}" target="_blank">','<div class="game_recommend_item">','<img src="#{game_icon}" alt="#{game_name}"/>',"</div>",'<span class="game_name">#{game_name}</span>',"</a>","</li>"].join(""),initial:function(e){try{this.thread_game_id=e.thread_game_id||0,this.tbs=e.tbs||"0",this._$container=$("#game_thread_recommend"),this._render()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/game_thread_recommend/game_thread_recommend.js",method:"",ln:25}),t}},_render:function(){var e=this,t="/game/browse/recommendList?timestamp="+(new Date).getTime();$.getJSON(t,function(t){var a=[];if(!t||"0"!=t.no)return $("#j_p_postlist .l_post").length>1&&$("#j_p_postlist .l_post:first").hide(),!1;a=t.data;for(var m="",n=0,i=a.length;i>n;n++)m+=$.tb.format(e._gameRecommendItemTmp,a[n]);m='<ul class="clearfix">'+m+"</ul>",e._$container.html(m)})}}});!function(t){function a(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=download");var e=t(a);return t.post("/data/filepost?method=update_file_statistic",{fs_id:e.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:0,tbs:PageData.tbs}),!0}return TbCom.process("User","buildLoginFrame"),!1}function e(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=forward");var e={31061:"\u6587\u4EF6\u5DF2\u5B58\u5728",31112:"\u767E\u5EA6\u4E91\u7A7A\u95F4\u4E0D\u8DB3&nbsp;<a href='http://pan.baidu.com' target='_blank'>\u6574\u7406\u7F51\u76D8</a> "},d=t(a);t.post("/data/filepost",{method:"archiveFile",src_uk:d.data("uk"),src_path:d.data("filePath"),dst_path:"/"+d.data("fileName"),tbs:PageData.tbs},function(a){var i;return a.status&&"-3"==a.status?(t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>\u64CD\u4F5C\u5931\u8D25\u4E86\uFF0C\u5237\u65B0\u4E00\u4E0B\u8BD5\u8BD5</div>",{width:300}),void 0):(a.error_code?(i=e[a.error_code],i||(i="\u8F6C\u5B58\u5931\u8D25"),t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>"+i+"</div>",{width:300})):d.hide().after("<a class='file_link' target='_blank' href='http://pan.baidu.com'>\u5DF2\u8F6C\u5B58</a>"),void 0)},"json"),t.post("/data/filepost?method=update_file_statistic",{fs_id:d.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:1,tbs:PageData.tbs})}else TbCom.process("User","buildLoginFrame");return!1}window.diskmanager={};var d=window.diskmanager;d.onClickDownload=a,d.onClickSaveToMine=e}(jQuery);_.Module.define({reward_dialog:' <div class="reward_dialog">     <div class="reward_row">     <div class="reward_row_title">\u793C\u7269\uFF1A</div>     <div class="reward_row_content">         <span class="reward_gift"></span>         <span class="reward_gift_title">\u9B54\u83C7</span>     </div>     </div>     <div class="reward_row">     <div class="reward_row_title">\u6570\u91CF\uFF1A</div>     <div class="reward_row_content">         <span data-num=1 class="reward_num_selector reward_num_selector_x j_num_selector">1\u4E2A</span>         <span data-num=9 class="reward_num_selector j_num_selector">9\u4E2A</span>         <span data-num=99 class="reward_num_selector j_num_selector">99\u4E2A</span>         <span data-num=999 class="reward_num_selector j_num_selector">999\u4E2A</span>         <span data-num=0 class="reward_num_selector j_num_selector"><input type="text" class="num_input j_num_input" placeholder="\u5176\u4ED6" />\u4E2A</span>     </div>     </div>     <% if(reward_text || reward_link){ %>     <div class="reward_row clearfix" style="height: auto;line-height: 1.5em;">         <div class="reward_row_title">&nbsp;</div>         <div class="reward_row_content">             <p ><%=reward_text%> <%:=reward_link%></p>         </div>     </div>     <% } %>     <div class="reward_row">     <div class="reward_row_title">\u9700\u8981T\u8C46\uFF1A</div>     <div class="reward_row_content">         <span class="reward_tdou j_reward_tdou">1000</span> T\u8C46     </div>     </div>      <div class="reward_row">     <div class="reward_row_title"></div>      <div class="reward_row_content">         <a class="ui_btn ui_btn_m reward_now j_reward_now">             <span>                 <em>\u7ACB\u5373\u6253\u8D4F</em>             </span>         </a>     </div>     </div>     <div class="error_tip  j_error_tip">         <div class="j_not_enough">T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u60A8\u76EE\u524D\u4EC5\u6709<%=score%>T\u8C46 &nbsp; &nbsp;         <a class="j_get_more_tdou" href="#">[\u83B7\u53D6T\u8C46]</a></div>         <div class="j_input_error">\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6253\u8D4F\u6570\u91CF\uFF0C\u4E0D\u5927\u4E8E10000</div>     </div> </div>',reward_success:' <div class="reward_dialog">     <div class="big_star"></div>     <div class="reward_success_text">\u5DF2\u6210\u529F\u6253\u8D4F\u697C\u4E3B<%=num%>\u4E2A\u9B54\u83C7</div>     <div class="success_btn_wrap">         <a class="ui_btn ui_btn_m j_close">             <span>                 <em>\u786E\u5B9A</em>             </span>         </a>     </div> </div>',reward_user:'<li><a class="j_reward_user" data-num="<%=num%>" data-user_name="<%=user_name%>" href="/home/main?id=<%=portrait%>" target="_blank">      <img src="http://tb.himg.baidu.com/sys/portrait/item/<%=portrait%>" />  </a></li>',path:"pb/widget/reward",requires:["common/widget/card","tbmall/widget/TbeanSafeAjax"],sub:{$wrap:$("#j_p_postlist, #j_core_title_wrap"),$reward_list:$(".j_reward_list"),card:null,score:PageData.user.Parr_scores&&PageData.user.Parr_scores.scores_total||0,REWARD_PRICE:1e3,BASE_NUM:1,ERROR:{CANNOT_REWARD_SELF:"\u4E0D\u80FD\u6253\u8D4F\u81EA\u5DF1",YOU_ARE_BLOCKED:"\u60A8\u5DF2\u88AB\u5C01\u7981\uFF0C\u4E0D\u80FD\u6253\u8D4F\u5662~",TDOU_NOT_ENOUGH:"T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5145\u503C\u540E\u518D\u8BD5",SYSTEM_ERROR:"\u670D\u52A1\u5668\u51FA\u9519\u4E86\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"},initial:function(e){try{if(Page.checkLoadedModules("reward"))return;this.author_id=e.author_id,this.star_count=parseInt(e.star_count),this.REWARD_PRICE=parseInt(e.reward_price),this.$star_count=$(".j_reward_star_count"),this.tbeanAjax=this.requireInstance("tbmall/widget/TbeanSafeAjax"),this.reward_text=PageUnit.load("reward_dialog_text"),this.reward_link=PageUnit.load("reward_dialog_link"),this.bindEvents()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/reward/reward.js",method:"",ln:44}),a}},bindEvents:function(){var e=this;this.$wrap.on("click",".j_reward_btn",function(){try{PageData.user.is_login?PageData.user.user_id==e.author_id?e.showErrorDialog(e.ERROR.CANNOT_REWARD_SELF):PageData.user.is_block?e.showErrorDialog(e.ERROR.YOU_ARE_BLOCKED):e.showRewardDialog():e.requireInstanceAsync("common/widget/LoginDialog")}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/reward/reward.js",method:"",ln:64}),a}}),this.$wrap.on("mouseenter",".j_reward_user",function(){var a=$(this).data("num"),r=$(this).data("user_name");e.card&&e.card.closeCard(),e.card=null,e.card=e.requireInstance("common/widget/card",{event_target:$(this),auto_positon:!0,arrow_dir:"down",card_css:{width:230},content:'<p style="padding: 10px; text-align: center;">'+r+"\u6253\u8D4F\u4E86\u697C\u4E3B"+a+"\u4E2A\u9B54\u83C7</p>"}),e.card.showCard()}).on("mouseleave",".j_reward_user",function(){e.card&&e.card.closeCard(),e.card=null})},addRewardRecord:function(e){var a=this.$reward_list.find("[data-user_name="+e.user_name+"]");a.length>0?a.data("num",a.data("num")+e.num):a=baidu.template('<li><a class="j_reward_user" data-num="<%=num%>" data-user_name="<%=user_name%>" href="/home/main?id=<%=portrait%>" target="_blank">      <img src="http://tb.himg.baidu.com/sys/portrait/item/<%=portrait%>" />  </a></li>',e),this.$reward_list&&this.$reward_list.prepend(a)},showErrorDialog:function(e){new $.dialog({html:'<p style="margin:20px;text-align: center;">'+e+"</p>",width:348,title:"\u6253\u8D4F\u697C\u4E3B"})},showRewardDialog:function(){var e=this,a=1,r=baidu.template(' <div class="reward_dialog">     <div class="reward_row">     <div class="reward_row_title">\u793C\u7269\uFF1A</div>     <div class="reward_row_content">         <span class="reward_gift"></span>         <span class="reward_gift_title">\u9B54\u83C7</span>     </div>     </div>     <div class="reward_row">     <div class="reward_row_title">\u6570\u91CF\uFF1A</div>     <div class="reward_row_content">         <span data-num=1 class="reward_num_selector reward_num_selector_x j_num_selector">1\u4E2A</span>         <span data-num=9 class="reward_num_selector j_num_selector">9\u4E2A</span>         <span data-num=99 class="reward_num_selector j_num_selector">99\u4E2A</span>         <span data-num=999 class="reward_num_selector j_num_selector">999\u4E2A</span>         <span data-num=0 class="reward_num_selector j_num_selector"><input type="text" class="num_input j_num_input" placeholder="\u5176\u4ED6" />\u4E2A</span>     </div>     </div>     <% if(reward_text || reward_link){ %>     <div class="reward_row clearfix" style="height: auto;line-height: 1.5em;">         <div class="reward_row_title">&nbsp;</div>         <div class="reward_row_content">             <p ><%=reward_text%> <%:=reward_link%></p>         </div>     </div>     <% } %>     <div class="reward_row">     <div class="reward_row_title">\u9700\u8981T\u8C46\uFF1A</div>     <div class="reward_row_content">         <span class="reward_tdou j_reward_tdou">1000</span> T\u8C46     </div>     </div>      <div class="reward_row">     <div class="reward_row_title"></div>      <div class="reward_row_content">         <a class="ui_btn ui_btn_m reward_now j_reward_now">             <span>                 <em>\u7ACB\u5373\u6253\u8D4F</em>             </span>         </a>     </div>     </div>     <div class="error_tip  j_error_tip">         <div class="j_not_enough">T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u60A8\u76EE\u524D\u4EC5\u6709<%=score%>T\u8C46 &nbsp; &nbsp;         <a class="j_get_more_tdou" href="#">[\u83B7\u53D6T\u8C46]</a></div>         <div class="j_input_error">\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6253\u8D4F\u6570\u91CF\uFF0C\u4E0D\u5927\u4E8E10000</div>     </div> </div>',{score:this.score,reward_link:this.reward_link,reward_text:this.reward_text});this.dialog=new $.dialog({html:r,title:"\u6253\u8D4F\u697C\u4E3B",width:548}),this.dialog.element.on("click",".j_num_selector",function(){try{$(this).addClass("reward_num_selector_x").siblings().removeClass("reward_num_selector_x"),a=$(this).data("num"),e.checkTdouNeeded(a)}catch(r){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:r.message||r.description,path:"pb:widget/reward/reward.js",method:"",ln:125}),r}}),this.dialog.element.find(".j_num_input").on("propertychange input",function(){if($(this).parent().hasClass("reward_num_selector_x")){var r=$(this).val(),t=/^[1-9]\d*$/g;a=t.test(r)&&1e4>=r?r:0,$(this).parent().data("num",a),e.checkTdouNeeded(a)}}),this.dialog.element.find(".j_get_more_tdou").click(function(){try{return e.requireInstanceAsync("common/widget/TchargeDialog"),e.dialog.close(),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/reward/reward.js",method:"",ln:149}),a}}),this.dialog.element.on("click",".j_reward_now",function(){try{var r=$(this);if($(this).data("clicked"))return!1;$(this).data("clicked",!0),e.tbeanAjax.post("/tbmall/sdou/reward",{thread_id:PageData.thread.thread_id,author_id:e.author_id,gift_num:a,forum_id:PageData.forum.forum_id,tbs:PageData.tbs},function(t){r.data("clicked",!1),e.dialog&&e.dialog.close(),0==t.no?(e.showSuccessDialog(a),e.addRewardRecord({num:a,portrait:PageData.user.portrait,user_name:PageData.user.user_name}),e.star_count+=parseInt(a),e.star_count-a>0&&e.$star_count.text(e.star_count)):220012==t.no?e.showErrorDialog(e.ERROR.YOU_ARE_BLOCKED):1989006==t.no?e.showErrorDialog(e.YOU_ARE_BLOCKED):2270005==t.no?e.showErrorDialog(e.TDOU_NOT_ENOUGH):e.showErrorDialog(e.ERROR.SYSTEM_ERROR)})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/reward/reward.js",method:"",ln:192}),t}}),this.checkTdouNeeded(this.BASE_NUM)},checkTdouNeeded:function(e){var a=this.dialog.element.find(".j_reward_tdou"),r=this.dialog.element.find(".reward_now"),t=this.dialog.element.find(".j_error_tip"),s=e*this.REWARD_PRICE;a.text(s),this.score<s||1>e?(r.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn_m ui_btn j_reward_now"),t.show(),this.score<s?t.find(".j_not_enough").show().siblings().hide():t.find(".j_input_error").show().siblings().hide()):(r.removeClass("ui_btn_disable ui_btn_m_disable").addClass("ui_btn_m ui_btn j_reward_now"),t.hide())},showSuccessDialog:function(e){var a=new $.dialog({html:baidu.template(' <div class="reward_dialog">     <div class="big_star"></div>     <div class="reward_success_text">\u5DF2\u6210\u529F\u6253\u8D4F\u697C\u4E3B<%=num%>\u4E2A\u9B54\u83C7</div>     <div class="success_btn_wrap">         <a class="ui_btn ui_btn_m j_close">             <span>                 <em>\u786E\u5B9A</em>             </span>         </a>     </div> </div>',{num:e}),title:"\u6253\u8D4F\u697C\u4E3B",width:548});a.element.find(".j_close").on("click",function(){try{a.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/reward/reward.js",method:"",ln:229}),e}}),a.bind("onclose",function(){$.tb.location.reload()})}}});_.Module.define({path:"props/component/PropsApi",requires:["common/component/JsPager"],sub:{initial:function(t){this.dataObj=t,this.initOptions(),this.bindEvents()},initOptions:function(){this.titleMap={"1070001_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070001_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070002_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D","1070002_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D"},this.urlMap={0:"/tbmall/getUserAppraise",1:"/tbmall/getPostAppraise"}},bindEvents:function(){var t=this,i=t.dataObj;$(".props_item_tail").live("click",function(){return t.propsData={props_id:$(this).data("propsid"),props_type:i.props_type},"0"==i.props_type&&(t.propsData.user_id=$(this).data("userid"),t.propsData.user_sex=$(this).data("usersex")),"1"==i.props_type&&(t.propsData.post_id=$(this).data("postid")),t.initPager=!0,t.showDialog(),!1})},getAttrsHtml:function(t){for(var i=null,s=[],a="",p=["user_id","user_sex","post_id","props_id"],e=0;e<p.length;e++)i=p[e],t[i]&&(a="data-"+i.replace(/_/,"")+'="'+t[i]+'"',s.push(a));return s.join(" ")},showUIHtml:function(t){for(var i=[],s=t.props||{},a=null,p=0,e=["1070001","1070002"],r=0;r<e.length;r++)t.props_id=e[r],a=s[e[r]],a&&(i.push('<li class="props_item_split"><span class="userinfo_split"></span></li>'),i.push('<li class="props_item props_item_'+e[r]+'">'),i.push('<a href="#" '+this.getAttrsHtml(t)+' class="props_item_tail">'),i.push('<span class="props_item_icon"></span>'),i.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),i.push('<span class="props_item_num">'+a.num+"</span></li>"),i.push("</a>"),p++);return 0>p?"":i.join("")},showUI:function(t){var i=this.showUIHtml(t);i&&t.wrap.html(i)},showDialog:function(){this.initDialogData(),this.initDialogUI(),this.showOrUpdateList()},initDialogData:function(){var t=this.propsData,i=t.props_id+"_"+t.props_type,s=this.titleMap[i];if(t.user_id!==PageData.user.id){var a=t.user_sex;s=s.replace(/\u6211/,a)}this.dialogTitle=s,this.dataurl=this.urlMap[t.props_type],this.pn=0,this.pageSize=10,this.pageCount=8},initDialogUI:function(){var t=this;this.$wrap=$('<div class="props_userlist_wrap"></div>'),this.$userlist=$('<div class="props_userlist_main"></div>'),this.$wrap.append(this.$userlist),this.dialog=new $.dialog({title:t.dialogTitle,width:554,height:340,show:!1,html:this.$wrap})},showOrUpdateList:function(){var t=this,i=t.propsData,s={props_id:i.props_id,look_user_id:i.user_id||"",post_id:i.post_id||"",pn:t.pn,c:t.pageSize};$.tb.get(t.dataurl,s,function(i){i&&0==i.no?(t.list=i.data.list,t.updateList(),t.initPager&&i.data.total>1&&(t.initPager=!1,t.total=Math.ceil(i.data.total/t.pageSize),t.buildPager()),t.dialog.show()):t.showErrorDialog()})},showErrorDialog:function(){new $.dialog({title:"\u63D0\u793A",width:300,height:50,html:'<p style="text-align:center;font-size:14px;line-height:40px;">\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5</p>'})},buildPager:function(){var t=$('<div class="props_userlist_pager"></div>');this.$wrap.append(t);var i=this,s=this.use("common/component/JsPager",{container:t,current:1,amount:i.pageCount,total:i.total});s.bind("pageChange",function(t,a){s.initial({current:a}),i.pn=a,i.showOrUpdateList()}),this.pager=s},updateList:function(){var t=this.list,i=[],s=null;i.push('<ul class="props_userlist">');for(var a=0;a<t.length;a++)s=t[a],i.push('<li class="userlist_item">'),i.push('<a class="userlist_head" href="/home/main?id='+s.portrait+'&fr=props" target="_blank"><img src="http://tb.himg.baidu.com/sys/portrait/item/'+s.portrait+'"/></a>'),i.push('<a class="userlist_name" href="/home/main?id='+s.portrait+'&fr=props" target="_blank">'+s.user_name+"</a>"),i.push('<p class="userlist_time">'+this.getShowtime(s.create_time)+"</p>"),i.push("</li>");i.push("</ul>"),this.$userlist.html(i.join(""))},getShowtime:function(t){t*=1e3;var i=new Date($.dateFormat(new Date(Env.server_time),"yyyy-MM-dd 00:00:00")).getTime();return t=t>i?$.dateFormat(new Date(t),"HH:mm"):$.dateFormat(new Date(t),"yyyy-MM-dd")}}});_.Module.define({path:"pb/widget/sub_list/postTail",requires:["props/component/PropsApi"],sub:{thread:{},power:{},initial:function(a){try{this.tailList=a.tailList,this.thread=PageData.thread,this.power=PageData.power,this.user=PageData.user,this.tailList=a.tailList,this.isLocal58=a.isLocal58,this.propsapi=this.use("props/component/PropsApi",{props_type:"1"})}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/sub_list/post_tail.js",method:"",ln:20}),s}},getPostTailTpl:function(a,s){var t='<div class="core_reply_tail '+(a.is_saveface?"save_card_reply_tail":"")+(a.is_reward?" reward_reply_tail ":"")+'">';return this.isLocal58||(t+=1==a.post_no?'<ul class="p_reply"><li><a href="#" class="p_reply_first">\u56DE\u590D</a></li></ul>':["<div class=\"j_lzl_r p_reply\" data-field=\"{'pid':'"+a.post_id+"','total_num':'"+a.comment_num+"'}\">",'<a href="#" class="lzl_link_unfold" style="display:'+(a.comment_num>0?"none":"")+';">\u56DE\u590D',a.comment_num>0?"("+a.comment_num+")":"","</a>",'<span class="lzl_link_fold" style="display:'+(a.comment_num>0?"":"none")+'">\u6536\u8D77\u56DE\u590D</span>',"</div>"].join("")),t+='<ul class="p_tail">'+this.showFloorNumAndDate(a)+"</ul>",t+=this.isLocal58?'<ul class="p_58cp"><li><a class="j_58_cp" href="#" onclick="return false;">\u6295\u8BC9</a></li></ul>':['<ul class="p_mtail">',this.getJubaoHtml(a,s,1),this.showTail(a),this.loadAdmin(a,s),"</ul>"].join(""),this.power.can_op_as_4thmgr&&(t+='<ul class="p_print_flower"><li data-uid="'+s.user_id+'" data-pid="'+a.post_id+'" class="print_reward j_print_reward">\u5370\u82B1\u5956\u52B1 <span class="print_seperator">|</span></li></ul>'),t+='<ul class="p_props_tail props_appraise_wrap">',t+=this.propsapi.showUIHtml({props:a.props||{},post_id:a.post_id}),t+="</ul>",t+=this.showMallTail(a),t+="</div>"},showFloorNumAndDate:function(a){var s=a.post_no+"\u697C",t="";return t+="1"==this.thread.thread_type?'<li class="lzl_time">'+s+"</li>":"<li><span>"+s+"</span></li>",t+="<li><span>"+a.date+"</span></li>"},getJubaoHtml:function(a,s){var t="",l=this.thread,i=this.power,e=this.user;if(!(1==l.thread_type&&1==a.post_no||(i.can_mask_delete||i.lz_del)&&1!=a.post_no)){var p=i.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5";if(e.user_id!=s.user_id||a.is_anonym){var n="window.open('http://tieba.baidu.com/complaint/info?type={type}&cid=0&tid="+l.thread_id+"&pid="+a.post_id+"','newwindow', 'height=900, width=800, toolbar =no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no');return false;";t='<li class="j_jb_ele"><a href="#" onclick="'+n.replace("{type}",0)+'" class="complaint complaint-opened" data-checkun="un">'+p+'</a>&nbsp;|<span class="super_jubao" style="display:none"><a href="#" onclick="'+n.replace("{type}",1)+'">\u4E2A\u4EBA\u4F01\u4E1A\u4E3E\u62A5</a><a href="#" onclick="'+n.replace("{type}",2)+'">\u5783\u573E\u4FE1\u606F\u4E3E\u62A5</a></span></li>'}else{var _="{'delete_mine':'1','index':'2','user_name':'"+s.user_name+"'}";p="\u5220\u9664",t='<li class="j_jb_ele"><a href="#" data-field='+_+' class="jb_in p_post_del_my post_del_href" data-checkun="un">'+p+"</a>&nbsp;|</li>"}}return t},showTail:function(a){var s=a.open_id,t=a.open_type,l=this.tailList,i={1:"1",4:"1",5:"1",6:"1",youliao:"1"};"wap"!==s||i.openType||"sharexc"==t||"webipad"==t||(t="phone");var e=s+"_"+t,p=l[e]?l[e]:[],n=p[0],_=p[1],o=p[2],r="";return n&&(r="xiangce"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':"shenqi"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':_&&o?'<li><span class="p_tail_txt">\u6765\u81EA</span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_wap" href="'+_+'" target="_blank">'+n+"</a></li>":_?'<li><span class="p_tail_txt">\u6765\u81EA</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+"</a></li>":o?'<li><span class="p_tail_txt"></span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_font"  >\u672C\u697C\u542B\u6709'+n+"</a></li>":'<li><span class="p_tail_txt">\u6765\u81EA</span>'+n+"</li>"),r},loadAdmin:function(a,s){var t=this.power,l=this.user,i="",e="&nbsp;|",t=this.power,l=this.user;return a.is_anonym?t.can_filter_ip&&(i+='<li><a class="p_post_ban_anonym" href="#">\u5C01</a>'+e+"</li>"):t.can_filter_id&&(i+='<li><a class="p_post_ban" href="#">\u5C01</a>'+e+"</li>"),1!=a.post_no&&(t.can_mask_delete||t.lz_del&&!l.forbidden.isForbid&&!l.is_black)&&(i+='<li><a class="p_post_del" href="#">\u5220\u9664</a>'+e+"</li>"),t.can_super&&!a.is_anonym&&(i+='<li><a class="p_tieba_manage" href="/f?ct=503316480&cm=6000&tn=bdUserManager&un='+encodeURIComponent(s.user_name)+'" target="_blank">\u8D34\u5427\u7BA1\u7406</a>&nbsp;|</li>'),i},showMallTail:function(a){var s="",t={1019001:"1",1019002:"1",1019003:"1",1049001:"1",1049002:"1",1049003:"1"};return(a.is_bub||a.ptype&&7==a.ptype.length&&!t[a.ptype])&&(s='<a href="/tbmall/home" class="p_mall_tail" target="_blank"></a>'),s}}});
;_.Module.define({path:"pb/widget/postList/Lzl",requires:["pb/widget/Admin","user/widget/Icons"],sub:{editor_entry:null,_reach_limit:!1,_new_reply_num:0,initial:function(t){try{if(Page.checkLoadedModules("lzlHasLoad"))return;this.postJdom=t,this.wapperDOM=$("#j_p_postlist"),this.icons=this.use("user/widget/Icons"),this._admin=this.use("pb/widget/Admin"),this._init()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:29}),e}},_init:function(){this._showJubao(),this._bindEditorEntry(),this._bindFoldClick(),this._bindClick()},_showLzlJubao:function(t){if(!PageData.power.can_mask_delete&&!PageData.power.lz_del){var e,e=(PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",t.find("li.j_lzl_s_p"));e.each(function(){var t=$(this).find("a").filter(function(){return $(this).tbattr("username")}).tbattr("username"),e="";if(PageData.user.user_name==t)var i="\u5220\u9664",e="{'delete_mine': 1, 'user_name' : '"+t+"'}",l='<a href="#" class="lzl_jb_in" data-field="'+e+'">'+i+"</a>&nbsp;|&nbsp;";else{var o=$(this).data("field");if(o)var i=PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",a="",l='<a href="#" class="lzl_jb_in" onclick="'+a.replace("{type}",0)+'">'+i+"</a>&nbsp;|&nbsp;";else l=""}$(this).find(".lzl_jb").html(l)})}},_bindFoldClick:function(){var t=this;this.wapperDOM.delegate(".lzl_link_unfold","click",function(e){try{var i=e.srcElement||e.target;return PageData.user.is_login?(t._loadLzlContent($(i)),t._unfoldLzl($(i))):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_reply"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:84}),e}}).delegate(".lzl_link_fold","click",function(e){try{var i=e.srcElement||e.target;t._foldLzl($(i))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:87}),e}})},_loadLzlContent:function(t){var e=t.parents(".l_post");LzlEditor.cur_optdom.postJdom=e;e.find(".j_lazy_lzl");LzlEditor.cur_optdom.jdom=e.find(".j_lzl_wrapper"),LzlEditor.cur_optdom.mainDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_container"),LzlEditor.cur_optdom.tailDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_r"),LzlEditor.cur_optdom.mainData=LzlEditor.cur_optdom.mainDom.getData(),LzlEditor.cur_optdom.tailData=LzlEditor.cur_optdom.tailDom.getData(),AntiAnswerLzl=new CaptchaReqCom({forumName:PageData.forum.name_url,forumId:PageData.forum.forum_id,tid:PageData.thread.thread_id,postType:"reply"})},_updateReplyNum:function(t){var e=0;if(t)e=t;else{this._new_reply_num++;var e=1*this.mainData.total_num+this._new_reply_num}this.tailDom.find("a.lzl_link_unfold").html("\u56DE\u590D("+e+")")},_foldLzl:function(t){var e=t.parents(".l_post").find(".j_lzl_container");if(LzlEditor.cur_sec){var i=LzlEditor.cur_sec;i.find("span.close").click(),LzlEditor._s_p._ie6RelativeHack()}e.slideUp("normal",function(){t.hide(),t.parent().find("a.lzl_link_unfold").show()})},_unfoldLzl:function(t){var e=this;if(e.target=t,t.hide(),t.parent().find("span.lzl_link_fold").show(),LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid){var i="";LzlEditor._s_p._se&&(i=LzlEditor._s_p._se.getContent()),LzlEditor._lzl=null,LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor.init(e),LzlEditor._s_p._se&&LzlEditor._s_p._se.ready(function(){LzlEditor._s_p._se.execCommand("inserthtml",i)}),LzlEditor._s_p._ie6RelativeHack(),CaptchaLzl&&!CaptchaLzl.needUpdate&&CaptchaLzl.reload(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover()})}else LzlEditor.init(e),LzlEditor._s_p._ie6RelativeHack(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover()});LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_unfold")},_showJubao:function(){this.wapperDOM.delegate(".j_lzl_s_p","mouseover",function(){$(this).find(".lzl_jb").show()}).delegate(".j_lzl_s_p","mouseout",function(){$(this).find(".lzl_jb").hide()})},asyncImage:function(t,e){var i=t.find("img."+e);return 0==i.length?!1:($.each(i,function(t,e){e.src=e.getAttribute("data-passive")||e.getAttribute("src")}),void 0)},_bindClick:function(){var t=this;this.wapperDOM.delegate(".j_lzl_m","click",function(){try{if(PageData.user.is_login){var e=$(this).parents(".j_lzl_m_w");return t.asyncImage($("#"+$(this).tbattr("lzlid")),"forasync"),e.find(".lzl_post_hidden").slideDown(),e.find(".j_pager").show(),e.find(".lzl_more").hide(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_more"),!1}return _.Module.use("common/component/force_login",["","userbar","dialog","pb_lzl_more"]),!1}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:227}),i}}).delegate(".lzl_s_r","click",function(e){try{var i=e.target||e.srcElement;return PageData.user.is_login?(t._loadLzlContent($(i)),t._fastReply($(i)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus()):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_interact"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:241}),e}}).delegate(".j_pager","click",function(e){try{if("A"==e.target.tagName){window.global&&"function"==typeof window.global.shieldPost&&window.global.shieldPost();var i=$(e.target),l=$.tb.unescapeHTML(i.tbattr("index"));if(!l){var o=$.tb.unescapeHTML(i.tbattr("href")).split("#");l=parseInt(o[1])}return t.mainDom=i.parents(".j_lzl_container"),t.mainData=t.mainDom.getData(),t.postJdom=i.parents(".l_post"),t._turnPage(t,l,i.parents(".core_reply_content")),!1}}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:259}),a}})},_bindEditorEntry:function(){var t=this;t.wapperDOM.delegate("p.j_lzl_p","click",function(){try{return t.editor_entry=$(this),PageData.user.is_login?(LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid&&"none"!=LzlEditor.cur_sec.css("display")?LzlEditor._s_p._getHtml()?LzlEditor._s_p._se.setContent(""):LzlEditor._hide():(t._loadLzlContent($(this)),LzlEditor.init(t)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1):(TbCom.process("User","buildLoginFrame",null,null,null,"too_reply"),!1)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:290}),e}})},_fastReply:function(t){var e=t.parents(".j_lzl_s_p"),i=e.getData(),l="\u56DE\u590D&nbsp;"+i.user_name+"&nbsp;:";LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid?LzlEditor._s_p._se&&(LzlEditor._s_p._se.$body.html(""),LzlEditor._show(),LzlEditor._s_p._se.execCommand("inserthtml",l)):(LzlEditor.init(this),LzlEditor._s_p._se&&LzlEditor._s_p._se.execCommand("inserthtml",l)),LzlEditor._s_p._setData(i)},_turnPage:function(t,e,i){var l=new Date;l=l.getTime(),$.ajax({url:"/p/comment",data:{tid:PageData.thread.thread_id,pid:t.mainData.pid,pn:e,t:l},dataType:"html",success:function(e){t._ajaxSucc(e,i),$.tb.location.setHash("noExistHash"),$.tb.location.setHash(t.mainData.pid+"l")},error:function(e){t._ajaxErr(e)}})},_ajaxSucc:function(t,e){var i=this;if(t&&t.length>200){var l=$(t);l.find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}),l.find(".voice_player_desc").remove(),this.mainDom.find("ul.j_lzl_m_w").html(l),i._showLzlJubao(e),this._admin.loadLzlAdmin(e),l.find(".lzl_cnt").each(function(){var t=$(this),e=t.getData().iconArr,l=t.getData().free_flag,o=e?i.icons.getPreIconHtml(e,l):"";t.prepend(o)}),$.browser.msie&&$.browser.version<=7&&this.postJdom.tbattr("class",$.tb.unescapeHTML(this.postJdom.tbattr("class")))}else{var o='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',a=$.dialog.alert(o,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});a.bind("onclose",function(){return!0})}},_ajaxErr:function(){var t='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',e=$.dialog.alert(t,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});e.bind("onclose",function(){return!0})}}});
;var LzlEditor={_lzl:null,default_options:{autoFocus:!0,autoEnable:!0,height:"40px",width:"527px",maxHeight:"40",wrapperClassName:"lzl_simple_wrapper",enableRefer:!0},options:{},cur_sec:null,cur_optdom:{},_s_p:null,init:function(i,l){LzlEditor.options={},$.extend(LzlEditor.options,LzlEditor.default_options),l&&$.extend(LzlEditor.options,l),LzlEditor._buildEditor(i)},_buildEditor:function(i){if(LzlEditor._lzl){if(LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid)return LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec.show(),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1;var l=LzlEditor.cur_sec;l.find("span.close").click();var t=l.find(".tb-editor-editarea");t[0]&&t.html().length>0&&l.bindData({txt:t.html()}),LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor._s_p=null;var o=LzlEditor._lzl.mainDom.find("li.j_lzl_s_p");0==o.length&&(LzlEditor._lzl.tailDom.find(".lzl_link_fold").hide(),LzlEditor._lzl.tailDom.find(".lzl_link_unfold").show(),LzlEditor._lzl.mainDom.hide())}LzlEditor._lzl=i,$.extend(LzlEditor._lzl,LzlEditor.cur_optdom);var l=i.jdom.find("div.j_lzl_e_c"),e=PageData.thread.topic;LzlEditor.cur_sec=l;var r=$.extend({container:l[0],uid:PageData.user.user_id},LzlEditor.options);LzlEditor._lzl._reach_limit=LzlEditor._limitCheck()||LzlEditor._lzl._reach_limit?!0:!1;var d={_can_post:PageData.power.can_post,_forum_type:PageData.forum_type,_no_un:PageData.user.no_un,_is_block:PageData.user.forbidden.isForbid?!0:!1,_reach_limit:LzlEditor._lzl._reach_limit,_login:PageData.user.is_login,_thread_topic_type:e.is_topic?"1":"0",_thread_topic_subtype:e.is_topic&&"2"==e.topic_type?"3":"0",data:LzlEditor._lzl.mainData,tpl_id:"j_simpleeditor_tpl"};_.Module.use("common/widget/SimplePoster",{op:d,edOp:r},function(i){i.bind("toTop",function(){$(window).scrollTop(0)},!0),i.bind("onsuccess",function(){LzlPostor._appendNew()},!0),i.bind("onclose",function(){LzlEditor._lzl._updateReplyNum(2e4),LzlEditor._lzl._reach_limit=!0,LzlEditor.init(LzlEditor._lzl)},!0),i.bind("hide",function(){LzlEditor._hide()},!0),LzlEditor._s_p=i});var n=l.getData();if(null!=n){var t=l.find(".tb-editor-editarea");t.html(n.txt)}LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),l.show(),l.parent().find("input.j_lzl_e_f_h").show().focus().hide()},_limitCheck:function(){var i=!1,l=LzlEditor._lzl.jdom.find("li.j_lzl_l_p");if(0==l.length)return i;var t=l.getData();return t.total_num>=2e4&&(i=!0),i},_hide:function(){LzlEditor.cur_sec&&(LzlEditor.cur_sec.find("span.close").click(),LzlEditor.cur_sec.hide()),LzlEditor._lzl&&LzlEditor._lzl.editor_entry&&LzlEditor._lzl.editor_entry.show()},_show:function(){LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec&&LzlEditor.cur_sec.show()}};
;var LzlPostor={_appendNew:function(){var e=LzlEditor._lzl.jdom.find("ul.j_lzl_m_w");if(0==e.length){var a=LzlEditor._lzl.jdom.find("div.j_lzl_c_b_a");a.prepend($('<div class="lzl_big_splitline"></div>')),e=$('<ul class="j_lzl_m_w"></ul>'),a.prepend(e)}e.show();var t=$('<li class="lzl_single_post j_lzl_s_p"></li>');t.bindData({user_name:PageData.user.user_name});var l=$.tb.dataField({un:PageData.user.user_name}),s=' username="'+PageData.user.user_name+'"'+l,i="/home/main/?un="+encodeURIComponent(PageData.user.user_name)+"&fr=pb&ie=utf-8",r="";r+='<div class="lzl_p_p">',r+='  <a class="j_user_card" href="'+i+'" '+s+'><img src="http://tb.himg.baidu.com/sys/portrait/item/'+PageData.user.portrait+'" style="visibility:hidden;" onload="Page.resizePic(this, 32, 32, true);"/></a>',r+="</div>",r+='<div class="lzl_cnt">',_.Module.use("user/widget/Icons",null,function(e){r+=e.getPreIconHtml(PageData.user.mParr_props,PageData.user.free_flag)}),r+='  <a class="at j_user_card" href="'+i+'" '+s+">"+("1"==PageData.user.is_verify?PageData.user.user_nickname:PageData.user.user_name)+"</a>",r+="1"==PageData.user.is_verify?'<img style="vertical-align: middle;margin-top: -3px;" src="http://tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B98\u65B9\u8BA4\u8BC1" width="11" height="18" class="verified_icon">':"",r+='   :<span class="lzl_content_main">',r+=LzlEditor._s_p._getHtml(),r+="    </span>",r+='  <div class="lzl_content_reply">',r+='    <span class="lzl_time">'+LzlPostor.getCurrentTime()+"</span>",r+='    <a href="#" class="lzl_s_r">\u56DE\u590D</a>',r+="  </div>",r+="</div>",t.html(r),t.insertBefore(e.find("li.j_lzl_l_p")),LzlEditor._lzl._updateReplyNum()},getCurrentTime:function(){function e(e){return 10>1*e?"0"+e:e}var a=new Date,t="";return t+=a.getFullYear()+"-",t+=a.getMonth()+1+"-",t+=a.getDate()+"&nbsp;",t+=e(a.getHours())+":",t+=e(a.getMinutes())}},AntiAnswerLzl,CaptchaLzl;
;_.Module.define({path:"pb/widget/sub_list/subListTotal",requires:["user/widget/pbUserBase","user/widget/Icons","pb/widget/sub_list/postTail","common/component/JsPager","props/component/PropsApi"],sub:{initial:function(e){try{this._searchCid=e.searchCid,this._commentList=e.commentData.comment_list,this._userList=e.commentData.user_list,this._icons=this.requireInstance("user/widget/Icons"),this._user=this.requireInstance("user/widget/pbUserBase"),this.propsapi=this.requireInstance("props/component/PropsApi",[{props_type:"1"}])}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/sub_list/sub_list_total.js",method:"",ln:26}),s}},showLzlPost:function(e){var s=this,t=$(e),n=t.closest(".l_post").getData().content;0==n.comment_num&&t.hide(),t.bindData({pid:n.post_id,floor_num:n.post_no,total_num:n.comment_num}).html(s._getSubContent(n)).css("minHeight",0);var i=n,a=this.propsapi.showUIHtml({props:i.props||{},post_id:i.post_id});t.closest(".j_lzl_wrapper").find(".props_appraise_wrap").html(a),t.closest(".j_lzl_wrapper").find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)})},_getSubContent:function(e){var s=e.comment_num>0?"":"none";e.page={total_page:Math.floor((e.comment_num-1)/10)+1,cur_page:1};var t=['<div class="core_reply_border_top"></div>','<div class="j_lzl_c_b_a core_reply_content">','<ul class="j_lzl_m_w" style="display:'+s+'">',this._getSubPostList(e),"</ul>",'<div class="lzl_editor_container j_lzl_e_c lzl_editor_container_s" style="display:none;"></div>','<input type="text" class="j_lzl_e_f_h" style="display:none;" />',"</div>",'<div class="core_reply_border_bottom"></div>'].join("");return t},_getSubPostList:function(e){for(var s,t,n="",i=this._commentList[e.post_id],a="",l="",_=i&&i.comment_info?i.comment_info:[],r=0;r<_.length;r++)s=_[r],t=this._userList[s.user_id]||{},5==r&&(l="lzl_hidden_"+e.post_index,a+='<ul class="lzl_post_hidden" id="'+l+'">',n=!0),t.nickname=t.is_verify||t.is_official?t.nickname:t.user_name,a+=['<li class="lzl_single_post j_lzl_s_p '+(0==r?"first_no_border":"")+"\" data-field=\"{'pid':'"+e.post_id+"','spid':'"+s.comment_id+"','user_name':'"+t.user_name+"','portrait':'"+t.portrait+"'}\" >",this._user.face_link(t),'<div class="lzl_cnt">',this._icons.getPreIconHtml(t.mParr_props),this._user.name_link(t),"1"==t.is_verify||"1"==t.is_official?'<img style="vertical-align: middle;margin-top: -3px;" src="http://tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" width="11" height="18" class="verified_icon" />':"",':&nbsp;<span class="lzl_content_main">',this._searchCid==s.comment_id?"<b>"+s.content+"</b>":s.content,this._getVoiceHtml(s),"</span>",this._getReplyHtml(s,t),"</div>","</li>"].join("");return a+=n?"</ul>":"",a+=this._getLzlPager(e,l),delete this._commentList[e.post_id],a},_getLzlPager:function(e,s){var t='<li class="lzl_li_pager j_lzl_l_p lzl_li_pager_s" data-field="{total_num:'+e.comment_num+",total_page:"+e.page.total_page+'}" >';return t+='<p class="j_lzl_p"><a href="##">\u6211\u4E5F\u8BF4\u4E00\u53E5</a></p>',e.comment_num>5?(t+='<p class="lzl_more">',t+="<span>\u8FD8\u6709"+(e.comment_num-5)+"\u6761\u56DE\u590D\uFF0C</span>",t+='<a href="#" class="j_lzl_m" lzlid="'+(s?s:"")+'">\u70B9\u51FB\u67E5\u770B</a>',t+="</p>",t+='<p class="j_pager l_pager pager_theme_2 lzl_pager" style="display:none">',e.comment_num>10?(this._pager=this.requireInstance("common/component/JsPager",[{current:1,total:e.page.total_page,mode:1,url:"#",isHtml:!0,classname:{current:"tP"}}]),t+=this._pager._render()):t+="&nbsp",t+="</p>"):t+="<p>&nbsp;</p>",t+="</li>"},_getForbiddenTip:function(e){var s="";return e.exist_forbidden_tip&&(s='<p class="lzl_thread_forbidden_tip j_lzl_thread_forbidden_tip" >\u672C\u697C\u5305\u542B\u90E8\u5206\u5E7F\u544A\u7B49\u8FDD\u89C4\u5185\u5BB9\u7684\u56DE\u590D\uFF0C\u5DF2\u7ECF\u88AB\u5C4F\u853D\uFF0C\u6682\u4E0D\u53EF\u89C1\u3002<span class="lzl_forbidden_tip_close j_lzl_forbidden_tip_close">x</span></p>'),s},_getVoiceHtml:function(e){var s,t,n="";return e.ptype&&(s=e.during_time?Math.floor(e.during_time/60):"0",t=e.during_time?e.during_time%60:"0",n=['<br/><div class="voice_player voice_player_mini voice_player_lzl">','<a href="#" class="voice_player_inner">','<span class="before">&nbsp;</span><span class="middle"><span class="speaker speaker_animate">&nbsp;</span>','<span class="time">',s>0?'<span class="minute">'+s+"</span>&#039;":"",t>0||s>0?'<span class="second">'+t+"</span>&quot;":"","</span>","</span>",'<span class="after">&nbsp;</span>',"</a>","</div>"].join("")),n},_getReplyHtml:function(e,s){var t="",n=PageData.power,i=PageData.user;return t+='<div class="lzl_content_reply"><span class="lzl_jb"  style="display:none">',n.can_mask_delete||n.lzl_del||(t+=s.user_name==i.user_name?"<a href=\"#\" data-field=\"{'delete_mine':'1','user_name':'"+s.user_name+'\'}" class="lzl_jb_in" >\u5220\u9664</a>&nbsp;|':"<a href=\"#\" data-field=\"{'delete_mine':'0','user_name':'"+s.user_name+'\'}" class="lzl_jb_in" >'+(n.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5")+"</a>&nbsp;|&nbsp;"),t+='</span><span class="lzl_op_list j_lzl_o_l">',t+=this._loadLzlAdmin(s,n,i),t+='</span><span class="lzl_time">'+this._getTime(e.now_time)+'</span><a href="#" class="lzl_s_r">\u56DE\u590D</a>',t+="</div>"},_loadLzlAdmin:function(e,s,t){var n="",i="&nbsp;|&nbsp;";return(s.can_filter_ip||s.can_filter_id)&&(n+='<a href="#" class="j_lzl_ban">\u5C01</a>'+i),(s.can_mask_delete&&e.user_name!=t.user_name||s.lz_del&&!t.forbidden.isForbid&&!t.is_black&&e.user_name!=t.user_name)&&(n+='<a href="#" class="j_lzl_del">\u5220\u9664</a>'+i),s.can_super&&(n+='<a href="/f?ct=503316480&cm=6000&tn=bdUserManager&un="'+e.user_name+' class="j_lzl_manage p_tieba_manage" target="_blank">\u8D34\u5427\u7BA1\u7406</a>'+i),n},_getTime:function(e){function s(e){return 10>1*e?"0"+e:e}var t;t=void 0==e?new Date:new Date(1e3*e);var n="";return n+=t.getFullYear()+"-",n+=t.getMonth()+1+"-",n+=t.getDate()+"&nbsp;",n+=s(t.getHours())+":",n+=s(t.getMinutes())}}});var bdShareTb=bdShareTb||{};bdShareTb._LogPool=bdShareTb._LogPool||[],bdShareTb.ApiPVLogger||!function(e){function n(e,n){var t=[];for(var o in n){var i=typeof n[o];"function"!=i&&"object"!=i&&n.hasOwnProperty(o)&&t.push(e+"_"+o+"="+n[o])}return t.join("&")}function t(){for(var e=bdShareTb._LogPool||[],n={},t=e.length-1;t>=0;t--){var o=e[t],i=n[o.key];i?(i.linkid=i.linkid||o.api.linkid,i.loadTime=o.api.loadTime||i.loadTime,i.type=(i.type||0)|(o.api.type||0)):n[o.key]=o.api}e=[];for(var d in n)n.hasOwnProperty(d)&&e.push({key:d,api:n[d]});return bdShareTb._LogPool=e,e}function o(){var e=bdShareTb._LogPool||[],o=e.length;if(o>0){e=t(),o=e.length;for(var i=[],d="",a=null,u=[0,0,0,0,0,0,0,0],l=0;o>l;l++)a=e[l],u[r[a.key]]=1,a.api.linkid&&(d=a.api.linkid,delete a.api.linkid),i.push(n(a.key,a.api));i.unshift("linkid="+d),i.unshift("apitype="+parseInt(u.reverse().join(""),2)),c(i.join("&"))}}function i(){l=!0,d.dom.ready(o)}var d,a=d={version:"1.5.2.2"};a.guid="$BAIDU$",a.$$=window[a.guid]=window[a.guid]||{global:{}},a.browser=a.browser||{},function(){var e=navigator.userAgent;a.browser.safari=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)?+(RegExp.$1||RegExp.$2):void 0}(),a.browser.ie=a.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,a.browser.opera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,a.dom=a.dom||{},function(){var e=a.dom.ready=function(){function e(){if(!e.isReady){e.isReady=!0;for(var n=0,t=d.length;t>n;n++)d[n]()}}function n(){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(n,1)}e()}function t(){if(!i)if(i=!0,"complete"===document.readyState)e.isReady=!0;else if(document.addEventListener)document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",o),window.attachEvent("onload",e);var t=!1;try{t=null==window.frameElement}catch(d){}document.documentElement.doScroll&&t&&n()}}var o,i=!1,d=[];return document.addEventListener?o=function(){document.removeEventListener("DOMContentLoaded",o,!1),e()}:document.attachEvent&&(o=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",o),e())}),t(),function(n){e.isReady?n():d.push(n)}}();e.isReady=!1}(),d.undope=!0;var r={cite:0,img:1,addto:2,video:3},u=function(){var e=[];return function(n){var t="bdsharelog__"+(new Date).getTime(),o=e[t]=new Image;o.onload=o.onerror=function(){e[t]=null},o.src=n,o=null}}(),c=function(e){var n=/(\d+\-[a-zA-Z\d]+\-\d+\-\d+\-[a-f\d]+)/gi,t=(location.href.match(n)||"").toString(),o="http://nsclick.baidu.com/v.gif?pid=307&type=3071&sign="+t+"&desturl="+encodeURIComponent(document.referrer)+"&";u(o+e)},l=!1;e.ApiPVLogger={add:function(e,n){bdShareTb._LogPool.push({key:e,api:n})}},l||i()}(bdShareTb);
;var bdShareTb=bdShareTb||{};bdShareTb.ready=bdShareTb.ready||function(e,t){if(t=t||document,/complete/.test(t.readyState))e();else if(t.addEventListener)"interactive"==t.readyState?e():t.addEventListener("DOMContentLoaded",e,!1);else{var a=function(){a=new Function,e()};void function(){try{t.body.doScroll("left")}catch(e){return setTimeout(arguments.callee,10)}a()}(),t.attachEvent("onreadystatechange",function(){"complete"==t.readyState&&a()})}},bdShareTb.loadScript=bdShareTb.loadScript||function(e){var t=document.createElement("script");t.src=e,bdShareTb.ready(function(){document.getElementsByTagName("script")[0].parentNode.appendChild(t)})},bdShareTb.loadTime=+new Date;
;var bdShareTb=bdShareTb||{};!function(){var e=(new Date).getTime(),t=(new Date).getTime(),n=(new Date).getTime();if(document.getElementById("bdshare_tb")){var o=window,i=document,s=i.body,r=i.documentElement,a={},d="",l=i.title,c=[],h="",f={},u=i.getElementById("bdshare_tb").attributes.data,b=/MSIE 6.0/.test(navigator.userAgent),m="CSS1Compat"!=i.compatMode,u=u.nodeValue.replace(/&amp;/g,"&").split("&")||"";try{var p=o.location||i.location;a.href=p.href,a.search=p.search,a.hash=p.hash,a.protocol=p.protocol,a.hostname=p.hostname,a.pathname=p.pathname,d=encodeURIComponent(a.href)}catch(g){setTimeout(function(){var e=o.location||i.location;a.href=e.href,a.search=e.search,a.hash=e.hash,a.protocol=e.protocol,a.hostname=e.hostname,a.pathname=e.pathname,d=encodeURIComponent(a.href)},0)}for(var y=u.length;y--;){var v=u[y].split("=");c[v[0]]=v[1]}var T={bdPref:"bds_",bdBtns:c.btnArray?c.btnArray.split(","):[],bdEntranceLog:c.entrance||"",bdNums:c.mini?7:15,bdMini:c.mini||!1,bdType:c.type||"",bdLeft:c.pos||"right",bdTitle:"\u5206\u4EAB\u5230",bdText:c.text||l,weiboText:"",bdMore:"\u66F4\u591A...",bdPopTitle:"\u5206\u4EAB\u5230",bdImg:c.img||0,bdImgW:24,bdTop:0,bdIds:"bdshare",bdIdsl:c.mini&&"0"==c.mini?"bdshare_tb_l":"bdshare_tb_m",bdUid:c.uid||"",bdPic:c.bdPic||"",searchPic:c.searchPic||0,bdComment:"",bdDesc:"",wbUid:"",tongji:"on",review:"on",render:!0,snsKey:{},bdHost:"http://bdimg.share.baidu.com/static/",bdJump:"http://share.baidu.com/",bdApi:"http://api.share.baidu.com/",bdStatistics:"http://share.baidu.com/commit",bdCommit:"http://s.share.baidu.com/",bdMshare:"http://s.share.baidu.com/mshare",bdCout:"http://nsclick.baidu.com/v.gif?pid=307",bdWList:"([http|https]://[a-zA-Z0-9_.]+.baidu.com)",bdList:["mshare,\u4E00\u952E\u5206\u4EAB,mshare","qzone,QQ\u7A7A\u95F4,qqkj","tsina,\u65B0\u6D6A\u5FAE\u535A,xlwb","baidu,\u767E\u5EA6\u641C\u85CF,bdsc","renren,\u4EBA\u4EBA\u7F51,rrw","tqq,\u817E\u8BAF\u5FAE\u535A,txwb","bdxc,\u767E\u5EA6\u76F8\u518C,bdxc","kaixin001,\u5F00\u5FC3\u7F51,kxw","tqf,\u817E\u8BAF\u670B\u53CB,txpy","tieba,\u767E\u5EA6\u8D34\u5427,bdtb","douban,\u8C46\u74E3\u7F51,db","tsohu,\u641C\u72D0\u5FAE\u535A,shwb","bdhome,\u767E\u5EA6\u65B0\u9996\u9875,bdhome","sqq,QQ\u597D\u53CB,sqq","thx,\u548C\u8BAF\u5FAE\u535A,thx","qq,QQ\u6536\u85CF,qqsc","taobao,\u6211\u7684\u6DD8\u5B9D,tjh","hi,\u767E\u5EA6\u7A7A\u95F4,bdkj","msn,MSN,msn","sohu,\u641C\u72D0\u767D\u793E\u4F1A,shbsh","t163,\u7F51\u6613\u5FAE\u535A,wywb","qy,\u5947\u827A\u5947\u8C08,qyqt","meilishuo,\u7F8E\u4E3D\u8BF4,mls","mogujie,\u8611\u83C7\u8857,mgj","diandian,\u70B9\u70B9\u7F51,diandian","huaban,\u82B1\u74E3,huaban","leho,\u7231\u4E50\u6D3B,leho","share189,\u624B\u673A\u5FEB\u4F20,share189","duitang,\u5806\u7CD6,duitang","hx,\u548C\u8BAF,hexun","tfh,\u51E4\u51F0\u5FAE\u535A,fhwb","fx,\u98DE\u4FE1,feixin","youdao,\u6709\u9053\u4E91\u7B14\u8BB0,youdao","sdo,\u9EA6\u5E93\u8BB0\u4E8B,sdo","qingbiji,\u8F7B\u7B14\u8BB0,qingbiji","ifeng,\u51E4\u51F0\u5FEB\u535A,ifeng","people,\u4EBA\u6C11\u5FAE\u535A,people","xinhua,\u65B0\u534E\u5FAE\u535A,xinhua","ff,\u996D\u5426,fanfou","mail,\u90AE\u4EF6\u5206\u4EAB,mail","kanshou,\u641C\u72D0\u968F\u8EAB\u770B,kanshou","yaolan,\u6447\u7BEE\u7A7A\u95F4,yaolan","wealink,\u82E5\u90BB\u7F51,wealink","tuita,\u63A8\u4ED6,tuita","xg,\u9C9C\u679C,xianguo","ty,\u5929\u6DAF\u793E\u533A,tianya","fbook,Facebook,facebook","twi,Twitter,twitter","ms,Myspace,myspace","deli,delicious,delicious","s51,51\u6E38\u620F\u793E\u533A,51shequ","s139,139\u8BF4\u5BA2,shuoke","linkedin,linkedin,LinkedIn","copy,\u590D\u5236\u7F51\u5740,kaobei","print,\u6253\u5370,print"]}||{},w={_parseJson:function(e){e=e.replace(/^\s*{|}\s*$/g,"");for(var t=e.split(","),n={},o=0,i=t.length;i>o;o++){var s=t[o],r=s.indexOf(":");r>0&&(key=s.substring(0,r).replace(/^\s*[\'\"]?|[\"\']?\s*$/g,""),val=s.substring(r+1).replace(/^\s*[\'\"]?|[\"\']?\s*$/g,""),n[key]=val)}return n},_createScriptTag:function(e,t,n){e.setAttribute("type","text/javascript"),n&&e.setAttribute("charset",n),e.setAttribute("src",t),document.getElementsByTagName("head")[0].appendChild(e)},_removeScriptTag:function(e){if(e.clearAttributes)e.clearAttributes();else for(var t in e)e.hasOwnProperty(t)&&"parentNode"!=t&&delete e[t];e&&e.parentNode&&e.parentNode.removeChild(e),e=null},callByBrowser:function(e,t,n){var o,i=document.createElement("SCRIPT"),s=0,r=n||{},a=r.charset,d=t||function(){},l=r.timeOut||0;i.onload=i.onreadystatechange=function(){if(!s){var e=i.readyState;if("undefined"==typeof e||"loaded"==e||"complete"==e){s=1;try{d(),clearTimeout(o)}finally{i.onload=i.onreadystatechange=null,w._removeScriptTag(i)}}}},l&&(o=setTimeout(function(){i.onload=i.onreadystatechange=null,w._removeScriptTag(i),r.onfailure&&r.onfailure()},l)),w._createScriptTag(i,e,a)},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},unon:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},html:function(e,t){var n=i.createElement(t||"div");for(var o in e)"style"==o?n[o].cssText=e[o]:n[o]=e[o];return"link"!=t?s.insertBefore(n,"iframe"==t?s.firstChild:h.nextSibling):void i.getElementsByTagName("head")[0].appendChild(n)},list:function(e){var t=T.bdPref,n=e.split(","),o=n[1],i="#",s=t+n[0]+" "+n[2];return{name:o,url:i,cls:s}},list_s:function(e){var t=[],n=inner="",o=T,i=o.bdList,s=o.bdBtns.length;if(more=o.bdNums<i.length?'<li><a href="#" class="bds_more">'+o.bdMore+"</a></li>":"",o.bdBtns.length<=0)for(s=o.bdNums;s--;)n=w.list(i[s]),t.push('<a href="'+n.url+'" class="'+n.cls+'">'+n.name+"</a>");else for(;s--;)o.bdBtns[s]<i.length&&(n=w.list(i[o.bdBtns[s]]),t.push('<a href="'+n.url+'" class="'+n.cls+'">'+n.name+"</a>"));if(inner='<iframe id="bdsTbIfr" style="position:absolute;display:none;z-index:9999;" frameborder="0"></iframe>',inner+='<div id="'+o.bdIdsl+'"><div id="'+o.bdIdsl+'_c"><h6>'+o.bdTitle+"</h6>",inner+="<ul><li>"+t.reverse().join("</li><li>")+"</li>"+more+'</ul><p><a href="#" class="goWebsite">\u767E\u5EA6\u5206\u4EAB</a></p></div></div>',!e)return inner;var r=w.html({id:"bdshare_tb_s",innerHTML:inner}),a=w.children(r);r=a[a.length-1],w.on(r,"mouseover",function(e){var e=e||window.event,t=e.target||e.srcElement,n=w.getPosition(t),o=e.relatedTarget||e.fromElement,i=w.getMousePos(e),s=i.x-n.l,a=i.y-n.t;t.buttontype=1,t.x=s,t.y=a,w.contains(r,o)||(r.time=+new Date)})},scroll:function(e,t){w.on(o,"scroll",function(){var n=w.getSize(),o=T,s=o.bdTop;"slide"==o.bdType&&(b||m?(w.setAttr(i.getElementById(o.bdIdsl),"display:block"),_bdS.style.top=n.t+(0==s?n.h/2-(i.getElementById(o.bdIdsl).offsetHeight-11)/2:parseInt(s))+"px"):0!=o.bdTop&&(_bdS.style.top=parseInt(o.bdTop)+"px")),"pop"==t&&(b||m)&&(e.style.top=n.t+n.h/2-e.offsetHeight/2+"px",w.setAttr(h,"top:"+e.style.top))})},getSize:function(){return{t:s.scrollTop||r.scrollTop,l:s.scrollLeft||r.scrollLeft,w:r.clientWidth||s.clientWidth,h:o.innerHeight||r.clientHeight||s.clientHeight}},getPosition:function(e){var t=w.getSize(),n=e,o={t:0,l:0},r=/gecko/.test(navigator.userAgent),a=function(e,t){o.t+=e,o.l+=t};if(n&&n!=s)if(n.getBoundingClientRect){var d=n.getBoundingClientRect(),l=e.ownerDocument,c=l.body,h=l.documentElement,f=h.clientTop||c.clientTop||0,u=h.clientLeft||c.clientLeft||0;if(d.top==d.bottom){var b=n.style.display;n.style.display="block",n.style.display=b}a(d.top+t.t-f,d.left+t.l-u)}else{for(var m=i.defaultView;n;){a(n.offsetTop,n.offsetLeft);var p=m.getComputedStyle(n,null);if(r){var g=parseInt(p.getPropertyValue("border-left-width"),10)||0,y=parseInt(p.getPropertyValue("border-top-width"),10)||0;a(y,g),n!=e&&"visible"!=p.getPropertyValue("overflow")&&a(y,g)}n=n.offsetParent}for(n=e.parentNode;n&&n!=s;)a(-n.scrollTop,-n.scrollLeft),n=n.parentNode}return o},setAttr:function(e,t){for(var n=t.split(";"),o=n.length;o--;)if(n[o]){var i=n[o].split(":");i&&(e.style[i[0]]=i[1])}},children:function(e){for(var t=[],n=e.firstChild;n;n=n.nextSibling)1==n.nodeType&&t.push(n);return t},generateRandom:function(e,t){for(var n=e.length,o="",i=1;t>=i;i++){var s=Math.floor(n*Math.random());o+=e.charAt(s)}return o},generateLinkid:function(){var e=(+new Date).toString(36),t=w.generateRandom("0123456789abcdefghijklmnopqrstuvwxyz",3);return e+t},contains:function(e,t){if(!t||!e)return!1;if(e==t)return!0;for(var n=t.parentNode;null!=n&&"undefind"!=typeof n.tagName;){if(n==e)return!0;n=n.parentNode}return!1},getMousePos:function(e){return e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:document.documentElement&&document.documentElement.scrollTop?{x:e.clientX+document.documentElement.scrollLeft-document.documentElement.clientLeft,y:e.clientY+document.documentElement.scrollTop-document.documentElement.clientTop}:document.body?{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop}:void 0},_isCookieValidKey:function(e){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(e)},getCookieRaw:function(e){if(w._isCookieValidKey(e)){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);if(n)return n[2]||null}return null},setCookieRaw:function(e,t,n){if(w._isCookieValidKey(e)){n=n||{};var o=n.expires;"number"==typeof n.expires&&(o=new Date,o.setTime(o.getTime()+n.expires)),document.cookie=e+"="+t+(n.path?"; path="+n.path:"")+(o?"; expires="+o.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")}},getCookie:function(e){var t=w.getCookieRaw(e);return"string"==typeof t?t=decodeURIComponent(t):null},setCookie:function(e,t,n){w.setCookieRaw(e,encodeURIComponent(t),n)}},x=function(e){w.html({href:T.bdHost+"css/bdsstyle.css?cdnversion=20121228",rel:"stylesheet",type:"text/css"},"link"),h=h||w.html({style:"display:none;"+(e||""),frameBorder:0},"iframe")},_=function(e){var t=/(#\d+\-[a-zA-Z\d]+\-\d+\-\d+\-[a-f\d]{32}$)/g,n=(a.search+a.hash).replace(/&/g,"#"),o=n.match(t)||"",s=new RegExp(T.bdWList,"ig"),r=a.protocol+"//"+a.hostname+a.pathname+a.search;if(!s.test(a.href)||""!=o||"undefined"!=typeof e){var d=[];bdShareTb.fn.b.length>0&&d.push("button"),bdShareTb.fn.t.length>0&&d.push("tools"),bdShareTb.fn.conf.bdType&&d.push(bdShareTb.fn.conf.bdType);var c=function(){for(var e=0,t=d.length,n={},o=[];t>e;e++)!(d[e]in n)&&o.push(d[e])&&(n[d[e]]="");return o.join(",")}();if("on"==T.tongji||""!=o||"undefined"!=typeof e){""!=o&&"3072"!=e&&(o=o.toString().replace("#",""),(new Image).src=T.bdCommit+"back?url="+encodeURIComponent(r)+"&sign="+encodeURIComponent(o)+"&title="+encodeURIComponent(l.substr(0,300)));var h=bdShareTb.loadTime?+new Date-bdShareTb.loadTime:"";if("undefined"!=typeof e)(new Image).src=T.bdCout+"&type="+e+"&sign="+o+"&uid="+T.bdUid+"&desturl="+encodeURIComponent(i.referrer)+"&linkid="+k+"&button="+c+"&loadTime="+h;else{for(var f=[0,0,0,0],u=0,b=d.length;b>u;u++)f[{tools:0,button:1,slide:2}[d[u]]]=1;bdShareTb._LogPool=bdShareTb._LogPool||[],bdShareTb._LogPool.push({key:"cite",api:{uid:T.bdUid||"",linkid:k,type:parseInt(f.reverse().join(""),2),mini:T.bdMini?1:0,loadTime:h}})}}}},S={create:function(){var e=T,t=e.bdList,n=t.length,s=[],r="",a=w.getSize(),d=i.getElementById(e.bdIds+"_pop"),l=b||m?"absolute":"fixed",c=b||m?a.t:0;if(!d){for(;n--;)r=w.list(t[n]),s.push('<a href="'+r.url+'" class="'+r.cls+'">'+r.name+"</a>");var u=w.html({id:e.bdIds+"_pop",style:"position:"+l,innerHTML:"<div><h5></h5><ul><li>"+s.reverse().join("</li><li>")+'</li></ul><p><a href="#" class="goWebsite">\u767E\u5EA6\u5206\u4EAB</a></p></div>'});I.bind(u,"mouseover","a"),I.bind(u,"click","b",function(){u.style.display="none",h.style.display="none"}),w.on(u,"mouseover",function(e){var e=e||window.event,t=e.target||e.srcElement,n=w.getPosition(t),o=w.getMousePos(e),i=o.x-n.l,s=o.y-n.t;t.buttontype=2,t.x=i,t.y=s;var r=e.relatedTarget||e.fromElement;w.contains(u,r)||(u.time=+new Date)})}var p=u||d;p.getElementsByTagName("h5")[0].innerHTML=(f.title||e.bdPopTitle)+"<b>&nbsp;</b>",w.setAttr(p,"display:block;"),w.setAttr(p,"left:"+(a.w/2-p.offsetWidth/2)+"px;top:"+(c+a.h/2-p.offsetHeight/2)+"px"),w.setAttr(h,"position:"+l+";display:block;z-index:10000;width:"+p.offsetWidth+"px;height:"+p.offsetHeight+"px;left:"+p.style.left+";top:"+p.style.top),w.scroll(p,"pop"),w.on(o,"resize",function(){var e=w.getSize(),t="left:"+(e.w/2-p.offsetWidth/2)+"px;top:"+(c+e.h/2-p.offsetHeight/2)+"px";w.setAttr(p,t),w.setAttr(h,t)}),"slide"!=e.bdType&&(i.getElementById(T.bdIdsl).style.display="none",i.getElementById("bdsTbIfr").style.display="none"),window.bdShareActivity&&bdShareActivity.check()}},I={bind:function(e,t,n,i){var s=this;e.addEventListener?e.addEventListener(t,function(t){return s._action(t,t.target,n,e,i)},!1):e.attachEvent("on"+t,function(t){return t=o.event,s._action(t,t.srcElement,n,e,i)})},_action:function(e,t,n,o,i){var s=T.bdEntranceLog;if(t.nodeName==n.toUpperCase()){if("a"==n||"span"==n){var r=t.className,a="goWebsite"==r?r:r.split(" ")[0].split("_")[1],d=this;return a&&("more"==a&&"span"==n?d._tools(s):t.onclick=function(e,n){return function(o){var o=o||window.event,i=o.target||o.srcElement,r=w.getPosition(i),a=w.getMousePos(o),l=a.x-r.l,c=a.y-r.t;return"more"==e?d._tools(s):"copy"==e?d._copy(d):"print"==e?d._print():d._jump(e,n,t,l,c),!1}}(a,o)),!1}"function"==typeof i&&i()}"function"==typeof e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.returnValue=!1,e.cancelBubble=!0)},_tools:function(e){_(3072),S.create(),$.stats.sendRequest("bdshare=tb&page=logcount&entrance="+e)},_copy:function(e){_this=e;var t=new _this._browsers;"IE"==t.name?(window.clipboardData.setData("text",document.title+" "+a.href),alert("\u6807\u9898\u548C\u94FE\u63A5\u590D\u5236\u6210\u529F\uFF0C\u60A8\u53EF\u4EE5\u63A8\u8350\u7ED9QQ/MSN\u4E0A\u7684\u597D\u53CB\u4E86\uFF01")):window.prompt("\u60A8\u4F7F\u7528\u7684\u662F\u975EIE\u6838\u5FC3\u6D4F\u89C8\u5668\uFF0C\u8BF7\u6309\u4E0B Ctrl+C \u590D\u5236\u4EE3\u7801\u5230\u526A\u8D34\u677F",document.title+" "+a.href)},_mail:function(){},_print:function(){var e=document.getElementById("bdshare_pop");e&&(e.style.display="none"),window.print(),e&&(e.style.display="block")},_jump:function(i,s,r,a,l){var c=T,h=T.bdEntranceLog,u=T.bdIds,b=c.bdPic,m=c.bdText,p=c.weiboText,g=c.wbUid,y=d,v=c.bdDesc,x=c.bdComment,_=c.bdMiniWindow||0;f=s.getAttribute("data")&&""!=s.getAttribute("data")?w._parseJson(s.getAttribute("data")):f,""!=f?(b=encodeURIComponent(f.pic||"")||b,y=encodeURIComponent(f.url||"")||y,x=encodeURIComponent(f.comment||"")||x,v=encodeURIComponent(f.desc||"")||v,g=f.wbuid||g,m="tsina"==i?encodeURIComponent(f.text&&f.weibotext?(f.text+f.weibotext).substr(0,300):f.weibotext?(m+f.weibotext).substr(0,300):f.text?(f.text+p).substr(0,300):(m+p).substr(0,300)):encodeURIComponent((f.text||"").substr(0,300))||encodeURIComponent(m.substr(0,300))):m=encodeURIComponent("tsina"==i?(m+p).substr(0,300):m.substr(0,300)),m=encodeURIComponent(m),n=(new Date).getTime()+3e3;var S=e.toString(32)+t.toString(32)+n.toString(32),I=r.buttontype,C=Math.floor(bdShareTb.XY.loadedX),E=Math.floor(bdShareTb.XY.loadedY),A=I>0?1:0,L=Math.floor(r.x),P=Math.floor(r.y),M=Math.floor(a),W=Math.floor(l),R=Math.floor(r.offsetWidth),B=Math.floor(r.offsetHeight),N=I,U=+new Date;U-=s.time;var q,D=[C,E,A,L,P,M,W,R,B,N,U].join(".");switch(T.bdType){case"button":q=1;break;case"slide":q=2;break;default:q=0}var H="mail"==i?"_mail":i,j="?click=1&url="+y+"&uid="+c.bdUid+"&to="+H+"&type=text&relateUid="+g+"&pic="+b+"&title="+m+"&key="+(c.snsKey[i]||"")+"&sign="+c.review+"&desc="+v+"&comment="+x+"&searchPic="+c.searchPic+"&l="+S+"&linkid="+k+"&sloc="+D+"&apiType=0&buttonType="+q+"&firstime="+w.getCookie("bdshare_firstime");if("mshare"==i)var z=c.bdMshare+j;else var z=c.bdCommit+j;var X=c.bdCommit+"commit"+j+"&t="+Math.random();if("goWebsite"!=i){bdShareTb.fn._getSc("share");var Y=function(){var e=[];return function(t){var n=e.push(new Image)-1;e[n].onload=function(){e[n]=e[n].onload=null},e[n].src=t,"block"!=$("#"+u+"_pop").css("display")&&$.stats.sendRequest("bdshare=tb&page=logcount&entrance="+h)}}();if(setTimeout(function(){Y(X)},1500),"bdxc"==i){var V,Q=window,z=document,K="_bdXC";Q[K]?window._bdXC_loaded&&Q[K].reInit():(V=z.createElement("script"),V.setAttribute("charset","utf-8"),V.src="http://xiangce.baidu.com/zt/collect/mark.js?"+(new Date).getTime(),z.getElementsByTagName("head")[0].appendChild(V))}else if("mail"==i){var J=T.bdCommit+"sendmail";window.open(J+j,"_blank")}else 1==_?o.open(z,"bdShare","height=400, width=600"):o.open(z)}else o.open(c.bdJump)},_browsers:function(){var e,t={},n=navigator.userAgent.toLowerCase();return n.match(/msie ([\d.]+)/)?(e=n.match(/msie ([\d.]+)/),t.name="IE",t.version=e[1]):n.match(/firefox\/([\d.]+)/)?(e=n.match(/firefox\/([\d.]+)/),t.name="firefox",t.version=e[1]):n.match(/chrome\/([\d.]+)/)?(e=n.match(/chrome\/([\d.]+)/),t.name="chrome",t.version=e[1]):n.match(/opera.([\d.]+)/)?(e=n.match(/opera.([\d.]+)/),t.name="opera",t.version=e[1]):n.match(/safari.([\d.]+)/)?(e=n.match(/safari.([\d.]+)/),t.name="safari",t.version=e[1]):(t.name="\u672A\u77E5\u7684\u6D4F\u89C8\u5668",t.version="\u672A\u77E5\u7684\u7248\u672C\u53F7"),t}},k=w.generateLinkid();bdShareTb.fn=function(){return{init:function(){function e(t){var t=t||window.event,n=w.getMousePos(t);bdShareTb.XY.loadedX=n.x,bdShareTb.XY.loadedY=n.y,bdShareTb.XY.loadedX>0&&bdShareTb.XY.loadedY>0&&w.unon(document,"mousemove",e)}t=(new Date).getTime()+1e3,this.b=[],this.t=[],this.s=[],this.type="load",this._getShare();var n=this;if("undefined"!=typeof bds_config)for(var o in bds_config)("bdPopTitle"==o||"bdText"==o||"weiboText"==o||"bdPic"==o||"wbUid"==o||"tongji"==o||"render"==o||"snsKey"==o||"review"==o||"bdComment"==o||"bdDesc"==o||"bdTop"==o||"searchPic"==o||"bdUrl"==o||"bdMiniWindow"==o)&&(T[o]="render"==o||"snsKey"==o||"bdPopTitle"==o||"bdText"==o||"weiboText"==o?bds_config[o]:encodeURIComponent(bds_config[o]));this.conf=T,this.imgW=T.bdImgW,this.conf.render&&((this.b.length>0||this.t.length>0)&&this._share(),"slide"==this.conf.bdType&&this._slide()),this._getSc(this.type);for(var i=this.t,s=0;s<i.length;s++)for(var r=i[s].getElementsByTagName("a"),a=0;a<r.length;a++)!r[a].getAttribute("href")&&r[a].setAttribute("href","#");bdShareTb.XY=bdShareTb.XY||{},w.on(document,"mousemove",e);for(var s=0,d=this.t.length;d>s;s++)!function(e){var t=e;w.on(n.t[e],"mouseover",function(e){var e=e||window.event,o=e.target||e.srcElement,i=w.getPosition(o),s=w.getMousePos(e),r=s.x-i.l,a=s.y-i.t;o.buttontype=0,o.x=r,o.y=a;var d=e.relatedTarget||e.fromElement;w.contains(n.t[t],d)||(n.t[t].time=+new Date)})}(s);_(),null==w.getCookie("bdshare_firstime")&&w.setCookie("bdshare_firstime",1*new Date,{path:"/",expires:(new Date).setFullYear(2022)-new Date})},_getSc:function(e){this.type=e;for(var t=i.querySelectorAll?i.querySelectorAll(".shareCount"):i.getElementsByTagName("*"),n=t.length;n--;)/\sshareCount|shareCount\s|shareCount$/.test(t[n].className)&&this.s.push(t[n]);this.s.length>0&&w.callByBrowser(this.conf.bdApi+"getnum?url="+d+"&callback=bdShareTb.fn._getShare&type="+e+"&t="+(new Date).getTime())},_getShare:function(e){var t=e?!0:!1,n=[];if(i.querySelectorAll)this.b=i.querySelectorAll(".bdshare_b"),this.t=i.querySelectorAll(".bdshare_t");else for(var o=i.getElementsByTagName("*"),s=o.length;s--;){var r=o[s];/\sbdshare_t|bdshare_t\s/.test(r.className)&&this.t.push(r),/\sbdshare_b|bdshare_b\s|bdshare_b$/.test(r.className)&&this.b.push(r)}if(t){for(var a,n=this.s,d=n.length;d--;)/\sshareCount|shareCount\s|shareCount$/.test(n[d].className)&&(a="share"==this.type?e.num[0]<1e4?parseInt(n[d].innerHTML)+1:e.num[1]:1*e.errno==0?e.num[1]:0,n[d].innerHTML=decodeURI(a),n[d].setAttribute("title","\u7D2F\u8BA1\u5206\u4EAB"+e.num[0]+"\u6B21"),n[d].onclick=function(){S.create()});this.s=[]}},_share:function(){w.list_s(!0);var e=this.b,t=this.t,n=e.length,o=t.length,s=i.getElementById(this.conf.bdIdsl),r=i.getElementById("bdsTbIfr"),a=this.conf.bdList,d=a.length;if(w.setAttr(s,"display:none;"),I.bind(s,"mouseover","a"),n>0)for(;n--;)"bdshare_tb"==e[n].id&&(I.bind(e[n],"click","img",function(){S.create()}),I.bind(e[n],"mouseover","a",function(){S.create()}),this._s(e[n],s,r,e[n],"b"));if(o>0)for(;o--;)if("bdshare_tb"==t[o].id){I.bind(t[o],"click","span",function(){S.create()}),I.bind(t[o],"mouseover","a");for(var l=w.children(t[o]),c=l.length,h="";c--;){var f=l[c];if(/bds_more/.test(f.className))h=l[c],m&&(h.style.height=(/bds_tools_32/.test(t[o].className)?38:17)+"px"),this._s(""==h?t[o]:h,s,r,t[o],h);else for(var u=0;d>u;u++)if(a[u]){var b=a[u].split(","),p=new RegExp(this.conf.bdPref+b[0]+"$","ig");if(a[u]){var b=a[u].split(","),p=new RegExp(this.conf.bdPref+b[0]+"$","ig");p.test(f.className)&&("\u62F7\u8D1D"==b[1]?f.title="\u590D\u5236\u7F51\u5740":f.title||(f.title="\u5206\u4EAB\u5230"+b[1]))}}}}},_s:function(e,t,n,o,i){var s,r=this,a=[],d=""==i?"none":"block";this._popShow(e,{over:function(i){a=w.getPosition(e),f=o.getAttribute("data")&&""!=o.getAttribute("data")?w._parseJson(o.getAttribute("data")):"",w.setAttr(t,"display:"+d),w.setAttr(t,"left:"+(w.getSize().w-i.clientX<t.offsetWidth?a.l-t.offsetWidth+e.offsetWidth:a.l)+"px"),w.setAttr(t,"top:"+(w.getSize().h-i.clientY<t.offsetHeight?a.t-t.offsetHeight:a.t+e.offsetHeight)+"px"),w.setAttr(n,"display:"+d+";width:"+t.offsetWidth+"px;height:"+t.offsetHeight+"px;left:"+t.style.left+";top:"+t.style.top)},out:function(){s=setTimeout(function(){t.style.display="none",n.style.display="none"},100),r._popShow(t,{over:function(){clearTimeout(s),t.style.display="block",n.style.display="block"},out:function(){t.style.display="none",n.style.display="none"}})}})},_slide:function(){function e(){w.setAttr(c,"display:block;"),c.offsetWidth+a.imgW!=d.offsetWidth&&(tm=setTimeout(function(){c.offsetWidth+a.imgW!=d.offsetWidth&&a._move(d,0,a.imgW,c.offsetWidth,h)},100),a._popShow(c,{over:function(){w.setAttr(h,"height:"+c.offsetHeight+"px;"+a.conf.bdLeft+":0;top:0;display:block")},out:function(){}}),a._popShow(d,{over:function(){},out:function(){d.offsetWidth==c.offsetWidth+a.imgW&&(clearTimeout(tm),a._move(d,0,c.offsetWidth+a.imgW,-c.offsetWidth,h)),h.style.display="none"}}))}if(!o._bdS){var t="right"==this.conf.bdLeft?"left":"right",n=this.conf.bdHost+"images/"+this.conf.bdLeft.substring(0,1)+this.conf.bdImg+".gif";o._bdS=w.html({id:this.conf.bdIds,innerHTML:'<img src="'+n+'" alt="" style="float:'+t+';margin-top:58px;"/>'+w.list_s(!1)});var s=w.children(_bdS),r=s[s.length-1];w.on(r,"mouseover",function(e){var e=e||window.event,t=e.target||e.srcElement,n=w.getPosition(t),o=e.relatedTarget||e.fromElement,i=w.getMousePos(e),s=i.x-n.l,a=i.y-n.t;t.buttontype=1,t.x=s,t.y=a,w.contains(r,o)||(r.time=+new Date)})}var a=this,d=_bdS,l=w.getSize(),c=i.getElementById(this.conf.bdIdsl),h=i.getElementById("bdsTbIfr"),f=b||m?"absolute":"fixed",u=(b?l.t:0)+(0==this.conf.bdTop?l.h<c.offsetHeight?-40:l.h/2-c.offsetHeight/2:parseInt(this.conf.bdTop));w.setAttr(d,"overflow:hidden;height:330px;position:"+f+";top:"+u+"px;"+this.conf.bdLeft+":0;"+("right"==t?t+":"+(l.w-this.imgW)+"px":"")),w.setAttr(c,t+":"+this.imgW+"px;display:none"),I.bind(d,"click","img",function(){_(3072),S.create()}),I.bind(d,"mouseover","img",e),I.bind(c,"mouseover","a"),w.scroll(d,"slide"),w.on(o,"resize",function(){w.setAttr(d,"right"==t?t+":"+(w.getSize().w-a.imgW)+"px":"")})},_move:function(e,t,n,o,i){var s=e.style,r=i.style,a=this,d=6;setInterval(function(){d>t&&(t++,s.width=Math.ceil(o*t/d+n)+"px",r.width=Math.ceil(o*t/d+n)-a.imgW+"px")},10)},_popShow:function(e,t){function n(e){t.over(e)}function s(e){t.out(e)}i.all?(e.onmouseenter=function(){n(o.event)},e.onmouseleave=s):(e.onmouseover=function(e){null==e.relatedTarget?n(e):!(this===e.relatedTarget||20==this.compareDocumentPosition(e.relatedTarget))&&n(e)},e.onmouseout=function(e){null==e.relatedTarget?s(e):!(this===e.relatedTarget||20==this.compareDocumentPosition(e.relatedTarget))&&s(e)})}}}(),x(),bdShareTb.fn.init()}}();
;_.Module.define({path:"common/widget/bd_share"});_.Module.define({path:"album/component/initApiConfig",sub:{appid:"314406",xiangceUrl:"http://favo.xiangce.baidu.com/",uploadUrl:"http://up.xiangce.baidu.com/",tags:null,descript:null,cache:{},imgUrl:null,sourceURL:null,offset:{x:-72,y:6},likeButton:null,timer:null,currentQueryImgUrl:null,currentUpImgUrl:null,currentIndex:0,hasLogin:!1,hasNoUn:!1,area:[],descript:"",no_pic_pb:!1,sourceURL:"",tags:"",initial:function(t){var e=this;e.hasLogin=t.isLogin,e.hasNoUn=t.hasNoUn,e.area=t.conf.area,e.descript=t.conf.descript,e.no_pic_pb=t.conf.no_pic_pb,e.sourceURL=t.conf.sourceURL,e.tags=t.conf.tags},isImgMarked:function(t){return t in this.cache&&1==this.cache[t]},checkImgSize:function(t,e){return e.width>=$(t).width()||e.height>=$(t).height()?!1:!0},loginEvent:function(){TbCom.process("User","buildLoginFrame",null,null,null,"fav_img")},showLikeButton:function(){this.likeButton&&this.likeButton.show()},hideLikeButton:function(){this.likeButton&&this.likeButton.hide()},setLikeButtonPosition:function(t,e){{var i,n,o=this,r=$(t),s=r.offset(),u=s.left,a=s.top,c=r.outerHeight(),l=r.outerWidth(),d=o.likeButton;o.area[e]}d.find(".download").show();var h=d.outerHeight(),g=d.outerWidth();return(h+20>c||g+20>l)&&(d.find(".download").hide(),h=d.outerHeight(),g=d.outerWidth(),h+20>c||g+20>l)?!1:(i=a-parseInt(d.css("padding-top")),n=u+l-g+d.width(),d.css({top:i,left:n}),!0)},setImgConf:function(t){var e=this;if("IMG"!=t.tagName){var i=($(t).find("img")[0],$.parseJSON($(t).tbattr("favData")));if(!i.src)return!1;e.imgUrl=i.src,e.sourceURL=i.sourceURL,e.tags=i.tags,e.descript=i.descript}else e.imgUrl=t.src||"";var n=e.imgUrl.lastIndexOf(".webp");return-1!=n&&(e.imgUrl=e.imgUrl.slice(0,n)+".jpg"),!0},resetAndshowLikeButton:function(t,e){var i=this;return i.currentIndex=e,i.setImgConf(t)&&i.setLikeButtonPosition(t,e)?void(i.imgUrl in i.cache?(i.likeButton[i.isImgMarked(i.imgUrl)?"addClass":"removeClass"]("done"),i.showLikeButton()):i.queryAndshowLikeButton()):!1},queryAndshowLikeButton:function(){var t=this,e=t.cache,i=t.imgUrl,n=t.likeButton;return t.hasLogin?t.currentQueryImgUrl==i?!1:(t.timer&&clearTimeout(t.timer),void(t.timer=setTimeout(function(){var o=t.xiangceUrl+"opencom/picture/fav/query?app_id="+t.appid+"&url="+encodeURIComponent(i)+"&callback=?";$.stats.sendRequest("st_mod=fav_img&fr=tb0_forum&st_type=fav_btn_request&from=pic_forums"),t.currentQueryImgUrl=i,$.getJSON(o,function(o){0==o.errno&&o.data&&0!=o.data.status?(e[i]=1,n.addClass("done")):(e[i]=0,n.removeClass("done")),t.showLikeButton()})},200))):void this.showLikeButton()},setAreaConf:function(t,e,i){var n=this,o=n.area,r=null;for(var s in o)o[s].tag===t&&(r=o[s]);r[e]=i}}});_.Module.define({path:"album/widget/imgLikeAction",requires:["album/component/initApiConfig"],sub:{_defaultConfig:{sourceURL:"http://tieba.baidu.com/p/"+PageData.thread.thread_id,tags:"\u767E\u5EA6\u8D34\u5427,"+PageData.forum.forum_name+"\u5427",descript:$.tb.subByte(PageData.thread.title,40,""),no_pic_pb:PageData.isPicBa?!1:!0,area:[{container:"#j_p_postlist",tag:".BDE_Image",offset:{x:-4,y:5},minSize:{width:170,height:80}},{container:"#j_p_postlist",tag:".j_user_sign",offset:{x:-4,y:5},minSize:{width:170,height:80}}]},initial:function(){var t=this;t.isLogin=PageData.user.is_login,t.hasNoUn=PageData.user.no_un,t.conf=t._defaultConfig,t.isEnabled=!0,t.initApiConf(),t.createLikeButton(),t.initEvent()},initApiConf:function(){var t=this;t.favConfig=t.use("album/component/initApiConfig",{isLogin:t.isLogin,hasNoUn:t.hasNoUn,conf:t.conf})},initEvent:function(){var t=this;t.bindImgEvent(),t.bindPostEvent(),t.addShareButton(),t.mobileDownloadClick(),t.initCustomEmotion()},initCustomEmotion:function(){var t=this,e=$.cookie("tb_lab"),a={};e&&(a=$.json.decode(e)),a.custom_emotion&&(t.favConfig.likeButton.find(".emotion").show(),t.favConfig.likeButton.on("click",".emotion",function(){_.Module.use("common/component/CustomEmotion",{},function(e){e.openDialog({forumId:PageData.forum.forum_id,url:t.favConfig.imgUrl})})}))},bindImgEvent:function(){var t=this;$.each(t.favConfig.area,function(e,a){var i=a.container||document.body,o=a.tag;$(i).on("mouseover",o,{index:e},function(e){t.containerMouseover(e)}),$(i).on("mouseleave",o,function(e){t.containerMouseout(e)})})},bindPostEvent:function(){var t=this,e=t.favConfig,a=e.likeButton;a.delegate(".mark","click",function(){if(!e.hasLogin)return void e.loginEvent();if(e.currentUpImgUrl==e.imgUrl)return!1;var i=e.uploadUrl+"opencom/picture/fav/upload?app_id="+e.appid+"&descript="+encodeURIComponent(e.descript)+"&uid="+PageData.user.user_id+"&source_url="+encodeURIComponent(e.sourceURL)+"&tags="+encodeURIComponent(e.tags)+"&url="+encodeURIComponent(e.imgUrl)+"&callback=?",o={top:parseInt(a.css("top"),10)-e.area[e.currentIndex].offset.y,left:a.offset().left+40};setTimeout(function(){a.addClass("done")},200),$.stats.sendRequest("st_mod=fav_img&fr=tb0_forum&st_type=fav_btn_click"),e.currentUpImgUrl=e.imgUrl,$.getJSON(i,function(a){switch(a.errno){case 0:t.markSuccess(o);break;case 20026:return void e.loginEvent();case 20028:return void t.markFail(o,".n20028");default:return void t.markFail(o,".ndefault")}})}).mouseover(function(){if("undefined"==typeof bdRes2Exe){var t=document.getElementsByTagName("body").item(0),a=document.createElement("script");a.type="text/javascript",a.id="bdres2exejs",a["data-proxy"]="http://tieba.baidu.com/tb/static-album/proxy.html",a.src="http://m.baidu.com/static/as/res2exe/js/res2exe_1.0.4.min.js",a.setAttribute("data-proxy","http://tieba.baidu.com/tb/static-album/proxy.html"),t.appendChild(a)}e.showLikeButton()}).mouseout(function(){e.hideLikeButton()}),$("body").delegate(".sr-bdimgshare-layer","mouseover",function(){e.showLikeButton()}).delegate(".sr-bdimgshare-layer","mouseout",function(){e.hideLikeButton()})},markSuccess:function(t){var e=this;e.favConfig.cache[e.favConfig.imgUrl]=1,"1"!=$.cookie("ablum_hls")&&e.favConfig.likeButton.parent().find(".fav-success").fadeIn("fast",function(){var t=$(this);$.cookie("ablum_hls","1",{expires:30}),setTimeout(function(){t.fadeOut()},3e3)}).css(t)},markFail:function(t,e){var a=this;$fav_fail=a.favConfig.likeButton.parent().find(".fav-fail"),$fav_fail.find(".text").hide(),$fav_fail.find(e).show(),$fav_fail.fadeIn("fast",function(){var t=$(this);setTimeout(function(){t.fadeOut()},2e3)}).css(t)},closeBSharePanel:function(){bdShare&&bdShare.ImgShare&&bdShare.ImgShare.closeHoverPop()},addShareButton:function(){if(PageData&&("v3"==PageData.page||"pb_bright"==PageData.page)){var t=this,e=t.favConfig;window.bdShare_config_imgshare={type:"collection",pos:"top",hidden:"share collect",content:encodeURIComponent(document.title)},$.JsLoadManager.use("http://tb1.bdstatic.com/tb/static-common/js/pic_share/imgshare_shell.js",function(){e.likeButton.find(".share").show().mouseover(function(t){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){$.stats.sendRequest("st_mod=album&fr=tb0_forum&st_type=share_show");var a=$(t.target).offset();a.top+=24,bdShare.ImgShare.showHoverPop(e.imgUrl,a)},200)}).click(function(){$.stats.sendRequest("st_mod=album&fr=tb0_forum&st_type=share_click"),t.closeBSharePanel(),bdShare.ImgShare.showAllPop(e.imgUrl)}).mouseout(function(a){e.timer&&clearTimeout(e.timer);var i=t.getMouseHoverDirection.call(this,a);"bottom"!=i&&t.closeBSharePanel()})})}},containerMouseover:function(t){var e=this;if(e.isEnabled){e.closeBSharePanel();var a=t.currentTarget,i=t.data.index;e.favConfig.resetAndshowLikeButton(a,i)}},containerMouseout:function(){var t=this;t.favConfig.timer&&clearTimeout(t.favConfig.timer),t.favConfig.hideLikeButton()},mobileDownloadClick:function(){var t=this;$(".fav-toolbar .download").click(function(){$(this).tbattr({data_name:(new Date).getTime(),data_url:t.favConfig.imgUrl,data_size:1024,data_icon:t.favConfig.imgUrl});var e=[];$(".mobile_res").each(function(t,a){var i=bdRes2Exe.getPackageByDom(a);i&&e.push(i)}),bd_app_dl(e),$.stats.sendRequest("fr=tb0_forum&st_mod=picMobile&st_type=imgLikeAction")})},createLikeButton:function(){var t=this,e=['<div class="fav-wrapper" style="">','<div class="fav-toolbar" style="display:none">','<a href="#" onclick="return false" class="mark" title="\u6536\u85CF\u5230\u767E\u5EA6\u76F8\u518C"></a>','<a href="http://xiangce.baidu.com/opencom/picture/fav/rewrite" target="_blank" onclick="$.stats.sendRequest(\'fr=tb0_forum&st_mod=shoucang&st_value=xiangce\')" title="\u67E5\u770B\u5DF2\u6536\u85CF\u56FE\u7247" class="marked"></a>','<a href="#" class="share j_shareImg" onclick="return false"></a>','<a class="download mobile_res"  title="\u4E0B\u8F7D\u56FE\u7247\u5230\u624B\u673A"  href="javascript:;" hidefocus="true" data_type="picture" data_url="" data_name="" data_icon="" data_size="1048576" data_from="1001714x" ></a>','<a class="mobile_res" data_type="apk" data_url="http://static.tieba.baidu.com/client/operate/android/tieba_pc_picdownload.apk" data_name="\u767E\u5EA6\u8D34\u5427" data_icon="http://static.tieba.baidu.com/tb/static-album/img/tieba_client.png" data_size="12488145"  data_from="1001714x"  data_versionname="4.4.1"  data_versioncode="4" data_package="com.baidu.tieba" data_detail_type="soft" style="display:none" ></a>','<a href="javascript:void(0)" style="display: none;" class="emotion" title="\u6DFB\u52A0\u5230\u81EA\u5B9A\u4E49\u8868\u60C5"></a>',"</div>",'<div class="fav-success" style="display:none;">','<span class="ico"></span>','<span class="text">\u4F7F\u7528\u4E91\u76F8\u518C\u6536\u85CF\u5DE5\u5177\uFF0C\u6279\u91CF\u6536\u85CF\u7CBE\u7F8E\u56FE\u7247\uFF01<a target="_blank" href="http://xiangce.baidu.com/tool/shoucang/">\u7ACB\u5373\u5B89\u88C5</a></span>',"</div>",'<div class="fav-fail" style="display:none;">','<span class="ico"></span>','<span class="text ndefault">\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01</span>','<span class="text n20028">\u62B1\u6B49\uFF0C\u60A8\u6CA1\u6709\u6743\u9650\u8FDB\u884C\u8BE5\u9879\u64CD\u4F5C</span>',"</div>",'<div id="album_hl_container" style="display:none;"></div>',"</div>"].join("");t.favConfig.likeButton=$(e).appendTo(document.body).find(".fav-toolbar")},getMouseHoverDirection:function(t){var e=t.target,a=e.offsetWidth,i=e.offsetHeight,o=$(e).offset(),n=(t.pageX-o.left-a/2)*(a>i?i/a:1),s=(t.pageY-o.top-i/2)*(i>a?a/i:1),r=Math.round((Math.atan2(s,n)*(180/Math.PI)+180)/90+3)%4,c=new Array("up","right","bottom","left");return c[r]||"bottom"},enableSelf:function(t){var e=this;e.isEnabled=t,t||e.favConfig.hideLikeButton()}}});_.Module.define({path:"pb/widget/postList/FeedBack",sub:{initial:function(){try{this.autoResponseHelp(),this.autoResponseForNotLouzhu(),this.autoResponseClickEvt()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/feedback.js",method:"",ln:13}),e}},autoResponseForNotLouzhu:function(){0!=$(".not-louzhu-response").length&&$(".not-louzhu-response").each(function(e,l){var t=$(l).data("replyHelp"),p="",a={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$(l),closeBtn:!1,level:1,arrowReq:!0};1==t?p='<div class="reply-help-tips">\u697C\u4E3B\u6682\u672A\u5BF9\u6B64\u7B54\u590D\u8FDB\u884C\u8BC4\u4EF7\u54E6~</div>':2==t?p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u6709\u5E2E\u52A9\u201D\u54E6~</div>':t>2&&(p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u65E0\u5E2E\u52A9\u201D\u54E6~\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>',a.bubble_css.width=345),a.content=p;var i=new UiBubbleTipBase(a);i.showBubble()})},autoResponseHelp:function(){if(0!=$("#plReplyHelpBubble").length){var e={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#plReplyHelpBubble"),closeBtn:!1,level:1,arrowReq:!0},l=$("#plReplyHelpBubble").data("replyHelp");1==l?e.content='<div class="reply-help-tips">\u4EB2\uFF0C\u4EE5\u4E0A\u5185\u5BB9\u662F\u5426\u89E3\u51B3\u4E86\u60A8\u7684\u95EE\u9898\u5462\uFF1F</div><div class="reply-help-tips"><label>\u662F<input type="radio" name="p-is-helpable" value="2"/></label><label>\u5426<input type="radio" name="p-is-helpable" value="0"/></label></div><ul class="p-not-helpable"><li><label><input type="radio" value="4" name="why-nothelp"/>\u592A\u7B80\u5355\u7528\u4E0D\u4E0A</li></label><li><label><input type="radio" value="8" name="why-nothelp"/>\u5B57\u592A\u591A\u4E0D\u60F3\u770B</li></label><li><label><input type="radio" value="16" name="why-nothelp"/>\u592A\u590D\u6742\u770B\u4E0D\u61C2</li></label><li><label><input type="radio" value="32" name="why-nothelp"/>\u641C\u7D22\u5230\u7684\u5185\u5BB9\u4E0D\u5339\u914D</li></label></ul>':l>1&&(e.content='<div class="reply-help-tips">\u611F\u8C22\u60A8\u7684\u53CD\u9988\uFF0C\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>');var t=new UiBubbleTipBase(e);t.showBubble(),this.autoResponseClickEvt()}},autoResponseClickEvt:function(){var e=this;$("#plReplyHelpBubble").on("click",".reply-help-tips input",function(){try{var l=$(this).val(),t={};2==l?($("#plReplyHelpBubble .p-not-helpable").hide(),t={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:l},e.autoResponsePost(t)):$("#plReplyHelpBubble .p-not-helpable").show()}catch(p){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:p.message||p.description,path:"pb:widget/post_list/feedback.js",method:"",ln:105}),p}}).on("click",".p-not-helpable li input",function(){try{var l={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:$(this).val()};e.autoResponsePost(l)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/feedback.js",method:"",ln:112}),t}})},autoResponsePost:function(e){var l=this;$.post("/hermes/commit/help",e,function(e){e.errno||($("#plReplyHelpBubble").html("").data("replyHelp",2),l.autoResponseHelp())},"json")}}});
;_.Module.define({path:"pb/widget/postList/PostPic",sub:{initial:function(){try{"album_pb"!=PageData.pageType&&this._bindOpenImg()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:15}),t}},_isAlbumImg:function(t){var e=/^http:\/\/[^\/\?]*?\.baidu\.com[:8090]*\/(\w+)\/([^\/\?]+)\/([^\/\?]+)\/(\w+?)\.(?:webp|jpg)/;return e.test(t)},_bindOpenImg:function(){for(var t,e,a,s,i=this,p=$("#j_p_postlist").find(".BDE_Image"),n=$.browser.msie&&$.browser.version<=7,o=0,c=p.length;c>o;o++){var r=p[o];if(r&&(t=$(r),a=t.height(),s=t.width(),i._isAlbumImg(r.src)&&a>=80&&s>=80&&a*s>=1e4&&(t.click(function(t){try{var a=t.target||t.srcElement,s=1,i=$(a).tbattr("src"),p=$(a).closest(".l_post");if(p){postData=p.getData(),postData.author.user_name!=PageData.thread.author&&(s=0),e=i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."));var n=$(a).closest(".j_d_post_content").find("#j_pb_repost"),o="";if(0==n.length)o="http://tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(PageData.forum.forum_name))+"&flux=1&tid="+PageData.thread.thread_id+"&pic_id="+e+"&pn=1&fp=2&see_lz="+s;else{var c=n.getData();o="http://tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(c.fname))+"&flux=1&tid="+c.tid+"&pic_id="+e+"&pn=1&fp=2&see_lz="+s}window.open(o,"_blank")}}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:62}),t}}),n?$(r).css("cursor","pointer").tbattr("title","\u70B9\u51FB\u8FDB\u5165\u8FDE\u7EED\u770B\u56FE\u6A21\u5F0F"):$(r).css("cursor","url('http://tb2.bdstatic.com/tb/static-pb/img/cur_zin.cur'),pointer")),a>999)){var d=$(document.createElement("div")),l=$(document.createElement("div"));html=s>160?'<em class="expand"></em><span class="txt">\u70B9\u51FB\u5C55\u5F00\uFF0C\u67E5\u770B\u5B8C\u6574\u56FE\u7247</span>':'<em class="expand"></em><span class="txt-empty"></span>',l.html(html),d.addClass("replace_div").css("width",s),l.addClass("replace_tip").css("width",s-2);var m=t.clone(!0);d.append(m),d.append(l),t.replaceWith(d)}}}}});
;_.Module.define({path:"pb/widget/postList/HidePost",sub:{initial:function(){try{1==PageData.forum.shield_post&&this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:13}),e}},_bindEvent:function(){var e,t,s,i,o=$('<div class="user-hide-post-down"></div>'),a=$('<div class="user-hide-post-action"><a href="javascript:void(0)" class="hide-author"></a></div>'),n=!1,d=!1,r={110000:"\u4F60\u8FD8\u6CA1\u6709\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\u3002",210009:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002",210004:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002","000000":"\u64CD\u4F5C\u6210\u529F\u3002"},l=function(l){var p={},h=d?void 0:i.content.post_no;1==h?"hide-post"==l?(p.type=2,p.fname=PageData.forum.forum_name,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t):"hide-post"==l?(p.type=3,p.pid=d?i.spid:i.content.post_id,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t),p.ie="utf-8",$.ajax({url:"/tphide/add",data:p,type:"post",dataType:"json",success:function(i){if(0==i.no)if(n=!1,1==h)$.tb.location.setHref("/f?kw="+PageData.forum.forum_name);else if("hide-post"==l)if(s.close(),o.hide(),a.hide(),$("body").append(o).append(a),d===!1)e.parents("div.l_post").remove();else{var p=e.parent().find("li.lzl_single_post");if(p.length<2){e.parents("div.j_lzl_container").hide().find("li.lzl_li_pager").remove();var c=e.parents("div.j_lzl_wrapper");c.find("a.lzl_link_unfold").show().text("\u56DE\u590D"),c.find("span.lzl_link_fold").hide()}e.remove()}else t==PageData.thread.author?$.tb.location.setHref("/f?kw="+PageData.forum.forum_name):$.tb.location.reload();else{s.close();var u=new $.dialog({html:'<div class="user-hide-post-tip">'+(r[i.no]||"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002")+"</div>",title:"\u63D0\u793A",width:400,closeable:!0,draggable:!1,show:!0});setTimeout(function(){u.close(),n=!1},4500)}}})};$("#pb_content").delegate(".user-hide-post-action","click",function(e){try{var o,a=$(e.target).tbattr("class"),r=d?void 0:i.content.post_no;if("hide-post"==a)o=1==r?"\u9690\u85CF1\u697C\u8D34\u5B50\uFF0C\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u4E2A\u8D34\u5B50\u5417\uFF1F":"\u64CD\u4F5C\u4E4B\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D\u8FD9\u6761\u8D34\u5B50\u7684\u9690\u85CF\u72B6\u6001<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u6761\u8D34\u5B50\u5417\uFF1F";else{if("hide-author"!=a)return;o=t==PageData.thread.author?'\u9690\u85CF\u7684\u7528\u6237\u4E3A\u672C\u8D34\u7684\u697C\u4E3B\uFF0C\u64CD\u4F5C\u4E4B\u540E\uFF1A\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF\uFF0C\u4E14<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F":'\u64CD\u4F5C\u4E4B\u540E\uFF0C<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F"}o+='<div class="user-hide-post-confirm"><button class="confirm">\u786E\u8BA4</button>&nbsp;&nbsp;<button class="cancel">\u53D6\u6D88</button></div>',s=new $.dialog({html:'<div class="user-hide-post-tip">'+o+"</div>",title:"\u63D0\u793A",width:400,closeable:!1,draggable:!1,show:!0}),$("div.user-hide-post-confirm").click(function(e){try{var t=$(e.target).tbattr("class");"cancel"==t?s.close():"confirm"==t&&n===!1&&(n=!0,l(a))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:145}),e}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:146}),e}}).delegate(".user-hide-post-down","click",function(){try{var s,o=$(this);o.tbattr("class","user-hide-post-up"),a.css({top:parseInt(o.css("top"))+15,right:parseInt(o.css("right"))+2}).appendTo(e),d===!1?(i=e.parents("div.l_post").getData(),t=i.author.user_name):(i=e.getData(),t=i.user_name),s="\u5BF9\u6211\u9690\u85CF\u8BE5\u7528\u6237\u7684\u6240\u6709\u8D34\u5B503\u5929",a.show().find("a.hide-author").html(s)}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:165}),o}}).delegate(".user-hide-post-up","click",function(){try{var e=$(this);e.tbattr("class","user-hide-post-down"),a.hide()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:169}),e}}).delegate(".p_content","mouseenter",function(){var t=$(this).parents("div.l_post"),s=t.getData();return""==PageData.user.user_name||PageData.user.user_name==(s&&s.author&&s.author.user_name)?!1:(e=$(this),d=!1,window.postDown=$(this).find(".user-hide-post-down"),window.postDown.show(),void 0)}).delegate(".p_content","mouseleave",function(){var e=window.postDown;return"undefined"==typeof e?!1:(e.hasClass("user-hide-post-up")&&e.tbattr("class","user-hide-post-down"),e.hide(),$(this).find(".user-hide-post-action").hide(),void 0)}).find("li.lzl_single_post").live("mouseenter","li.lzl_single_post",function(){e=$(this);var t=e.getData();if(""==PageData.user.user_name||PageData.user.user_name==t.user_name)return!1;o.appendTo(e);var s={};PageData.is_posts_admin||PageData.is_thread_admin?(s=e.find(".j_lzl_o_l").position(),o.css({top:s.top,right:536-s.left}).show()):(s=e.find(".lzl_time").position(),o.css({top:s.top,right:536-s.left+38}).show()),d=!0}).live("mouseleave","li.lzl_single_post",function(){o.hasClass("user-hide-post-up")&&o.tbattr("class","user-hide-post-down"),o.hide(),a.hide()}),window.global=window.global||{},window.global.shieldPost=function(){$("body").append(o).append(a)}}}});
;_.Module.define({path:"pb/widget/postList/PrintFlower",sub:{initial:function(){try{this._bindEvent()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/print_flower.js",method:"",ln:11}),t}},_bindEvent:function(){var t=this;$("#j_p_postlist").delegate(".j_print_reward","click",function(){try{var e=$(this),a=e.tbattr("data-pid"),s=e.tbattr("data-uid");t._introducePrintDialog(a,s)}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/post_list/print_flower.js",method:"",ln:19}),i}}).delegate(".j_click_flower","click",function(){try{$.stats.track("stamp_flower_show","fudai","frs/pb","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/print_flower.js",method:"",ln:21}),t}}).delegate(".j_award_flower","mouseover",function(){$(this).parent().next(".what_flower").css("display","block")}).delegate(".j_award_flower","mouseout",function(){$(this).parent().next(".what_flower").css("display","none")}).delegate(".what_flower","mouseover",function(){$(this).css("display","block")}).delegate(".what_flower","mouseout",function(){$(this).parent().next(".what_flower").css("display","none")})},_introducePrintDialog:function(t,e){var a=this,s='<p class="stamp_title">\u8BF7\u9009\u62E9\u4F60\u8981\u5956\u52B1\u7684\u5370\u82B1\u6570</p>',i='<input type="radio" name="stamp_num" value="5" checked="checked" /><span class="stamp_number">+5</span>',n='<input type="radio" name="stamp_num" value="10"/><span class="stamp_number">+10</span>',o='<input type="radio" name="stamp_num" value="50"/><span class="stamp_number">+50</span>',p='<input type="radio" name="stamp_num" value="1" /><input type="text" class="stamp_number stamp_input"><span class="stamp_error">\u8BF7\u8F93\u5165\u5370\u82B1\u6570</span>',r=i+n+o+p,c='<div class="stamp_button"><a href="#" class="ui_btn ui_btn_m j_notice_ok"><span><em>\u786E\u5B9A</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_cancel j_notice_no"><span><em>\u53D6\u6D88</em></span></a><p class="stamp_error_tip">\u60A8\u5DF2\u7ECF\u5956\u52B1\u8FC7\u5566\uFF0C\u8BF7\u52FF\u91CD\u590D\u5956\u52B1</p></div>',l='<div class="stamp_wrapper">'+s+'<div class="stamp_select">'+r+"</div>"+c+"</div>",d=$.dialog.open(l,{title:"\u5370\u82B1\u5956\u52B1",width:428});$(".j_notice_ok").click(function(s){try{s.preventDefault(),a._stampAjax(t,e)}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/post_list/print_flower.js",method:"",ln:48}),s}}),this.bind("showtips",function(t,e){e&&setTimeout(function(){d.close()},500)}),$(".j_notice_no").click(function(t){try{t.preventDefault(),d.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/print_flower.js",method:"",ln:59}),t}})},_stampAjax:function(t,e){var a=this,s=$('input:radio[name="stamp_num"]:checked').val(),i=0;if(1==s){if(i=$(".stamp_input").val(),""==i)return $(".stamp_error").css("display","inline-block"),!1}else i=s;var n={word:PageData.forum.forum_name,tbs:PageData.tbs,add_point:i,uid:e,post_id:t,ie:"utf-8"};$.post("/bawu2/fortune/addPoint?",n,function(t){t&&0==t.errno?(_html='<div class="stamp_reword_success">\u5956\u52B1\u6210\u529F</div>',$(".stamp_wrapper").append(_html),a.trigger("showtips",!0)):($(".stamp_error_tip").css("display","block"),a.trigger("showtips",!1))},"json")}}});
;_.Module.define({path:"pb/widget/postList/TbmallGuide",requires:["common/component/Card"],sub:{initial:function(){try{this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:12}),e}},_private_guide_card:"",_guideTimeoutId:"",_bindEvent:function(){var e=this;$("#j_p_postlist").delegate(".j_tbmall_guide","click",function(){try{e.preventDefault(),$(window).scrollTop($("[name='sub']").offset().top),$(".edui-btn-medal").click(),e.stopPropagation()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:22}),e}}).delegate(".j_nameplate","mouseenter",function(){clearTimeout(e._guideTimeoutId),e._showTip($(this))}).delegate(".j_nameplate","mouseleave",function(){clearTimeout(e._guideTimeoutId),e._guideTimeoutId=setTimeout(function(){e._hideTip($(this))},300)})},_showTip:function(e){var t=this;t._private_guide_card&&t._private_guide_card.closeCard();var a=e.offset(),i=(e.hasClass("j_nameplate")||e.hasClass("p_mall_tail")?a.top:a.top+43,e.hasClass("p_mall_tail")?a.left+132:a.left+105,""),l=180;e.hasClass("j_self_has_nameplate")?(i='<a class="pb_nameplate_recast_guide" href="/tbmall/propslist?category=112&ps=24" target="_blank" style="color: #1d53bf;">\u94ED\u724C\u73B0\u5728\u53EF\u4EE5\u91CD\u94F8\u4E86\u54E6~</a>',l=140):e.hasClass("j_self_nameplate")?(i='<a class="pb_nameplate_recast j_nameplate_recast" href="javascript:;" data-nameplate="'+$.json.encode(e.data("field")).replace(/\"/g,"&quot;")+'">\u91CD\u94F8\u94ED\u724C</a>',l=100):i=e.hasClass("j_self_no_nameplate")?'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/tshow" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>':'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/home" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>',t._private_guide_card=t.use("common/component/Card",{content:i,arrow_dir:"left",arrow_pos:{left:-7,top:9},card_css:{top:a.top+(e.outerHeight()-34)/2,left:a.left+e.outerWidth()+7,width:l,height:50}}),t._private_guide_card.showCard(),t._private_guide_card._j_card.on("mouseenter",function(){clearTimeout(t._guideTimeoutId)}).on("mouseleave",function(){t._private_guide_card.closeCard()})},_hideTip:function(){self._private_guide_card&&self._private_guide_card.closeCard()}}});
;_.Module.define({path:"pb/widget/postList",requires:["pb/widget/Posts","album/widget/imgLikeAction","pb/widget/sub_list/subListTotal"],sub:{initial:function(t){try{var e=this;if(this.posts=e.requireInstance("pb/widget/Posts"),this._bindOperatePower(),this._getCommentList(t),this._processSaveFaceBubble(),this.requireInstance("pb/widget/postList/FeedBack"),this.requireInstance("pb/widget/postList/PostPic"),Page.checkLoadedModules("forumList"))return;this.requireInstance("pb/widget/postList/HidePost"),this.requireInstance("pb/widget/postList/PrintFlower"),this.requireInstance("pb/widget/postList/TbmallGuide"),this.requireInstance("album/widget/imgLikeAction"),this._bindEvents()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:44}),i}},_loadCommentList:function(t,e){var i=this;i.requireInstance("pb/widget/postList/Lzl"),i._loadSubList=i.requireInstance("pb/widget/sub_list/subListTotal",[{commentData:t,searchCid:e}]),this.require.async(["datalazyload"],function(t){window.datalazyload=new t($(document.body),{diff:500,autoDestroy:!1,subListOnloadCallback:function(t){i._loadSubList.showLzlPost(t)}})})},_getCommentList:function(t){var e=this,i=t.searchCid||0,s=t.pn||1,o=t.isSeeLz||0,n="/p/totalComment?t="+(new Date).getTime();$.getJSON(n,{tid:PageData.thread.thread_id,fid:PageData.forum.forum_id,pn:s,see_lz:o},function(t){0==t.errno&&e._loadCommentList(t.data,i)})},_bindEvents:function(){var t=this;$("#pb_content").delegate(".j_quick_reply, a.p_reply_first","click",function(e){try{return e.preventDefault(),e.stopPropagation(),PageData.user.is_login?setTimeout(function(){t.fire("wanna_post")},50):TbCom.process("User","buildLoginFrame",null,null,null,"quick_reply"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:103}),e}}).delegate(".j_louzhubiaoshi","mouseenter",function(){var t=$(this),e=t.position(),i={content:"\u70B9\u51FB\u5373\u53EF\u201C\u53EA\u770B\u697C\u4E3B\u201D\u54DF~",arrow_dir:"up",arrow_pos:{left:20},bubble_css:{top:e.top+36,left:e.left,width:140},wrap:t.parent(),closeBtn:!1},s=new UiBubbleTipBase(i);s.showBubble({zIndex:$.getcurzIndex()}),t.one("mouseleave",function(){s.closeBubble()})}).delegate(".j_voice_ad_gif","click",function(){try{$.stats.track("voice_ad_gif","voice"),$("body").trigger("showvoicedialog",!0)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:130}),t}}).delegate(".replace_tip","click",function(){try{$(this).hide().parent(".replace_div").css("height","auto"),$(this).closest(".j_d_post_content").find(".cnt_act_vote_area").css("z-index",10)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:133}),t}}).delegate(".j_lzl_forbidden_tip_close","click",function(){try{$(this).parent().parent().slideUp()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:135}),t}})},_processSaveFaceBubble:function(){var t=$.tb.Storage.get("fisfbb_shown_times")||0,e=$.tb.Storage.get("fisfbb_is_today_shown")||!1,i=new Date;i.setDate(i.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),3>t&&!e&&$(".j_fisfbb").on("click",".j_close",function(){try{$.tb.Storage.set("fisfbb_is_today_shown",!0,i),$.tb.Storage.set("fisfbb_shown_times",++t),$(this).remove()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:152}),e}}).show()},_bindOperatePower:function(){Page.checkLoadedModules("pbAdmin")||(PageData.is_thread_admin||PageData.is_posts_admin)&&this.requireInstanceAsync("pb/widget/Admin",[],function(t){t.loadThreadManage(),t.bindAdminEvents(),t.bindLzlAdminEvents()})}}});_.Module.define({path:"tbmall/widget/forumMemberDialog",requires:["tbmall/widget/tbean_safe_ajax"],sub:{opts:{},initial:function(e){var t=this,s={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:""};this.opts=$.extend({},s,e),this.tpl_data.forums=this.opts.forums,this.opts.scores=this.opts.scores||PageData.scores,this.safeAjax=this.use("tbmall/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:886,height:t.opts.cnt_height||295,html:t.buildInitHtml()}),t.opts.current_option=$($(".sel_time .j_pertime_unit")[t.opts.current_time_order]),t.opts.current_option.addClass("current_time_unit"),t.bindEvents()},bindEvents:function(){var e=this,t=$(".excharge_bd"),s=$("#customForum");t.delegate(".j_charge_tdou","click",function(t){var o=e.getTimeValue(),a=e.opts.scores,i=a.scores_money+a.scores_other,r=parseInt(5e3*o),n=$("#customTime").val();return t.preventDefault(),e.opts.is_show_forum?e.util._isEmpty($("#customForum").val())?(e.showErrorForum("empty"),void 0):$.trim(n).length>0&&!e.util._isPositiveDigital(n)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(n),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):e.opts.isClickByUser?r>i?(e.initTdouNotEnough(i,r),void 0):(e.initBuyMember(),void 0):(e.checkHasForum(s.val(),function(t){e.opts.current_forum_id=t.data.forum_id,e.opts.current_forum_name=t.data.forum_name,r>i?e.initTdouNotEnough(i,r):e.initBuyMember()}),void 0):r>i?(e.initTdouNotEnough(i,r),void 0):(e.initBuyMember(),void 0)}),$(".j_close_excharge").on("click",function(t){t.preventDefault(),e.closeDialog()}),$(".excharge_bd").delegate(".j_pertime_unit","click",function(t){t.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._close_tip_bubble(),e.changeTdouNum(),$("#customTime").val("")}),$(".excharge_bd").delegate("#customTime","focus",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),$(".excharge_bd").delegate("#customTime","keyup",function(){var t=$(this).val();return $.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._close_tip_bubble(),e.changeTdouNum(),void 0)}),$(".sel_forum").delegate(".j_forum_unit","click",function(t){t.preventDefault();var o=$(this),a=o.data("forumid"),i=decodeURIComponent(o.text());e.hideErrorForum(),e.opts.current_forum_id=a,e.opts.current_forum_name=i,e.opts.isClickByUser=!0,s.val(i),$(".j_show_more").hasClass("show_more_forums_list")&&$(".j_show_more").removeClass("show_more_forums_list")}),$(".sel_forum").delegate("#customForum","keyup",function(){var t=e.opts.current_forum_name,o=$.trim(s.val());t!==o&&(e.opts.isClickByUser=!1),""===o&&e.hideErrorForum()}),$(".sel_forum").delegate("#customForum","blur",function(){var t=s.val();return e.util._isEmpty(t)?(e.showErrorForum("empty"),void 0):$.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):(e._close_tip_bubble(),e.checkHasForum(t),void 0)}),$(".sel_forum").delegate(".j_get_more_f","click",function(e){e.preventDefault(),$(".j_show_more").toggleClass("show_more_forums_list")}),$(".excharge_bd").delegate(".j_get_tdou","click",function(t){t.preventDefault(),e.closeDialog(),_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()})})},initTdouNotEnough:function(e,t){var s=this,o=s.getTimeValue(),a={month:o,baidu_charge:t,tdou_num:e};s.closeDialog(),s.chargeFailFn($.extend({},a,{f_name:s.opts.current_forum_name}))},initBuyMember:function(){var e=this,t=e.getTimeValue(),s=PageData.user?PageData.user.mParr_props?PageData.user.mParr_props.forum_member?PageData.user.mParr_props.forum_member[e.opts.current_forum_id]:null:null:null,o=function(){e.safeAjax.ajax({url:"/tbmall/mall/buyForumMember",data:{tbs:PageData.tbs,forum_id:e.opts.current_forum_id,buy_num:t},success:function(t){e.closeDialog(),e.chargeSuccessFn(t)}})},a=PageData.user?PageData.user.mParr_props?PageData.user.mParr_props.level?2===PageData.user.mParr_props.level.props_id?PageData.user.mParr_props.level.end_time:0:null:null:null,i=s?s.end_time:0,r=i||a,r=Math.max(Math.max(i,a),1*new Date/1e3);if(t>=24||r&&parseInt(r)+31*t*24*60*60-1*new Date/1e3>=64281600){var n=new $.dialog({html:['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="long_time_area">','<p class="long_time_msg">\u5F00\u901A<b>\u3010'+e.opts.current_forum_name+"\u5427\u7279\u6743\u5305\u3011</b></p>",'<p class="long_time_msg"><b>\u7279\u6743\u65F6\u957F\u6700\u591A\u8FDE\u7EED\u5151\u636224\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</b></p>','<p class="long_time_msg">\u672C\u6B21\u5151\u6362\u9700\u8981<span class="tdou_num">'+5e3*t+"</span></p>",'<div class="long_time_operation">','<a href="#" class="long_time_cancel_btn j_close_excharge">\u53D6&nbsp;\u6D88</a>','<a href="#" class="long_time_accept_btn j_accept_excharge">\u786E&nbsp;\u8BA4</a>',"</div>","</div>"].join(""),width:460,height:170,showTitle:!1}),u=n.element;u.on("click",".j_close_excharge",function(e){e.preventDefault(),n.close()}).on("click",".j_accept_excharge",function(e){e.preventDefault(),o(),n.close()})}else o()},changeCurrentOpt:function(e,t){var s=this;s.opts.current_option&&s.opts.current_option.removeClass(t),s.opts.current_option=e,s.opts.current_option.addClass(t)},changeTdouNum:function(){var e=this;$(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeSuccessFn:function(e){var t=this,s={0:{html:t.buildSuccessHtml(e.data),height:456},2270046:{html:t.buildEnoughHtml(),height:216}};0==e.no&&(t.opts.scores=$.extend(t.opts.scores,e.data.left_scores)),t.showDialog({width:537,height:s[e.no].height,showTitle:!1,html:s[e.no].html}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()})},chargeFailFn:function(e){var t=this;t.showDialog({width:537,height:226,showTitle:!1,html:t.buildFailHtml(e)}),$(".j_close_excharge").on("click",function(e){e.preventDefault(),t.closeDialog()}),$(".j_get_tdou").on("click",function(e){e.preventDefault(),t.closeDialog(),_.Module.use("common/widget/tcharge_dialog")})},buildInitHtml:function(){var e=this,t=baidu.template,s=e.opts.is_show_forum?"\u5151\u6362\u7279\u6743\u5305":"\u5151\u6362\u3010"+e.opts.current_forum_name+"\u5427\u3011\u7279\u6743\u5305";return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(e.tpl.hd,{title:s}),"</div>",'<div class="excharge_bd">','<div class="lp">',e.tpl.bd_lp_t,e.opts.is_show_features?t(e.tpl.features,e.tpl_data):"","</div>",'<div class="rp">',e.opts.is_show_forum?t(e.tpl.bd_rp_forum,e.tpl_data):"",t(e.tpl.bd_rp_time,e.tpl_data),'<p class="long_time_warning">\u7279\u6743\u5305\u65F6\u957F(\u7D2F\u8BA1\u8D85\u7EA7\u4F1A\u5458)\u6700\u591A\u8FDE\u7EED24\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</p>',$.tb.format(e.tpl.bd_rp_tdou,{tdou_num:5e3*e.opts.current_time_unit}),e.tpl.bd_rp_btn,"</div>","</div>"].join("")},buildSuccessHtml:function(e){{var t=this;baidu.template}return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(t.tpl.hd,{title:"\u5151\u6362\u3010"+t.opts.current_forum_name+"\u5427\u3011\u7279\u6743\u5305"}),"</div>",'<div class="excharge_bd excharge_succ_bd">',$.tb.format(t.tpl.charge_success,$.extend(e,{end_time:t.util._getDate(e.end_time)})),"</div>"].join("")},buildEnoughHtml:function(){return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_bd excharge_enough_bd">','<p class="main_intro">\u60A8\u5DF2\u5F00\u901A25\u4E2A\u5427\u7684\u7279\u6743\u5305\uFF0C\u8FBE\u5230\u7279\u6743\u5305\u6570\u91CF\u4E0A\u9650</p>','<p class="sub_intro">\u7ACB\u5373\u5F00\u901A\u8D34\u5427\u4F1A\u5458\uFF0C\u5C3D\u4EAB\u8D34\u5427\u7279\u6743\u65E0\u4E0A\u9650</p>','<a class="j_charge_confirm charge_tdou" href="#">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>',"</div>"].join("")},buildFailHtml:function(e){var t=this;return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(t.tpl.hd,{title:"\u5151\u6362\u3010"+t.opts.current_forum_name+"\u5427\u3011\u7279\u6743\u5305"}),"</div>",'<div class="excharge_bd excharge_fail_bd">','<div class="lp">',t.tpl.bd_lp_t,"<p>\u65F6\u957F\uFF1A"+e.month+"\u4E2A\u6708</p>","</div>",'<div class="rp">',$.tb.format(t.tpl.charge_fail,e),"</div>","</div>"].join("")},tpl_data:{forums:null,features:[{type:"\u7EA2\u8272\u6807\u9898"},{type:"\u7ECF\u9A8C\u52A0\u901F"},{type:"\u76F4\u9001\u7ECF\u9A8C"},{type:"\u8865\u7B7E\u5361",num:"1"},{type:"\u9B54\u62DC",num:"1"},{type:"\u9B54\u86CB",num:"1"}],bd_rp_time:[1,3,6,12]},tpl:{hd:'<p class="title">#{title}</p>',bd_lp_t:['<div class="intro">',"<h5>\u3010\u7279\u6743\u5305\u3011</h5>",'<span class="forum_img_box"></span>','<p class="tdou_num"><strong>5000</strong>/\u6708</p>',"</div>"].join(""),features:['<ul class="features">',"<%for(var i = 0; i< features.length; i++){%>",'<li class="feature_<%=i%>"><%=features[i].type%>',"<%if (!!features[i].num) {%>","<strong>X<%= features[i].num %></strong>","<%}%>","</li>","<%}%>","</ul>"].join(""),bd_rp_forum:['<div class="sel_forum">','<span class="sel_label">\u8BF7\u9009\u62E9\u5427:</span>','<div class="sel_cnt">','<input id="customForum" type="text" value=""/>\u5427','<span class="error_forum_tip empty_forum_tip">\u8BF7\u9009\u62E9\u4E00\u4E2A\u5427</span>','<span class="error_forum_tip hasNot_forum_tip">\u8BE5\u5427\u4E0D\u5B58\u5728</span>',"</div>",'<div class="forum_lists j_show_more">',"<%if (forums.length <= 6) {%>","<%for(var i = 0; i < forums.length; i++) {%>",'<a class="per_forum_unit j_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i]["f_name"]%></a>',"<%}%>","<%}else {%>",'<a class="j_get_more_f">','<span class="more_forum_btn"><ins></ins>\u66F4\u591A</span>','<span class="less_forum_btn"><ins></ins>\u5173\u95ED</span>',"</a>","<%for(var i = 0; i < 6; i++) {%>",'<a class="per_forum_unit j_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i]["f_name"]%></a>',"<%}%>",'<div class="more_forums">',"<%for(var i = 6; i < forums.length; i++) {%>",'<a class="j_forum_unit per_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i].f_name%></a>',"<%}%>","</div>","<%}%>","</div>","</div>"].join(""),bd_rp_time:['<div class="sel_time">','<span class="sel_label">\u8BF7\u9009\u62E9\u65F6\u957F:</span>','<span class="sel_cnt">',"<%for(var i = 0; i< bd_rp_time.length; i++){%>",'<a class="j_pertime_unit per_time_unit" data-value="<%=bd_rp_time[i]%>">',"<strong><%=bd_rp_time[i]%></strong>\u4E2A\u6708",'<span class="decorate_icon"></span>',"</a>","<%}%>",'<a class="j_customTime_unit per_time_unit custom_time">','<input id="customTime" type="text" value=""/><span>\u4E2A\u6708</span>','<span class="decorate_icon"></span>',"</a>","</span>","</div>"].join(""),bd_rp_tdou:['<div class="sel_tdou">','<span class="sel_label">\u9700\u8981T\u8C46:</span>','<span class="tdou_num">#{tdou_num}</span>',"</div>"].join(""),bd_rp_btn:['<a class="j_charge_tdou charge_tdou" href="#">\u7ACB\u5373\u5151\u6362</a>','<p class="be_svip"><a class="j_get_tdou" href="#">\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743</a></p>'].join(""),charge_success:['<div class="charge_success_info">','<p class="charge_month_num">\u60A8\u5DF2\u7ECF\u6210\u529F\u5151\u6362<strong class="forum_name">\u3010#{forum_name}\u5427\u7279\u6743\u5305\u3011</strong></p>','<p class="expire_date">\u6709\u6548\u671F\u81F3#{end_time}</p>',"</div>",'<ul class="charge_success_feature">','<li class="s_feature_1">',"<p>\u7EA2\u8272\u6807\u9898</p>","<span></span>","</li>",'<li class="s_feature_2">',"<p>\u7ECF\u9A8C\u52A0\u901F</p>","<span></span>","</li>",'<li class="s_feature_3">',"<p>\u76F4\u9001\u7ECF\u9A8C</p>","<span></span>","</li>",'<li class="s_feature_4">',"<p>\u9053\u5177\u8D60\u9001</p>",'<span class="props_1">\u8865\u7B7E\u5361X1</span>','<span class="props_2">\u9B54\u62DCX1</span>','<span class="props_3">\u9B54\u86CBX1</span>',"</li>","</ul>",'<p class="success_btns">','<a class="charge_tdou" href="/tbmall/mall/forumMember">\u8BE6\u7EC6\u4E86\u89E3\u7279\u6743</a>','<a class="j_excharge_confirm charge_tdou" href="#">\u5173\u95ED</a>',"</p>"].join(""),charge_fail:['<div class="fail_cnt">','<p>\u5F00\u901A<strong class="forum_name">\u3010#{f_name}\u3011</strong>#{month}\u4E2A\u6708</p>','<p>\u8BE5\u7279\u6743\u9700\u8981<span class="orange_num">#{baidu_charge}</span></p>','<p>\u5F53\u524D\u60A8\u4EC5\u6709<span class="orange_num">#{tdou_num}</span></p>',"</div>",'<a class="j_get_tdou charge_tdou" href="#">\u83B7\u53D6T\u8C46</a>'].join("")},showErrorForum:function(e){$(".error_forum_tip").hide(),$("."+e+"_forum_tip").css("display","inline-block")},hideErrorForum:function(){$(".error_forum_tip").hide()},checkHasForum:function(e,t){var s=this;$.post("../get/checkForum",{forum_name:encodeURIComponent(e),tbs:PageData.tbs}).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?s.showErrorForum("hasNot"):(s.hideErrorForum(),$.isFunction(t)&&t(e)))})},showDialog:function(e){this._dialog=new $.dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},_build_tip_bubble:function(e){var t=this,s={content:e,arrow_dir:"up",bubble_css:{top:t.opts.is_show_forum?124:52,right:45,width:130,"z-index":9999},arrow_pos:{left:10},attr:"",wrap:$(".sel_time"),closeBtn:!0};this.opts.tip_bubble=new UiBubbleTipBase(s);var o=this.opts.tip_bubble;o.showBubble(),o.bind("onclose",function(){t._close_tip_bubble()})},_close_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_show_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._show_tip_bubble():this._build_tip_bubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var t=new Date(1e3*e),s=t.getFullYear(),o=t.getMonth()+1,a=t.getDate();return s+"\u5E74"+o+"\u6708"+a+"\u65E5"}}}});_.Module.define({path:"user/widget/myCurrentForum",requires:["common/widget/JoinVipDialog","tbmall/widget/forumMemberDialog"],sub:{initial:function(){this.joinVipDialogInstance=this.use("common/widget/JoinVipDialog"),this.user=PageData.user,this.forum=PageData.forum,this.bindEvents()},bindEvents:function(){var e=this;$(".user_level .badge, .user_level .badge_block").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_intro"),!1}),$(".user_level .exp_bar").bind("click",function(){return window.open("/f/like/level?kw="+PageData.forum.name_url+"&lv_t=lv_nav_who"),!1}),$(".user_level").on("click",".j_exp_speedup",function(n){if(n&&n.preventDefault(),e.user.mParr_props&&e.user.mParr_props.level&&e.user.mParr_props.level.props_id>0&&1e3*e.user.mParr_props.level.end_time>+new Date)return e.joinVipDialogInstance.getMemberDialog(),!1;new $.dialog({html:'<h2 style="text-align:center;margin: 20px 0;">\u5F00\u901A\u9AD8\u7EA7\u4F1A\u5458,\u83B7\u7B7E\u5230<span style="color:orange">6</span>\u500D\u7ECF\u9A8C!</h2><div  style="text-align:center;margin: 20px 0;"><a class="j_join_vip ui_btn ui_btn_m" style="margin-right:20px;"><span><em>\u7ACB\u5373\u5F00\u901A</em></span></a><a class="ui_btn ui_btn_sub_m" target="_blank" href="http://tieba.baidu.com/tbmall/tshow"><span><em>\u4E86\u89E3\u4F1A\u5458</em></span></a></div>',title:"\u63D0\u793A",width:500});return $(".j_join_vip").click(function(n){n&&n.preventDefault(),e.joinVipDialogInstance.getMemberDialog()}),!1}),$(".j_beFMember").on("click",function(n){n.preventDefault();var r=($(this),{scores_money:0,scores_other:0});e.use("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.forum_id,current_forum_name:e.forum.forum_name,scores:e.user.Parr_scores?e.user.Parr_scores:r,cnt_height:225,callback:function(){$.tb.location.reload()}})}),$(".fMember_cnt").on("mouseover",function(){$(".feature_panel").is(":visible")||$(".feature_panel").show()}).on("mouseout",function(){$(".feature_panel").hide()})}}});_.Module.define({path:"encourage/widget/encourageEntry",sub:{initial:function(){this._root=$("#encourage_entry"),this._stats()},_stats:function(){this._root.on("click","a",function(){var t=$(this).data("log");$.stats.track(t,"\u7528\u6237\u6FC0\u52B1\u53F3\u4FA7\u5165\u53E3")})}}});_.Module.define({path:"common/component/LoginForm",sub:{_formKey:"",_formType:0,_jq_wrapper:null,_loginInstance:null,_pageLoginIndex:0,_userInputTip:{_jq_input:null,_jq_tip:null,_jq_newtip:null,type:"normal",init:function(){}},initial:function(n,e,t){this._formKey=e,this._formType=t?t:this._formType,this._jq_wrapper=n;var o=this,i="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();$.JsLoadManager.use("http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(i/6e4),function(){o._initLoginApi()})},_initLoginApi:function(){var n=this;passport.use("login",{tangram:!0},function(e){n._loginInstance=new e.passport.login({product:"tb",loginType:1,defaultCss:!1,loginMerge:!0,hasRegUrl:!0,memberPass:!0,autosuggest:!1,hasPlaceholder:!0,sms:!1,u:$.tb.location.getHref(),isPhone:!1,safeFlag:0,staticPage:"http://tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"});var t=n._jq_wrapper.find(".login_form")[0];n._loginInstance.render(t),n._loginInstance.on("loginSuccess",function(e){Stats.sendRequest("fr=tb0_forum&st_mod="+n._formKey+"&st_type=login_succeed"),$.tb.location.reload(),e.returnValue=!1}),n._loginInstance.on("beforeSubmit",function(){Stats.sendRequest("fr=tb0_forum&st_mod="+n._formKey+"&st_type=login_click")})})}}});_.Module.define({path:"comforum/widget/HistoryGame",sub:{initial:function(){this._bindEvents(),this._showTrack()},_showTrack:function(){var t="";"frs"===PageData.product?t="FRS\u9875":"pb"===PageData.product&&(t="PB\u9875");var a=$(".game_content .game_h .game_link");if(a.length>0){var e=[];a.each(function(){e.push($(this).tbattr("title"))}),$.stats.track(t+"_\u6211\u7684\u6E38\u620F","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u5C55\u73B0",{obj_name:e.join(","),obj_type:"\u6211\u7684\u6E38\u620F"})}var n=$(".game_content .game_s .game_link");if(n.length>0){var i=[];n.each(function(){i.push($(this).tbattr("title"))}),$.stats.track(t+"_\u63A8\u8350\u6E38\u620F","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u5C55\u73B0",{obj_name:i.join(","),obj_type:"\u63A8\u8350\u6E38\u620F"})}},_bindEvents:function(){var t="",a=$(".game_tab"),e=$(".game_content");"frs"===PageData.product?t="FRS\u9875":"pb"===PageData.product&&(t="PB\u9875"),a.on("click","li",function(){var n=$(this).data("game"),i="game_h"==n?"\u6211\u7684\u6E38\u620F":"\u63A8\u8350\u6E38\u620F";a.children("li").removeClass("sel"),$(this).addClass("sel"),e.children("ul").removeClass("sel").end().children("ul."+n).addClass("sel"),$.stats.track(t+"_"+i+"_tab","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_type:i})}),e.on("click",".j_stats",function(){var a=$(this).data("category"),e="h"==a?"\u6211\u7684\u6E38\u620F":"\u63A8\u8350\u6E38\u620F",n=$(this).find("img").tbattr("src"),i=$(this).tbattr("title");"undefined"==typeof n&&(n=""),$.stats.track(t+"_"+e,"PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:n,obj_name:i,obj_type:e})}),$("#game_login_btn").on("click",function(){return PageData.user.is_login||_.Module.use("common/widget/LoginDialog",[],function(){}),!1}),$(".j_privilege_btn").on("click",function(){$.stats.track("\u6E38\u620F\u7279\u6743","\u6E38\u620F\u7279\u6743","","\u70B9\u51FB",{obj_type:"\u6E38\u620F\u7279\u6743",obj_name:"\u6E38\u620F\u7279\u6743",obj_url:"-"})})}}});_.Module.define({path:"comforum/widget/u9Aside",requires:[],sub:{initial:function(e){this.gameName=e.game_name||"",this.gameType=e.game_type||"",this.viewData=e.view_data||[],this.bindEvents()},bindEvents:function(){if(this.gameType){var e=this,a=0,i=this.viewData.length,t=[],s=1==this.gameType?"U9\u5B9A\u5236\u7248":"U9\u901A\u7528\u7248";if(i>0)for(this.gameName=this.viewData[0].summary,a;i>a;a++)t.push(this.viewData[a].summary);$.stats.track("\u53F3\u4FA7",s,"","view",{obj_type:"U9",obj_name:e.gameName,obj_game:t}),$(".u9_aside").on("click",".u9_aside_list a",function(){$.stats.track("\u793C\u5305","U9\u901A\u7528\u7248","","click",{obj_type:"U9",obj_name:$(this).data("code")})})}}}});_.Module.define({path:"encourage/widget/scoreGain",requires:["common/widget/Card","encourage/widget/scoreOnlineTime","encourage/widget/scoreRandEgg","encourage/widget/scoreCustomEgg","encourage/widget/scoreProvideEgg","encourage/widget/scoreMonthIcon"],sub:{NEW_DEAD_LINE:13962816e5,URL:{postHeartBeat:"/tbscore/timebeat",fetchGift:"/tbscore/fetchtg",openGift:"/tbscore/opengift",aquireScore:"/tbmall/eggs/eggslist",findScore:"/tbmall/eggs/searcheggs",provideScore:"/tbmall/eggs/userSendPrivateEgg",myAquireScore:"/tbmall/eggs/mygeteggs",myProvideScore:"/tbmall/eggs/mysendeggs",initEggAndDynamic:"/tbmall/eggs/feedlist",initVIPEgg:"/tbscore/eggsvip",openVIPScore:"/tbmall/eggs/userGetVipEgg",openCustomScore:"/tbmall/eggs/userGetPrivateEgg",followUser:"/home/post/follow"},initial:function(e){this.tbs=PageData.tbs||"0",this.fr=PageData.product||"frs",this.forum_id=PageData.forum.forum_id||0,this.controlCenter=$("#tbmall_score_control_center"),this.opt=$.extend(e,{controlCenter:this.controlCenter}),this.scoreEncWrap=$(".score_encourage"),this.bindEvents(),this.scoreEncourage(),this.randEgg=this.use("encourage/widget/scoreRandEgg",this.opt),this.customEgg=this.use("encourage/widget/scoreCustomEgg",this.opt),this.provideEgg=this.use("encourage/widget/scoreProvideEgg",this.opt),this.animateEgg=this.use("encourage/widget/scoreAnimation",this.opt),this.monthIcon=this.use("encourage/widget/scoreMonthIcon")},showOfflineCard:function(){var e=this,t=(new Date).getTime();$.tb.Storage.get("score_doupiao_offline")>t-864e5||(this.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/tbmall/doudizhu?page=5"><img style="margin: 4px 4px 0;" src="http://tb2.bdstatic.com/tb/static-encourage/widget/score_gain/images/offline_6a3513f.png"></a>',clazz:"doupiao_offline",arrow_dir:"down",card_css:{width:170,"z-index":1e3,left:12,top:-35},wrap:$(".online_time"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("score_doupiao_offline",t),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("score_doupiao_offline",t+1296e6),e.offline_card._j_card.remove()}),this.offline_card.showCard())},scoreEncourage:function(){var e=this;this.scoreEncWrap.on("click",".provide_score_btn a.score_btn",function(){{var t=e.opt.wrapper.find(".score_slide");e.opt.wrapper.find(".score_list")}t.hasClass("score_slide_down")||t.trigger("click"),e.controlCenter.off("score.finishEggAndDynamic").one("score.finishEggAndDynamic",function(){var t=e.opt.wrapper.find(".score_provide .provide_score_btn a.score_btn");t.trigger("click")});var o=e.opt.wrapper.find(".score_provide .provide_score_btn a.score_btn");return o.trigger("click"),!1})},bindEvents:function(){var e=this,t=this.opt.wrapper.find(".score_slide"),o=this.opt.wrapper.find(".score_wrapper");t.on("click",function(){o.slideToggle(),e.scoreEncWrap.slideToggle(),$(this).toggleClass("score_slide_down")}).one("click",function(t,o){o||e.customEgg.initScore("aquireScore"),e.provideEgg.initList()}),e.controlCenter.bind("score.openScore",function(t,o,i){e.openGift(o,i)}).bind("score.openVIPScore",function(t,o,i){e.openVIPScore(o,i)}).bind("score.openCustomScore",function(t,o,i){e.openCustomScore(o,i)}).bind("score.heartBeat",function(t,o){e.heartBeatHandler(o)}).bind("score.fetchScore",function(){e.fetchGift()}).bind("score.aquireScore",function(t,o,i){e.updateScore(o,i)}).bind("score.findScore",function(t,o,i){e.updateScore(o,i)}).bind("score.provideScore",function(t,o){e.provideScore(o)}).bind("score.myAquireScore",function(t,o,i){e.updateScore(o,i)}).bind("score.myProvideScore",function(t,o,i){e.updateScore(o,i)}).bind("score.initEggAndDynamic",function(t,o){e.initEggAndDynamic(o)}).bind("score.initVIPEgg",function(t,o){e.initVIPEgg(o)}).bind("score.followUser",function(t,o,i){e.followUser(o,i)})},heartBeatHandler:function(e){var t,o,i="noGift",r=e.data.gift_info;this.onlineTime.timeBarInit(e.data.time_stat);for(t in r)if(o=r[t],2==o.gift_type){var n=e.data.eggs_style;this.randEgg.initRandGift(o,n)}else 1==o.gift_type&&(i=o);this.onlineTime.timeGiftInit(i,e.data.time_stat)},posterTextInit:function(e){window.repeat_has_score=e.data.time_stat.repeat_has_score},postHeartBeat:function(){var e=this;e.reqCtrl("postHeartBeat",function(t){0==t.no&&e.posterTextInit(t)})},fetchGift:function(){var e=this;e.reqCtrl("fetchGift",function(t){0==t.no&&e.heartBeatHandler(t)})},openGift:function(e,t){var o=this;o.reqCtrl("openGift",e,function(i){0!=i.no&&$.isEmptyObject(i.data.gift_got)?("time"===e.type&&o.onlineTime.showTips("overTime"),o.heartBeatHandler(i)):("time"===e.type?o.onlineTime.addScore(i,e,t):o.animateEgg.startAnimate(i,t),$.cookie("monthicon_tip")||o.monthIcon.showMonthIconTip())})},provideScore:function(e){var t=this;t.reqCtrl("provideScore",e,function(e){t.provideEgg.handleRes(e.no),t.provideEgg.handleTip(e)})},openVIPScore:function(e,t){var o=this;return PageData.user&&PageData.user.Parr_props&&PageData.user.Parr_props.level&&2==PageData.user.Parr_props.level.props_id&&1e3*PageData.user.Parr_props.level.end_time>(new Date).getTime()?(o.reqCtrl("openVIPScore",e,function(i){if("2270012"==i.no)o.randEgg.authError(t);else{var r=new Date;r.setDate(r.getDate()+1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),"vip1"==e.vip_type?$.cookie("has_vip1_egg",1,{expires:r}):$.cookie("has_vip2_egg",1,{expires:r}),o.animateEgg.startAnimate(i,t)}}),void 0):(o.randEgg.authError(t),void 0)},openCustomScore:function(e,t,o){var i=this;$.extend(e,o),i.reqCtrl("openCustomScore",e,function(o){"2270012"==o.no?i.customEgg.authError(t):40==o.no?i._validVCode(o,function(o){i.openCustomScore(e,t,o)},function(){}):(i.animateEgg.startAnimate(o,t),i.customEgg.closeOpened(t))})},_validVCode:function(e,t,o){_.Module.use("common/component/CaptchaDialog",{message:e.data.vcode.str_reason,vCode:e.data.vcode.captcha_vcode_str,vCodeType:e.data.vcode.captcha_code_type,exceptionalAccount:1==e.data.vcode.userstatevcode,forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,title:"\u9886\u5F69\u86CB",forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,checkUrl:"/tbmall/vcode/checkvcode?tbs="+PageData.tbs,vCodeUrl:"/tbmall/vcode/getvcode",paramsCallback:function(){return{app:"getEgg",tbs:PageData.tbs,forum_id:PageData.forum.forum_id}}},function(e){e.bind("onclose",function(){return e.hide(),o(),!1}),e.bind("onaccept",function(){var o={};o.vcode=e.getInputValue(),o.vcode_md5=e.getVCode(),"function"==typeof t&&t(o)}),e.show()})},updateScore:function(e,t){var o=this;o.reqCtrl(e,t,function(t){0==t.no?o.customEgg.updateList(e,t.data):o.customEgg.handError()})},initEggAndDynamic:function(e){var t=this;t.reqCtrl(e,function(e){0==e.no&&t.provideEgg.initEggAndDynamic(e.data)})},initVIPEgg:function(e){var t=this;t.reqCtrl(e,function(e){0==e.no&&t.randEgg.getVIPEgg(e.data)})},followUser:function(e,t){var o=this;o.reqCtrl(e,t,function(e){o.customEgg.followError(e.no)})},reqCtrl:function(e,t,o){var i,r,n=this,a=n.URL[e],c={tbs:n.tbs,fr:n.fr,forum_id:n.forum_id,ie:"utf8"};arguments.length>2?(r=o,i="provideScore"==e?t+"&tbs="+PageData.tbs+"&forum_id="+PageData.forum.forum_id:$.extend(c,t)):(r=t,i=c),$.post(a,i,function(e){"function"==typeof r&&r(e)})}}});
;_.Module.define({path:"encourage/widget/scoreOnlineTime",requires:[],sub:{timeGiftHTML:['<div class="time_keeper">','<a class="time_gift"></a>','<span class="time_wrapper"></span>','<div class="active_len"></div>','<ul class="time_bar clearfix">',"<li>",'<div class="time_edge_first"></div>','<div class="time_point_first">0\'</div>','<div class="time_point">10\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">30\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">50\'</div>','<div class="time_edge"></div>',"</li>","<li>",'<div class="time_point">90\'</div>','<div class="time_edge"></div>',"</li>","</ul>","</div>"].join(""),blockRanges:{0:0,1:600,2:1800,3:3e3},currentDomLen:68,tips:["\u70B9\u51FB\u9886\u53D6\u5956\u52B1","\u4FDD\u6301\u5728\u7EBF\u53EF\u83B7\u5F97\u4E00\u888B\u8C46\u7968"],initial:function(t){this.timeGiftWrapper=t.wrapper.find(".online_time"),this.scoreIncre=t.scoreIncre,this.controlCenter=t.controlCenter,this.timeKeeper=$(this.timeGiftHTML).appendTo(this.timeGiftWrapper),this.giftTips=null,this.timeInterval=null,this.criticalLen=0,this.timeRange=0,this.timeStep=0,this.activeRange=0,this.currentLen=null,this.activeLen=this.timeKeeper.find(".active_len"),this.timeGift=this.timeKeeper.find(".time_gift"),this.bindEvents()},bindEvents:function(){var t=this,i={};this.timeKeeper.delegate(".unopen_gift","click",function(){i={type:"time",gift_key:$(this).getData().gift_key},t.controlCenter.trigger("score.openScore",[i,$(this).addClass("bomb_gift")])}),$("body").delegate(".time_gift_tip_close","click",function(){return $("#time_gift_tip_card .all_gift_got").length>0&&$.cookie("all_time_gift_got","close"),$("#time_gift_tip_card").remove(),t.giftTips=null,!1})},timeGiftInit:function(t,i){var e=this,s=i.time_has_score,n=i.interval_type,a=i.time_len;this.timeGift.tbattr({"class":"time_gift",style:""}),s!==!1&&4!=n&&("noGift"==t?(this.activeRange=this.currentDomLen*(i.now_time-i.interval_begin_time)/a,this.currentLen.append(this.timeGift.addClass("next_gift").tbattr("title",this.tips[1])),this.timeEnd-this.timeRange<=this.criticalLen&&(this.activeRange=this.currentDomLen*(a-this.criticalLen)/a),this.activeLen.width(parseInt(this.activeRange)),this.timeInterval=setInterval(function(){return e.timeCounter()},1e3)):(this.activeLen.width(this.currentDomLen),this.currentLen.append(this.timeGift.addClass("unopen_gift").bindData(t).tbattr("title",this.tips[0]))))},timeBarInit:function(t){this.timeKeeper.show();var i=this.timeKeeper.find(".time_bar"),e=this.timeKeeper.find(".time_bar li").removeClass(),s=t.time_len,n=t.now_time-t.interval_begin_time,a=t.time_has_score,r=t.interval_type;if(clearInterval(this.timeInterval),this.timeKeeper.find(".time_keeper_tip").hide(),this.timeInterval=null,4==r)return e.addClass("allpass"),i.addClass("allGiftGot"),this.activeLen.width(0),this.timeKeeper.find(".time_keeper_tip").show(),this.showTips("allGiftGot"),void 0;if(a===!1)return e.addClass("allunpass"),i.addClass("overScore"),this.activeLen.width(0),this.showTips("overScore"),void 0;for(var l=0;4>l;l++)r>l?e.eq(l).addClass("pass_len"):l==r?this.currentLen=e.eq(l).addClass("curren_len").append(this.activeLen):e.eq(l).addClass("unpass_len");this.timeEnd=this.blockRanges[r]+s,this.criticalLen=t.critical_len,this.timeRange=this.blockRanges[r]+n,this.timeRange=this.timeEnd-this.timeRange>this.criticalLen?this.timeRange:this.timeEnd-this.criticalLen,this.timeStep=this.currentDomLen/s},timeCounter:function(){if(this.timeRange>=this.timeEnd)clearInterval(this.timeInterval),this.timeInterval=null,this.controlCenter.trigger("score.fetchScore");else{this.timeRange+=1;var t=this.timeEnd-this.timeRange;t<=this.criticalLen&&this.timeGift.addClass("red_to_grey"),this.activeRange+=this.timeStep,this.activeLen.width(parseInt(this.activeRange))}},addScore:function(t,i,e){var s={type:"time",len:6,pos:["0 30px","0 -90px","0 -120px","0 -150px","0 -180px","0 -210px","0 30px"]};e.bindData(t.data.gift_got),this.burstAnimate(t,s,e,0)},burstAnimate:function(t,i,e,s){var n=this;setTimeout(function(){e.css("backgroundPosition",i.pos[s]),s<i.len?(n.burstAnimate(t,i,e,++s),2==s&&n.scoreAnimate(i,e)):n.controlCenter.trigger("score.heartBeat",[t])},50)},scoreAnimate:function(t,i){var e=i.offset(),s=i.getData().gift_score,n=null;s||(s=0),n=$('<div class="fly_score_online">+'+s+"\u8C46\u7968</div>").css({top:e.top+5,left:e.left}).appendTo("body").animate({top:"-=100",left:"+=50",opacity:.4},2e3,function(){$(this).remove()})},showTips:function(t){var i=this,e={overScore:'<div class="time_gift_tip">\u60A8\u7684\u3010\u8C46\u7968\u3011\u5DF2\u8FBE\u5230\u4E0A\u9650\uFF01<a href="/tbmall/getTdou">\u8C46\u7968\u4E0A\u9650\u8BF4\u660E</a><a class="time_gift_tip_close" onclick="return false;"></a></div>',overTime:'<div class="time_gift_tip">\u793C\u5305\u5DF2\u7ECF\u8FC7\u671F\uFF0C\u4E0B\u6B21\u8BF7\u5C3D\u5FEB\u9886\u53D6\uFF01\uFF08\u793C\u5305\u5F69\u86CB\u5F53\u65E5\u6709\u6548\u3002\uFF09</div>',allGiftGot:'<div class="time_gift_tip all_gift_got">\u4ECA\u65E5\u5728\u7EBF\u6D3B\u8DC3\u5956\u52B1\u5DF2\u7ECF\u9886\u53D6\u5B8C\u6210<a class="time_gift_tip_close" onclick="return false;"></a></div>'};i.giftTips&&(i.giftTips.closeCard(),i.giftTips=null),"allGiftGot"!=t&&(i.giftTips=i.use("common/widget/Card",{wrap:i.timeKeeper,content:e[t],card_css:{width:180,height:50,top:-28,left:6,zIndex:9999},card_leave_display:/^(overScore|allGiftGot)$/.test(t)?!0:!1,attr:"id = 'time_gift_tip_card'"}),i.giftTips.showCard())}}});
;_.Module.define({path:"encourage/widget/scoreRandEgg",requires:["encourage/widget/scoreAnimation","common/widget/JoinVipDialog"],sub:{randGiftHTML:['<a class="score_egg" title="\u6253\u5F00\u5F69\u86CB\u6709\u673A\u4F1A\u83B7\u5F97T\u8C46\u54E6" onclick="return false;">','<img src="">',"</a>"].join(""),giftGuide:!1,initial:function(e){this.fr=PageData.product,this.wrapperDom=e.wrapper,this.slideDom=e.wrapper.find(".score_slide"),this.eggDom=e.wrapper.find(".score_show"),this.controlCenter=e.controlCenter,this.randGift=$(this.randGiftHTML),this.initEggBlock(),this.initVIPEgg(),this.bindEvents()},initEggBlock:function(){var e=['<p>\u6709<span class="score_total_left"></span>\u679A\u798F\u5229\u5F69\u86CB <a class="j_score_open" href="javascript:;">\u3010\u5FEB\u6765\u62A2\u3011</a></p>',"</div>"].join("");this.eggDom.append(e)},bindEvents:function(){var e=this,i={};e.randGift.one("click",function(){i={type:"rand",gift_key:$(this).getData().gift_key},e.controlCenter.trigger("score.openScore",[i,$(this)]),e.slideDom.trigger("click")}),e.wrapperDom.on("click",".j_VIP_score",function(){return e.slideDom.hasClass("score_slide_down")||e.slideDom.trigger("click"),i=$(this).getData(),i.vip_type=$(this).data("vip"),e.controlCenter.trigger("score.openVIPScore",[i,$(this)]),!1}).on("mouseleave",".j_VIP_score",function(){return e.vip_card&&e.vip_card.closeCard({type:"delayClose",time:200}),e.vip_card=null,!1}).on("click",".j_score_open",function(){e.slideDom.hasClass("score_slide_down")||e.slideDom.trigger("click")})},initRandGift:function(e,i){if(null!=this.randGift){var t=this.eggDom.find(".block_middle"),n=$.extend({},e,i);this.randGift.find("img").tbattr("src",n.image),this.randGift.bindData(n).appendTo(t)}},initVIPEgg:function(){this.controlCenter.trigger("score.initVIPEgg",["initVIPEgg"])},getVIPEgg:function(e){var i=0,t="",n=null,o=this.eggDom.find(".score_total_left");delete e.vip1;for(t in e)if(n=e[t])if("left_number"!=t){if(i>1)return;++i}else o.html(n)},authError:function(e){var i=e.data("vip");if(i&&"vip2"===i){var t=new Date;t.setDate(t.getDate()+1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),$.cookie("has_vip2_egg",1,{expires:t})}_.Module.use("encourage/widget/scoreAnimation",[{wrapperDom:this.wrapperDom,controlCenter:this.controlCenter}],function(i){i.startAnimate({},e)}),_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()})}}});
;_.Module.define({path:"encourage/widget/scoreCustomEgg",requires:["common/component/JsPager"],sub:{initial:function(e){this.fr=PageData.product,this.scoreWrapper=e.wrapper.find(".score_wrapper"),this.slideDom=e.wrapper.find(".score_slide"),this.scoreTab=e.wrapper.find(".score_tab"),this.scoreList=e.wrapper.find(".score_list"),this.scorePager=e.wrapper.find(".score_pager"),this.scoreProvide=e.wrapper.find(".score_provide"),this.guideDom=e.wrapper.find(".score_guide"),this.eggBlockDom=e.wrapper.find(".score_show .egg_block"),this.controlCenter=e.controlCenter,this.pager=null,this.bindEvents()},bindEvents:function(){var e=this;$("#tbmall_score_region").on("click",".tbmall_score_op, .tip_to_find",function(){e.slideDom.hasClass("score_slide_down")||e.slideDom.trigger("click",[!0]),e.eggBlockDom.slideUp(),e.initScore("findScore",!0)}),this.scoreTab.on("click",".find_score_tab .tab_btn",function(){e.initScore("findScore")}).on("click",".find_score_tab .tab_close",function(){e.eggBlockDom.slideDown(),e.initScore("aquireScore")}).on("click",".my_score_tab li",function(){var i=$(this).tbattr("data-type"),t=$(this).closest(".my_score_tab").find("li");t.removeClass("sel"),$(this).addClass("sel"),e.initScore(i)}),this.scoreList.on("click",".aquire_score_item .info_btn",function(){if(!$(this).hasClass("info_btn_disable")){e.scoreList.find(".item_info").slideUp();var i=$(this).closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");e.scoreList.find(".item_detail").not(r).slideUp(),t.slideUp(),r.slideDown(),e.scoreProvide.slideUp()}return!1}).on("click",".aquire_score_item .detail_close",function(){var i=$(this).closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");e.scoreList.find(".item_info").not(t).slideDown(),t.slideDown(),r.slideUp(),e.scoreProvide.slideDown()}).on("click",".my_provide_item .info_btn",function(){e.scoreList.find(".item_info").slideDown();var i=$(this).closest(".my_provide_item"),t=i.find(".item_detail");t.slideDown(),e.scoreList.find(".item_detail").not(t).slideUp()}).on("click",".j_custom_score",function(){return opt=$(this).getData(),e.controlCenter.trigger("score.openCustomScore",[opt,$(this)]),!1}).on("click",".j_user_attention",function(){e.followUser($(this))}),this.guideDom.on("click",".j_my_score",function(){return e.initScore("myProvideScore"),e.scoreProvide.find(".provide_score_btn").tbattr("class","aquire_score_btn"),!1}),this.scoreProvide.on("click",".aquire_score_btn a",function(){e.eggBlockDom.slideDown(),e.initScore("aquireScore"),$(this).parent(".aquire_score_btn").tbattr("class","provide_score_btn")})},initScore:function(e,i){var t=1;return this.scorePager.empty(),this.pager=null,this.initTab(e),i?(this.scoreList.empty(),void 0):(this.getList(e,{pn:t}),void 0)},initTab:function(e){var i={aquireScore:"",findScore:['<div class="find_score_tab">','<p class="tab_title">\u6D88\u8017 50 T\u8C46\u5728\u5168\u5427\u627E\u798F\u5229\u5F69\u86CB</p>','<p><a class="tab_btn" href="#" onclick="return false;"></a></p>','<a class="tab_close" href="#" onclick="return false;"></a>',"</div>"].join(""),myProvideScore:['<div class="my_score_tab provide_tab">','<ul class="clearfix">','<li class="sel tab_left" data-type="myProvideScore">\u6211\u53D1\u7684\u5F69\u86CB</li>','<li class="tab_right" data-type="myAquireScore">\u6211\u9886\u53D6\u7684\u5F69\u86CB</li>',"</ul>","<p>\u5F69\u86CB\u989D\u5EA6","<span></span>\u9886\u53D6\u6B21\u6570","<span></span>\u9886\u53D6\u4EBA","</p>","</div>"].join(""),myAquireScore:['<div class="my_score_tab aquire_tab">','<ul class="clearfix">','<li class="tab_left" data-type="myProvideScore">\u6211\u53D1\u7684\u5F69\u86CB</li>','<li class="sel tab_right" data-type="myAquireScore">\u6211\u9886\u53D6\u7684\u5F69\u86CB</li>',"</ul>","<p>\u53D1\u798F\u5229\u7684\u4EBA","<span></span>\u9886\u53D6\u7684\u5427","<span></span>\u9886\u53D6\u989D\u5EA6","</p>","</div>"].join("")};"aquireScore"==e?this.scoreTab.slideUp().html(i[e]):this.scoreTab.html(i[e]).slideDown()},aquireScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="aquire_score_item" #{data}>','<div class="item_info clearfix">','<div class="info_block">','<p><a class="" title="#{user_name_enty}" href="#{user_link}" target="_blank" #{user_data}>',"#{user_name}</a>\u7684\u798F\u5229</p>",'<p class="info_num">\u798F\u5229\u603B\u989D#{total_score}T\u8C46</p>',"</div>",'<a class="info_btn #{info_disable}" href="#" onclick="return false;"></a>',"</div>",'<div class="item_detail">','<div class="detail_head clearfix">','<a class="detail_user" href="#{user_link}" target="_blank" ${user_data}>','<img src="#{user_portrait}" alt="\u7528\u6237\u5934\u50CF"/>',"</a>",'<div class="detail_block">','<p><a class="" title="#{user_name_enty}" href="#{user_link}" target="_blank" #{user_data}>',"#{user_name}</a>\u7684\u798F\u5229</p>",'<p class="detail_attention">','<a class="j_user_attention" href="#" onclick="return false;" #{user_data}>\u5173\u6CE8Ta</a>',"</p>","</div>","</div>",'<div class="detail_area">','<a class="j_custom_score score_egg" href="#" onclick="return false;" #{score_data}>','<img src="#{image}" />',"</a>","</div>",'<div class="detail_condition">','<p class="j_limit_error" #{forum_data}>\u9886\u53D6\u6761\u4EF6\uFF1A','<a href="#{forum_link}" title="#{forum_name_enty}" target="_blank">',"#{forum_name}</a>\u5427 LV#{level}\u4EE5\u4E0A</p>",'<p class="j_limit_total">\u798F\u5229\u603B\u989D\uFF1A<b>#{total_score}</b>&nbsp;T\u8C46</p>',"</div>",'<a class="detail_close" href="#" onclick="return false;"></a>',"</div>","</div>"].join("");t>i&&5!==i;i++)r=e[i],s={data:$.tb.dataField(r),image:r.image,user_data:$.tb.dataField({un:r.user_name}),user_name:$.tb.subByte(r.user_name,12),user_name_enty:r.user_name,user_link:"/home/main/?ie=utf8&un="+r.user_name+"&fr="+this.fr,user_portrait:r.portrait,left_num:r.left_number,forum_data:$.tb.dataField({forum_name:r.cond_forum_name,forum_link:"/f?kw="+r.cond_forum_name,level:r.cond_user_level}),forum_name:$.tb.subByte(r.cond_forum_name,12),forum_name_enty:r.cond_forum_name,forum_link:"/f?kw="+r.cond_forum_name,level:r.cond_user_level,score_data:$.tb.dataField(r),score_image:r.image,info_disable:r.get_status?"info_btn_disable":"",total_score:r.score},a+=$.tb.format(n,s);return a},findScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="find_score_item">','<div class="item_info clearfix">','<img src="#{image}" alt="\u5427\u5934\u50CF"/>','<div class="info_block">','<p><a href="#{forum_link}" title="#{forum_name_enty}" target="_blank">',"#{forum_name}</a>\u5427</p>",'<p class="info_num">\u8FD8\u5269\u4E2A#{left_num}</p>',"</div>",'<a class="info_btn" target="_blank" href="#{forum_link}"></a>',"</div>","</div>"].join("");t>i&&5!==i;++i)r=e[i],s={image:r.portrait,forum_name:$.tb.subByte(r.forum_name,14),forum_name_enty:r.forum_name,forum_link:"/f?kw="+r.forum_name,left_num:r.left_num},a+=$.tb.format(n,s);return a},myProvideScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="my_provide_item">','<div class="item_info clearfix">','<span class="info_val" title="#{info_val_enty}">#{info_val}</span>','<span class="info_num">#{info_num}\u6B21</span>','<a class="info_btn" href="#" onclick="return false;"></a>',"</div>",'<div class="item_detail">',"#{details}","</div>","</div>"].join("");t>i&&5!==i;i++)r=e[i],s={image:r.image,info_val:$.tb.subByte(r.score,6),info_val_enty:r.score,info_num:r.number,details:this.initInfo(r.user_list)},a+=$.tb.format(n,s);return a},initInfo:function(e){var i="",t=0,r=0,a=null,s={},n=['<p><span title="#{user_name_enty}">#{user_name}</span>\u9886\u53D6\u4E86<span>#{get_score}</span>T\u8C46</p>'].join("");if($.isArray(e))for(r=e.length;r>t;++t)a=e[t],s={user_name:$.tb.subByte(a.user_name,12),user_name_enty:a.user_name,get_score:a.get_score},i+=$.tb.format(n,s);return i},myAquireScore:function(e){for(var i=0,t=e.length,r=null,a="",s={},n=['<div class="my_aquire_item">','<span title="#{from_user_name}">#{from_user_name}</span>','<span title="#{forum_name}\u5427">#{forum_name}\u5427</span>',"<span>#{get_score}T\u8C46</span>","</div>"].join("");t>i&&10!==i;i++)r=e[i],s={forum_name:r.forum_name,from_user_name:r.from_user_name,get_score:r.get_score},a+=$.tb.format(n,s);return a},updateList:function(e,i){if(!i.list||0===i.list.length)return this.handError("emptyData"),void 0;var t=this;null==this.pager&&parseInt(i.count)>0&&(this.pager=t.use("common/component/JsPager",{container:t.scorePager,current:1,amount:10,total:Math.ceil(i.count/5)||0,template:{head:"",tail:""},classname:{wrapper:"tbui_js_pager",current:"current grey_border",normal:"",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}}),this.pager.bind("pageChange",function(i,r){t.getList(e,{pn:r}),t.pager.initial({current:r}),t.scoreProvide.slideDown()}));var r=this[e](i.list);this.scoreList.empty().html(r)},getList:function(e,i){var t=this;t.controlCenter.trigger("score."+e,[e,i])},closeOpened:function(e){var i=e.closest(".aquire_score_item"),t=i.find(".item_info"),r=i.find(".item_detail");r.slideUp(),t.slideDown().find(".info_btn").addClass("info_btn_disable")},followUser:function(e){var i=this,t=e.getData();i.controlCenter.trigger("score.followUser",["followUser",t])},followError:function(e){var i={0:"\u5173\u6CE8\u6210\u529F",1130036:"\u6B64\u7528\u6237\u7981\u6B62\u88AB\u5173\u6CE8","else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u4E00\u4E0B\u5427"},t=e in i?i[e]:i["else"],r=new $.dialog({html:'<p style="text-align:center">'+t+"<p>",width:300,height:30});r.bind("onclose",function(){})},handError:function(e){var i={emptyData:'\u672C\u5427\u6CA1\u6709\u798F\u5229\u5F69\u86CB<br />\u5F00\u59CB<a class="tip_to_find" href="#" onclick="return false;">\u5BFB\u627E\u5F69\u86CB</a>\uFF01',"else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u4E00\u4E0B\u5427\uFF01"},t=e in i?i[e]:i["else"];this.scoreList.html('<p class="score_list_tip">'+t+"</p>")},authError:function(e){var i=e.closest(".item_detail").find(".detail_condition"),t=i.find(".j_limit_error"),r=i.find(".j_limit_total"),a=0,s=(t.html(),t.getData()),n='\u9700\u8981\u5728<a href="'+s.forum_link+'" target="_blank">'+s.forum_name+"\u5427</a>\u8FBE\u5230"+s.level+"\u7EA7\u4EE5\u4E0A";t.html(n).addClass("limit_center"),r.remove();var o=setInterval(function(){4==a?(t.addClass("limit_error"),clearInterval(o),o=null):(t.toggleClass("limit_error"),++a)},200)}}});
;_.Module.define({path:"encourage/widget/scoreProvideEgg",requires:[],sub:{initial:function(e){this.fr=e.fr,this.visibleNum=3,this.scoreNum=0,this.wrapperDom=e.wrapper,this.provideDom=e.wrapper.find(".score_provide"),this.dynamicDom=e.wrapper.find(".score_dynamic"),this.guideDom=e.wrapper.find(".score_guide"),this.eggBlockDom=e.wrapper.find(".egg_block"),this.scoreWrapper=e.wrapper.find(".score_wrapper"),this.controlCenter=e.controlCenter,this.scoreStyles="",this.scoreForums="",this.provideFlag=!0,this.tipDom=null,this.selEgg=null,this.initGuide()},bindEvents:function(){var e=this,i=this.provideDom,o=i.find(".provide_score_btn"),s=i.find(".provide_score_item"),r=this.scoreWrapper.find(".score_list"),t=this.scoreWrapper.find(".score_pager");this.tipDom=s.find(".provide_tip"),i.on("click",".provide_score_btn a.score_btn",function(){return o.slideUp(),s.slideDown(),r.slideUp(),t.slideUp(),e.eggBlockDom.slideUp(),e.dynamicDom.slideUp(),e.initCarouse(),!1}).on("click",".provide_close",function(){s.slideUp(),o.slideDown(),r.slideDown(),t.slideDown(),e.eggBlockDom.slideDown(),e.dynamicDom.slideDown()}).on("submit","form.score_form",function(i){return i.preventDefault(),e.provideScore($(this)),!1}).on("keyup",".score_total",function(){e.checkProvide($(this))}).on("focus",".score_total, .egg_total",function(){var i=$(this);$(this).hasClass("score_total")||(i=$(this).closest(".score_form").find(".score_total")),e.checkProvide(i)}).on("click",".score_to_charge",function(){_.Module.use("common/widget/TchargeDialog")})},initList:function(){var e=this;e.controlCenter.trigger("score.initEggAndDynamic",["initEggAndDynamic"])},initEggAndDynamic:function(e){var i=this;$.isArray(e.feed_list)&&this.initDynamic(e.feed_list),$.isArray(e.egg_list)&&this.initScore(e.egg_list),$.isArray(e.forum_list)&&this.initForum(e.forum_list),this.initProvide(),this.bindEvents(),i.controlCenter.trigger("score.finishEggAndDynamic")},initProvide:function(){var e="",i={},o=['<div class="provide_score_btn">','<a class="score_btn" href="#" onclick="return false;"></a>','<a class="score_egg_user" href="/tbmall/zt/eggtop#user" target="_blank">\u5F69\u86CB\u8FBE\u4EBA</a>','<a class="score_egg_forum" href="/tbmall/zt/eggtop#forum" target="_blank">\u798F\u5229\u7EA2\u5427</a>',"</div>",'<div class="provide_score_item">','<div class="score_title">\u5728<a href="#{forum_link}" target="_blank">#{forum_name}</a>\u5427\u53D1\u798F\u5229</div>','<div class="score_info">#{score_info}</div>','<form class="score_form" action="#" method="post">','<p><span>T\u8C46\u603B\u91CF\uFF1A</span><input class="score_total" name="score" type="text" value="20000"/>T\u8C46</p>','<p><span>\u5F69\u86CB\u6570\uFF1A</span><input class="egg_total" name="number" type="text" value="150"/>\u4E2A</p>',"<p>","<span>\u9886\u53D6\u6761\u4EF6\uFF1A</span>",'<input class="score_id" name="style_id" type="text" value=""/>','<select class="forum_name" name="cond_forum_id">#{forum_info}</select>','<select class="level" name="cond_user_level" class="cond_user_level">','<option value="1">Lv1\u4EE5\u4E0A</option>','<option value="2">Lv2\u4EE5\u4E0A</option>','<option value="3" selected="selected">Lv3\u4EE5\u4E0A</option>','<option value="4">Lv4\u4EE5\u4E0A</option>','<option value="5">Lv5\u4EE5\u4E0A</option>','<option value="6">Lv6\u4EE5\u4E0A</option>','<option value="7">Lv7\u4EE5\u4E0A</option>',"</select>","</p>",'<p class="provide_tip">\u5C06\u6D88\u801721000T\u8C46<br /><span>\uFF08\u6BCF\u65E5\u6263\u96641000T\u8C46\u798F\u5229\u4F59\u989D\uFF09</span></p>','<p class="provide_submit"><button type="submit"></button></p>',"</form>",'<a class="provide_close" href="#" onclick="return false;"></a>',"</div>"].join("");i={forum_id:PageData.forum.forum_id,forum_name:PageData.forum.forum_name,forum_link:"/f?kw="+PageData.forum.forum_name,forum_info:this.scoreForums||"",score_info:this.scoreStyles||""},e+=$.tb.format(o,i),this.provideDom.append(e)},initForum:function(e){var i=0,o=e.length,s=[];if(o>0)for(;o>i;++i)s.push('<option value="'+e[i].forum_id+'">'+$.tb.subByte(e[i].forum_name,13)+"\u5427</option>");else s.push('<option value="'+PageData.forum.forum_id+'">'+$.tb.subByte(PageData.forum.forum_name,13)+"\u5427</option>");this.scoreForums=s.join("")},initScore:function(e){var i=0,o=e.length,s=null,r="",t="";for(this.scoreNum=o;o>i;++i)s=e[i],r+=["<li "+$.tb.dataField({sid:s.id})+">",'<a href="#" onclick="return false;">','<img src="'+s.image+'" alt="">',"</a>","</li>"].join("");t=['<div class="info_carousel clearfix">',"<ul>",r,"</ul>","</div>",'<a href="#" onclick="return false;" class="info_prev">','<span class="caro_arrow"></span><span class="caro_block"></span>',"</a>",'<a href="#" onclick="return false;" class="info_next">','<span class="caro_arrow"></span><span class="caro_block"></span>',"</a>",'<div class="info_sel"><span></span></div>'].join(""),this.scoreStyles=t},initCarouse:function(){this.selEgg=null;var e=this,i=this.provideDom.find(".score_info");i.find(".info_carousel").jCarouselLite({btnNext:i.find(".info_next"),btnPrev:i.find(".info_prev"),visible:this.visibleNum,circular:!0,afterEnd:function(i){e.selEgg=$(i[1])}}),_.Module.use("common/widget/Placeholder",["#tbmall_score_control_center .score_provide .score_total","20000"],function(){}),_.Module.use("common/widget/Placeholder",["#tbmall_score_control_center .score_provide .egg_total","150"],function(){})},initDynamic:function(e){for(var i=0,o="",s=e.length,r=null,t=null,a=['<p class="dynamic_item">','<a class="j_user_card" href="#{user_link}" target="_blank" #{user_data}>','<img src="#{user_portrait}" />',"</a>","\u62A2\u4E86",'<a class="j_user_card" href="#{from_user_link}" target="_blank" #{from_user_data}>','<img src="#{from_user_portrait}" />',"</a>","\u7684\u5F69\u86CB\u83B7\u5F97","<span>#{get_score}</span>","T\u8C46","</p>"].join("");s>i&&!(i>10);++i)r=e[i],t={user_link:"/home/main/?ie=utf8&un="+r.user_name,user_name:r.user_name,user_portrait:r.portrait,user_data:$.tb.dataField({un:r.user_name}),from_user_link:"/home/main/?ie=utf8&un="+r.from_user_name,from_user_name:r.from_user_name,from_user_portrait:r.from_portrait,from_user_data:$.tb.dataField({un:r.from_user_name}),get_score:r.get_score},o+=$.tb.format(a,t);this.dynamicDom.append('<div class="dynamic_wrapper">'+o+"</div>"),1>s&&this.dynamicDom.hide();{var n=this.dynamicDom.find(".dynamic_wrapper");setInterval(function(){n.find(".dynamic_item").first().slideUp(function(){$(this).appendTo(n).show()})},3e3)}},initGuide:function(){},provideScore:function(e){if(this.provideFlag&&this.formValid()){var i="";if(this.selEgg)i=this.selEgg.getData().sid;else{var o=this.provideDom.find(".info_carousel li"),s=this.scoreNum-this.visibleNum+1;i=o.eq(s).getData().sid}e.find("input.score_id").val(i),this.controlCenter.trigger("score.provideScore",[e.serialize()]),self.provideFlag=!1}},formValid:function(){var e=this.provideDom.find(".provide_score_item"),i=e.find(".score_total").val(),o=e.find(".egg_total").val();return this.scoreValid(i)&&this.eggValid(o,i)},scoreValid:function(e){var i=PageData.user.Parr_scores?PageData.user.Parr_scores.scores_money+PageData.user.Parr_scores.scores_other:0;return/^\d+$/.test(e)?1e4>e?(this.handleRes(111e4),!1):e>i?(this.handleRes(2270005),!1):!0:(this.handleRes(1001),!1)},eggValid:function(e,i){var o=parseInt(i/100-50);return/^\d+$/.test(e)?10>e?(this.handleRes(1110002),!1):e>o?(this.handleRes(1110003,o),!1):!0:(this.handleRes(1001),!1)},checkProvide:function(e){var i=e.val(),o=parseInt(i)+1e3;this.tipDom&&(/^\d+$/.test(i)?this.tipDom.html("\u5C06\u6D88\u8017"+o+"T\u8C46<br /><span>\uFF08\u6BCF\u65E5\u6263\u96641000T\u8C46\u798F\u5229\u4F59\u989D\uFF09</span>"):this.tipDom.html(""))},handleRes:function(e,i){this.provideFlag=!0;var i=i&&!isNaN(parseInt(i))?parseInt(i):0,o={0:"\u63D0\u4EA4\u6210\u529F\uFF01",1001:"\u8BF7\u8F93\u5165\u6570\u5B57",1110000:"T\u8C46\u6570\u4E0D\u80FD\u5C0F\u4E8E10000",1110001:"\u60A8\u5728\u5427\u5185\u7B49\u7EA7\u4E0D\u80FD\u5C0F\u4E8E1\u6216\u5927\u4E8E7",1110002:"\u5F69\u86CB\u6570\u4E0D\u80FD\u5C0F\u4E8E10",1110003:"\u6240\u53D1T\u8C46\u7684\u5F69\u86CB\u6570\u4E0D\u80FD\u591A\u4E8E"+i,2270005:'\u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C<a class="score_to_charge" href="#" onclick="return false;">\u53BB\u5145\u503C>></a>',2251009:"\u53D1\u653E\u7684\u5427\u4E0D\u5B58\u5728","else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u5237\u65B0\u8BD5\u8BD5\u5427"},s=e in o?o[e]:o["else"];this.tipDom&&this.tipDom.html(s)},handleTip:function(e){if(0==e.no&&e.data&&e.data.get_icon){var i=$('<div class="score_alert"><p class="tt">\u606D\u559C\u4F60\u83B7\u5F97\u4E86</p><div class="score_alert_img"></div><span class="score_alert_foot">\u3010\u798F\u5229\u5370\u8BB0\u3011</span><a class="score_alert_close" href="#"></a></div>');$("body").append(i),i.on("click",".score_alert_close",function(){return i.remove(),$.tb.location.reload(),!1})}else if(0==e.no){setTimeout(function(){$.tb.location.reload()},1e3)}}}});
;_.Module.define({path:"encourage/widget/scoreAnimation",requires:[],sub:{initial:function(e){this.wrapperDom=e.wrapper,this.controlCenter=e.controlCenter,this.bindEvents()},bindEvents:function(){$("body").on("click",".score_close_gif",function(){$(this).closest(".score_open_gif").remove()})},startAnimate:function(e,o){var t="custom",n=null;if(e.data){var r=e.data.gift_got;r?(n={props_num:r.gift_score,props_name:""},t="rand"):n=e.data}else n={props_num:"0",props_name:""};n=$.extend(o.getData(),n||{props_num:"0",props_name:""},!0),o.bindData(n),o.fadeOut(),this._addScore(t,o,e)},_addScore:function(e,o,t){var n={len:5,pos:["0 -66px","0 -132px","0 -198px","0 -264px","0 0"]};this._showGif(o),this._burstAnimate(e,n,o,0,t)},_burstAnimate:function(e,o,t,n,r){var s=this;setTimeout(function(){t.css("backgroundPosition",o.pos[n]),n<o.len?(s._burstAnimate(e,o,t,++n,r),2==n&&s._scoreAnimate(t,e)):"rand"==e&&s.controlCenter.trigger("score.heartBeat",[r])},50)},_showGif:function(e){var o="",t=e.getData(),n=e.offset(),r=t.gif||"",s=t.link||"/tbmall/home";if(""!==$.trim(r)){var a=['<div class="score_open_gif">','<a href="#{link}" target="_blank">','<img src="#{gif}"/>',"</a>",'<a class="score_close_gif" href="#" onclick="return false;"></a>',"</div>"].join(""),i={link:s,gif:r};o=$.tb.format(a,i),$(o).css({top:n.top-48,left:n.left-48}).appendTo("body").fadeIn(2e3)}},_scoreAnimate:function(e,o){var t=e.getData().props_name||"",n=e.getData().props_num||0,r="",s=t?"prop":"egg",a=o||"",i=['<div class="fly_score_#{scoreStyle} fly_score_#{scoreType}">#{scoreShow}<span></span></div>'].join(""),c=e.offset();r="prop"==s?t+"×"+n:"+"+n+("rand"==a?"\u8C46\u7968":""),r={scoreShow:r,scoreStyle:s,scoreType:a},fly_dom=$($.tb.format(i,r)),fly_dom.css({top:c.top+26,left:c.left+20}).appendTo("body"),fly_dom.animate({top:"-=100",left:"+=50",opacity:.4},3e3,function(){$(this).remove(),e.remove(),e=null})}}});
;_.Module.define({path:"encourage/widget/scoreBuy",requires:[],sub:{URL:{provideScore:"/tbmall/eggs/userSendPrivateEgg",checkScore:"/tbmall/checkorder"},callBack:null,initial:function(){this._dialog=null,this._bindEvents()},buyScore:function(e,a){"function"==typeof a&&(this.callBack=a),this._getOrderId(e),this._chargingDialog()},_bindEvents:function(){$("body").delegate(".j_charge_success_btn","click",function(){self._closeDialog(self._dialog),self._confirmChargeState()}).delegate(".j_charge_fail_btn","click",function(){self._closeDialog(self._dialog),$.tb.location.setHref(h)})},_getOrderId:function(e){var a=this,s=e+"&tbs="+PageData.tbs+"&forum_id="+PageData.forum.forum_id;$.ajax({type:"POST",url:a.URL.provideScore,dataType:"json",data:s,success:function(e){switch(e.no){case 0:"88888888"==e.data.order_id?(a._closeDialog(a._dialog),a._closeBubble(a._bubble),a._bubble=a._showBubble("<span class='charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5145\u503C <span class='orange_tip'>"+e.data.scores+"</span>T\u8C46",1500,"canClose"),windowOpen&&windowOpen.close()):(a._order_id=e.data.order_id,window.open(e.data.dubi_url))}}})},_confirmChargeState:function(){var e=this,a=6;this._bubble=this._showBubble("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+a+"\u79D2...");var s=setInterval(function(){if(a--,e._bubble.html("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+a+"\u79D2..."),a%2==0){var l={ie:"utf-8",tbs:PageData.tbs,order_id:e._order_id};$.ajax({type:"POST",url:e.URL.checkScore,dataType:"json",dataType:"json",data:l,success:function(l){switch(l.no){case 0:1e4==l.data.result_code&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5145\u503C <span class='orange_tip'>"+l.data.scores+"</span>T\u8C46",1500,"canClose",function(){$.tb.location.setHref($.tb.location.getHref().replace("&showsend=1","").replace("&showmask=1",""))}),clearInterval(s)),0>=a&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,T\u8C46\u6CA1\u6709\u5145\u503C\u6210\u529F</span>",1500,"canClose"),clearInterval(s));break;case 1:case 2:default:0>=a&&(e._closeBubble(e._bubble),e._bubble=e._showBubble("<span class='charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,T\u8C46\u6CA1\u6709\u5145\u503C\u6210\u529F</span>",1500,"canClose"),clearInterval(s))}},error:function(){e._bubble.html("<p>\u672A\u77E5\u9519\u8BEF</p>"),clearInterval(s)}})}0>=a&&clearInterval(s)},1e3)},_showBubble:function(e,a,s,l){var n=$("<div class='small_bubble_block'  ></div>");return n.append(e),$("body").append(n),n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2}),$(window).resize(function(){n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2})}),"function"==typeof l&&l(),s&&n.click(function(){$(this).remove()}),a?(this._closeBubble(n,a),void 0):n},_closeBubble:function(e,a){a&&a>0?setTimeout(function(){e&&e.fadeOut("normal",function(){e.remove()})},a):e&&e.fadeOut("normal",function(){e.remove()})},_chargingDialog:function(){var e="<p class='dialog_content'>\u8BF7\u5728\u65B0\u6253\u5F00\u7684\u9875\u9762\u4E0A\u5B8C\u6210\u652F\u4ED8</p><p class='dialog_second_content'>\u652F\u4ED8\u5B8C\u6210\u524D&nbsp;&nbsp;&nbsp;&nbsp;\u8BF7\u52FF\u5173\u95ED\u7A97\u53E3</p><div class='dialog_btn_wrap'><a class='charge_btns j_charge_success_btn'>\u652F\u4ED8\u6210\u529F</a><a class='charge_btns j_charge_fail_btn'>\u652F\u4ED8\u5931\u8D25</a></div>";this._showDialog("\u5145\u503CT\u8C46",e,500)},_showDialog:function(e,a,s){this._dialog=new $.dialog({html:a,title:e,width:s,draggable:!1,closeable:!0})},_closeDialog:function(e){e&&e.close(),e=null}}});
;_.Module.define({path:"encourage/widget/scoreMonthIcon",requires:[],sub:{initial:function(){},showMonthIconTip:function(){function t(t){return t>9?t:"0"+t.toString()}var n=PageUnit.load("score_gain_txt"),e=PageUnit.load("score_gain_button"),i=PageUnit.load("score_gain_title"),o=PageUnit.load("score_gain_link"),a=PageUnit.load("score_gain_constellation");if(n){var l=new Date(Env.server_time),r=l.getFullYear(),_=t(l.getMonth()+2),c=new $.dialog({html:'<p style="text-align:center;margin-top:20px;">'+n+'<br><br><a id="month_icon_tip" style="margin-bottom: 20px;" target="_blank" href="'+o+'" class="ui_btn ui_btn_m"><span><em>'+e+'</em></span></a><a style="margin-left: 15px;margin-bottom: 20px;" href="#" class="j_dont_remind ui_btn ui_btn_sub_m"><span><em>\u4E0D\u518D\u63D0\u9192</em></span></a></p>',title:i,width:400,show:!1});"1"!=a&&PageData.user.tbmall_month_icon&&PageData.user.tbmall_month_icon[r+""+_]||c.show(),$.cookie("monthicon_tip","1",{path:"/",expires:1/6}),$(c.getElement()).on("click","#month_icon_tip",function(){c.close()}).on("click",".j_dont_remind",function(t){t.preventDefault(),$.cookie("monthicon_tip","1",{path:"/",expires:1}),c.close()})}}}});_.Module.define({path:"comforum/widget/LotteryHelper",sub:{initial:function(){},permute:function(r,n){for(var t=1,e=0;n>e;e++)t*=r-e;return parseInt(t,10)},combine:function(r,n){var t=this,e=t.permute(r,n);return e/=t.permute(n,n),parseInt(e,10)},fullCombination:function(r,n){for(var t=[],e=r.length,o=[],a=0;n>=a;a++)o.push(a-1);for(var u=n,i=!0;-1==o[0];){if(i){for(var f=[],a=1;n>=a;a++)f.push(r[o[a]]);t.push(f),i=!1}o[u]++,o[u]!=e?n>u?(u++,o[u]=o[u-1]):u==n&&(i=!0):(o[u]=0,u--)}return t},fullCombinationDantuo:function(r,n,t){var e=this,o=0;n&&(o=n.length);var a=t.length;if(r>o+a)return!1;for(var u=r-o,i=e.fullCombination(t,u),f=0,h=i.length;h>f;f++)i[f]=i[f].concat(n);return i},countCombinationDantuo:function(r,n,t){var e=this;n="undefined"==typeof n?0:n;var o=r-n;return e.combine(t,o)},arrayFullCombination:function(r){for(var n=this,t=function(r,n){for(var t=r,e=[];n.length>0;){for(var o=0;o<t.length;o++){for(var a=[n[0]],u=0;u<t[o].length;u++)a.push(t[o][u]);e.push(a)}n=n.slice(1,n.length)}return e},e=n.fullCombination(r[0],1),o=1;o<r.length;o++)e=t(e,r[o]);return e},arrayIsNoRepeat:function(r){for(var n=0,t={};n<r.length;n++){if(void 0!==t[r[n]])return!1;t[r[n]]=!0}return!0},arrayIsHasNoRepeat:function(r){for(var n=this,t=r.length,e=[],o=[],a=[],u=[],i=1,f=0;t>f;f++)e[f]=r[f].length,i*=e[f],o[f]=0;for(var f=0;i>f;f++)a[f]=[];for(var h=0;;){for(var f=0;t>f;f++)a[h][f]=o[f]+1,u[f]=r[f][a[h][f]-1];if(n.arrayIsNoRepeat(u))return!0;h++;for(var f=t-1;f>=0&&o[f]==e[f]-1;f--)o[f]=0;if(0>f)break;o[f]++}return!1},generateRandom:function(r,n,t){if(t>n-r)return[];for(var e=[],o=0;t>o;){var a=Math.round(Math.random()*(n-1)+r);-1===$.inArray(a,e)&&(e.push(a),o++)}return e},numberKeyOnly:function(r){var n=r.which,t=!1;return r.shiftKey&&(9==n&&(t=!0),t=!1),(57>=n&&n>=48||37==n||39==n||8==n||9==n||46==n||105>=n&&n>=96||229==n)&&(t=!0),t}}});var Observe=Observe||{};!function(n,t,e){"use strict";var r="function"==typeof define,o="undefined"!=typeof module&&module.exports;r?define(t):o?module.exports=t():e[n]=t()}("observe",function(){var n=[],t=[],e=function(n){function t(){e(),a=n}function e(){o(c.generic,function(t){t(n,a)})}function r(n,t){o(c.create,function(e){e(n,t)})}function i(n,t,e){o(c.update,function(t){t(n,old_item,e)})}function u(n,t){o(c["delete"],function(e){e(n,t)})}function f(){var e=a.length,o=n.length;if(e!==o||$.json.encode(a)!==$.json.encode(n))for(var f=Math.max(o,e),c=f;c>=0;c--){var p=a[c],s=n[c];c>e-1?r(s,c):c>o-1?u(p,c):s!==p&&i(s,p,c)}t()}var a=[],c={generic:[],create:[],update:[],"delete":[]};return n.pop=function(){f();var n=Array.prototype.pop.call(this,arguments),e=this.length;return u(n,e),t(),n},n.push=function(){f();var n=arguments[0],e=Array.prototype.push.apply(this,arguments);return r(n,e-1),t(),e},n.splice=function(n){f();for(var e=Array.prototype.slice.call(arguments,2),i=Array.prototype.splice.apply(this,arguments),a=i.length-1;a>=0;a--)u(i[a],n+a);return o(e,function(t,e){r(t,n+e)}),t(),i},{bind:function(n,t){if("undefined"==typeof c[n])throw"type is not allow";c[n].push(t)},unbind:function(){}}},r=function(n,t){return Object.prototype.toString.call(n)==="[object "+t+"]"},o=function(n,t){for(var e,r=0,o=n.length;o>r&&(e=t.call(n[r],n[r],r),e!==!1);r++);},i=function(n,t){var e=0;if(Array.prototype.indexOf)return n.indexOf(t);for(;e<n.length;e++)if(n[e]===t)return e;return-1};return function(o,u,f){if(arguments.length<2)throw"arguments length is not right";if(!r(o,"Array"))throw"first argument must be an array";r(u,"Function")&&(f=u,u="generic");var a=i(n,o);if(-1===a){a=n.length,n.push(o);var c=new e(o);t.push(c)}return t[a].bind(u,f),o}},Observe);
;_.Module.define({path:"comforum/widget/BasketLottery",sub:{_container:null,_lotteryHelper:null,_singleLottery:null,_index:0,_selected:[],_t:null,_bubble:null,_page:"",initial:function(t,e,i,n){this._container=$("#basket_lottery"),this._page=n,this._lotteryHelper=this.use("comforum/widget/LotteryHelper"),this._singleLottery=this._formatData(e),this._bindEvents(),i||1!==t?this._selected.push(3):this._selected.push(0),this._t=this._countTime(),this._stats()},_formatData:function(t){for(var e=$.parseJSON(t),i=0,n=e.length;n>i;i++)e[i].scale_home.toString().length>5&&(e[i].scale_home=e[i].scale_home.toPrecision(4)),e[i].scale_away.toString().length>5&&(e[i].scale_away=e[i].scale_away.toPrecision(4));return e},_formatTime:function(t){if(0>t)return"00:00:00";var e=new Date(1e3*t),i=function(t){return 10>t?"0"+t:t},n=i(Math.floor(t/3600))+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds());return n},_bindEvents:function(){var t=this;t._container.on("keydown",".j_quick_ipt",function(e){return t._lotteryHelper.numberKeyOnly(e)}).on("change",".j_quick_ipt",function(){var t=$(this).val();t||$(this).val(1)}).on("keyup",".j_quick_ipt",function(){var t=$(this).val();t&&(t=t.replace(/\D/g,"")),0===parseInt(t,10)&&(t=1),$(this).val(t)}),Observe.observe(t._selected,"create",function(e){var i=t._container.find(".lottery_basket_"+e),n=t._container.find(".j_quick_tz");i.addClass("lottery_select"),t._bubble&&t._bubble.hideBubble(),t._setBtnTips(),n.toggleClass("disable",0===t._selected.length)}),Observe.observe(t._selected,"delete",function(e){var i=t._container.find(".lottery_basket_"+e),n=t._container.find(".j_quick_tz");i.removeClass("lottery_select"),t._setBtnTips(),n.toggleClass("disable",0===t._selected.length)}),t._container.on("click",".j_lottery_select",function(){var e=$(this).data("rel");$(this).hasClass("lottery_select")?t._selected.splice($.inArray(e,t._selected),1):t._selected.push(e)}),t._container.on("click",".j_quick_tz",function(){return $(this).hasClass("disable")?(t._bubble||(t._bubble=t._showBubble({content:"\u81F3\u5C11\u9009\u62E9\u4E00\u79CD\u6BD4\u8D5B\u7ED3\u679C",wrap:t._container.find(".j_lottery_bubble")})),t._bubble.showBubble(),void 0):(window.open(t._buildUrl()),void 0)}),t._container.on("click",".j_quick_refresh",function(){t._index++,t._selected.length=0,t._index===t._singleLottery.length&&(t._index=0);var e=t._singleLottery[t._index];e.format_lotttery_end=t._formatTime(e.lottery_end_time-Math.floor((new Date).getTime()/1e3));var i=$.tb.format(t._tpl1,e),n=$.tb.format(t._tpl2,e);t._container.find(".j_quick_rpl1").replaceWith(i),t._container.find(".j_quick_rpl2").replaceWith(n),t._selected.push(3);var o=t._container.find(".j_bottom_tip");o.length&&o.remove(),clearInterval(t._t),t._t=t._countTime()})},_setBtnTips:function(){var t=this._singleLottery[this._index],e=this._container.find(".j_quick_tz"),i=e.children("span");1===this._selected.length?(3==this._selected[0]&&i.text("\u652F\u6301"+t.home+" \u7ACB\u5373\u6295\u6CE8"),0==this._selected[0]&&i.text("\u652F\u6301"+t.away+" \u7ACB\u5373\u6295\u6CE8")):i.text("\u773C\u5149\u4E0D\u9519 \u7ACB\u5373\u6295\u6CE8")},_tpl1:['<div class="lottery_logo clearfix j_quick_rpl1">','<div class="lottery_logo_home">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{home_imgsrc}">',"<p>#{home}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>",'<div class="lottery_middle">','<div class="lottery_middle_info">','<p class="lottey_middle_time j_lottery_deadline" data-end="#{lottery_end_time}">#{format_lotttery_end}</p>',"<p>#{race}</p>","</div>",'<i class="lottery_icon_vs_small"></i>',"</div>",'<div class="lottery_logo_away">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{away_imgsrc}">',"<p>#{away}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>","</div>"].join(""),_tpl2:['<div class="lottery_btn j_quick_rpl2 clearfix">','<div class="lottery_basket_3 j_lottery_select" data-match="#{match_num}" data-rel="3" title="\u6570\u5B57\u8D8A\u5C0F\u4E2D\u5956\u53EF\u80FD\u8D8A\u5927" data-log="lottery_sp_3">\u4E3B\u80DC<span>#{scale_home}</span></div>','<div class="lottery_basket_0 j_lottery_select" data-match="#{match_num}" data-rel="0" title="\u6570\u5B57\u8D8A\u5C0F\u4E2D\u5956\u53EF\u80FD\u8D8A\u5927" data-log="lottery_sp_0">\u5BA2\u80DC<span>#{scale_away}</span></div>',"</div>"].join(""),_buildUrl:function(){var t=this,e="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=70",i="7001:7002%",n=parseInt($(".j_quick_ipt").val(),10);return i+=t._singleLottery[t._index].match_num+"("+t._selected.join(";")+")",e+"&content="+encodeURIComponent(i)+"&multiple="+n},_countTime:function(){var t=this,e=t._container.find(".j_lottery_deadline"),i=parseInt(e.data("end"))-Math.floor((new Date).getTime()/1e3),n=function(t){return 10>t?"0"+t:t},o=setInterval(function(){var l,_;return 0>=i?(t._container.find(".j_quick_tz").addClass("disable"),$(t._bottomTip("\u672C\u573A\u6BD4\u8D5B\u6295\u6CE8\u5DF2\u622A\u6B62")).insertAfter(t._container.find(".j_quick_options")),t._singleLottery[t._index].isEnd=!0,clearInterval(o),void 0):(i-=1,l=new Date(1e3*i),_=n(Math.floor(i/3600))+":"+n(l.getUTCMinutes())+":"+n(l.getUTCSeconds()),e.text(_),void 0)},1e3);return o},_bottomTip:function(t){var e='<div class="lottery_nomatch_tip j_bottom_tip">'+t+"</div>";return e},_showBubble:function(t){var e={content:'<div class="lottery_bubble_content">'+t.content+"</div>",arrow_dir:"down",bubble_css:{top:-20,right:10,width:t.width||150},arrow_pos:{right:0},attr:" id='tb_message_tip_n' ",wrap:t.wrap,closeBtn:!1,level:1,arrowReq:!0},i=new UiBubbleTipBase(e);return i},_stats:function(){var t=this;t._container.on("click",function(e){var i=e.target||e.srcElement,n=$(i).data("log");n&&$.stats.track(n,"\u7ADE\u5F69\u84DD\u7403",t._page,"click")})}}});var Observe=Observe||{};!function(n,t,e){"use strict";var r="function"==typeof define,o="undefined"!=typeof module&&module.exports;r?define(t):o?module.exports=t():e[n]=t()}("observe",function(){var n=[],t=[],e=function(n){function t(){e(),a=n}function e(){o(c.generic,function(t){t(n,a)})}function r(n,t){o(c.create,function(e){e(n,t)})}function i(n,t,e){o(c.update,function(t){t(n,old_item,e)})}function u(n,t){o(c["delete"],function(e){e(n,t)})}function f(){var e=a.length,o=n.length;if(e!==o||$.json.encode(a)!==$.json.encode(n))for(var f=Math.max(o,e),c=f;c>=0;c--){var p=a[c],s=n[c];c>e-1?r(s,c):c>o-1?u(p,c):s!==p&&i(s,p,c)}t()}var a=[],c={generic:[],create:[],update:[],"delete":[]};return n.pop=function(){f();var n=Array.prototype.pop.call(this,arguments),e=this.length;return u(n,e),t(),n},n.push=function(){f();var n=arguments[0],e=Array.prototype.push.apply(this,arguments);return r(n,e-1),t(),e},n.splice=function(n){f();for(var e=Array.prototype.slice.call(arguments,2),i=Array.prototype.splice.apply(this,arguments),a=i.length-1;a>=0;a--)u(i[a],n+a);return o(e,function(t,e){r(t,n+e)}),t(),i},{bind:function(n,t){if("undefined"==typeof c[n])throw"type is not allow";c[n].push(t)},unbind:function(){}}},r=function(n,t){return Object.prototype.toString.call(n)==="[object "+t+"]"},o=function(n,t){for(var e,r=0,o=n.length;o>r&&(e=t.call(n[r],n[r],r),e!==!1);r++);},i=function(n,t){var e=0;if(Array.prototype.indexOf)return n.indexOf(t);for(;e<n.length;e++)if(n[e]===t)return e;return-1};return function(o,u,f){if(arguments.length<2)throw"arguments length is not right";if(!r(o,"Array"))throw"first argument must be an array";r(u,"Function")&&(f=u,u="generic");var a=i(n,o);if(-1===a){a=n.length,n.push(o);var c=new e(o);t.push(c)}return t[a].bind(u,f),o}},Observe);
;_.Module.define({path:"comforum/widget/LecaiLotteryB",requires:["comforum/widget/LotteryHelper"],sub:{_container:null,_lotteryHelper:null,_singleLottery:null,_index:0,_selected:[],_t:null,_bubble:null,_page:"",initial:function(t,e,i,n,o){this._container=$("#lecai_lottery"),this._page=o,this._lotteryHelper=this.use("comforum/widget/LotteryHelper"),this._singleLottery=this._formatData(e),this._bindEvents(),i||1!==t?this._selected.push(3):this._selected.push(0),this._t=this._countTime(),this._stats(n)},_formatData:function(t){for(var e=$.parseJSON(t),i=0,n=e.length;n>i;i++)e[i].scale_home.toString().length>5&&(e[i].scale_home=e[i].scale_home.toPrecision(4)),e[i].scale_away.toString().length>5&&(e[i].scale_away=e[i].scale_away.toPrecision(4)),e[i].scale_equal.toString().length>5&&(e[i].scale_equal=e[i].scale_equal.toPrecision(4));return e},_formatTime:function(t){if(0>t)return"00:00:00";var e=new Date(1e3*t),i=function(t){return 10>t?"0"+t:t},n=i(Math.floor(t/3600))+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds());return n},_bindEvents:function(){var t=this;t._container.on("keydown",".j_quick_ipt",function(e){return t._lotteryHelper.numberKeyOnly(e)}).on("change",".j_quick_ipt",function(){var t=$(this).val();t||$(this).val(1)}).on("keyup",".j_quick_ipt",function(){var t=$(this).val();t&&(t=t.replace(/\D/g,"")),0===parseInt(t,10)&&(t=1),$(this).val(t)}),Observe.observe(t._selected,"create",function(e){var i=t._container.find(".lottery_icon_btn_"+e),n=t._container.find(".j_quick_tz");i.addClass("select"),t._bubble&&t._bubble.hideBubble(),t._setBtnTips(),n.toggleClass("disable",0===t._selected.length)}),Observe.observe(t._selected,"delete",function(e){var i=t._container.find(".lottery_icon_btn_"+e),n=t._container.find(".j_quick_tz");i.removeClass("select"),t._setBtnTips(),n.toggleClass("disable",0===t._selected.length)}),t._container.on("click",".j_lottery_select",function(){var e=$(this).data("rel");$(this).hasClass("select")?t._selected.splice($.inArray(e,t._selected),1):t._selected.push(e)}),t._container.on("click",".j_quick_tz",function(){return $(this).hasClass("disable")?(t._bubble||(t._bubble=t._showBubble({content:"\u81F3\u5C11\u9009\u62E9\u4E00\u79CD\u6BD4\u8D5B\u7ED3\u679C",wrap:t._container.find(".j_lottery_bubble")})),t._bubble.showBubble(),void 0):(window.open(t._buildUrl()),void 0)}),t._container.on("click",".j_quick_refresh",function(){t._index++,t._selected.length=0,t._index===t._singleLottery.length&&(t._index=0);var e=t._singleLottery[t._index];e.format_lotttery_end=t._formatTime(e.lottery_end_time-Math.floor((new Date).getTime()/1e3));var i=$.tb.format(t._tpl1,e),n=$.tb.format(t._tpl2,e);t._container.find(".j_quick_rpl1").replaceWith(i),t._container.find(".j_quick_rpl2").replaceWith(n),t._selected.push(3);var o=t._container.find(".j_bottom_tip");o.length&&o.remove(),clearInterval(t._t),t._t=t._countTime()})},_setBtnTips:function(){var t=this._singleLottery[this._index],e=this._container.find(".j_quick_tz"),i=e.children("span");1===this._selected.length?(3==this._selected[0]&&i.text("\u652F\u6301"+t.home+" \u7ACB\u5373\u6295\u6CE8"),1==this._selected[0]&&i.text("\u773C\u5149\u4E0D\u9519 \u7ACB\u5373\u6295\u6CE8"),0==this._selected[0]&&i.text("\u652F\u6301"+t.away+" \u7ACB\u5373\u6295\u6CE8")):i.text("\u773C\u5149\u4E0D\u9519 \u7ACB\u5373\u6295\u6CE8")},_tpl1:['<div class="lottery_logo clearfix j_quick_rpl1">','<div class="lottery_logo_home">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{home_imgsrc}">',"<p>#{home}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>",'<div class="lottery_middle">','<div class="lottery_middle_info">','<p class="lottey_middle_time j_lottery_deadline" data-end="#{lottery_end_time}">#{format_lotttery_end}</p>',"<p>#{race}</p>","</div>",'<i class="lottery_icon_vs_small"></i>',"</div>",'<div class="lottery_logo_away">','<img src="http://tb1.bdstatic.com/tb/cms/com/lottery/team/#{away_imgsrc}">',"<p>#{away}</p>",'<div class="lottery_logo_cover lottery_icon_logo_frs"></div>',"</div>","</div>"].join(""),_tpl2:['<div class="lottery_btn j_quick_rpl2">','<div class="lottery_icon_btn_3 j_lottery_select" data-match="#{match_num}" data-rel="3" title="\u6570\u5B57\u8D8A\u5C0F\u4E2D\u5956\u53EF\u80FD\u8D8A\u5927" data-log="lottery_sp_3">\u4E3B\u80DC<span>#{scale_home}</span></div>','<div class="lottery_icon_btn_1 j_lottery_select" data-match="#{match_num}" data-rel="1" title="\u6570\u5B57\u8D8A\u5C0F\u4E2D\u5956\u53EF\u80FD\u8D8A\u5927" data-log="lottery_sp_1">\u5E73\u5C40<span>#{scale_equal}</span></div>','<div class="lottery_icon_btn_0 j_lottery_select" data-match="#{match_num}" data-rel="0" title="\u6570\u5B57\u8D8A\u5C0F\u4E2D\u5956\u53EF\u80FD\u8D8A\u5927" data-log="lottery_sp_0">\u5BA2\u80DC<span>#{scale_away}</span></div>',"</div>"].join(""),_buildUrl:function(){var t=this,e="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=85",i="8501:8502%",n=parseInt($(".j_quick_ipt").val(),10);return i+=t._singleLottery[t._index].match_num+"("+t._selected.join(";")+")",e+"&content="+encodeURIComponent(i)+"&multiple="+n},_countTime:function(){var t=this,e=t._container.find(".j_lottery_deadline"),i=parseInt(e.data("end"))-Math.floor((new Date).getTime()/1e3),n=function(t){return 10>t?"0"+t:t},o=setInterval(function(){var _,l;return 0>=i?(t._container.find(".j_quick_tz").addClass("disable"),$(t._bottomTip("\u672C\u573A\u6BD4\u8D5B\u6295\u6CE8\u5DF2\u622A\u6B62")).insertAfter(t._container.find(".j_quick_options")),t._singleLottery[t._index].isEnd=!0,clearInterval(o),void 0):(i-=1,_=new Date(1e3*i),l=n(Math.floor(i/3600))+":"+n(_.getUTCMinutes())+":"+n(_.getUTCSeconds()),e.text(l),void 0)},1e3);return o},_bottomTip:function(t){var e='<div class="lottery_nomatch_tip j_bottom_tip">'+t+"</div>";return e},_showBubble:function(t){var e={content:'<div class="lottery_bubble_content">'+t.content+"</div>",arrow_dir:"down",bubble_css:{top:-20,right:10,width:t.width||150},arrow_pos:{right:0},attr:" id='tb_message_tip_n' ",wrap:t.wrap,closeBtn:!1,level:1,arrowReq:!0},i=new UiBubbleTipBase(e);return i},_stats:function(t){var e=this;e._container.on("click",function(i){var n=i.target||i.srcElement,o=$(n).data("log");o&&($.stats.sendRequest("fr=tb0_forum&st_page="+e._page+"&st_mod=lottery_footer_new&st_fid="+t.forum.id+"&first_class="+encodeURIComponent(t.forum.first_class)+"&second_class="+encodeURIComponent(t.forum.second_class)+"&enfirst_class="+t.forum.first_class+"&ensecond_class="+t.forum.second_class+"&st_type="+o),$.stats.track(o,"\u65B0\u7248\u8DB3\u5F69\u6837\u5F0F",e._page,"click"))})}}});_.Module.define({path:"comforum/widget/SsqLottery",requires:["comforum/widget/LotteryHelper"],sub:{_container:null,_red:[],_blue:[],_lotteryHelper:null,_redTpl:'<li><a href="javascript:;" class="ssq_icon_red">#{red}</a></li>',_blueTpl:'<li class="ssq_item_last"><a href="javascript:;" class="ssq_icon_blue">#{blue}</a></li>',initial:function(t,e,n){this._container=$("#ssq_lottery"),this._red=t,this._blue=e,this._lotteryHelper=this.use("comforum/widget/LotteryHelper"),this._countTime(n),this._bindEvent(),this._stats()},_countTime:function(t){var e=this,n=e._container.find(".j_count_time"),r=function(t){return 10>t?"0"+t:t},i=setInterval(function(){if(t--,0>=t)clearInterval(i),n.text("00:00:00");else{var e=new Date(1e3*t),o=r(Math.floor(t/3600)),l=r(e.getUTCMinutes()),s=r(e.getUTCSeconds());n.text(o+":"+l+":"+s)}},1e3)},_bindEvent:function(){var t=this,e=function(t){return 10>t?"0"+t:t};t._container.on("click",".j_ssq_go",function(){for(var n="http://tieba.lecai.com/user/cooperator/baidu/bet_confirm.php?lottery_type=50",r="5001%",i=0,o=t._red.length;o>i;i++)r+=e(t._red[i])+",";r=r.slice(0,-1),r+="|"+t._blue,n+="&content="+encodeURIComponent(r)+"&mutiple=1",window.open(n)}),t._container.on("click",".j_ssq_refresh",function(){var e=t._lotteryHelper.generateRandom(1,33,6),n=t._lotteryHelper.generateRandom(1,16,1),r="",i=function(t){return 10>t?"0"+t:t};e.sort(function(t,e){return t-e}),t._red=e,t._blue=n;for(var o=0,l=e.length;l>o;o++)r+=$.tb.format(t._redTpl,{red:i(e[o])});r+=$.tb.format(t._blueTpl,{blue:i(n[0])}),t._container.find(".j_ssq_lists").html(r)})},_stats:function(){this._container.on("click",function(t){var e=t.target||t.srcElement,n=$(e).data("log");n&&$.stats.track(n,"\u53CC\u8272\u7403","frs","click")})}}});