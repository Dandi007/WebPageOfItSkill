_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(i,a){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=i,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),a||this.bindEvents())},bindEvents:function(){var i=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return i.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card&&i._visit_card.closeCard({type:"delayClose",time:200}),i._visit_card=null,!1}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(i){var a=this;a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var t='<div class="user_card_loading"><img src="/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:a._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='user_visit_card'",wrap:$("body")};a._visit_card=a.use("common/widget/Card",e),a._visit_card.showCard({type:"delayShow",time:200}),a.buildVisitCard(i)},getVisitCardContent:function(i){var a=this,t={ie:"utf-8"};i.un?t.un=i.un:t.id=i.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=i.bg_id;var r=a._util.getVisitCardTpl(1,e,!0);i.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i.wrap.html(r)}i.callBack&&$.isFunction(i.callBack)&&i.callBack()})},buildVisitCard:function(i){var a=this,t={ie:"utf-8"};i.getData().un?t.un=i.getData().un:t.id=i.getData().id,a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==a.dataObj.uname,s=a._util.getVisitCardTpl(r,e,!0);a._visit_card.setContent(s),a._visit_card._j_card.bindData({un:e.name}),a._visit_card.showCard(),a._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),a._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),a._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(i){i.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return a.buildCard(i),!1})}})},bindVisitCardEvent:function(){var i=this;i._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,r){var i=PageData.product||"",t=this.use("user/widget/Icons"),n=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done":"btn_concern",un:encodeURIComponent(a.name),btn_group:r?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:i,icon_pre:t.getPreIconHtml(a.mParr_props,a.free_flag),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.name_show,icon:t.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a)};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="";e||(l='<div class="interaction_wrap interaction_wrap_theme2"><a class="#{concernClass}" target="_blank" href="#" onclick="return false"></a><a class="btn_sendmsg" target="_blank" href="http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un=#{un}"></a></div>');var m=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',l,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon}',"</div>",'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>","</div>",'<div class="card_userinfo_honor honor_margin_#{honor_margin} clearfix">',"#{honor}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(m,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var r=e.can_begcard,i="";0==r?i='<a class="btn_begcard j_begcard" href="#"></a>':1==r?i='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==r&&(i='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:i};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},r=e.manager,i=null,t="",n="";this.countLen=0;for(var s in r){i=r[s];var o=i.forum_list.join("\u3001"),_=a[s];o=i.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,t+=this.getHonorItem(_.level,i.count,o),this.countLen+=String(i.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){i=c[l[d]];var o=i.forum_list.join("\u3001");i.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[d],i.count,o),this.countLen+=String(i.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,r){var i={level:e,title:r,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,i)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},r=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),i=0;i<e.length;i++)a.verify_forums+=this.getVForumItem(i,e[i].forum_name);return $.tb.format(r,a)},getVForumItem:function(e,a){var r="",i={},t=[];return a.length>5?(r=a.substring(0,5),r+="..."):r=a,i={index:e,verify_forum_name:r,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,i)},getVipTips:function(e){var a="",r=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>r&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"common/widget/AudioPlayer",requires:[],sub:{defaultOptions:{src:"http://play.baidu.com/player/static/flash/fmp.swf"},isReady:!1,isPlaying:!1,isMute:!1,volume:void 0,url:"",initial:function(t){var e=this;this.options=$.extend(this.defaultOptions,t);var i=$("<div></div>").css({width:1,height:1,overflow:"hidden"});i.appendTo("body"),i.html(this.renderSwf(this.options.src)),$swf=i.find("object");var s=$.browser.msie?$swf[0]:$swf.find("embed")[0];this.$container=i,this.$swf=$swf,this.swfObject=s;var a=setInterval(function(){100===e.swfObject.PercentLoaded()&&(clearInterval(a),setTimeout(function(){e.onSwfLoaded()},100))},100);window.pl=this},onSwfLoaded:function(){this.isReady=!0,this.bindEvents(),this.trigger("playerloaded",this)},renderSwf:function(){var t=['<object id="audio_player_core" width="#{width}" height="#{height}" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#4,0,0,0">','<param name="quality" value="high" />','<param name="allowscriptaccess" value="always">','<param name="scale" value="noscale">','<param name="wmode" value="window">','<param name="movie" value="#{srcWithStamp}">','<embed name="audio_player_core" width="#{width}" height="#{height}" allowscriptaccess="always" wmode="window" scale="noscale" src="#{srcWithStamp}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">',"</object>"].join("");return function(e){return $.tb.format(t,{src:e,srcWithStamp:e,width:1,height:1})}}(),bindEvents:function(){this.bind("reset",this._reset,this),this.bind("load",this._load,this),this.bind("play",this._play,this),this.bind("pause",this._pause,this),this.bind("stop",this._stop,this),this.bind("setmute",this._setMute,this)},_reset:function(){this.stop(),this.url="",this.isPlaying=!1},_load:function(t,e,i,s){function a(){var t=n._getLoadedPercent();return t>.3?(n.trigger("songloaded",t),n.failHandler&&clearTimeout(n.failHandler),i&&i(),!0):!1}var n=this;this.url=e,this.swfObject.closeStream(),this.swfObject.f_load(e),this.failHandler&&clearTimeout(this.failHandler),this.failHandler=setTimeout(function(){s&&s()},5e3),this.checkLoadedHandler&&clearTimeout(this.checkLoadedHandler),this.checkLoadedHandler=setTimeout(function(){a()||(n.checkLoadedHandler=setTimeout(arguments.callee,50))},50)},_play:function(t,e,i,s){function a(){var t=n._getCurrentPosition();return i&&i({percent:t,totalTime:n._getTotalTime(),currentTime:n._getCurrentTime()}),1==t?(n.trigger("playfinish",t),s&&s(),!0):!1}var n=this;if(!this.isPlaying){var o=this._getTotalTime();this.swfObject.f_play(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!0,e&&e({totalTime:o}),this.checkFinishedHandler=setTimeout(function(){a()||(n.checkFinishedHandler=setTimeout(arguments.callee,500))},1e3)}},_pause:function(){this.isPlaying&&(this.swfObject.f_pause(),this.isPlaying=!1)},_stop:function(){this.swfObject.f_stop(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!1},_setMute:function(t,e){this.isMute=e,this.swfObject.setData("mute",e)},_setVolume:function(t,e){this.volume=e,this.swfObject.setData("volume",e)},_setCurrentPosition:function(){},_getCurrentPosition:function(){return this.swfObject.getData("postionPct")},_getLoadedPercent:function(){return this.swfObject.getData("loadedPct")},_getTotalTime:function(){return this.swfObject.getData("length")},_getCurrentTime:function(){return this.swfObject.getData("currentPosition")}}});_.Module.define({path:"common/widget/Voice",requires:["common/widget/Card","common/widget/AudioPlayer"],sub:{version:"0.1",dialog:null,api:"/voice/index?",pidWhiteList:[40649447103,40649504943,40649558518,40649601183],initial:function(t){if(!PageData.pbVoiceLoaded){PageData.pbVoiceLoaded=!0;var i=this;this.product=PageData.product,this.product&&(this.api=t&&t.api||this.api,this.useMd5=t&&t.useMd5,this.canPlay=t&&t.canPlay,this.showClientAd=t&&t.showClientAd,this.showPostorAd=t&&t.showPostorAd,"frs"===this.product&&(this.showClientAd=1==this.canPlay?0:t.frsShowClientAd),$("body").on("click",".voice_player a ",function(t){t.preventDefault()}),1==this.showPostorAd&&this.initPostorAd(),this.initPlayer(),$(window).bind("initvoicelength",function(t,i){var e=$(i),a=e.find(".minute"),n=e.find(".second");if(a.length>0||n.length>0&&n.text()>=30)e.width(125);else if(n.length>0){var o=n.text();5>=o?e.width(50):e.width(50+3*(o-5))}}),$(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}),$("body").bind("showvoicedialog",function(t,e){i.dialog?i.dialog.show():(dialog=new $.dialog({width:398,html:$(".voice_client_ad_template").html(),title:"",draggable:!1,show:!1}),dialog.element.addClass("voice_dialog"),e&&dialog.element.addClass("voice_dialog_post"),dialog.show(),dialog.modal.bind("click",function(){dialog.hide()}))}))}},initClientAd:function(){$("body").on("click",".voice_player a",function(){$("body").trigger("showvoicedialog")})},initPostorAd:function(){$("#j_p_postlist").on("click",".j_lzl_p_sv",function(t){t.stopPropagation();var i=$(this);i.find(".new_icon").remove(),$.tb.Storage.set("VoicePostorAdClosed",1),$.stats.track("lzl_poster","pc_voice"),$("body").trigger("showvoicedialog",!0)})},initPlayer:function(){var t=this;this.player=this.use("common/widget/AudioPlayer"),this.player.bind("playerloaded",function(){t.bindPlayerEvent(),t.player._setVolume("",100)})},bindPlayerEvent:function(){var t=this,i=this.animateIcon,e=this.player,a=null;$("body").on("click",".voice_player a",function(n){function o(t){t.totalTime>0&&!g.data("time")&&0!=t.totalTime&&g.data("time",t.totalTime)}function s(i){var e=(0!=i.totalTime?i.totalTime:g.data("time"))-i.currentTime;t.updateTime(g,e)}function r(){c.data("state",""),t.resetTime(g),i.reset(p)}n.preventDefault(),$.stats.track("voice_btn_total","pc_voice");{var l,d,c=$(this).parent(".voice_player"),p=c.find(".speaker"),g=c.find(".time"),h=c.hasClass("voice_player_mini");h?"lzl":t.product}"pb"===t.product?(l=PageData.thread&&PageData.thread.thread_id,d=h?c.parents(".j_lzl_s_p").getData().spid:c.parents(".l_post").getData().content.post_id):"frs"==t.product?l=c.parents(".j_thread_list").data("field").id:"index"==t.product&&(l=c.data("tid"));var m="";if(m=1==t.useMd5?t.api+"?voice_md5="+c.data("md5")+"&kw="+PageData.forum.forum_name+"&tbs="+PageData.tbs:t.api+"tid="+l+(d?"&pid="+d:""),1!=t.canPlay&&-1==$.inArray(d,t.pidWhiteList))return a&&(e.trigger("stop"),t.resetPrevPlayer(a)),$.stats.track("voice_dialog_show","pc_voice"),$("body").trigger("showvoicedialog"),void 0;if("playing"===c.data("state"))e.trigger("stop"),c.data("state",""),i.reset(p),t.resetTime(g),$.stats.track("voice_stop","pc_voice");else{t.resetPrevPlayer(a),e.trigger("stop"),c.data("state","playing"),i.set(p,"loading"),$.stats.track("voice_play","pc_voice");var u=g.find(".minute"),v=g.find(".second"),f=u.length>0?+u.html():0,_=v.length>0?+v.html():0;g.data("time",6e4*f+1e3*_),e.trigger("load",m,function(){e.trigger("play",o,s,r),i.set(p,"playing")},function(){e.trigger("stop"),c.data("state",""),i.reset(p),t.resetTime(g);var a=$.tb.alert({title:"\u64AD\u653E\u5931\u8D25",message:"\u6211\u4E0D\u662F\u6545\u610F\u7684\uFF0C\u64AD\u653E\u5931\u8D25\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u4E0B\u5427~",buttons:[{text:"\u786E\u8BA4"}],width:310});a.modal.bind("click",function(){a.hide()})}),a=c}})},updateTime:function(t,i){i=i||t.data("time")||0;var e=Math.floor(i/6e4),a=Math.round(i%6e4/1e3),n="";e>0&&(n+='<span class="minute">'+e+"</span>'"),(a>0||e>0)&&(n+='<span class="second">'+a+'</span>"'),t.html(n)},resetTime:function(t){this.updateTime(t)},resetPrevPlayer:function(t){if(t){var i=t.find(".speaker"),e=t.find(".time");t.data("state",""),this.resetTime(e),this.animateIcon.reset(i)}},animateIcon:function(){function t(t,i){if($.browser.mozilla){var e=t.parent().parent().hasClass("loading")?"loading":"playing",a=t.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal",n=i+"px "+s[a][e]+"px";t.css("background-position",n)}else t.css("background-position-x",i)}function i(i,s){l&&e(l),e(i),l=i,i.parent().parent().addClass(s);var d=i.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal";"playing"===s?(i.parent().parent().hasClass("voice_player_mini")?t(i,-38):t(i,-58),r=setTimeout(function(){var e=0;return function(){e=(e+1)%4,t(i,a[d][e]),r=setTimeout(arguments.callee,o[s])}}(),o[s])):"loading"===s&&(i.parent().parent().hasClass("voice_player_mini")?t(i,-1):t(i,-1),r=setTimeout(function(){var e=0;return function(){e=(e+1)%12,t(i,-1-e*n[d]),r=setTimeout(arguments.callee,o[s])}}(),o[s]))}function e(i){clearTimeout(r),i.parent().parent().removeClass("loading playing"),i.parent().parent().parent().hasClass("voice_player_mini")?t(i,-38):t(i,-58)}var a={normal:[-1,-20,-39,-58],mini:[1,-12,-25,-38]},n={normal:20,mini:15},o={playing:400,loading:100},s={normal:{playing:-202,loading:-167},mini:{playing:-264,loading:-237}},r=null,l=null;return{set:i,reset:e}}()}});_.Module.define({path:"encourage/widget/meizhi_vote",requires:["common/component/Card"],sub:{_visit_card:null,_vote_card:null,_visit_card_ajax:null,_vote_button:null,_visit_card_option:{width:280,height:237},_special_visit_card_option:{width:280,height:210},initial:function(){this._wrap=$("body"),this._is_meizhi=PageData.user.is_login&&PageData.user.meizhi_level>=0?!0:!1,this.bindEvents()},bindEvents:function(){var t=this;this._wrap.delegate(".j_meizhi_vip","mouseenter",function(){return t.buildVisitCard(this),!1}),this._wrap.delegate(".j_meizhi_vip","mouseleave",function(){return t._visit_card_ajax&&t._visit_card_ajax.abort(),t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:200}),t._visit_card=null,!1}),this._wrap.delegate(".j_meizhi_vote","click",function(e){return t._vote_card&&(t._vote_card.closeCard(),t._vote_card=null,t._vote_button==e.target)?(e.preventDefault(),!1):(t.buildVoteCard(this),t._vote_button=e.target,e.preventDefault(),void 0)})},buildVoteCard:function(t){var e=this,i=$(t).getData(),a=i.user_id;$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),s=$(t),_=s.offset().left-140+s.outerWidth(!0)/2,d=s.offset().top-64-12;e._vote_card&&(e._vote_card.closeCard(),e._vote_card=null),e._vote_card=e.use("common/component/Card",{content:n,card_css:{top:d,left:_,width:280,height:64},attr:"id='meizhi_vote_card'",wrap:$("body")}),e.bindVoteCardEvent()}})},bindVoteCardEvent:function(){var t=this;t._vote_card.showCard(),t._vote_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("frs_btn","meizhi_vote"),t.vote(this)})},vote:function(t){var e=this,i=$(t),a=i.getData(),o=a.vote_type,n="/encourage/post/meizhi/checkvcode",s="/encourage/post/meizhi/getvcode";_.Module.use("common/component/PostorServiceMeizhi",[],function(t){t.postHandler({data:{content:"",tbs:PageData.tbs,fid:PageData.forum.id||PageData.forum.forum_id,kw:PageData.forum.name,uid:a.user_id,scid:PageData.user.id||0,vtype:o,ie:"utf-8",vcode:""},checkUrl:n,vCodeUrl:s,url:"/encourage/post/meizhi/vote",type:"vote",success:function(t){var a=t,n=$('<img class="add_one_icon" src="/tb/static-encourage/img/meizhi/add_one.gif">');n.appendTo(i).animate({top:"-=20",opacity:0},1e3);var s=e.cutVoteCount(a.vote_count[o]);s=s?s:1,i.find(".j_vote_count").text(s);var _=i.parent();_.find(".j_vote_text").addClass("vote_text_small"),_.find(".j_vote_count").removeClass("hide"),_.siblings(".j_vote_tip").text("\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002"),_.addClass("disabled").find(".j_vote_button").removeClass("j_vote_button"),1==a.hasCheckVcode&&e._msgDialog(),$.stats.track("vote_succ","meizhi_vote")}})})},_msgDialog:function(){var t={image:'<img style="border:none;" src="http://tb1.bdstatic.com/tb/img/messageFace.gif">',subMessage:"\u6295\u7968\u6210\u529F",message:"",dialogSet:{width:410,height:50,title:"\u53D1\u8D77\u6295\u7968"}},e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>";$.dialog.alert(e,t.dialogSet)},buildVisitCard:function(t){var e=this,i=$(t).parent().getData(),a=i.user_id;this._visit_card_ajax&&this._visit_card_ajax.abort(),this._visit_card_ajax=$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a,type:1},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=o.level-1?o.level-1:"",s=e.calPercent(o.vote_count),_="/i/sys/jump?un="+encodeURIComponent(o.uname)+"&ie=utf-8",d=o.group_info.has_group,v=d?'<span class="group_icon" title="\u5FEB\u5230\u88D9\u91CC\u6765">&nbsp;</span>':"",r=d?'<div class="clearfix"><span style="display:inline;float:left;">Ta\u7684\u7FA4\u7EC4\uFF1A</span><a class="group_name" href="/group/index?id='+o.group_info.group_id+'" target = "_blank" >'+o.group_info.group_name+"</a></div>":"",c=["<a href="+_+' title="\u5934\u50CF" class="meizhi_avatar" target="_blank"><img src="'+o.avatar+'"></a>','<div class="meizhi_corner"></div>','<div class="meizhi_info">','<h1 class="clearfix"><a class="name" href='+_+' title="\u540D\u5B57" target="_blank">'+o.uname+"</a>"+v+"</h1>",r,'<div>\u7B49\u7EA7\uFF1A<span class="level">MVP'+n+"</span></div>",'<div>\u6240\u5728\u5427\uFF1A<span class="forum_name">'+o.forum_name+"\u5427</span></div>","</div>",'<p><a href = "/p/'+o.thread_id+'" target = "_blank" >\u770B\u770BTa\u7684\u8BA4\u8BC1\u8D34>>></a></p>',"<p>\u5DF2\u6295\u7968\u6BD4\u4F8B\uFF1A</p>",'<div class="meizhi_vote_weight_wrap">','<span class="vote_weight_meizhi" style="width:'+s.meizhi_orign_percent+'%">'+s.meizhi_need_percent+"</span>",'<span class="vote_weight_weiniang" style="width:'+s.weiniang_orign_percent+'%;">'+s.weiniang_need_percent+"</span>",'<span class="vote_weight_renyao" style="width:'+s.renyao_orign_percent+'%;">'+s.renyao_need_percent+"</span>","</div>"].join(""),l=e._is_meizhi;l||(c+=o.can_vote?'<p class="j_vote_tip">\u6295\u51FA\u65E0\u8282\u64CD\u7684\u771F\u8BDA\u4E00\u7968\uFF01</p>':"<p>\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002</p>"),c+=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),c+=e.addTip(o,l);var u=$(t),p=l?e._special_visit_card_option:e._visit_card_option;e._visit_card&&(e._visit_card.closeCard(),e._visit_card=null),e._visit_card=e.use("common/component/Card",{content:c,card_css:{width:p.width,height:p.height},auto_positon:!0,event_target:u,attr:"id='meizhi_visit_card'",wrap:$("body")}),e.bindVisitCardEvent()}})},addTip:function(t,e){var i;return i=e?'<p class="level_up_tip"><span class="level_up_tip_title">\u5B8C\u6210\u5EA6:</span>\u83B7\u5F97'+t.exp_value+"\u70B9\u7ECF\u9A8C\u3001"+t.levelup_left+"\u5F20\u59B9\u7EB8\u7968\u540E\u5347\u7EA7</p>":'<a class="meizhi_card_tip" href="http://tieba.baidu.com/tb/zt/meizhi/index.html" target="_blank">\u4EC0\u4E48\u662F\u59B9\u7EB8\u8BA4\u8BC1\u7CFB\u7EDF>></a>'},calPercent:function(t){var e=t.meizhi+t.weiniang+t.renyao,i=Math.round(t.meizhi/e*100),a=Math.round(t.weiniang/e*100),o=100-i-a,n=10,s=i>n?i+"%":"",_=a>n?a+"%":"",d=o>n?o+"%":"";$.browser.msie&&$.browser.version<8&&(i>30?i-=1:a>30?a-=1:o>30&&(o-=1));var v={meizhi_orign_percent:i,weiniang_orign_percent:a,renyao_orign_percent:o,meizhi_need_percent:s,weiniang_need_percent:_,renyao_need_percent:d};return v},buildVoteBtnGroup:function(t,e,i){var a;if(this._is_meizhi)a=['<div class="meizhi_vote_button_wrap meizhi_disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");else if(t){var o={user_id:e,vote_type:"meizhi"},n={user_id:e,vote_type:"weiniang"},s={user_id:e,vote_type:"renyao"};a=['<div class="meizhi_vote_button_wrap">','<div class="j_vote_button vote_button vote_button_meizhi"'+$.tb.dataField(o)+">",'<div class="vote_text j_vote_text">\u59B9\u7EB8</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_weiniang"'+$.tb.dataField(n)+">",'<div class="vote_text j_vote_text">\u4F2A\u5A18</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_renyao"'+$.tb.dataField(s)+">",'<div class="vote_text j_vote_text">\u4EBA\u5996</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("")}else a=['<div class="meizhi_vote_button_wrap disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");return a},cutVoteCount:function(t){return t>9999?"9999+":t},bindVisitCardEvent:function(){var t=this;this._visit_card.showCard({type:"delayShow",time:200}),this._visit_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("card_btn","meizhi_vote"),t.vote(this)})}}});
;var Thread_add_result={resultNo:0,fid:"",tid:"",vid:"",sign:"",bdauditreason:0,bdQueryWordEnc:"",autoMsg:"",is_login:0,init:function(e){if(Thread_add_result&&e.data&&"object"==typeof e.data)for(var a in e.data)Thread_add_result[a]=e.data[a];Thread_add_result.resultNo=e.no},isNeedWaitForCheck:function(){var e=!1;switch(this.resultNo){case 9:case 20:case 23:e=!0}return e},isNeedBindPhone:function(){return 4010==this.resultNo},Action_FocusTitle:"focusTitle",Action_FocusContent:"focusContent",Action_ClearYZM:"clearYZM",Action_FocusUrl:"focusUrl",Action_GoToHead:"goToHead",Action_FlushAndGoToHead:"flushAndGoToHead",getActionType:function(){var e="";switch(this.resultNo){case 10:case 14:case 501:case 15:case 36:case 41:case 42:case 43:case 46:case 9001:case 10010:case 10011:case 10012:case 10013:case 220012:case 220015:case 220035:case 2130001:case 2130007:case 2130008:case 2130009:case 2130011:case 2130012:case 2130014:case 2130005:e=this.Action_FocusContent;break;case 11:case 20:e=this.Action_FocusTitle;break;case 17:case 0:e=this.Action_FlushAndGoToHead;break;case 22:case 9:case 23:case 119:case 44:case 100:case 703:case 704:case 705:e=this.Action_GoToHead;break;case 38:case 39:case 40:e=this.Action_ClearYZM;break;case 1120:case 1121:e=this.Action_FocusUrl}return e},getMessage:function(){var e="",a=null;if(this.resultNo>=901&&this.resultNo<=950)return Thread_add_result.autoMsg;switch(null==a&&(a=PageData.forum?PageData.forum.id:null),null==a&&(a=PageData.forum_id),null==a&&(a=PageData.forumID),this.resultNo){case 10:e="\u8D34\u5B50\u5185\u5BB9\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57";break;case 11:e="\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F";break;case 12:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u8D26\u53F7\u56E0\u8FDD\u89C4\u64CD\u4F5C\u800C\u88AB\u5C01\u7981&nbsp;&nbsp;<a href='/pmc/main' target=\"_blank\">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>":"\u64CD\u4F5C\u5931\u8D25";break;case 13:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid="+a+'\' target="_blank">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>':"\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01 ";break;case 14:e="\u60A8\u53D1\u5E03\u7684\u8D34\u5B50\u5DF2\u7ECF\u5B58\u5728";break;case 501:case 15:e="\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34";break;case 16:e="\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6240\u8F93\u5165\u7684\u8D34\u5427\u4E0D\u5B58\u5728\u3002\u7531\u4E8E\u7CFB\u7EDF\u5347\u7EA7\u7EF4\u62A4\uFF0C\u65B0\u5EFA\u8D34\u5427\u529F\u80FD\u6682\u505C\uFF0C\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\uFF01";break;case 19:case 200:case 201:case 202:e="\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868";break;case 20:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868";break;case 17:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 18:case 21:e="\u5176\u4ED6\u672A\u77E5\u539F\u56E0";break;case 22:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u7531\u4E8E\u7279\u6B8A\u539F\u56E0\u6211\u4EEC\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u6211\u4EEC\u4F1A\u572810\u5206\u949F\u5185\u786E\u8BA4\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\uFF01";break;case 9:e=this.getCheckMessage(this.bdauditreason);break;case 33:e=1==Thread_add_result.is_login?"\u60A8\u53D1\u8D34\u592A\u5FEB\u4E86:) \u8BF7\u7A0D\u540E\u518D\u53D1":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 34:e=1==Thread_add_result.is_login?"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 220034:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898";break;case 220035:e="\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~";break;case 35:e=1==Thread_add_result.is_login?"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 36:e="\u8BF7\u4E0D\u8981\u53D1\u5E7F\u544A\u8D34\uFF01";break;case 37:e="\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 38:e="\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";break;case 39:e="\u7531\u4E8E\u60A8\u591A\u6B21\u8F93\u9519\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 40:e="\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165";break;case 41:e="\u60A8\u7684\u8D34\u5B50\u53EF\u80FD\u5305\u542B\u4E0D\u5408\u9002\u7684\u5185\u5BB9\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u63D0\u4EA4";break;case 42:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u88AB\u7CFB\u7EDF\u8BA4\u4E3A\u6709\u53D1\u5E7F\u544A\u5ACC\u7591\uFF0C\u8BF7\u60A8\u7A0D\u540E\u518D\u53D1";break;case 43:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u6216\u8D34\u5B50\u5185\u5BB9\u6709\u5E7F\u544A\u6216\u4E0D\u5408\u9002\u7684\u7279\u5F81\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u53D1\u9001";break;case 23:e="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u9700\u8981\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u5EFA\u7ACB\u8D34\u5427";break;case 119:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898";break;case 1120:e="\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='http://www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539";break;case 1121:e="\u62B1\u6B49\uFF0C\u89C6\u9891\u670D\u52A1\u5347\u7EA7\u4E2D\uFF0C\u60A8\u6682\u65F6\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u89C6\u9891\u7684\u8D34\u5B50\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u8BF7\u539F\u8C05";break;case 44:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8868\u4E3B\u9898\u8D34\u5B50\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u6216\u56DE\u590D\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 100:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u4F7F\u7528\u5B8C\u6574\u7684\u8D34\u5427\u529F\u80FD\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 701:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u4E0D\u5141\u8BB8\u672A\u767B\u5F55\u7528\u6237\u53D1\u8D34\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 702:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 703:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u4F1A\u5458\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F\u3002<a href='/f?kw="+this.bdQueryWordEnc+"#1' target=_blank>\u70B9\u6B64\u7533\u8BF7\u52A0\u5165</a>\u672C\u5427\u4F1A\u5458";break;case 704:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u7BA1\u7406\u56E2\u961F\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 705:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 706:e="\u62B1\u6B49\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 45:e="\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0";break;case 46:e="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!";break;case 800:break;case 801:break;case 802:break;case 803:break;case 804:break;case 805:break;case 806:break;case 807:break;case 808:break;case 809:break;case 814:break;case 815:e="\u62B1\u6B49\uFF0C\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u6216\u672A\u8D2D\u4E70\u97F3\u4E50\u9053\u5177\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5";break;case 900:e="\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 961:e="\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09";break;case 9001:e="\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002";break;case 2100:e="\u5185\u5BB9\u542B\u6709\u9AD8\u7EA7\u5B57\u4F53\u6548\u679C\uFF0C\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5C31\u80FD\u4F7F\u7528\u54E6~~";break;case 4010:e="\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002";break;case 9e3:e="\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002";break;case 10010:e="\u60A8\u7684\u6027\u522B\u65E0\u6CD5\u8FDB\u884C\u59B9\u7EB8\u8BA4\u8BC1</br><a style = 'font-size:12px;' href = 'http://www.baidu.com/p/setting/profile/basic' target ='_blank'>\u53BB\u4FEE\u6539\u6211\u7684\u6027\u522B>><a>";break;case 10012:e="\u8BF7\u4E0A\u4F20\u81F3\u5C11\u4E00\u5F20\u56FE\u7247\u3002";break;case 10013:e="\u60A8\u53D1\u5F80\u7684\u5427\u672A\u5F00\u901A\u59B9\u7EB8\u8BA4\u8BC1\u529F\u80FD\u3002";break;case 2130001:e="\u8BF7\u4E0D\u8981\u7ED9\u975E\u59B9\u7EB8\u7528\u6237\u6295\u7968\u3002";break;case 2130007:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2130008:e="\u60A8\u5DF2\u7ECF\u7ED9\u8BE5\u7528\u6237\u6295\u8FC7\u7968\u3002";break;case 2130009:e="\u6295\u7968\u5931\u8D25\u3002";break;case 2130005:e="\u60A8\u5DF2\u7ECF\u53D1\u8D77\u8FC7\u59B9\u7EB8\u8BA4\u8BC1\u8D34</br><a href='/p/"+Thread_add_result.thread_id+"' target = '_blank' >http://tieba.baidu.com/p/"+Thread_add_result.thread_id+"</a>";break;case 2130011:e="\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E4B\u95F4\u4E0D\u80FD\u76F8\u4E92\u6295\u7968\u3002";break;case 220012:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 220013:e="\u60A8\u7684IP\u5DF2\u88AB\u5C01\u7981\u3002";break;case 225001:e="\u60A8\u7684\u8D26\u53F7\u7981\u6B62\u8D34\u6761\u3002";break;case 220015:e="\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u542B\u6709\u654F\u611F\u4FE1\u606F\u3002";break;case 219e4:e="<p>\u62B1\u6B49\u60A8\u6CA1\u6709\u8D34\u6761\u9053\u5177\u4E86\u4E0D\u80FD\u53D1\u5E03\u8D34\u6761\u4FE1\u606F\u3002</p><p>PS\uFF1A\u53D1\u8D34,\u56DE\u8D34,\u53C2\u52A0\u6D3B\u52A8\u90FD\u6709\u673A\u4F1A\u83B7\u5F97\u8D34\u6761\u9053\u5177\u3002</p>";break;case 2130012:e="\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u6295\u7968\u3002";break;case 2130014:e="\u4E0D\u80FD\u7ED9\u7537\u6027\u7528\u6237\u6295\u7968";break;case 2190001:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u5566\uFF0C\u8BF7\u4F11\u606F\u4E00\u4E0B\u3002";break;case 2190002:e="\u62B1\u6B49\uFF0C\u6BCF10\u5206\u949F\u53EA\u80FD\u62A2\u4E00\u6B21\u8D34\u6761\u3002";break;case 2190003:e="<p>\u771F\u9057\u61BE~\u60A8\u6CA1\u6709\u62A2\u5230\u8D34\u6761\u9053\u5177\u3002</p><p>PS\uFF1A\u7B49\u7EA7\u8D8A\u9AD8\u83B7\u5F97\u9053\u5177\u51E0\u7387\u8D8A\u9AD8\u54E6\uFF01</p>";break;case 2190004:e="\u670D\u52A1\u5668\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5";break;case 2190005:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2190006:e="\u8D34\u6761\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u3002";break;case 2190007:e="\u8D34\u6761\u5185\u5BB9\u8FC7\u957F\u3002";break;case 2190008:e="\u4ECA\u5929\u7684\u9053\u5177\u88AB\u62A2\u5B8C\u5566\uFF0C\u660E\u5929\u7EE7\u7EED\u52A0\u6CB9\uFF01";break;default:e="\u672A\u77E5\u9519\u8BEF\u3002"}return e},getCheckMessage:function(e){var a="";switch(e){case-61:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u6240\u53D1\u7684\u8D34\u5B50\u5F85\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-62:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u8D34\u56FE\u7684\u8D34\u5B50\u9700\u8981\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-74:case-75:case-60:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-70:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u63A7\u5236\u5E7F\u544A\u8D34\uFF0C\u9700\u8981\u901A\u8FC7\u5BA1\u6838\u540E\u624D\u80FD\u53D1\u5E03\u3002\u767B\u9646\u7F72\u540D\u53D1\u8D34\u4E0D\u53D7\u6B64\u9650\u5236\u3002";break;case-71:a="\u60A8\u53D1\u8868\u7684\u5E16\u5B50\u592A\u957F\u4E86\u3002\u4E3A\u4E86\u9632\u6B62\u704C\u6C34\uFF0C\u9700\u7CFB\u7EDF\u5BA1\u6838\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u7A0D\u540E\u67E5\u770B";break;default:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85"}return a}};_.Module.define({path:"encourage/widget/WelfareIcon",sub:{_card:null,_isGifing:!1,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;this._wrap.on("mouseenter",".j_score_welfare",function(){t._buildCard(this)}).on("mouseleave",".j_score_welfare",function(){return t._card&&t._card.closeCard({type:"delayClose",time:200}),t._card=null,!1}).on("click",".j_score_welfare",function(e){return t.showGif(e),!1})},showGif:function(t){var e=$("<div></div>"),i=this,o="http://tb1.bdstatic.com/tb/r/image/2014-04-11/968642070f6c20e5274ba44b5a75707f.gif",n=$('<img style="position:absolute;z-index: 50000; left: 80px; top: 80px;width:1px;height: 1px;" src="">');this._isGifing||(this._isGifing=!0,e.css({position:"absolute",zIndex:5e4,left:t.pageX-80,top:t.pageY-80}),e.append(n),$("body").append(e),setTimeout(function(){n.tbattr("src",o)},0),n.animate({width:190,height:134,top:0,left:0},300),setTimeout(function(){n.animate({width:1,height:1,top:80,left:80},300,function(){e.remove(),i._isGifing=!1})},3e3))},_buildCard:function(t){var e,i=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u6709\u6548\u671F\uFF1A2014\u5E7412\u670831\u65E5</p></div>"].join(""),o=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u53D1\u798F\u5229\u6709\u673A\u4F1A\u83B7\u5F97\uFF01</p>",'<p style="color:#fc6853">\u70B9\u6211\uFF01</p></div>'].join(""),n=$(t),s=n.getData();if(s){e=s.user_id!==PageData.user.user_id?o:i;var a=n.offset().left-86+n.outerWidth(!0)/2,d=n.offset().top-64-12;this._card=this.use("common/widget/Card",{content:e,card_css:{top:d,left:a,width:172},auto_positon:!0,event_target:n,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}}});_.Module.define({path:"encourage/widget/achieveCard",requires:["common/component/Card"],sub:{initial:function(){this._wrap=$("body"),this._bindEvent()},_bindEvent:function(){var a=this;this._wrap.on("mouseenter",".j_fighter",function(e){var t=$(e.target),i=t.getData();$.post("/tbmall/gthread/iconbanner",{tbs:PageData.tbs,user_id:i.user_id},function(e){var i=t.offset();if(0===e.no){var c='<div class="achievement_card">    <p class="achievement_card_content">       <img class="achievement_card_img" src="http://tb.himg.baidu.com/sys/portrait/item/'+e.data.portrait+'" alt="" height=66 width=66 />        <span class="achievement_card_uname">'+e.data.user_name+'</span><i class="achievement_card_icon"></i></br>        <span class="achievement_card_medal">\u9996\u5C4A\u62F3\u738B\u4E89\u9738\u8D5B - '+e.data.icon_name+' </span></br>    </p><a class="achievement_card_link" href="/tbmall/gthread/center" target="_blank">\u9996\u5C4A\u8D34\u5427\u62F3\u738B\u4E89\u9738\u8D5B>></a></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:265,"z-index":1e3,top:i.top-117-12,left:i.left-126,card_leave_display:!0},wrap:$("body"),attr:"id='achieve_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}})}).on("mouseleave",".j_fighter",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_fighter",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_cup_a, .j_cup_b",function(e){var t=$(e.target),i=t.offset(),c="A CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_a.png";$(this).hasClass("j_cup_b")&&(c="B CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_b.png");var n='<div class="cup_card"><div class="cup_card_top clearfix"><img src="'+d+'" width="57" height="57" /><p class="title">'+c+'</p><p>\u8981\u4E24\u4E2A\u4E00\u8D77\u624D\u591F\u597D\uFF01</p></div><div class="cup_card_bottom"><a href="/f?ie=utf-8&kw=%E4%B8%96%E7%95%8C%E6%9D%AF#cupicon" target="_blank">\u4E16\u754C\u676F\u671F\u95F4\u7ED9\u5973\u795E\u9C9C\u82B1\u83B7\u5F97\uFF01</a></div></div>';a._medalCard=a.use("common/component/Card",{content:n,card_css:{width:235,"z-index":1e3,top:i.top-110-12,left:i.left-110,card_leave_display:!0},wrap:$("body"),attr:"id='cup_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_cup_a, .j_cup_b",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_cup_a, .j_cup_b",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_minigame",function(e){var t=$(e.target),i=(t.getData(),t.offset()),c='<div class="minigame_card"><div class="minigame_card_top clearfix"><img src="http://tb1.bdstatic.com/tb/r/image/2014-08-05/32d9b951b986efbb2ad5ce0f445ce9be.png" width="57" height="57" /><p class="title">\u6E38\u620F\u738B\u5370\u8BB0</p><p>\u5728\u3010T\u8C46\u5C0F\u6E38\u620F\u3011\u4E2D\u8FDE\u7EED3\u5929\uFF0C\u6BCF\u5929\u81F3\u5C11\u5B8C\u6210\u4E00\u5C40\u6BD4\u8D5B\uFF0C\u5373\u53EF\u83B7\u5F97\u3002</p></div><div class="minigame_card_bottom"><a href="/minigame/home" target="_blank">T\u8C46\u5C0F\u6E38\u620F</a></div></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:275,"z-index":1e3,top:i.top-110-12,left:i.left-130,card_leave_display:!0},wrap:$("body"),attr:"id='minigame_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_minigame",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})})}}});_.Module.define({path:"fanclub/widget/fancard",requires:["common/widget/Card"],sub:{_fancard:null,_fancard_ajax:null,_fancard_data:{},_forum_id:"0",initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var a=this;this._wrap.delegate(".j_fanclub_vip","mouseenter",function(){return $(this).tbattr("title",""),a._getCardData(this),!1}),this._wrap.delegate(".j_fanclub_vip","mouseleave",function(){return a._fancard_ajax&&a._fancard_ajax.abort(),a._fancard&&a._fancard.closeCard({type:"delayClose",time:200}),a._fancard=null,!1})},_getCardData:function(a){var t=$(a).getData();if(t){var n=t.user_id,r=this;this._fancard_ajax=$.ajax({type:"GET",url:"/frsstar/browse/fanclub/fanInfo?userid="+n,dataType:"json",success:function(t){switch(t.no){case 0:r._fancard_data=t,r._buildCard(a)}},error:function(){$(a).tbattr("title","\u7F51\u7EDC\u9519\u8BEF")}})}},_buildCard:function(a){var t="",n=this._fancard_data.fanclub_array.length;n>3&&(n=3);for(var r=0;n>r;r++)0==r&&(this._forum_id=this._fancard_data.fanclub_array[r].forum_id),t+='<a  target="_blank"  href="/f?kw='+encodeURIComponent(this._fancard_data.fanclub_array[r].name)+'&ie=utf-8" class="fanclub_card_forum_name">'+this._fancard_data.fanclub_array[r].name+' <span class="fanclub_icon fanclub_icon_vip_'+this._fancard_data.fanclub_array[r].level+'"></span></a>',n-1>r&&(t+='<a class="fanclub_card_forum_name_gap">|</a>');var e=['<div id="fanclub_card_container">','<div class="fanclub_card_head">','<a  target="_blank"  href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8"  ><img src="http://tb.himg.baidu.com/sys/portrait/item/'+this._fancard_data.portrait+'" alt="" /></a>',"</div>",'<div class="fanclub_card_right">','<a target="_blank" href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8" class="fanclub_card_right_title">'+this._fancard_data.username+'<span class="fanclub_icon fanclub_icon_frs "></span></a>',"<p>\u52A0\u5165\u4F1A\u5458\u65F6\u95F4:<span>"+this._formatDate(this._fancard_data.entertime)+"</span></p>","<p>\u5DF2\u52A0\u5165\u7C89\u4E1D\u4F1A:<span>"+this._fancard_data.fanclub_count+"\u4E2A</span></p>","</div>",'<div class="fanclub_card_forum_icon_wrapper" >',t,"</div>",'<div class="fanclub_card_bottom">','<a  target="_blank"  href="http://tieba.baidu.com/p/2676282434">\u4EC0\u4E48\u662F\u7C89\u4E1D\u4F1A\u5458&gt;&gt;</a>',"</div>","</div>"].join(""),_=$(a),i=_.offset().left-140+_.outerWidth(!0)/2,d=_.offset().top-64-12;this._fancard=this.use("common/widget/Card",{content:e,card_css:{top:d,left:i,width:302,height:147},auto_positon:!0,event_target:_,attr:"id='fancard_show'",wrap:$("body")}),this._fancard.showCard({type:"delayShow",time:200})},_buildErrorCard:function(){},_formatDate:function(a){var t=new Date(1e3*a);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"liveshow/widget/xiu8FollowWarn",requires:["frs/widget/forum_card/focus_btn"],sub:{initial:function(e){var t=this;t.forum_name=e.forum_name||"\u79C0",this.$el=$("#xiu8_follow_warn"),this.bindEvents()},bindEvents:function(){var e=this;this.$el.on("click",".j_xiu8_follow_warn_close",function(t){t.preventDefault(),e.$el.remove(),$.stats.track("\u5173\u95ED\u6309\u94AE",e.forum_name+"\u5427\u573A\u666F\u8499\u7248")}).on("click",".j_xiu8_follow_btn",function(t){t.preventDefault(),e.requireInstance("frs/widget/forum_card/focus_btn",[{tbs:PageData.user.tbs,uid:PageData.user.user_id}])._dolike(),$.stats.track("\u5173\u6CE8\u6309\u94AE",e.forum_name+"\u5427\u573A\u666F\u8499\u7248"),e.$el.remove()})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar;var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:69}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:72}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:88}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:91}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:92}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no}]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"pplatform/widget/LocalityPopWindow",requires:[],sub:{initial:function(t,o){var i=$.parseJSON(t);i&&(this.pageMap={0:"FRS",1:"PB","0,1":"\u5168\u90E8"},this.windowTypeMap={1:"\u56FE\u7247\u5F39\u7A97","00":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E00","01":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E8C"},this.popWindow=$(".locality_pop_window_wrap"),this.bindEvents(i,o),this.runStrategy(i))},bindEvents:function(t,o){var i=this,a=i.pageMap[t.position],n="1"==t.type?t.type:t.type.toString()+t.subtype.toString();n=i.windowTypeMap[n],$(".locality_pop_window_wrap").on("click",".locality_pop_head_close_btn",function(o){o.preventDefault(),$.stats.track("\u6587\u5B57\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".locality_pop_window_pic_close_btn",function(o){o.preventDefault(),$.stats.track("\u56FE\u7247\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".j_local_pic_pop_window",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+n,t.taskName,a,"click",{popWindowType:n,obj_id:t.adId})}).on("click",".locality_pop_text_img",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+n,t.taskName,a,"click",{popWindowType:n,obj_id:t.adId})}).on("click",".locality_pop_text_title",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+n,t.taskName,a,"click",{popWindowType:n,obj_id:t.adId})}).on("click",".local_pop_window_content",function(){var i=window.open();i.location=$(this).tbattr("data-id"),$.stats.track("frs"==o?73:75,t.taskName,a,"click",{popWindowType:n,taskName:t.taskName,tbjump:t.link,obj_id:t.adId})})},runStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);if(!o||0>o)this.resetStrategy(t),this.stepStrategy(t);else{if(0==o)return;this.stepStrategy(t)}this.showPop(t)},resetStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,1)},stepStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);$.cookie("locality_pop_window_"+t.adId,++o)},clearStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,0)},showPop:function(){var t=this,o=setTimeout(function(){t.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(o),o=null},2e3)},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})}}});_.Module.define({path:"common/widget/PlatformSpreadLayer",requires:[],sub:{initial:function(t){this.$platformLayer=$("#platform_left_float"),this.$platformCloseBtn=$("#j_platform_close_btn"),this.$platformClickBtn=$("#j_platform_left_content"),this.shouldShowLayer=$.cookie("platform_float_hide_"+t)?!0:!1,this.opt=t,this.shouldShowLayer||($.stats.track("\u6574\u4F53","\u8D34\u5427\u6D6E\u6807",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:t}),this.$platformLayer.show(),this._bindEvent())},_bindEvent:function(){var t=this,o=t.$platformLayer,a=t.$platformCloseBtn,e=t.$platformClickBtn,i=t.opt;e.on("click",function(){$.stats.track("\u6574\u4F53\u70B9\u51FB","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i})}),a.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i}),o.hide(),$.cookie("platform_float_hide_"+i,1,{expires:999,path:"/"}),!1})}}});_.Module.define({path:"common/widget/pkFixedBubble",sub:{initial:function(){this.$wrap=$("#pk_bubble_w"),this.$close_btn=this.$wrap.find(".close_btn"),this.showBubble(),this.bindEvent()},showBubble:function(){if(1!=$.cookie("pk_bubble_hide")&&document.body.clientWidth>1024){var i=Math.round($(window).height()/2-this.$wrap.outerHeight()/2);this.$wrap.css({top:i}).show()}else this.$wrap.hide()},bindEvent:function(){var i=this;this.$close_btn.click(function(e){e.preventDefault(),i.$wrap.remove(),$.cookie("pk_bubble_hide",1,1)}),$(window).resize(function(){i.showBubble()})}}});_.Module.define({path:"common/widget/PlatformSpreadVideo",requires:[],sub:{ANIMATE_STYLE:{UP:1,DOWN:2},videoHeight:255,ch:document.documentElement.clientHeight||document.body.clientHeight,cw:document.documentElement.clientWidth||document.body.clientWidth,initial:function(t,o){var e=$.cookie("platform_spread_video_"+o),i=$.cookie("platform_video_spread_close_"+o),a=$.cookie("platform_video_spread_autoShow_"+o),n=null!=i,d=null==e&&!parseInt(e),s=$.browser.msie&&6==Number($.browser.version);return this.swfURL=t,this.opt=o,this.$videoWrap=$("#platform_spread_video"),this.$videoTopHeads=this.$videoWrap.find(".platform_video_head"),this.$videoContent=this.$videoWrap.find(".platform_video_content"),this.$upHead=this.$videoTopHeads.eq(0),this.$downHead=this.$videoTopHeads.eq(1),this.$downBtn=this.$upHead.find(".head_down_btn"),this.$upBtn=this.$downHead.find(".head_up_btn"),this.$closeBtns=this.$videoTopHeads.find(".head_close_btn"),this.shouldShowVideo=d,s||n?(this.$videoWrap.hide(),void 0):($.stats.track("\u6574\u4F53","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:o}),d&&null==a?($.cookie("platform_video_spread_autoShow_"+o,1,{expires:999,path:"/"}),this._animateTo(this.ANIMATE_STYLE.UP)):this._animateTo(this.ANIMATE_STYLE.DOWN),this._bindEvent(),void 0)},_animateTo:function(t){var o=this,e=o.$videoWrap,i=o.$videoContent,a=o.$downHead,n=o.$upHead,d=o.opt;t&o.ANIMATE_STYLE.UP?($.stats.track("\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d}),i.show(),e.animate({bottom:0},600,function(){a.hide(),n.show(),setTimeout(function(){$.stats.track("\u6709\u6548\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d})},5e3)}),o._loadSwf()):e.animate({bottom:-1*o.videoHeight},600,function(){i.hide(),n.hide(),a.show()})},_bindEvent:function(){var t=this,o=t.$videoWrap,e=t.$closeBtns,i=t.$upBtn,a=t.$downBtn,n=t.opt;e.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),$.cookie("platform_video_spread_close_"+n,1,{expires:999,path:"/"}),o.hide(),!1}),i.on("click",function(){return t._animateTo(t.ANIMATE_STYLE.UP),!1}),a.on("click",function(){return $.stats.track("\u6536\u8D77\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),t._animateTo(t.ANIMATE_STYLE.DOWN),!1}),a.one("click",function(){return $.cookie("platform_video_spread_"+n,1,{expires:999,path:"/"}),!1})},_loadSwf:function(){{var t=this,o=t.swfURL,e=t.opt;t.$videoContent}new $.swf(o,{id:"platform_video_spread_"+e,container:"#j_platform_video_content",width:340,height:255})}}});var PopWidowHandle=function(t){var o={url:{P_GET:"/app/pop/bws/popup",P_POST:"/app/pop/commit/click"},delay:15,from_forum:"",page:""};this._option=$.extend(!0,o,t),this._init()};PopWidowHandle.prototype={constructor:PopWidowHandle,_init:function(){var t=this;$(document).ready(function(){setTimeout(function(){t._getPopWindow()},1e3*t._option.delay)})},_getPopWindow:function(){var t=this._option,o=this;$.tb.get(t.url.P_GET,{from_forum:$.tb.escapeHTML(t.from_forum),position:t.page},function(t){0==t.no&&t.data.task_id&&o._showPopWindow(t.data)})},_showPopWindow:function(t){this.data=t;var o=this._option,n={styleId:t.style_id,templateObj:{title:t.title,content:t.content,button:t.button,note:t.note,link:t.link}};this.popWindow=new PopWindow(n);var i=this.popWindow;i.bind("closeSuccess",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:1,count:t.count},function(){})},!0),i.bind("clickBtn",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:2,count:t.count},function(){})},!0),i.showPop()}};_.Module.define({path:"common/component/image_flash_editor",sub:{_swfPath:"http://tb2.bdstatic.com/tb/static-common/swf/FlashFilterUI_6e543a5.swf",_vars:{configURL:"/tb/static-common/htmlfilter/filterconf.js",reviewURL:"",iconPath:"/tb/static-common/img/image_editor/",uploadURL:"",imageURL:null,maxSize:5,maxWidth:3e3,maxHeight:3e3},_events:["upload_complete","compress_complete","upload_error"],_flashInstance:null,initial:function(t,i){i&&$.extend(this._vars,i),this._buildHTML(t.container,t.width,t.height),this._buildFlash(t)},_buildHTML:function(t,i,s){var a=this,e='<div class="image_flash_editor"><div class="flash_editor_container"></div><div class="button_bar"><a href="#" class="ui_btn ui_btn_m j_ok"><span><em>\u786E \u5B9A</em></span></a><a href="#" class="ui_btn ui_btn_sub_m j_cancel"><span><em>\u53D6 \u6D88</em></span></a></div></div>';this.$root=$(e),this.$root.css({width:i,height:s}),this.$root.find(".j_ok").click(function(){return a.startUpload(),!1}),this.$root.find(".j_cancel").click(function(){return a.trigger("cancel"),!1}),$(t).append(this.$root)},_buildFlash:function(t){this._swfOptions=t,this._swfOptions.height=t.height-45,this._swfOptions.container=this.$root.find(".flash_editor_container"),this._swfOptions.vars=this._vars,this._swfOptions.callBacks={},this._generateCallBack(),this._flashInstance=new $.swf(this._swfPath,this._swfOptions)},_generateCallBack:function(){var t=this;for(var i in this._events){var s=this._events[i];this._swfOptions.callBacks[s]=function(i){return function(){var s=Array.prototype.slice.call(arguments,0);s.unshift(i),t.trigger.apply(t,s)}}(s)}},loadRemoteImage:function(t){this._flashInstance.remote("loadRemoteImage",t)},startUpload:function(){this._flashInstance.remote("startUpload")},setUploaderVariables:function(t){this._flashInstance.remote("setUploaderVariables",t)},clearPreview:function(){this._flashInstance.remote("clearPreview")}}});_.Module.define({path:"common/widget/EditorPicMeizhi",requires:["common/widget/EditorPicMeizhi/EditorPicMeizhiUpload"],sub:{tempHTML:['<div id="meizhi_img_layer" class="img_layer_content j_content ui_card_wrap hide"><ul class="mz_ul clearfix"><li class="mz_imgUpload_btn" ><a class="mz_uploader_container" href="#" onclick="return false;" ></a><span class="cut_line"></span></li><li class="mz_album_btn"><a class="mz_btn_myalbum" href="#" onclick="return false;"></a><span class="cut_line"></span></li><li class="mz_camera_btn"><a class="mz_btn_camera" href="#" onclick="return false;" ></a></li></ul><span class="ui_white_down arrow"></span></div>'].join(""),count:0,imageLimite:20,initial:function(){},init:function(i,e){var t=this;t.editor=e,i.before(this.tempHTML),t.j_content=i.siblings(".j_content"),t.picUploader=this.use("common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",t.j_content.find(".mz_uploader_container"),e),t.myAlbumHandler(e),t.myCameraHandler(e),t.addImageArray={}},myAlbumHandler:function(i){var e=this,t=e.j_content.find(".mz_album_btn");t.click(function(){e.editorAlbum?e.editorAlbum.run():(e.editorAlbum=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",i),e.editorAlbum.run())})},myCameraHandler:function(i){var e=this,t=e.j_content.find(".mz_camera_btn");t.click(function(){e.editorCamera?e.editorCamera.run():(e.editorCamera=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",i),e.editorCamera.run())})},getLimitNum:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();return t},showMaxImage:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();t=Math.max(0,t),i.j_tip.find(".j_image_num").html(t)}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",requires:["common/widget/ScrollPanel"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{GET_ALBUM_URL:"/photo/interface/alblist",initial:function(e){var l=this;l.editor=e},run:function(){this.selectedPic={},this.albumList={},this.curAlbumId=null,this.myAlbumLayer(),this.getAlbumList()},layerHeight:451,layerWidth:683,selectedPic:{},albumList:{},curAlbumId:null,errorHandler:function(e){var l=this;switch(e){case"noalbum":return $('<div class="album_error">\u4E0A\u4F20\u56FE\u7247\u5230\u767E\u5EA6\u76F8\u518C\uFF0C\u53D1\u8D34\u914D\u56FE\u968F\u9009\u968F\u7528\uFF0C\u65B9\u4FBF\u5FEB\u6377\uFF01<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u4E0A\u4F20</a></div>');case"creatAlbum":return $('<div class="album_error">\u5F00\u901A\u767E\u5EA6\u76F8\u518C\uFF0C\u53EF\u4EE5\u53D1\u8D34\u65F6\u76F4\u63A5\u63D2\u5165\u56FE\u7247\uFF0C\u65B9\u4FBF\u5FEB\u6377~<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u5F00\u901A</a></div>');case"login":return $("<div class=\"album_error\">\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u72B6\u6001\uFF0C\u8BF7\u91CD\u65B0<a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', '']);\">\u767B\u5F55</a></div>");case"systemError":var a=$('<div class="album_error">\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7<a href="#" >\u5237\u65B0</a>\u91CD\u8BD5</div>');return a.find("a").click(function(){l.getAlbumList()}),a;case"noImage":return'<div class="album_error">\u8BE5\u76F8\u518C\u6CA1\u6709\u56FE\u7247\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u76F8\u518C\u8BD5\u8BD5~</div>'}},renderAlbumList:function(e,l){var a=this,t='<div class="l_album_list"><select class="l_album_select" onmousewheel="event.returnValue=false;return false;" >';for(i=0;e>i;i++)album=l[i],t+="<option "+(album==a.curAlbumId?'selected="selected"':"")+' value="'+album.id+'">',t+=album.name+"</option>",a.albumList[album.id]=album.pic_num;var r=a.getImageLimit(a.albumContainer.find(".l_album_selected_con"));t+='</select>\u8FD8\u53EF\u4EE5\u9009\u4E2D<span class="j_image_num" id="album_max">'+r+"</span>\u5F20</div>";var s=$(t);return s.find(".l_album_select").change(function(){a.getPicByUrl($(this).val())}),s},renderAlbumPic:function(e,l){var a=this,i=$('<div class="l_album_pics" ></div>'),t=a.getImgEles(e,1,50);return l.append(i),a.l_album_pics=i,l.click(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){$.browser.msie&&$.browser.version<8?a.l_album_pics.html(t):(a.scrollPanel=a.use("common/widget/ScrollPanel",{container:i,height:350,content:t}),a.rightScrollPanel=a.use("common/widget/ScrollPanel",{container:a.albumContainer.find(".l_album_selected_con"),height:350,content:""})),i.delegate(".j_prepage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page-1),!1}),i.delegate(".j_nextpage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page+1),!1}),i.delegate(".l_album_small_pics","click",function(){return a.selectImage(this),!1}),i.delegate(".l_album_small_pics","mouseenter",function(){return $(this).addClass("l_hover"),!1}),i.delegate(".l_album_small_pics","mouseleave",function(){return $(this).removeClass("l_hover"),!1}),a.reloadImage()}),i},reloadImage:function(){var e=this;this.l_album_pics.find(".l_album_pic").each(function(){var l=$(this),a=l.data("src");l.load(function(){e.resetImg(this,120,120)}).tbattr("src",a)})},addSelected:function(e,l){var a=this,i=$('<a class="i_item_con complete" data-url="'+e+'"><img src="'+l+'"  onload="resizePic_temp(this,84,84)" /></a>');return $.browser.msie&&$.browser.version<8?a.albumContainer.find(".l_album_selected_con").append(i):a.rightScrollPanel.appendContent(i),i},removeSelected:function(){},selectImage:function(e){var l=this;e="IMG"==e.tagName?$(e).parent():$(e);var a=e.tbattr("data-url"),i=e.tbattr("data-surl");if(this.errDom=$(".i_error_tips"),this.errDom.text(""),e.hasClass("selected"))e.removeClass("selected"),l.selectedPic[a].remove(),delete l.selectedPic[a];else{var t=l.getImageLimit(l.albumContainer.find(".l_album_selected_con"));if(0>=t)return;if(a.match("priv.hiphotos.baidu.com"))return this.errDom.text("\u60A8\u7684\u79C1\u6709\u7167\u7247\u65E0\u6CD5\u5728\u8D34\u5B50\u4E2D\u663E\u793A\uFF0C\u8BF7\u4F7F\u7528\u5176\u4ED6\u7167\u7247\u3002"),void 0;e.addClass("selected"),l.selectedPic[a]=l.addSelected(a,i)}l.updateRemianImage(l.albumContainer)},getAlbumList:function(){var e=this;$.get(e.GET_ALBUM_URL,{_t:(new Date).getTime()},function(l){var a=e.albumContainer.find(".l_album_lwrapper");if(l=$.parseJSON(l),"0"==l.no){{var i,t=l.data.defalut_album,r=l.data.album_list,s=r.length,n=t.pic_list;n.length}if(e.curAlbumId=t.id,0==s)i=e.errorHandler("noalbum"),a.html(i);else{a.append(e.renderAlbumList(s,r)),e.renderAlbumPic(n,a)}}else if("4049"==l.no){var i=e.errorHandler("creatAlbum");a.html(i)}else if("265"==l.no){var i=e.errorHandler("login");a.html(i)}else{var i=e.errorHandler("systemError");a.html(i)}})},getPicByUrl:function(e,l){var a=this;a.curAlbumId=e,$.get("/photo/interface/piclist",{album_id:e,pn:l,_t:(new Date).getTime()},function(e){if(e=$.parseJSON(e),0==e.no){var l=e.data;$.browser.msie&&$.browser.version<8?a.l_album_pics.html(a.getImgEles(l.pic_list,l.cur_page,l.page_size)):(a.scrollPanel.setContent(a.getImgEles(l.pic_list,l.cur_page,l.page_size)),a.scrollPanel.scrollTopTo(0)),a.reloadImage()}else a.l_album_pics.html(a.errorHandler("systemError"))})},getImgEles:function(e,l,a){var i,t,r="",s=e.length,a=a||50,n=this;if(n.curPagePicNum=s,n.cur_page=l||1,0==s)r=this.errorHandler("noImage");else{for(r+="<div class='l_album_pics_container'>",i=0;s>i;i++)t=this.selectedPic[e[i].big_pic]?"selected":"",r+='<a href="#" onclick="return false" class="l_album_small_pics '+t+'" data-surl="'+e[i].small_pic+'" data-url="'+e[i].big_pic+'"><span class="l_album_pic_hover"></span><span class="l_album_pic_select" title="\u5DF2\u9009\u4E2D"></span><img class="l_album_pic" data-src="'+e[i].small_pic+'"/></a>';r+="</div>";var c=this.albumList[this.curAlbumId],o=((c-1)/a|0)+1;1!=o&&(r+='<div class="l_album_pic_pager">',1!=l&&(r+='<a href="#"  class="l_album_page j_prepage" >&lt;\u4E0A\u4E00\u9875</a>'),o>l&&(r+='<a href="#"  class="l_album_page j_nextpage" >\u4E0B\u4E00\u9875&gt;</a>'),r+="</div>")}return r},myAlbumLayer:function(){var e=this;if(!e.lDialogOp){var l=$("<div></div>"),a=$('<div class="l_album_container"></div>'),i='<div class="l_album_lwrapper"></div><div class="l_album_rwrapper"><div class="l_album_rwrapper_title">\u5F53\u524D\u9009\u4E2D</div><div class="l_album_selected_con"></div></div>';e.albumContainer=a,a.html(i),l.append(a).append(e.layerBottom("showtips"));var t=e.layerWidth,r={html:l,title:"\u6211\u7684\u76F8\u518C",width:t,height:e.layerHeight,closeable:!0};$.browser.msie&&$.browser.version<7&&l.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),e.editor.overlay.hide(),e.lDialogOp=new $.dialog(r),e.lDialogOp.bind("onclose",function(){e.editor.overlay.show(),delete e.lDialogOp}),e.lDialogOp.show()}},submit:function(){var e=this,l=[];for(var a in this.selectedPic)l.push({url:a,pic_id_encode:e.getEncode(a)});this.editor.insertImage(l),this.lDialogOp.close(),this.editor.overlay.show()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",requires:["common/widget/image_uploader_manager","common/widget/ScrollPanel","common/component/image_flash_editor"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{picItemPath:"http://imgsrc.baidu.com/forum/pic/item/",abpicPath:"http://imgsrc.baidu.com/forum/abpic/item/",layerHeight:460,layerWidth:680,initial:function(e,i){var t=this;t.editor=i,t.j_con=e,t.uploader=t.localUploader(e),t.addImageArray={},Function.prototype.BINDEVENT=function(e){var i=this;return function(){i.apply(e,arguments)}}},localUploader:function(e){var i=this,t=this.use("common/widget/image_uploader_manager",{container:e,width:e.width(),height:e.height(),queueLen:100,fid:PageData.forum.forum_id||PageData.forum.id,isAutoUp:!1});return t.bind("onFileSelected",function(e,a){for(var o=i.dealWithData(a.imageList),r=o.filterId,n=0,d=r.length;d>n;n++)t.deleteFile(r[n]);var l=i.getImageLimit(i.imageContainer),c=o.imageList.length,s=c-r.length;if(s>l){for(var p=l;c>p;p++)t.deleteFile(o.imageList[p].id);o.imageList=o.imageList.splice(0,l)}t.startUpload(),i.startRender(o.imageList,"upload")}),t.bind("onProgressListen",function(e,t){i.progressHandler(t)}),t.bind("onComplete",function(e,t){i.uploadComplete(t)}),t.bind("onError",function(){}),t},imageHandler:function(e,i){var t=e.id,a=i.filter('[data-id="'+t+'"]'),o=a.find("b"),r=e.response,n=e.percent,d=this;a.hasClass("complete")||(o.css({width:n+"%"}),100==n&&d.renderItem(r,a))},renderItem:function(e,i){var t=this,a=i.find("b");if(null!=e&&0==e.error_code){var o=e.info.pic_id_encode,r=e.info.fullpic_width,n=e.info.fullpic_height,d=e.info.pic_water,l=i.find("img")[0];l.src="/tb/static-common/editor_img/layer/i.gif";if(200>r||200>n)return t.errorBigHandler(i.find("img")),a.parent().hide(),!1;i.removeClass("uploading").addClass("complete"),i.tbattr("data-url",t.picItemPath+o+".jpg"),i.tbattr("href","#"),i.tbattr("data-water-url",d),i.tbattr("data-width",r),i.tbattr("data-height",n),i.tbattr("data-id-encode",o),(new Image).src=t.picItemPath+o+".jpg";var c=new Image;c.onload=function(){l.style.backgroundImage="url("+t.abpicPath+o+".jpg)",a.parent().hide()},c.src=t.abpicPath+o+".jpg",d&&((new Image).src=d)}else t.errorHandler(i.find("img")),a.parent().hide()},errorHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error")},errorBigHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error_big")},addImageArray:{},dealWithData:function(e){for(var i=[],t=[],a=this.addImageArray,o=0,r=e.length;r>o;o++){var n=e[o],d=n.id,l=n.name,c=n.size,s=l+c;a[s]==s?t.push(d):(i.push(n),a[s]=s)}return{imageList:i,filterId:t}},renderContinueUpload:function(){var e=this.getImageLimit(this.imageContainer),i="";0==e&&(i="i_upload_limit");var t='<a class="i_continue_add '+i+'"><div class="i_continue_upbtn"></div><span class="i_image_remain">\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+e+"</span>\u5F20</span></a>";return t},addDragger:function(){},startRender:function(e){var i=this,t=e;if(i.lDialogOp){if(t.length>0){var a=i.genericImageCon(t,"continue");i.continueUploader.before(a),$.browser.msie&&$.browser.version<8||(i.scrollPanel._resizeHeight(),i.scrollPanel.scrollTopTo(2e4),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")}),i.addDragger())}}else{var o=$('<div class="l_image_container clearfix"></div>');i.imageContainer=o,i.imageContainer.css({width:667});var r=$('<div class="l_image_upcontainer"></div>'),a=i.genericImageCon(t,"first");i.imageContainer.delegate(".close","click",function(){var e=$(this).parent(),t=e.tbattr("data-name"),a=e.tbattr("data-size"),o=e.tbattr("data-id"),r=e.tbattr("data-uptype");"first"==r?i.uploader.deleteFile(o):"continue"==r&&i.conUploader.deleteFile(o),delete i.addImageArray[t+a],e.remove(),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")})}),i._layerBottom=i.layerBottom("upload"),r.append(i.imageContainer).append(i._layerBottom);var n=i.layerWidth,d={html:r,holderClassName:"meizhi_uploader",title:"\u63D2\u5165\u56FE\u7247",width:n,height:i.layerHeight,show:!1,closeable:!0};if(i.editor.overlay.width(1),i.editor.overlay.height(1),i.lDialogOp=new $.dialog(d),i.lDialogOp.bind("onclose",function(){i.uploader&&i.uploader.stopUpload(),i.uploader&&i.uploader.clearList();try{i.conUploader&&i.conUploader.stopUpload(),i.conUploader&&i.conUploader.clearList()}catch(e){}i.destroyJquery(i.imageContainer),window.PicUploaderShow=!1,i.editor.overlay.width(700),i.editor.overlay.height(650),delete i.lDialogOp}),r.closest(".dialogJcontent").css("padding","0"),window.PicUploaderShow=!0,i.uploader.uploader.flash){var l=i.lDialogOp.element;i.lDialogOp.element=i.lDialogOp.element.add(i.uploader.uploader.flash.parentNode),i.lDialogOp.show(),i.lDialogOp.element=l}else i.lDialogOp.show();i.container=r,$.browser.msie&&$.browser.version<8?(i.imageContainer.html(a),i.imageContainer.append(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addContinueUploader()):$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){i.scrollPanel=i.use("common/widget/ScrollPanel",{container:i.imageContainer,height:388,content:a}),i.scrollPanel.appendContent(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addDragger(),i.addContinueUploader()}),i.initPictureEditor()}},initPictureEditor:function(){var e=this;e.$pictureEditorContainer=$("<div class='pic_editor_container' id='picture_editor_container'></div>"),e.container.append(e.$pictureEditorContainer),this.pictureEditor=this.use("common/component/image_flash_editor",{container:e.$pictureEditorContainer,width:678,height:461},{uploadURL:"http://upload.tieba.baidu.com/upload/pic?tbs=4f165305af36ccdc013751701760125500_1&fid="+PageData.forum.forum_id||PageData.forum.id}),this.imageContainer.delegate(".j_editor_button","click",function(){var i=$(this).closest(".i_item_con");e.showPictureEditor(i)}),this.pictureEditor.bind("upload_complete",function(i,t){e.hidePictureEditor(),e.renderItem(t,e.pictureEditor.$item)}),this.pictureEditor.bind("cancel",function(){e.hidePictureEditor()})},showPictureEditor:function(e){this.pictureEditorOpen=!0,this.lDialogOp.setTitle("\u56FE\u7247\u7F16\u8F91"),this.pictureEditor.$item=e,this.pictureEditor.loadRemoteImage(e.tbattr("data-url")),this.$pictureEditorContainer.animate({left:-1},500)},hidePictureEditor:function(){this.pictureEditorOpen=!1,this.lDialogOp.setTitle("\u63D2\u5165\u56FE\u7247"),this.$pictureEditorContainer.animate({left:684},500)},addContinueUploader:function(){var e=this;e.conUploader=e.localUploader(e.continueUploader.find(".i_continue_upbtn"))},uploadComplete:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},progressHandler:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},submit:function(){var e=this,i=e._layerBottom.find(".i_checkbox")[0],t=i.checked?"1":"0";$.cookie("WATER_CHECK",t,{expires:30}),e.closeUploadLayer();var a=e.getURLs(t,e.imageContainer,"obj");e.editor.insertImage(a),e.lDialogOp.close(),e.editor.overlay.width(700),e.editor.overlay.height(650),delete e.lDialogOp},closeUploadLayer:function(){this.j_con.closest(".j_content").addClass("hide")}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{id:"mz_camera_flash",layerHeight:460,layerWidth:680,initial:function(i){var e=this;e.editor=i},run:function(){this.cameraPicLayer()},cameraPicLayer:function(){var i=this;if(!i.lDialogOp){var e=$("<div></div>");i.cameraContainer=$('<div class="l_camerapic_container"></div>'),i._layerBottom=i.layerBottom("showtips"),e.append(i.cameraContainer).append(i._layerBottom);var t={html:e,title:"\u6444\u50CF\u5934\u62CD\u7167",width:i.layerWidth,height:i.layerHeight,closeable:!0};i.editor.overlay.hide(),i.lDialogOp=new $.dialog(t),i.scrollOff(),i.lDialogOp.bind("onclose",function(){i.scrollOn(),i.editor.overlay.show(),delete i.lDialogOp}),e.click(function(i){return i.stopPropagation&&i.stopPropagation(),!1}),$.browser.msie&&$.browser.version<7&&e.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),i.lDialogOp.show(),i._loadTBS()}},_showErrorTips:function(i){switch(this.errDom||(this.errDom=$(".i_error_tips")),i){case"compressed":this.errDom.text("\u56FE\u7247\u538B\u7F29\u6210\u529F");break;case"already":this.errDom.text("\u6444\u50CF\u5934\u51C6\u5907\u5B8C\u6BD5\uFF0C\u8BF7\u6309\u4E0B\u786E\u5B9A\u62CD\u7167");break;case"not_support":this.errDom.text("\u6444\u50CF\u5934\u672A\u88AB\u5B89\u88C5\u6216\u5F53\u524D\u7CFB\u7EDF\u4E0D\u652F\u6301");break;case"busy":this.errDom.text("\u6444\u50CF\u5934\u5F53\u524D\u6B63\u88AB\u5360\u7528");break;case"error":this.errDom.text("\u51FA\u73B0\u5185\u90E8\u9519\u8BEF")}},_loadTBS:function(){var i=this;uploadURL="http://upload.tieba.baidu.com/upload/pic",tbsURL="http://tieba.baidu.com/dc/common/imgtbs",img_tbs=$.ajax({url:tbsURL,dataType:"json"}),img_tbs.done(function(e){0===Number(e.no)?(uploadURL+="?tbs="+e.data.tbs,i._loadCameraFlash(uploadURL)):alert("tbs error")})},_loadCameraFlash:function(i){var e=this,t={id:e.id,container:".l_camerapic_container",width:660,height:414,params:{wmode:"window"},vars:{imageWidth:800,imageHeight:600,maxSize:3,maxWidth:3e3,maxHeight:3e3,uploadURL:i},callBacks:{completeInterface:function(i){var t=[];t.push({pic_id_encode:e.getEncode(i.info.pic_water),url:i.info.pic_water}),e.editor.insertImage(t),e.lDialogOp.close(),e.scrollOn(),e.editor.overlay.show()},compressInterface:function(){e._showErrorTips("compressed")},errorInterface:function(){e._showErrorTips("error")},cameraStatus:function(i){switch(i){case"ready":e._showErrorTips("already");break;case"not_support":e._showErrorTips("not_support");break;case"busy":e._showErrorTips("busy")}}}};new $.swf("/tb/static-common/editor_img/FlashCameraPrinter.swf?dt=0724",t),this.flash=document[this.id]||window[this.id]},submit:function(){this.flash.print(),this.flash.startUpload()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",requires:[],sub:{layerHeight:515,layerWidth:810,initial:function(){},genericImageCon:function(t,e){for(var a="",i=0,n=t.length;n>i;i++){var r=t[i].id;a+='<a href="" unselectable="on" onclick = "return false;" class="uploading i_item_con"  data-name="'+t[i].name+'" data-uptype="'+e+'" data-size="'+t[i].size+'" data-id="'+r+'" draggable="false"><img class="i_item_bg" src="/tb/static-common/editor_img/layer/unload.png"><span class="progress"><b></b></span><span class="close" title="\u5220\u9664\u6B64\u56FE"></span><span class="button_bar"><span class="j_editor_button edit_button">\u7F8E\u5316\u56FE\u7247</span></span><span class="error">\u4E0A\u4F20\u5931\u8D25</span><span class="error_big">\u56FE\u7247\u8FC7\u5C0F</span><span class ="error_big_more">\u8BF7\u4E0A\u4F20\u5927\u56FE</span></a>'}return a},destroyJquery:function(t){t.remove(),t=null},imageHandler:function(){},checkURL:function(t){if(t=t.trim(),t.length<=0)return!1;0!==t.search(/http:\/\/|https:\/\//)&&(t+="http://");var e=/(.gif|.jpg|.jpeg|.png)$/i;return!e.test(t)||t.getByteLength()>this.urlLength?!1:t},layerBottom:function(t){var e="",a=this,i="upload"==t?"\u63D2\u5165\u56FE\u7247":"\u786E \u5B9A",n=$('<div class="i_layer_bottom"></div>'),r=$('<a href="#" style="float:left;margin-right:10px;" class="ui_btn ui_btn_m"><span><em>'+i+"</em></span></a>"),s=$(' <a href="#" style="float:left" class="ui_btn ui_btn_sub_m"><span><em>\u53D6 \u6D88</em></span></a>'),l=$('<div class="i_layer_btn"></div>');return l.append(r).append(s),n.append(l),"upload"==t?(e='<div class="i_layer_water"><input class="i_checkbox" checked type="checkbox" /><span style="float:left;">\u6DFB\u52A0\u672C\u5427\u6C34\u5370(gif\u683C\u5F0F\u6216\u8FC7\u5C0F\u7684\u56FE\u7247\u65E0\u6CD5\u6DFB\u52A0)</span></div>',n.append(e)):"showtips"==t&&(e='<div class="i_error_tips"></div>',n.append(e)),n.width(this.layerWidth-2),$.browser.msie&&$.browser.version<7&&n.css({bottom:6}),r.click(function(){return a.submit(),!1}),s.click(function(e){try{a.lDialogOp.close()}catch(e){alert(e.message)}return"upload"==t&&a.closeUploadLayer(),!1}),n},getURLs:function(t,e,a){for(var i,n=[],r=e.find(".i_item_con"),s=0;s<r.length;s++)if(i=r.eq(s),"obj"==a){var l={};i.hasClass("complete")&&i.tbattr("data-url")&&(l.url="1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?i.tbattr("data-water-url"):i.tbattr("data-url"),l.width=i.tbattr("data-width")||0,l.height=i.tbattr("data-height")||0,l.pic_id_encode=i.tbattr("data-id-encode")||0,n.push(l))}else i.hasClass("complete")&&i.tbattr("data-url")&&("1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?n.push(i.tbattr("data-water-url")):n.push(i.tbattr("data-url")));return n},remainImage:function(t,e){var a=this,i=a.getImageLimit(e),n='\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+i+"</span>\u5F20\u56FE\u7247",r=$('<div class="i_image_tip"></div>');return"upload"==t?(n+=',<span class="i_image_continue">\u7EE7\u7EED\u6DFB\u52A0:</span><span style="color:#1D53BF">\u672C\u5730\u4E0A\u4F20</span><div class="i_uploader_con" ></div>',r.html(n),a.conUploader=a.localUploader(r.find(".i_uploader_con"))):r.html(n),a.jCon=r,a.jCon},resetImg:function(t,e,a){var i,n=t.width,r=t.height,s=0,l=0;n>e||r>a?(i=n>=r?e/n:e/r,l=(e-n*i)/2,s=(a-r*i)/2,$(t).css({height:r*i,width:n*i,top:s,left:l,visibility:"visible"})):(l=(e-n)/2,s=(a-r)/2,$(t).css({top:s,left:l,visibility:"visible"}))},updateRemianImage:function(t,e,a){var i=this,n=i.getImageLimit(t);t.find(".j_image_num").html(n),0==n?e&&e():a&&a()},getImageLimit:function(t){var e=this,a=e.getImageNum(t),i=e.editor.getImageNum()-a;return i=Math.max(0,i)},onStartDrag:function(t,e){var a=e.holder;a.style.left=a.offsetLeft+"px",a.style.top=a.offsetTop+"px",e.holder.style.position="absolute",a.parentNode.insertBefore(this.placeHolder,a),a.parentNode.appendChild(a),this.currentIndex=parseInt(a.offsetLeft/this.width),this.currentIndex=Math.min(this.currentIndex,this.index-1)},onDragging:function(t,e){var a=e.left,i=Math.min(parseInt(a/this.width),this.index-1);i!==this.currentIndex&&(this.swapNode(this.list[i],this.list[this.currentIndex]),this.currentIndex=i)},onStopDrag:function(t,e){e.holder.style.position="relative",e.holder.style.left="0",e.holder.style.top="0",this.swapNode(e.holder,this.placeHolder),this.placeHolder.parentNode.removeChild(this.placeHolder)},swapNode:function(t,e){var a=t.parentNode,i=e.parentNode,n=t.cloneNode(!1);a.replaceChild(n,t),i.replaceChild(t,e),a.replaceChild(e,n)},getImageNum:function(t){var e=0;return e=t&&t.find(".i_item_con").size()||e},getEncode:function(t){var e=t.split("/"),a=e[e.length-1];return a.slice(0,a.indexOf("."))},scrollOn:function(){document.body.parentNode.style.overflow="scroll"},scrollOff:function(){document.body.parentNode.style.overflow="hidden"}}});_.Module.define({path:"postor/widget/MeizhiPostor",requires:["common/widget/LoginDialog","common/widget/EditorPicMeizhi","common/widget/PostService"],sub:{containerHTML:["<div>",'<div id="mz_post_wrapper">','<div class="mz_post_achieve clearfix">','<div class="mz_post_achieve_inner">','<p class="mz_post_achieve_title">\u7ECF\u8FC7\u8BC4\u5BA1\u8BA4\u8BC1\u540E\u83B7\u5F97\uFF1A</p>','<ul class="mz_post_achieve_list">',"<li>",'<img src="http://tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230014.png" width="75" height="75" />',"<p>\u5B9E\u4E60\u59B9\u7EB8</p>","</li>","<li>",'<img src="http://tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230013.png" width="75" height="75" />',"<p>\u8BA4\u8BC1\u59B9\u7EB8</p>","</li>","</ul>","</div>","#{meizi_notice}","</div>",'<div id="#{meizhi_tip}" class="meizhi_tip">\u6E29\u99A8\u63D0\u793A\uFF1A\u7533\u8BF7\u524D\u8BF7\u8BA4\u771F\u9605\u8BFB<a href="/tb/zt/meizituan.html" target="_blank">\u59B9\u5B50\u56E2\u5B88\u5219\u53CA\u89C4\u7AE0\u5236\u5EA6</a>\u3002<a class="tip_close" onclick="return false;" href="#"></a></div>','<form id="#{meizhi_post}"  method="post"  autocomplete="off">','<table  width="100%" border="0" cellspacing="0" cellpadding="3">','<tr id="#{title_tr}"> <td class = "label_wrapper" valign="top"  nowrap style="line-height:32px;">\u6807\u9898:</td> <td colspan="3"> <div id = "#{title_div}" class="input_wrapper"><span class ="input_prefix">\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011</span> <input type="text" id="#{title}" class="title_input" name="title" value="" autocomplete="off"  /> </div> <div id="#{titleError}" class="postErrorTitle"></div> </td> </tr>','<tr style="line-height:32px;"> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u6E38\u620F:</td> <td><input id="#{nick_ipt}" class="ui_textfield item_input" type="text" /></td> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u8D34\u5427:</td> <td><input id="#{like_forum_ipt}" type="text" class="ui_textfield item_input" /></td> </tr>','<tr id="#{content_tr}"> <td class = "label_wrapper" valign="top"  nowrap >\u7533\u8BF7\u7559\u8A00:</td> <td colspan="3"> <textarea class="content_input"></textarea> <div id="#{contentError}" class="postErrorContent"></div> </td> </tr>','<tr id="pic_tr"> <td class = "label_wrapper" valign="top"  nowrap >\u7167\u7247:</td> <td colspan="3"> <div id="#{pic_wrapper}" class="pic_wrapper clearfix"> <div id="#{pic_editor}" class="pic_add"> <div class="pic_remain_back"> <div class="pic_remain">\u8FD8\u53EF\u6DFB\u52A0<span class="pic_remain_num">30</span>\u5F20</div></div></div></div><p class="pic_remain_tips">\u6CE8\uFF1A\u81F3\u5C11\u4E0A\u4F203\u5F20\u7167\u7247\u5594</p><p class="pic_remain_like_forum"><input id="meizi_ysjg_like" name="meizi_ysjg_like" type="checkbox" disabled checked /><label for="meizi_ysjg_like">\u5173\u6CE8\u82F1\u4E09\u5609\u54E5\u5427</label></p></td></tr>','<tr id="#{submit_tr}"><td>&nbsp;</td><td class="submit"> <input type="submit" id="#{submit}" alog-alias="richpostor" class="subbtn_bg" value=" \u53D1 \u8868 "/> <span class="pt_posting_status j_posting_status"></span><span id="#{postError}" class="post_error"></span> </td> </tr>',"</tbody> </table> </form></div>","</div>"].join(""),noticeHTML:['<div class="mz_post_notice">',"<h3>\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E13\u4EAB</h3>",'<div class="mz_post_notice_inner">','<p class="mz_rewards">\u60A8\u662FLV#{level}\u59B9\u7EB8\u8BA4\u8BC1</p>','<p class="mz_rewards">\u52A0\u5165\u7ACB\u5373\u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>',"</div>",'<p class="mz_rewards_tips">\u52A0\u5165\u5E76\u8BA4\u8BC1\u6210\u529F\u540E\u59B9\u7EB8\u56FE\u6807\u5C06\u88AB\u65B0\u56FE\u6807\u66FF\u6362</p>',"</div>"].join(""),successHTML:['<div class="mz_post_success">','<p class="success_title">\u52A0\u5165\u7533\u8BF7\u6210\u529F\uFF01</p>',"#{reward_tip}",'<p class="success_relocation">\u8BA4\u8BC1\u7ED3\u679C\u8BF7\u5B9E\u65F6\u5173\u6CE8\u8BBA\u575B\u516C\u544A</p>','<div style="text-align: center; margin-top: 40px">','<a href="#" class="ui_btn ui_btn_m j_mz_iknown">',"<span><em>\u77E5\u9053\u4E86</em></span>","</a>","</div>","</div>"].join(""),rewardTipHTML:['<p class="success_mz_rewards">\u60A8\u662F\u59B9\u7EB8LV#{level} \u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>'].join(""),config:{imageLimite:30},_likeForumUrl:"/f/like/commit/add",rewardMap:{2:{reward:"200",level:"1"},3:{reward:"2000",level:"2"},4:{reward:"1W",level:"3"}},initial:function(){this._data_postor={},this._option={forum:PageData.forum,tbs:PageData.tbs,user:PageData.user},this._event={};var t=this.containerHTML,i="",e=this._option.user.meizhi_level;e>1&&(i=$.tb.format(this.noticeHTML,{level:this.rewardMap[e].level,reward:this.rewardMap[e].reward})),this._generi_dom_id(),t=$.tb.format(t,$.extend(this._dom_id,{meizi_notice:i})),this.container=$(t);var s=this._option.user.is_login;this._statInit(s),this._initPostService()},_statInit:function(t){return t?void this._canPost():void this._cannotPost()},_cannotPost:function(){this.use("common/widget/LoginDialog","","userBar")},_canPost:function(){this._dialogInit(),this._initTitleAndContent(),this._editorInitPic(this.picWrapper),this._postBtnInit(),this._hasTip()},_dialogInit:function(){var t={html:this.container.html(),title:"\u7533\u8BF7\u52A0\u5165\u8D34\u5427\u59B9\u5B50\u56E2",width:700,height:650};this.overlay=new $.dialog(t),this.title=$("#"+this._dom_id.title_div).find(".title_input"),this.content=$("#"+this._dom_id.content_tr).find(".content_input"),this.nick=$("#"+this._dom_id.nick_ipt),this.likeForums=$("#"+this._dom_id.like_forum_ipt),this.picEditor=$("#"+this._dom_id.pic_editor),this.picWrapper=$("#"+this._dom_id.pic_wrapper),this.submit_tr=$("#"+this._dom_id.submit_tr),this._likeInit()},_pic_wrapper_toggle:function(){var t=this,i=$("#meizhi_img_layer"),e=this.picEditor.find(".pic_remain_back");e.bind("click",function(){0!=t.getImageNum()&&i.hasClass("hide")?(i.removeClass("hide"),$(document).one("click",function(){i.addClass("hide")})):i.addClass("hide")}),e.bind("click",function(t){t.stopPropagation()})},_initTitleAndContent:function(){var t="\u7231\u6E38\u620F\uFF0C\u7231\u8D34\u5427\u7684\u59B9\u5B50\u7533\u8BF7\u5165\u56E2",i="\u4F8B\u5982\uFF1A\u8D34\u5427\u7BA1\u7406\u3001\u70ED\u7231\u7206\u7167\u5206\u4EAB\u3001\u6587\u5B57\u7F16\u8F91\u3001PS\u56FE\u7247\u8BBE\u8BA1\u3001\u89C6\u9891\u76F4\u64AD\u3001\u5531\u6B4C\u3001\u8DF3\u821E\u3001\u624B\u7ED8\u6F2B\u753B\u7B49\u7279\u957F\u90FD\u53EF";_.Module.use("common/widget/Placeholder",[this.title,t,{left:95,"font-size":14}],function(){}),_.Module.use("common/widget/Placeholder",[this.content,i,{"font-size":14,"max-width":"545px"}],function(){})},_likeInit:function(){var t=this.sel=$("#"+this._dom_id.like_tr).find("select"),i=this._option.forum.name;t.append('<option value="'+i+'">'+i+"</option>"),t.tbattr("disabled","disabled")},_editorInitPic:function(t){return this.imageLayer?this.imageLayer.init(t,this):(this.imageLayer=this.use("common/widget/EditorPicMeizhi"),this.imageLayer.init(t,this)),this._pic_wrapper_toggle(),this._picBoxEvents(),!1},_postBtnInit:function(){var t=this,i=this._dom_id,e=$("#"+i.submit);e.tbattr("disabled",!1),e.className="subbtn_bg",t._postBtnEvent()},_postBtnEvent:function(){var t=this,i=this._dom_id,e=$("#"+i.submit),s=$("#"+i.meizhi_post);e.hasClass("bubbtn_bg_banned")||(e.mouseover(function(){$(this).tbattr("class","subbtn_bg_hover")}),e.mouseout(function(){$(this).tbattr("class","subbtn_bg")}),e.mousedown(function(){$(this).tbattr("class","subbtn_bg_active")})),s.submit(function(){return t._submit(),!1}),s.keydown(function(t){var i=t||window.event;(i.ctrlKey&&13==i.keyCode||i.altKey&&83==i.keyCode)&&(i.preventDefault?i.preventDefault():i.returnValue=!1)})},_generi_dom_id:function(){var t=(new Date).valueOf();this._dom_id={meizhi_tip:"mt"+t,meizhi_post:"mp"+t,title_tr:"tt"+t,title_div:"td"+t,titleError:"te"+t,content_tr:"ct"+t,contentError:"ce"+t,pic_wrapper:"pw"+t,pic_editor:"pe"+t,like_tr:"lt"+t,vcode_tr:"vt"+t,vcode_div:"vd"+t,submit_tr:"st"+t,submit:"sm"+t,postError:"pr"+t,nick_ipt:"ni"+t,like_forum_ipt:"lfi_"+t}},getImageNum:function(){return this.config.imageLimite-this.picWrapper.find(".pic_box").length},insertImage:function(t){for(var i=this,e=0,s=t.length;s>e;e++){var r=$('<div class = "pic_box" ><div class = "pic_box_close"><a href="#" onclick="return false"></a></div><img unselectable="on" style="display:none;" data-id = "'+t[e].pic_id_encode+'" class="tmp_image" src="'+t[e].url+'"/></div>');r.insertAfter(this.picEditor).find("img").one("load",function(){i.resizePicSize($(this)),i.cutPic($(this),100),$(this).show(),i._resizePos()})}},resizePicSize:function(t){var i=560,e=t.width(),s=t.height();if(e>560){var r=i/e;e=560,s*=r}t.tbattr({width:e,height:Math.floor(s)})},cutPic:function(t,i){var e=t.width(),s=t.height();if(e>s&&s>=i){e=e/s*i,s=i;var r=Math.round((e-s)/2),n=Math.round(e-s-r);t.css({width:e,height:s,marginLeft:-1*r,marginRight:-1*n})}else s>e&&e>=i&&(s=s/e*i,e=i,t.css({width:e,height:s}))},_resizePos:function(){var t=$("#"+this._dom_id.pic_wrapper+">div");t.each(function(t){this.className=$(this).hasClass("pic_add")?"pic_add":"pic_box",(t+1)%5==0&&$(this).addClass("right_end"),t>4&&$(this).addClass("bottom_end")}),this.picWrapper.find(".pic_remain_num").text(this.getImageNum())},_picBoxEvents:function(){var t=this;this.picWrapper.find(".pic_box").live("mouseenter",function(){$(this).find(".pic_box_close").show()}).live("mouseleave",function(){$(this).find(".pic_box_close").hide()}),this.picWrapper.find(".pic_box_close").live("click",function(){$(this).parent(".pic_box").remove(),t._resizePos()})},successDialog:function(t){var i=this,e="",s=this._option.user.meizhi_level;s>1&&t&&(e=$.tb.format(i.rewardTipHTML,{level:i.rewardMap[s].level,reward:i.rewardMap[s].reward}));var r=$.tb.format(i.successHTML,{reward_tip:e}),n={html:r,width:700,height:280,title:"\u53D1\u8D77\u59B9\u5B50\u56E2\u7533\u8BF7\u8D34"};this.overlay&&this.overlay.close(),this.overlay=new $.dialog(n),this.overlay.element.find(".j_mz_iknown").on("click",function(){$.tb.location.reload(),i.overlay.close()})},_hasTip:function(){var t="1"==$.cookie("meizhiTipIsClosed"),i=$("#"+this._dom_id.meizhi_tip),e=i.find(".tip_close");t&&i.hide(),e.click(function(t){$.cookie("meizhiTipIsClosed","1",{empires:365,path:"/"}),i.hide(),t.stopPropagation()})},bind:function(t,i,e){var s={stat:e?!0:!1,fun:i};this._event[t]?this._event[t].push(s):(this._event[t]=[],this._event[t].push(s))},triggerEvent:function(t){var i=Array.prototype.slice.call(arguments,0);if(i.shift(),this._event[t])for(var e=this._event[t],s=0;s<e.length;s++)if(e[s].fun&&e[s].fun.apply(this,i),!e[s].stat)return!1;return!0},setPostorData:function(t,i){var e=this._data_postor;e[t]=i},getPostorData:function(t){var i=this._data_postor;return i[t]},removePostorData:function(t){var i=this._data_postor;delete i[t]},setPostingStatus:function(t){var i=this.submit_tr.find(".j_posting_status");t?i.addClass("pt_posting_loading"):i.removeClass("pt_posting_loading")},_getData:function(){var t=this._data_postor,i=(this._dom_id,this._option,this.picWrapper.find(".tmp_image")),e="";i.each(function(){var t=$(this),i=t.tbattr("data-id");v_url=t.tbattr("src"),i&&(e+="[img pic_type=2 width="+t.tbattr("width")+" height="+t.tbattr("height")+"]"+v_url+"[/img][br]")}),t.title="\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011"+this.title.val();var s="";return s+="\u6700\u559C\u7231\u7684\u6E38\u620F\uFF1A"+this.nick.val()+"[br]",s+="\u6700\u559C\u7231\u7684\u8D34\u5427\uFF1A"+this.likeForums.val()+"[br]",s+="\u4E2A\u4EBA\u7279\u957F\u53CA\u7533\u8BF7\u7559\u8A00\uFF1A"+this.content.val()+"[br]",s+=e,t.content=s,t},_validator:function(){return this._validFrsPostTitle()&&this._validLikeForumsContent()&&this._validNicksContent()&&this._validRichEditorContent()&&this._validPicEditor()?!0:!1},_validFrsPostTitle:function(){var t=this.title,i=t.val().trim();if(""==i)return this._errorTipShow("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),t.focus(),!1;var e=i.getByteLength(),s=60;if(e>s){var r="\u62B1\u6B49\uFF0C\u60A8\u7684\u6807\u9898\u8D85\u8FC7"+s/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u540E\u518D\u63D0\u4EA4";return this._errorTipShow(r),t.focus(),!1}return!0},_validRichEditorContent:function(){var t=(this._dom_id,this.content),i=this.content.val(),e=this;if(""==i.trim()||""==i.replace(/<[^>]*>|(&nbsp;)|[\s\u3000]*/g,""))return this._errorTipShow("\u53D1\u8D34\u5185\u5BB9\u9700\u5305\u542B\u6587\u5B57"),t.focus(),!1;var s=i.getByteLength(),r=1e4;if(s>r){var n="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+r/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4";return e._errorTipShow(n),!1}return!0},_validPicEditor:function(){var t=this.picWrapper.find(".pic_box").length;return 3>t?(this._errorTipShow("\u8BF7\u9009\u62E9\u81F3\u5C11\u4E09\u5F20\u7167\u7247"),!1):!0},_validLikeForumsContent:function(){var t=this.likeForums;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u8D34\u5427"),!1):!0},_validNicksContent:function(){var t=this.nick;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u6E38\u620F"),!1):!0},_errorTipShow:function(t){var i=(this._dom_id,$("#"+this._dom_id.postError));i.css("display",""),i.get(0).innerHTML=t},_errorTipHide:function(){var t=$("#"+this._dom_id.postError);t.css("display","none")},_submit:function(){var t=this;if(this._validator()&&!this.postService.isPosting()){this.setPostingStatus(!0);var i=$("#"+this._dom_id.submit);i.tbattr("disabled",!0),i.removeClass("subbtn_bg").addClass("subbtn_bg_banned"),this.postService.post("thread",t._getData(),PosterContext.getContext())}},_likeForum:function(){var t=PageData.tbs,i=PageData.forum.forum_id,e=PageData.forum.forum_name;$.tb.post(this._likeForumUrl,{fid:i,fname:e,tbs:t})},_initPostService:function(){var t=this;this.postService=this.use("common/widget/PostService"),this.postService.success(function(){var i=t._option.user.meizhi_level;i>1?$.tb.post("/encourage/post/meizhi/addtdou",{tbs:PageData.tbs},function(i){0==i.no?t.successDialog(!0):t.successDialog()}):t.successDialog(),t._likeForum()}).complete(function(){var i=$("#"+t._dom_id.submit);i.tbattr("disabled",!1),i.removeClass("subbtn_bg_banned").addClass("subbtn_bg"),t.setPostingStatus(!1)})}}});_.Module.define({path:"frs/widget/frs_stamp_notice",sub:{initial:function(){try{var t=PageData.forum.id,a=$.cookie("fudai_"+t),e=$.cookie("bless_post_"+t),s=PageData.userfortune;s&&1==s.has_fortune_bag&&!a&&1==e&&PageData.userfortune.data_fortune_bag.first_post&&this.showPrintDialog()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:12}),i}},showPrintDialog:function(){$.stats.track("stamp_flower_postor","fudai","frs/pb","click");var t=this,a=PageData.forum.id;$.cookie("bless_post_"+a,2,1);var e='<div class="content_1">\u606D\u559C\u4F60\u8FBE\u6210<span class="notice_color">\u672C\u5427\u4ECA\u65E5\u9996\u6B21\u53D1\u8D34\u4EFB\u52A1</span>\uFF0C\u83B7\u5F97<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><span class="notice_color">+'+PageData.userfortune.data_fortune_bag.first_post+"</span>\u5956\u52B1</div>",s='<p class="notice_app">\u540C\u65F6\u5982\u679C\u901A\u8FC7\u5BA2\u6237\u7AEF\u56DE\u8D34\uFF0C\u53EF\u4EE5\u989D\u5916\u83B7\u5F97\u5956\u52B1\u54E6\uFF01</p>',i='<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><a class="j_print_flower print_flower" href="http://tieba.baidu.com/p/2916765309" target="_blank">\u5370\u82B1\u662F\u4EC0\u4E48\uFF1F</a>',o='<div class="print_button"><a href="#" class="ui_btn ui_btn_m j_print_ok"><span><em>\u597D \u7684</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_tips j_print_no"><span><em>\u4E0D\u518D\u63D0\u793A</em></span></a></div>',n='<div class="frs_stamp_notice">'+e+s+i+o+"</div>",r=$.dialog.open(n,{width:428,noTitle:!0,modal:!1});$(".j_print_ok").click(function(t){try{t.preventDefault(),r.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:28}),t}}),$(".j_print_no").click(function(t){try{t.preventDefault(),r.close(),$.cookie("fudai_"+a,!0,365)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:33}),t}}),$(".j_print_flower").click(function(){try{t.trackFlower()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:36}),a}})},trackFlower:function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")}}});_.Module.define({path:"common/component/PostorService",requires:[],sub:{_dataPostor:{ie:"utf-8",kw:"",fid:"",tid:"",vcode_md5:"",floor_num:"",quote_id:"",rich_text:1,tbs:"",content:"\u5185\u5BB9"},_isPosting:!1,_postorUrl:{thread:"/f/commit/thread/add",reply:"/f/commit/post/add"},initial:function(){},isCanPost:function(t){var e={login:!1,canPost:0,noUn:!1,isBlock:!1,forbidFlag:0},a=$.extend(!0,e,t);if(!a.login)return{canPost:!1,type:"login"};if(a.login&&1==a.canPost&&a.noUn)return{canPost:!1,type:"noUn"};if(a.login&&1!=a.canPost){var i=parseInt(a.forbidFlag),o="";switch(i){case 1:o="login";break;case 2:o="old";break;case 3:o="balv";break;case 4:o="bawu";break;case 5:o="law"}return""!=o||a.isBlock||(o="isBlock"),{canPos:!1,type:o}}return a.login&&1==a.canPost&&!a.noUn?{canPost:!0}:void 0},genericRich:function(t){switch(t.type){case"smiley":var e=t.height,a=t.width;return'<img pic_type="" class="BDE_Smiley" src="'+t.src+'" height="'+e+'" width="'+a+'">';case"configSmile":var e=t.height,a=t.width;return'<img pic_type="" class="BDE_Smiley2" src="'+t.src+'" height="'+e+'" width="'+a+'" text="'+t.text+'">'}},postHandler:function(t){var e=this;if(!this._isPosting){this._isPosting=!0;var a=t.url;t.url||(a=this._postorUrl[t.type]),t.data.new_vcode=1,t.data.tag=11,this.post(a,t.data,function(a){e.showAddResult(a,t.success,t.error,t.context,t)})}},captchaHandler:function(t,e){var a=this;_.Module.use("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,forumName:e.data.kw,forumId:e.data.fid,isAnonymous:e.data.anonymous,postType:e.type,paramsCallback:function(){var t=e.data,a={content:t.content,title:t.title};return"reply"==e.type&&(a.tid=PageData.thread.id),a}},function(t){a.captchaDialog=t,t.bind("onclose",function(){return t.hide(),e.captchaCloseCallback&&e.captchaCloseCallback(),!1}),t.bind("onaccept",function(){var i=e.data;i.vcode=t.getInputValue(),i.vcode_md5=t.getVCode(),a.postHandler(e)}),t.show()})},_showErrorTip:function(t,e){var a='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>",i=$.dialog.alert(a,t.dialogSet);i.bind("onclose",e)},showAddResult:function(t,e,a,i,o){Thread_add_result.init(t);var s=Thread_add_result.resultNo,n=this;if(0==s)e(t.data,i),n._isPosting=!1;else{var r=Thread_add_result.getMessage();if(Thread_add_result.isNeedWaitForCheck()){var d={image:'<img style="border:none;" src="http://tb2.bdstatic.com/tb/img/messageFace.gif">',subMessage:"\u7B49\u5F85\u5BA1\u6838...",message:r,dialogSet:{width:380,height:105,title:"\u53D1\u8868\u8D34\u5B50"}};return n._showErrorTip(d,function(){return n.trigger("onCheckError"),!0}),n._isPosting=!1,void 0}if(Thread_add_result.isNeedBindPhone())return;if(40==s)n.captchaHandler(t,o),n._isPosting=!1;else{var d={image:'<img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:r,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};n._showErrorTip(d,function(){return n.trigger("onError",[r,s]),!0}),n._isPosting=!1}}},post:function(t,e,a){$.ajax({type:"post",async:!0,dataType:"json",url:t,data:e,success:function(t){a&&a(t)}})}}});_.Module.define({path:"common/component/image_water/water_flash",requires:[],sub:{initial:function(e){this.options=e,this.imageUrl=e.imageUrl,this.uploadUrl=e.uploadUrl,this.text=e.text||{},this.font=e.font||{},this.EVENTS=["onProgressListen","onComplete","onError"],this.token=+new Date},start:function(){this.initFlashvars(),this.generateCallBack(),this.initUI()},initFlashvars:function(){{var e=this.text,a=this.font;this.imageUrl}this.flashVars=["imageUrl="+encodeURIComponent(this.imageUrl),"uploadURL="+encodeURIComponent(this.uploadUrl),"content="+encodeURIComponent(e.content),"x="+encodeURIComponent(e.x),"y="+encodeURIComponent(e.y),"width="+encodeURIComponent(e.width),"lineHeight="+encodeURIComponent(a.lineHeight||""),"color="+encodeURIComponent(a.color||""),"family="+encodeURIComponent(a.family||""),"size="+encodeURIComponent(a.size||"")].join("&")},initUI:function(){var e=this.flashChecker(),a="flashImageWater"+this.token,t=$("<div>").appendTo(document.body).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:1,bottom:1});e.hasFlash||this.flashError();var n='<object id="'+a+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.options.flashUrl+'" /></object>',o='<object id="'+a+'" type="application/x-shockwave-flash" data="'+this.options.flashUrl+'" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /></object>';-1!=navigator.appName.indexOf("Microsoft")?t.html(n):t.html(o),this.imageWater=document[a]||window[a]},generateCallBack:function(){for(var e=this.token,a=this,t=0;t<this.EVENTS.length;t++){var n=this.EVENTS[t],o=n+e;window[o]=function(e){return function(t){a.trigger(e,t)}}(n),this.flashVars+="&"+this.decodeCamel(n)+"="+o}},decodeCamel:function(e){return e.replace(/([A-Z])/g,function(e,a){return"_"+a.toLowerCase()})},flashChecker:function(){var e,a=!1,t=0;if(t){var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");n&&(a=!0,e=n.GetVariable("$version"))}else if(navigator.plugins&&navigator.plugins.length>0){var n=navigator.plugins["Shockwave Flash"];n&&(a=!0,e=n.description)}e.split(",");return{hasFlash:a,version:e.match(/\d+/g)}},flashError:function(){$.dialog.alert('\u68C0\u6D4B\u5230\u60A8\u7684\u6D4F\u89C8\u5668\u6CA1\u6709\u5B89\u88C5\u6700\u65B0Adobe Flash Player\u63D2\u4EF6\uFF0C\u8FD9\u4F1A\u5F71\u54CD\u60A8\u8BBF\u95EE\u672C\u9875\u9762\u7684\u90E8\u5206\u529F\u80FD\u3002<br /><center>\u8BF7<a href="http://get.adobe.com/cn/flashplayer/" target="_blank">\u70B9\u6B64</a>\u5B89\u88C5</center>')},merge:function(){this.start()}}});
;_.Module.define({path:"common/component/image_water/water_html5",requires:["common/component/image_uploader"],sub:{initial:function(e){this.options=e,this.imageUrl=e.imageUrl,this._percent=0,this._errorCode=null,this._errorMessage=null,this._response=null,this.text=e.text||{},this.font=e.font||{},this.EVENTS=["onProgressListen","onComplete","onError"]},merge:function(){this._start()},_start:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d");var e=this.canvas,t=this.context,r=new Image,i=this.imageUrl,n=this;r.onload=function(){e.width=r.width,e.height=r.height,t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height),n._drawText()},r.onerror=function(){n._errorCode=1,n._errorMessage="\u56FE\u7247\u52A0\u8F7D\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u56FE\u7247\u662F\u5426\u5B58\u5728",n._percent=100,n.trigger("onError",n._getData())},r.src=i},_drawText:function(){var e=this.text,t=this.font,r=this.context,i=e.content,n=t.size||12,o=t.family||"",s=e.width,a=t.lineHeight||15,h=(a+t.size)/2,c=e.x,g=e.y,l="",_="";r.fillStyle=t.color||"",r.font=n+"px/"+a+"px "+o;for(var f=0;f<i.length;f++){var m=i[f];_+=m,r.measureText(_).width>s&&(r.fillText(l,c,g+h),g+=a,_=m),l=_}for(var u=r.measureText(_).width,p=r.measureText(" ").width,d=s-u,x=parseInt(d/2/p);x-->0;)_=" "+_;r.fillText(_,c,g+h),this._submit()},_submit:function(){var e=this,t=this.use("common/component/image_uploader",this.options.uploadUrl);t.bind("success",function(t,r,i){e._percent=100,e._response=i,e.trigger("onComplete",e._getData())}),t.bind("progress",function(t,r,i){e._percent=parseInt(r/i*90),e.trigger("onProgressListen",e._getData())}),t.bind("error",function(){e._errorCode=300,e._errorMessage="\u4E0A\u4F20\u5931\u8D25",e._percent=100,e.trigger("onError",e._getData())}),t.upload(this.canvas,5242880,"image/png")},_getData:function(){return{percent:this._percent,errorCode:this._errorCode,errorMessage:this._errorMessage,response:this._response}}}});
;_.Module.define({path:"common/component/image_water",requires:["common/component/image_water/water_flash","common/component/image_water/water_html5"],sub:{initial:function(t){this.options=$.extend({},t),this.EVENTS=["onProgressListen","onComplete","onError"],this._initUploadUrl(),this._initFlash()},merge:function(t){if(!t)throw new Error("merge\u65B9\u6CD5\u5FC5\u987B\u6709\u53C2\u6570");t.text.content=$.tb.subByte(t.text.content,40,""),$.extend(this.options,t),this._start()},_initUploadUrl:function(t){var a=this;if(this.options.uploadUrl)return t&&t.apply(a),void 0;var e=$.ajax({url:"http://tieba.baidu.com/dc/common/imgtbs",dataType:"json"});e.done(function(e){0===Number(e.no)?(a.options.uploadUrl="http://upload.tieba.baidu.com/upload/pic?tbs="+e.data.tbs,t&&t.apply(a)):t&&a._error()}).fail(function(){t&&a._error()})},_start:function(){this._initUploadUrl(this._startImageWater)},_startImageWater:function(){navigator.userAgent.toLowerCase().match(/chrome\/([\d]+)/);this._html5Visible()?this.imageWater=this.use("common/component/image_water/water_html5",this.options):(this.options.flashUrl=this.flashUrl,this.imageWater=this.use("common/component/image_water/water_flash",this.options)),this._generateCallBack(),this.imageWater.merge()},_generateCallBack:function(){for(var t=this,a=0;a<this.EVENTS.length;a++){var e=this.EVENTS[a];this.imageWater.bind(e,function(a){return function(e,i){t.trigger(a,i||e)}}(e))}},_initFlash:function(){if(!this._html5Visible()){var t=$("<div>").appendTo(document.body).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:1,bottom:1});this.flashUrl="http://tb2.bdstatic.com/tb/static-common/img/imagewater/imagewater_dc0b981.swf?v=1.0.6";var a="flashImageWater"+ +new Date,e='<object id="'+a+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.flashUrl+'" /></object>',i='<object id="'+a+'" type="application/x-shockwave-flash" data="'+this.flashUrl+'" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /></object>';-1!=navigator.appName.indexOf("Microsoft")?t.html(e):t.html(i)}},_html5Visible:function(){var t=navigator.userAgent.toLowerCase();return t=t.match(/chrome\/([\d]+)/),(t&&parseInt(t[1])>=21||$.browser.mozilla)&&!this.options.isFlash?!0:!1},_error:function(t){t=$.extend({percent:0,errorCode:400,errorMessage:"\u5408\u6210\u9519\u8BEF",response:null},t||{}),this.trigger("onError",t)}}});_.Module.define({path:"common/component/InterestSmiley",requires:["common/component/PostorService","common/component/image_water","common/component/ScrollPanel"],sub:{path:"http://tb2.bdstatic.com/tb/editor/images/",_imgWaterPath:"http://tb2.bdstatic.com/tb/editor/images/",smileTip:{qw_x:["\u6CA1\u56FEBS","\u4E0D\u660E\u89C9\u5389","\u778E\u4E86\u72D7\u773C","\u5751\u7239","\u4E0D\u4F1A\u7231","\u8EBA\u67AA","\u767D\u5BCC\u7F8E","\u4E0D\u670D\u6765\u8FA9","\u5BF9\u4E0D\u8D77"],qw_cat:["catsoul\u5D29\u6E83\u5730\u8BF4\uFF1A\u76F4\u5230\u6211\u819D\u76D6\u4E2D\u4E86\u4E00\u7BAD","catsoul\u53D1\u75AF\u8BF4\uFF1A\u6211\u64E6","catsoul\u574F\u7B11\u5730\u8BF4\uFF1A\u4F60\u61C2\u7684","catsoul\u5978\u7B11\u8BF4\uFF1A\u8FD9\u771F\u662F\u6781\u597D\u7684","catsoul\u7CBE\u795E\u5730\u8BF4\uFF1A\u7ED9\u529B\uFF01","catsoul\u7EA0\u7ED3\u5730\u8BF4\uFF1A\u4F60\u59B9","catsoul\u54ED\u8BF4\uFF1A\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","catsoul\u8C03\u76AE\u8BF4\uFF1A\u697C\u4E0B\u600E\u4E48\u770B\uFF1F","catsoul\u6DEB\u7B11\u8BF4\uFF1A\u5475\u5475"]},smileTextTip:{qw_x:["\u6CA1\u56FE\u4F60\u8BF4\u4E2Axx","\u4E0D\u660E\u89C9\u5389","\u778E\u4E86\u72D7\u773C","\u5751\u7239","\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","\u8EBA\u7740\u4E5F\u4E2D\u67AA","\u767D\u5BCC\u7F8E","\u4E0D\u670D\u6765\u8FA9","\u5BF9\u4E0D\u8D77"],qw_cat:["\u76F4\u5230\u6211\u819D\u76D6\u4E2D\u4E86\u4E00\u7BAD","\u6211\u64E6","\u4F60\u61C2\u7684","\u8FD9\u771F\u662F\u6781\u597D\u7684","\u7ED9\u529B\uFF01","\u4F60\u59B9","\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","\u697C\u4E0B\u600E\u4E48\u770B\uFF1F","\u5475\u5475"]},smileNum:{qw_x:9,qw_cat:9},smilePrev:{qw_x:"qw_x_00",qw_cat:"qw_cat_00"},smileSmallPath:{qw_x:"qw_x",qw_cat:"qw_cat_small"},smileQueen:["qw_cat","qw_x"],smileBrowse:{qw_x:"qw_x_browse",qw_cat:"qw_cat_browse"},smileTemplate:{qw_x:"qw_x_template",qw_cat:"qw_cat_template"},_dialogShow:!1,_layerShow:!1,isValueChange:!0,_isPosting:!1,_width:200,_height:200,version:"?20130427",initial:function(e){var t={type:"editor",smileClass:"t_smile_bg",scrollBar:"",scrollCss:{padding:"0px"},scrollBarHide:function(){},scrollBarShow:function(){},container:"",dataPostor:{}},i=this;this.option=$.extend(!0,t,e),this.manager(),this.postorService=this.use("common/component/PostorService"),this.wrapper=$(".wrap2"),this.bindPostor(),this._imageW=this.use("common/component/image_water"),this._imageW.bind("onComplete",function(e,t){var s=t.response,o=s.info.pic_id_encode,a=(s.info.fullpic_width,s.info.fullpic_height,s.info.pic_water,"http://imgsrc.baidu.com/forum/pic/item/"+o+".jpg");i.postorHandler(a,i._textValue,"configSmile",i._width,i._height),i._progessBar(100,140),i._isPosting=!1}),this._imageW.bind("onError",function(e,t){i._isPosting=!1;var s={image:'<img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:t.errorMessage,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};i._showErrorTip(s,function(){return!0})}),this._imageW.bind("onProgressListen",function(e,t){i.loading.show(),i.dBtn.hide(),setTimeout(function(){i._progessBar(t.percent,140)},200)})},_progessBar:function(e,t){var i=e*t/100,s=this;s.loading.find(".s_progress_bar").width(i)},bindPostor:function(){var e=this;this.postorService.bind("onCheckEroor",function(){e.trigger("onsuccess"),e.destroyLayer()}),this.postorService.bind("onError",function(){e.trigger("onsuccess"),e.destroyLayer(),e.dBtn.show(),e.loading.hide()})},manager:function(){window.InterestSmileyManager?window.InterestSmileyManager.push(this):(window.InterestSmileyManager=[],window.InterestSmileyManager.push(this))},generic:function(){this.render("qw_cat"),this.eventInit()},render:function(e){var t=this.option,i=this,s=t.container,o=i._gSmile(e);i.scrollPanel=i.use("common/component/ScrollPanel",{container:s,padding:i.option.scrollCss.padding,height:193,scrollBarHide:i.option.scrollBarHide,scrollBarShow:i.option.scrollBarShow,content:o})},_gSmile:function(e){var t=this.option,i=this,s="";if("all"==e)for(var o=i.smileQueen,a=0,n=o.length;n>a;a++)for(var r=o[a],l=i.smileNum[r],d=i.smilePrev[r],h=t.smileClass,c=1;l>=c;c++){var g=i.path+"qw_review/"+i.smileyName(d,c,"png");s+='<div class="s_image '+h+'" data-type="'+r+'" title="'+i.smileTip[r][c-1]+'"    data-num="'+c+'"><img src="'+g+'" /></div>'}else for(var r=e,l=i.smileNum[r],d=i.smilePrev[r],h=t.smileClass,c=1;l>=c;c++){var g=i.path+"qw_review/"+i.smileyName(d,c,"png");s+='<div class="s_image '+h+'" data-type="'+r+'" title="'+i.smileTip[r][c-1]+'"     data-num="'+c+'"><img src="'+g+'" /></div>'}return s},smileyName:function(e,t,i){var s="";return s=e,10>t&&(s+="0"),s=s+t+"."+i},shake:function(e,t,i,s){function o(){a>=0?(n.css({padding:0}),a%2==0?n.css({paddingLeft:r.easeInOut(0,s,a,i)}):n.css({paddingRight:r.easeInOut(0,s,a,i)}),a--,r.Timer=setTimeout(o,t)):clearTimeout(r.Timer)}var a=e,n=this.wrapper;this.Timer=setTimeout(o,t);var r=this},easeInOut:function(e,t,i,s){var o=i/s*2;return(1>o?Math.pow(o,3):(o-=2)*Math.pow(o,2)+2)*t/2+e},destroyLayer:function(){var e=this;e.layer&&1==e._layerShow&&(clearTimeout(e.Timer),$(".wrap2").css("padding",0),e.layer.stop(),e.layer.hide(),e._layerShow=!1),e.dialog&&e._dialogShow&&(e.dialog.hide(),e._dialogShow=!1),e.imageText&&(e.imageText.hide(),e.imageText.html(""))},eventInit:function(){var e=this.option,t=this.option.container,i=this;t.delegate(".s_image","click",function(){var t=$(this),s=t.data("type"),o=t.data("num"),a=i.smilePrev[s],n=i.path+i.smileBrowse[s]+"/"+i.smileyName(a,o,"gif");i.trigger("click");for(var r=($(document).height(),$(window)),l=r.height()/2-300,d=r.width()/2-500,h="fixed",c=d+270,g=window.InterestSmileyManager,m=0,p=g.length;p>m;m++)g[m].destroyLayer();$.browser.msie&&$.browser.version<7&&(l=$(window).scrollTop(),h="absolute"),i.imageText&&i.imageText.hide();var u=$.getzIndex();i.layer?(i.layer.tbattr("src",n+i.version),i.layer.css({width:1e3,height:1e3,top:l,zIndex:u,left:d,position:h,opacity:.1}),i.layer.tbattr("data-type",s),i.layer.tbattr("data-num",o),i.layer.tbattr("data-isTemplate","no"),i.layer.show(),i._layerShow=!0):(i.layer=$('<img src="'+n+i.version+'" data-type="'+s+'" data-isTemplate="no" data-num="'+o+'" style="width:1000px;height:1000px;top:'+l+"px;z-index:"+u+";opacity:0.1;left:"+d+"px;position:"+h+';" >'),$("body").append(i.layer),i._layerShow=!0),i.layer.animate({width:400,height:400,opacity:1,left:c},500,function(){$.browser.msie&&$.browser.version<7||($.browser.msie?i.shake(20,30,12,3):"sougou"==$.getBrowser().name?i.shake(20,25,16,4):i.shake(20,25,12,3)),i.renderDialog(l,c)}),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value="+e.type)})},_fTip:{isBlock:"\u60A8\u5DF2\u7ECF\u88AB\u5C01\u7981\uFF0C\u4E0D\u80FD\u53D1\u8D34",balv:' <a href="http://tieba.baidu.com/f/like/level?kw=d8" >4\u7EA7\u5934\u8854</a><br />\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34\u3002',old:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34",bawu:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34",law:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34",balv_undefined:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u5E16"},cannotPost:function(e){var t=this;switch(t.trigger("onsuccess"),t.destroyLayer(),e){case"login":return _.Module.use("common/widget/LoginDialog",["","editor"]),void 0;case"noUn":return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D"," "),void 0}var i="\u60A8\u4E0D\u80FD\u8FDB\u884C\u53D1\u8D34\u64CD\u4F5C";""!=e&&(i=this._fTip[e]);var s={image:'<img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:i,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};t._showErrorTip(s,function(){return!0})},_showErrorTip:function(e,t){var i='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+e.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+e.subMessage+"</td></tr></tbody></table>"+e.message+"</div>",s=$.dialog.alert(i,e.dialogSet);s.bind("onclose",t)},postorHandler:function(e,t,i,s,o){var a=this.postorService,n=this,r=(this.option.dataPostor,n._getData(e,i,t,s,o));a.postHandler({data:r,type:"reply",success:n.successCallback,context:n,error:n.errorCallback,captchaCloseCallback:function(){n.destroyLayer()}})},_getData:function(e,t,i,s,o){var a=this.option.dataPostor,n=this.postorService,r=$.extend(!0,{},a.data);r.content=UE.utils.html2ubb(n.genericRich({type:t,src:e,width:s,height:o,text:$.tb.escapeHTML(i)})),r.anonymous=0;var l=document.getElementById("sign_id"),d=document.getElementById("useSignName");return d&&d.checked&&l&&(r.sign_id=l.value),r},successCallback:function(e,t){t.trigger("onsuccess"),t.destroyLayer(),t.showSuccessTip()},errorCallback:function(){},showSuccessTip:function(){var e=($(document).height(),$(window)),t=e.scrollTop()+e.height()/2-50,i=e.width()/2-100,s=$.getzIndex(),o=$('<div style="position:absolute;z-index:'+s+'"><div class="editor_banned_tip_info"><span class="postor_success"></span><span style="">\u53D1\u8868\u6210\u529F!</span></div><div>');o.css({top:t,left:i}),o.appendTo($("body")),setTimeout(function(){o.fadeOut(300,function(){o.remove()})},1500)},addBubble:function(e){var t=this;if(!t.bubble){var i={content:"\u529F\u80FD\u5373\u5C06\u4E0A\u7EBF\uFF0C<br>\u656C\u8BF7\u671F\u5F85~",arrow_dir:"down",bubble_css:{top:0,left:50,width:100},arrow_pos:{left:45},attr:"  ",wrap:e,closeBtn:!1,level:1,arrowReq:!0},s=new UiBubbleTipBase(i);s.j_bubble.find(".j_content").css({backgroundColor:"white",border:"1px solid #848482",textAlign:"center"}),s.j_bubble.find(".ui_triangle_outter").css({color:"#848482"}),s.j_bubble.find(".ui_triangle_inner").css({color:"white"}),t.bubble=s}},_submit:function(){var e=this.postorService,t=this;if(!t._isPosting){t._isPosting=!0;var i=this.option.dataPostor,s=e.isCanPost(i.canPostor);if(s.canPost){var o=t.layer,a=o.tbattr("data-type"),n=o.tbattr("data-num"),r=t.textInput.val().trim();t._textValue=r;var l=t.smilePrev[a],d=t._imgWaterPath+t.smileTemplate[a]+"/"+t.smileyName(l,n,"gif");if(""==r||r==t.smileTextTip[a][n-1]){var h=t.path+t.smileSmallPath[a]+"/"+t.smileyName(l,n,"gif");t.postorHandler(h,r,"smiley",t._width,t._height),t._isPosting=!1}else t._imageWater(d,r,t.textStyle[a][n-1]),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value=zidingyi")}else{var a=s.type;t.cannotPost(a),t._isPosting=!1}}},_imageWater:function(e,t,i){var s=this,o=s.filterStyle(t,i),a={imageUrl:e+s.version,text:{content:t,x:i.x,y:i.y,width:i.width},font:{size:o.size,lineHeight:o.lineHeight,color:i.color,family:"\u5FAE\u8F6F\u96C5\u9ED1"}};return s._imageW?(s._imageW.merge(a),void 0):void 0},textStyle:{qw_x:[{x:180,y:158,width:148,height:126,lineHeight:32,color:"#ffffff",size:14},{x:60,y:155,width:170,height:95,lineHeight:24,color:"#557E90",size:14},{x:212,y:166,width:130,height:86,lineHeight:20,color:"#ffffff",size:14},{x:246,y:127,width:90,height:125,lineHeight:19,color:"#ffffff",size:14},{x:45,y:155,width:180,height:80,lineHeight:20,color:"#557E90",size:14},{x:45,y:164,width:178,height:70,lineHeight:18,color:"#ffffff",size:14},{x:222,y:102,width:130,height:107,lineHeight:21,color:"#557E90",size:14},{x:85,y:145,width:150,height:100,lineHeight:25,color:"#ffffff",size:14},{x:51,y:122,width:160,height:90,lineHeight:25,color:"#557E90",size:14}],qw_cat:[{x:181,y:40,width:180,height:122,lineHeight:32,color:"#000000",size:24},{x:160,y:46,width:195,height:115,lineHeight:30,color:"#000000",size:24},{x:155,y:43,width:201,height:118,lineHeight:30,color:"#000000",size:24},{x:55,y:66,width:303,height:85,lineHeight:30,color:"#000000",size:24},{x:143,y:56,width:208,height:104,lineHeight:26,color:"#000000",size:24},{x:140,y:55,width:217,height:123,lineHeight:28,color:"#000000",size:24},{x:190,y:40,width:179,height:132,lineHeight:33,color:"#000000",size:24},{x:60,y:73,width:300,height:85,lineHeight:28,color:"#000000",size:24},{x:131,y:47,width:212,height:124,lineHeight:31,color:"#000000",size:24}]},filterStyle:function(e,t){var i=e.length,s=(t.lineHeight,t.size,t.width,{lineHeight:t.lineHeight,size:t.size});if(i>0){var o=t.height*t.width,a=o/i;s.lineHeight=Math.ceil(Math.pow(a,.5)),s.size=Math.ceil(1.5*s.lineHeight/2.5)}return s.lineHeight>t.height&&(s.lineHeight=t.height),s.lineHeight<t.lineHeight&&(s.lineHeight=t.lineHeight),s.size<t.size&&(s.size=t.size),s},showSmileTemplate:function(e,t,i){var s=this,o=s.layer,a=o.tbattr("data-type"),n=o.tbattr("data-num"),r=s.smilePrev[a],l=o.tbattr("data-isTemplate"),d=s.path+s.smileTemplate[a]+"/"+s.smileyName(r,n,"gif"),h=s.textStyle[a][n-1],c=function(e){var t=s.textInput.val();return s.imageText?(s.imageText.html($.tb.escapeHTML(t)),s.imageText.css(e),s.imageText.show(),void 0):(s.imageText=$('<div class="s_image_text"></div>'),s.imageText.html($.tb.escapeHTML(t)),s.imageText.css(e),$("body").append(s.imageText),s.imageText.show(),void 0)},g="fixed";$.browser.msie&&$.browser.version<7&&(g="absolute");var m=s.filterStyle(s.textInput.val(),h),p={position:g,zIndex:i,width:h.width,lineHeight:m.lineHeight+"px",left:h.x+t,fontSize:m.size,color:h.color,fontFamily:"\u5FAE\u8F6F\u96C5\u9ED1",top:h.y+e};"yes"==l?c(p):(o.tbattr("src",d+s.version),o.tbattr("data-isTemplate","yes"),c(p))},renderDialog:function(e,t){var i=this,s=i.layer,o=s.tbattr("data-type"),a=s.tbattr("data-num"),n=i.smileTextTip[o][a-1];return i.sTop=e,i.sL=t,i.imageText&&i.imageText.hide(),i.dialog?(i.dialog.setPosition(t,e+400),i.dialog.element.css({zIndex:$.getzIndex()}),i.loading.find(".s_progress_bar").width(0),i.dBtn.show(),i.loading.hide(),i.zIndex=$.getzIndex(),i.isValueChange=!1,i.textInput.val(n),i.dialog.show(),i._dialogShow=!0,void 0):(i.zIndex=$.getzIndex(),i.textInput=$('<input value="'+n+'" class="s_text_input"/>'),i.replyBtn=$('<a href="#" style="float:left;" class=" ui_btn ui_btn_m" alog-alias="qwsmile"><span><em>\u53D1\u8868\u56DE\u590D</em></span></a>'),i.cancelBtn=$('<a class="qw_cancel"></a>'),i.dBtn=$('<div style="position:relative;margin-left:9px;">').append(i.textInput).append(i.replyBtn).append(i.cancelBtn),i.loading=$('<div class="s_loading_wrap"><div class="s_progress_w"><span class="s_progress_bar"></span></div><div class="s_loading_tip">\u5BA2\u5B98\u7A0D\u7B49\u4E0B\uFF0C\u6211\u4EEC\u6B63\u5728\u52AA\u529B\u4E3A\u60A8\u751F\u6210\u56FE\u7247\u4E2D<div></div>'),i.dContent=$("<div></div>").append(i.dBtn).append(i.loading),i.replyBtn.click(function(e){i._submit(),e.preventDefault(),e.stopPropagation(),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value=send")}),i.textInput.focus(function(){var e=$(this);setTimeout(function(){i._isSelect=!0,e.select()},10)}),i.textInput.bind("mousedown",function(){i._isSelect=!1}),$.subInput(i.textInput,30),i.textInput.keydown(function(e){var t=e||window.event;if(13==t.keyCode)return i._submit(),!1;var s=$.tb.getByteLength(i.textInput.val());return i._isSelect&&s>39&&i.textInput.val(""),i._isSelect=!1,i.showSmileTemplate(i.sTop,i.sL,i.zIndex),!0}),i.textInput.bind("input",function(){return i.isValueChange&&i.showSmileTemplate(i.sTop,i.sL,i.zIndex),i.isValueChange=!0,!0}),i.textInput.bind("propertychange",function(){return i.isValueChange&&i.showSmileTemplate(i.sTop,i.sL,i.zIndex),i.isValueChange=!0,!0}),i.cancelBtn.click(function(){i.trigger("onCancel"),i.destroyLayer()}),i.dialog=new $.dialog({html:i.dContent,modal:!1,escable:!1,showTitle:!1,top:e+400,left:t,closeable:!0,fixed:!0,autoCenter:!1,width:420,height:30,draggable:!1,closeable:!1}),i._dialogShow=!0,void 0)}}});_.Module.define({path:"comforum/widget/Comtrial",sub:{initial:function(a){this.dataObj=a,this._initAD(),this._initPbFlashAd()},_initAD:function(){var a=this,e=a.dataObj,t=802;if($("#search_fengchao")[0]&&$("#search_fengchao_left")[0]&&"search"==e.page&&0==e.hide_searchad){window.arrBaiduAds=window.arrBaiduAds||{};var i="http://a.baidu.com/ecom?di=802,779&tm=baiduASPT802S,baiduASPT779S&tn=SE_ecomt01_b7az25cz,SE_ecomt01_b7az25cz&word="+e.query_encode+"&eid="+t;$.JsLoadManager.use([i],function(){$("#search_fengchao").html(arrBaiduAds[779]),$("#search_fengchao_left").html(arrBaiduAds[802])})}$.JsLoadManager.use(["http://cbjs.baidu.com/js/m.js"],function(){var e=a.dataObj,t=PageData.forum?PageData.forum.forum_id:0;window.BAIDU_DAN_config={zIndex:1},$("#pb_adbanner").length>0&&a._loadWm({width:960,height:90,tpl:"pb",page:"pb",id:613519,forumId:t,selector:"#pb_adbanner"}),$("#union_mod")[0]&&"pb"==e.page&&a._loadWm({width:200,height:200,tpl:"pb",page:"pb",id:666982,forumId:t,selector:"#union_mod"}),$("#search_union_mod")[0]&&"search"==e.page&&0==e.hide_searchad&&(a._loadWm({width:250,height:250,tpl:"pb",page:"pb",id:696315,forumId:t,selector:"#search_union_mod"}),$("#search_union_mod").show())}),$("#search_bottomad")[0]&&"search"==e.page&&0==e.hide_searchad&&($("#search_bottomad").html($.tb.format($("#comtrial_search_bottomad").html(),null)),$("#search_bottomad").show())},_loadWm:function(a){if(null!=a&&a){var e=a.src||"http://tieba.baidu.com/tb/zt/spread/pcwm.html?",t=a.id,i=a.forumId,d=a.tpl||"pb",o=a.page||"pb";e+="tpl="+d+"&page="+o+"&id="+t+"&forumId="+i;var r=a.selector,h=a.width,n=a.height,c=$('<iframe src="'+e+'" style="width:'+h+"px;height:"+n+'px" scrolling="no" frameborder="0"></iframe>');$(r).html(c)}},_initPbFlashAd:function(){var a=PageUnit.load("tope_pbbanner_swf");a&&new $.swf(a,{id:"chart",container:"#banner_pb_customize",width:960,height:90,params:{wmode:"transparent"}})}}});_.Module.define({path:"comforum/widget/SkinClick",sub:{initial:function(){this._calcAdWidth(),this._bindEvents()},_calcAdWidth:function(){var i=$(".com_skinad_left,.com_skinad_right"),n=$(window).width(),t=1380>n?(n-980)/2:200;i.css("width",t)},_bindEvents:function(){var i=this;$(window).on("resize",i._calcAdWidth),$(".com_skinad_left,.com_skinad_right").on("click",function(){$.stats.hive("skin_ad")})}}});_.Module.define({path:"comforum/widget/GamePopWindow",sub:{nextDay:new Date((new Date).getTime()+864e5-1e3*(60*(new Date).getHours()*60+60*(new Date).getMinutes()+(new Date).getSeconds())),nextTenMinutes:new Date((new Date).getTime()+6e5),nextHalfHour:new Date((new Date).getTime()+18e5),tmp:['<div id="game_pop_window">','<div class="pop_head">','<a class="pop_head_close" href="#" onclick="return false;"></a>',"</div>",'<div class="pop_body">','<div class="game_info">','<a class="game_image" href="#{game_link}" target="_blank">','<img src="#{game_image}" />',"</a>",'<p class="game_name">','<a href="#{game_link}" target="_blank">#{game_name}</a>',"</p>",'<div class="game_hot clearfix">#{game_hot}</div>',"</div>",'<div class="game_reco">','<div class="game_icon"></div>','<p class="game_reco_info">#{game_reco_info}</p>',"</div>",'<a class="game_btn" href="#{game_link}" target="_blank"></a>','<p class="game_desc clearfix">',"<span>#{game_desc_text}</span>",'<a href="#{game_desc_link}" target="_blank">\u8BE6\u60C5\u4ECB\u7ECD</a>',"</p>","</div>","</div>"].join(""),initial:function(){this.hanldeBaiduId();var t=this.initPopFromStorageOrLimitShow();t?this.checkLimitShow()&&this.loadBaiduYouxiScript():this.initPopFromAjax()},hanldeBaiduId:function(){var t=$.tb.Storage.get("game_pop_baidu_id"),e=$.cookie("BAIDUID");t!=e&&($.tb.Storage.remove("game_pop_window_data_storage"),$.tb.Storage.remove("game_pop_window_limit_show"),$.tb.Storage.set("game_pop_baidu_id",e,this.nextDay))},initPopFromStorageOrLimitShow:function(){var t=this.loadPopWindowDataFromStorage();return t?(this.initWindow(t),!0):this.checkLimitShow()?!0:!1},initPopFromAjax:function(){var t=this;$.getJSON("/gamepopup/getPopup?timestamp="+(new Date).getTime()).done(function(e){var a=e.data;return!a||$.isEmptyObject(a)?(t.setLimitShow(),void t.loadBaiduYouxiScript()):(a={game_name:a.name,game_image:a.icon,game_link:a.link,game_desc:a.desc,game_desc_link:a.desc_link,game_hot:a.hot,pop_type:2,start_time:a.start_time,end_time:a.end_time,damn_friends:a.damn_friends,task_name:a.task_name||""},t.initWindow(a),void t.storePopWindowData())})},loadBaiduYouxiScript:function(){if($.tb.Storage.get("game_pop_window_not_load_baiduyouxi"))return!1;var t=document.createElement("script");t.id="DQTuisong",t.setAttribute("data-config","false"),t.src="http://static.pay.baidu.com/resource/tuisong/v1/tuiSong.js",document.body.appendChild(t);var t=document.createElement("script");t.setAttribute("name","baidu_game_tips_"),t.setAttribute("data-skin",""),t.setAttribute("data-right",""),t.src="http://youxi.baidu.com/tips/bdtips_min.js",document.body.appendChild(t)},initWindow:function(t){return t||$.isEmptyObject(t)?(this.data=t,this.game_name=this.data.game_name,this.task_name=this.data.task_name,this.popWindow=null,this.buildTmp(this.data),this.bindEvents(this.data),void this.runStrategy(this.data)):!1},checkToShow:function(t){var e=parseInt((new Date).getTime()/1e3);return t.start_time&&t.end_time&&t.start_time<e&&t.end_time>e},checkLimitShow:function(){var t=$.tb.Storage.get("game_pop_window_limit_show");return t?!0:!1},setLimitShow:function(t){t=t||this.nextHalfHour,$.tb.Storage.set("game_pop_window_limit_show",1,t)},storePopWindowData:function(){$.tb.Storage.set("game_pop_window_data_storage",$.json.encode(this.data),this.nextDay)},clearPopWindowData:function(){$.tb.Storage.remove("game_pop_window_data_storage")},notPopWindowUntilNextDay:function(){this.clearPopWindowData(),this.setLimitShow(this.nextDay),$.tb.Storage.set("game_pop_window_not_load_baiduyouxi",1,this.nextDay)},loadPopWindowDataFromStorage:function(){var t=$.tb.Storage.get("game_pop_window_data_storage");try{t=$.json.parseJSON(t)}catch(e){return!1}return t},sendPopupAction:function(t){var e="/gamepopup/setPopup",a={task_id:this.data.id||-1,game_name:this.data.game_name,action:t};$.post(e,a)},bindEvents:function(t){{var e=this;1==t.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97","frs"==PageData.product?"frs\u9875_":"pb\u9875_"}$("#game_pop_window").on("click",".pop_head_close",function(){e.sendPopupAction("close"),e.notPopWindowUntilNextDay(),e.postTrack("\u5173\u95ED\u5F39\u7A97"),e.hidePop(),e.clearStrategy()}).on("click",".game_name a",function(){e.sendPopupAction("play"),e.notPopWindowUntilNextDay(),e.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u540D\u79F0"),e.hidePop(),e.clearStrategy()}).on("click",".game_image",function(){e.sendPopupAction("play"),e.notPopWindowUntilNextDay(),e.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u56FE\u6807"),e.hidePop(),e.clearStrategy()}).on("click",".game_btn",function(){e.sendPopupAction("play"),e.notPopWindowUntilNextDay(),e.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u6309\u94AE"),e.hidePop(),e.clearStrategy()}).on("click",".game_desc a",function(){e.sendPopupAction("view"),e.postTrack("\u8BE6\u60C5\u4ECB\u7ECD","\u6E38\u620F\u6309\u94AE")}).on("click",".forum_title",function(){e.postTrack("\u63A8\u8350\u5427\u70B9\u51FB",$(this).getData().forum_name)}).on("click",".user_link",function(){e.postTrack("\u63A8\u8350\u7528\u6237\u70B9\u51FB",$(this).getData().user_name)})},postTrack:function(t,e,a){var i="frs"==PageData.product?"frs\u9875_":"pb\u9875_",o=1==this.data.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97";"undefined"==typeof a&&(a="click");var n={obj_type:"\u6E38\u620F",obj_subtype:o,obj_game:this.game_name,obj_uid:$.cookie("BAIDUID"),obj_url:this.task_name};e&&(n.obj_name=e),$.stats.track(i+"\u5F39\u7A97_"+t,"\u4E2A\u6027\u5316\u5F39\u7A97\u5B9E\u9A8C","",a,n)},buildTmp:function(t){var e="",a={game_name:$.tb.subByte(t.game_name,16),game_image:t.game_image,game_link:t.game_link,game_hot:this.buildGameHot(t),game_reco_info:this.buildGameRecoInfo(t),game_desc_text:$.tb.subByte(t.game_desc,44),game_desc_link:t.game_desc_link};e=$.tb.format(this.tmp,a),this.popWindow=$(e).appendTo("body")},runStrategy:function(t){var e=$.cookie("game_pop_window");if(e=3,!e||0>e||e>3)this.resetStrategy(),this.stepStrategy();else if(3==e)this.showPop(t),this.resetStrategy();else{if(0==e)return;this.stepStrategy()}},resetStrategy:function(){$.cookie("game_pop_window",1,{expires:this.nextDay})},stepStrategy:function(){var t=$.cookie("game_pop_window");$.cookie("game_pop_window",++t,{expires:this.nextDay})},clearStrategy:function(){$.cookie("game_pop_window",0,{expires:this.nextDay})},showPop:function(t){var e=this,a=(1==t.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97","frs"==PageData.product?"frs\u9875_":"pb\u9875_",setTimeout(function(){e.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(a),a=null},2e3)),i=setTimeout(function(){e.hidePop(),clearTimeout(i),i=null},15e3);e.postTrack("\u5C55\u73B0","","view")},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})},buildGameHot:function(t){var e=0,a="",i=parseInt(t.game_hot)||0,o=i>9?9:i;for(e;o>e;++e)e%2!=1&&(a+='<span class="full"></span>');for(e%2==0&&(a+='<span class="half"></span>'),e;10>e;++e)e%2!=1&&(a+='<span class="empty"></span>');return a+='<span class="score">'+t.game_hot+"</span>"},buildGameRecoInfo:function(t){var e,a="";if(1==t.pop_type){var i=$.tb.dataField({forum_name:t.forum_name});a+='<a class="forum_title" href="/f?kw='+t.forum_name+'&ie=utf8" '+i+' target="_blank" >'+$.tb.subByte(t.forum_name,12)+"\u5427</a>\u91CC\u5DF2\u7ECF\u6709<span>"+t.user_num+"</span>\u4F4D\u8D34\u5427\u5C0F\u4F19\u4F34\u5728\u73A9\u8FD9\u6B3E\u6E38\u620F\uFF0C\u9A6C\u4E0A\u52A0\u5165\u5230\u4ED6\u4EEC\u7684\u884C\u5217\uFF01"}else if(2==t.pop_type)if(t.damn_friends)a+=t.damn_friends;else if("\u571F\u8C6A\u8DB3\u7403"==t.game_name)a+="\u5DF4\u897F\u4E16\u754C\u676F\u6FC0\u60C5\u5F00\u6218\uFF0C\u8D34\u5427\u4E3A\u4F60\u5F00\u542F\u4E13\u4EAB\u7684\u4E16\u754C\u676F\uFF01";else if("2014\u5DF4\u897F\u4E16\u754C\u676F"==t.game_name)a+="\u6851\u5DF4\u8363\u8000\uFF0C\u8C01\u80FD\u95EE\u9F0E\u4E16\u754C\u5DC5\u5CF0\uFF1F\u8D34\u5427\u9080\u4F60\u4E00\u8D77\u5F81\u6218\uFF01";else{for(e=0;e<t.user_info.length&&!(e>3);++e){var o=$.tb.dataField({user_name:t.user_info[e]});a+='<a class="user_link" href="/home/main/?ie=utf8&un='+t.user_info[e]+'"'+o+' target="_blank" >'+$.tb.subByte(t.user_info[e],12)+"</a>\u3001"}a=a.slice(0,a.length-1),a+="\u7B49\u591A\u4F4D\u8D34\u5427\u5C0F\u4F19\u4F34\u5728\u73A9\u8FD9\u6B3E\u6E38\u620F\uFF0C\u9A6C\u4E0A\u8DDF\u4ED6\u4EEC\u4E00\u8D77\u73A9\uFF01"}return a}}});_.Module.define({path:"pb/widget/UrlCheck",sub:{url:"/f/urlcheck",urlToBeChecked:"",b_option:{content:"",arrowReq:!1,closeBtn:!1},initial:function(){try{this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:35}),e}},_bindEvent:function(){var e=this;$("#j_p_postlist").on({mouseenter:function(){var t=$(this),a=t.parents("div.l_post"),n=a.getData(),c=n.content.id;t.data("handler",null);var o=null,l=!0;if(t.data("level")){var i=setTimeout(function(){e._show(t)},25);t.data("handler",i)}else{e.urlToBeChecked=t.tbattr("href");var r={urls:[t.tbattr("href")],ie:"utf8",post_id:c},u=function(){$.tb.get(e.url,r,function(a){if(-1!=a.no){var n=15;0==a.no&&a.data&&a.data.url_info&&(n=a.data.url_info[0].whitetype||15),t.data("level",n),l&&(o=setTimeout(function(){e._show(t)},25))}})};u()}t.on("mouseleave",function(){l=!1,clearTimeout(o),clearTimeout(t.data("handler")),i=setTimeout(function(){e._hide(t)},25),t.data("handler",i)})},click:function(e){try{{var t=$(this),a=t.data("level");t.tbattr("href")}11!=a&&12!=a&&15!=a&&void 0!=a&&e.preventDefault()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:110}),e}}},".j_d_post_content a:not(.at), .j_lzl_s_p .lzl_content_main a:not(.at)")},_show:function(e){var t=this;if(!e.data("bubble")){var a,n,c=e.data("level"),o=e.tbattr("href"),l=e.text(),i=e.position();switch(c){case 11:case 12:return;case 13:a="unsecure",n="\u53EF\u4FE1\u5EA6\u4F4E\uFF0C\u4E0D\u5EFA\u8BAE\u8BBF\u95EE";break;case 14:a="danger",n="\u5371\u9669\u7F51\u7AD9\uFF0C\u5343\u4E07\u522B\u8BBF\u95EE";break;case 15:default:return}t._sendStats("bbshow");var r=['<a href="http://guanjia.qq.com"  class="icon_link" target="_blank" >&nbsp;</a>','<div class="url_check_bubble_wrap '+a+'">','<p class="text">'+n+"</p>",'<p class="control"><a href="http://guanjia.qq.com/online_server/complain_url.html?url='+encodeURIComponent(l)+'" class="j_argue_url" target="_blank">\u7533\u8BC9</a> <a href="'+o+'" class="open_url j_open_url" target="_blank">\u6253\u5F00</a>',"</div>"].join(""),u=$.extend({},this.b_option);u.content=r,u.wrap=e.parents(".p_content");var s=i.top-55-e.height();u.bubble_css={left:i.left,top:s,width:258,height:72};var d={zIndex:$.getcurzIndex()},h=new UiBubbleTipBase(u);h.showBubble(d),h.j_bubble.addClass("url_check_bubble_container"),h.j_bubble.on({mouseenter:function(){h.j_bubble.find("a.j_argue_url");clearTimeout(e.data("handler"))},mouseleave:function(){hdl=setTimeout(function(){t._hide(e)},25),e.data("handler",hdl)}}),h.j_bubble.find("a.icon_link").on({click:function(){try{t._sendStats("iconclick")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:199}),e}}}),h.j_bubble.find("a.j_argue_url").on({click:function(){try{t._sendStats("argueclick")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:203}),e}}}),h.j_bubble.find("a.j_open_url").on({click:function(){try{t._sendStats("openclick")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:207}),e}}}),e.data("bubble",h)}},_sendStats:function(e){var t=this;$.stats.sendRequest("bubble=urlcheck&page=pb&function="+e+"&url="+t.urlToBeChecked)},_hide:function(e){var t=e.data("bubble");t&&(t.closeBubble(),e.removeData("bubble"))}}});window.__discarding&&__discarding("props/component/residual"),_.Module.define({path:"props/component/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},n=null,s="",t=["1070002","1070001"],a=0;a<t.length;a++)if(n=e[t[a]],n&&n.num>0&&n.end_time>Env.server_time/1e3){s=this.options[t[a]];break}return s},showUI:function(i){var e=i.wrap,n="",s=null,t=i.key||this.getResidualKey(i);t&&(n="residual_wrap residual_wrap_"+t,s=e.find(".residual_wrap"),s[0]?s.removeClass().addClass(n):(s=$('<div class="'+n+'"></div>'),e.append(s)))}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){{var i=this,e="1070002"==this.propsId?"egg":"worship",s="/tb/static-props/swf/guide_"+e+".swf?t=140112";new $.swf(s,{container:i.$guideContent,width:980,height:600,params:{wmode:"transparent"}})}this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});window.__discarding&&__discarding("props/component/magic_props"),_.Module.define({path:"props/component/MagicProps",requires:["props/component/Residual","props/component/Guide"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"\u9B54\u62DC",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"\u9B54\u86CB",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("props/component/Residual"),this.guide=this.use("props/component/Guide")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},i=null,a=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)a=o[r],i={id:a,count:t[a]&&t[a].left_num||0},$.extend(i,this.propsOptions[a]),s.push(i),e[a]=i;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,i=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),a=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],a.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?a.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/></a>'):a.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),a.push('<p class="props_item_title">'),a.push("<span>"+s.name+"</span>"),s.count>0&&(a.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),a.push('<span class="props_item_num">'+s.count+"</span>")),a.push("</p>"),a.push("</li>");i.html(a.join("")),i.hide().appendTo(t.$wrap),t.$propsList=i},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn(),t.guide.initMagicGuide()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var i=$(this).data("id"),a=t.propsMap[i];return t.propsObj=a,a.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},i=$("#headinfo_wrap"),a=i.offset().left,s=i.offset().top,e=a+i.width(),o={marginLeft:a,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),i=t.find(".l_post"),a=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<i.length;n++)a=$(i[n]),s=a.getData(),this.doPostItem(a,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,i,a,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:i.author.id,postId:i.content.id,propsData:i.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=a+130,r.marginLeft=a,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=a+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),i=$('<div class="mask_layer mask_right"></div>'),a=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(i).append(a).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:i,bottomMask:a,leftMask:s,lightArea:e}},setMaskPosition:function(t,i,a,s){var e=this.maskMap;e.topMask.css({height:i}),e.rightMask.css({left:t+a,top:i,width:$("body").width()-(t+a),height:s}),e.bottomMask.css({top:i+s,height:$("body").height()-(i+s)}),e.leftMask.css({top:i,width:t,height:s}),e.lightArea.css({left:t,top:i,width:a,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(i){if(27==i.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(i){if(3==i.which){if(t.disabledMove)return!1;t.clear()}return!1});var i=50,a=$("body").width()-i,s=0;t.$maskWrap.mousemove(function(i){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=i.pageX,s>a&&(s=a),t.$bulletLayer.css({left:s,top:i.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=i.pageX>=o.marginLeft&&i.pageX<=o.marginRight&&i.pageY>=o.marginTop&&i.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],i.pageX>=e.marginLeft&&i.pageX<=e.marginRight&&i.pageY>=e.marginTop&&i.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,i=$('<div class="bullet_layer"><span class="bullet_layer_tip">\u53F3\u952E\u53D6\u6D88</span></div>');return i.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),i},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,i="/tbmall/post/useAppraiseProps",a={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(i,a,function(i){i&&0==i.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,i=".props_item_"+t;this.updatePropsBtnNum(t,i),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,i)},updatePropsBtnNum:function(t,i){var a=$("#tbui_aside_props_list "+i),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?a.find(".props_item_num").text(s):(a.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),a.find(".props_item_sign").remove(),a.find(".props_item_num").remove())},updatePostAreaNum:function(t,i){var a=this.areaObj.propsData||{};a[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(i);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,i=this.propsOptions[this.propsObj.id].flashOptions,a=($(window).height()-i.height)/2;a=150>a?150:a;var s=this.areaObj.jdom.offset().top-a;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var i=this,a=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==i.areaObj.propsType&&"1070002"==i.propsObj.id&&("ihome"==PageData.product?(a=100,s=-15):(a=60,s=-20),r=r-(r+o.marginLeft-i.areaObj.jdom.offset().left)+a,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-props/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}i.flashPool.push(e),i.$maskWrap.append(e),i.topzIndex=$.getzIndex(),i.$bulletLayer.css({"z-index":i.topzIndex})},buildPlusOne:function(){var t=this,i="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(i+="_png8"),i="/tb/static-props/img/"+i+".png";var a=$('<div class="props_plusone"><img src="'+i+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),a.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(a),a.animate({top:"-=100px",opacity:.8},800,"swing",function(){a.remove()})},clearPool:function(){for(var t=this,i=t.flashPool,a=null,s=0;s<i.length;s++)a=i.shift(),a.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,i={},a=null;i.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var i=t.flashPool.shift();i.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?a=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(a=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:a,key:t.propsObj.key})))}},window.MagicProps=i},showTomallDialog:function(){var t=this,i=new $.dialog({title:"\u63D0\u793A",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">\u4F60\u76EE\u524D\u6CA1\u6709\u53EF\u7528\u7684\u9053\u5177\u4E86\uFF0C\u5FEB\u53BB\u5546\u57CE\u8D2D\u4E70\u5427</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">\u53BB\u8D2D\u4E70>></a><div>',width:400,height:80});i.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var i='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',a=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(i,{href:$.tb.unescapeHTML(t)}),width:400,height:80});a.bind("onclose",function(){$.tb.location.reload()}),a.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});_.Module.define({path:"props/widget/Feedback",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions(),this.initCallbacks(),this.initData(),this.play()},initOptions:function(){this.options={1070001:{id:"1070001",key:"worship",name:"\u819C\u62DC",flashOptions:{width:250,height:220,marginLeft:120,marginTop:95}},1070002:{id:"1070002",key:"egg",name:"\u81ED\u9E21\u86CB",flashOptions:{width:410,height:260,marginLeft:195,marginTop:30}}}},initData:function(){for(var i=this.dataObj.appraise||{},t=null,e=null,a=[],n=["1070001","1070002"],s=0;s<n.length;s++)t=i[n[s]],t&&t.notice>0&&(e=this.options[n[s]],$.extend(e,t),a.push(e));this.playList=a},play:function(){var i=this.playList;i.length>0&&(i.sort(function(i,t){return t.notice!=i.notice?t.notice-i.notice:parseInt(t.id)-parseInt(i.id)}),this.index=0,this.buildFlash(),this.clearNotice())},buildFlash:function(){if(this.index<this.playList.length){var i=$('<div class="props_flash_wrap"></div>');$("body").append(i);var t=this.playList[this.index],e=this.getFlashData(t);i.css({width:e.width,height:e.height,left:e.marginLeft,top:e.marginTop,"z-index":e.zindex});{var a="/tb/static-props/swf/"+e.feedbackName+"?t=0101";new $.swf(a,{id:"props_flash_content",name:"props_flash_content",container:i,width:e.width,height:e.height,params:{wmode:"transparent"}})}t.wrap=i}},getFlashData:function(i){var t=i.flashOptions,e=0,a=0,n=0,s=0,o=PageData.product;switch(o){case"pb":case"frs":case"index":n=40,e=$("#user_info").offset().left,a=$("#user_info").offset().top;break;case"ihome":n=92,e=$("#userinfo_wrap").offset().left,a=$("#userinfo_wrap").offset().top}e=e-t.marginLeft+n,a=a-t.marginTop+s;var h=i.notice>1?"more":"single";return feedbackName="feedback_"+i.key+"_"+h+".swf",{key:i.key,feedbackName:feedbackName,width:t.width,height:t.height,marginLeft:e,marginTop:a,zindex:$.getzIndex()}},clearNotice:function(){var i="/tbmall/post/clearAppraiseNotice",t={type:0,tbs:PageData.tbs};$.tb.post(i,t,function(i){i&&0==i.no})},initCallbacks:function(){var i=this,t={};t.finishPlay=function(){i.playList[i.index].wrap.remove(),i.index++,i.buildFlash()},window.MagicProps=t}}});_.Module.define({path:"encourage/widget/firework",requires:["encourage/widget/firework/fireworkTemplate"],sub:{$btn:$(".j_firework_sender"),fireworkUnits:{},dialog:null,_buyFireworkUrl:"/tbmall/submit/giftpkg/buyGiftPkg",_getFireworkUrl:"/tbmall/submit/giftpkg/getBonus",_likeForumUrl:"/f/like/commit/add",_likeUserUrl:"/home/post/follow",_productType:"frs"===PageData.product?0:1,_productId:"frs"===PageData.product?PageData.forum.forum_id:PageData.thread.thread_id,scores:PageData.user.Parr_scores&&PageData.user.Parr_scores.scores_total,FIREWORK_PRICE:99e3,FIREWORK_TYPE_99:0,FIREWORK_UNIT_COUNT:8,ERROR_TIP_MAP:{220012:"\u68C0\u6D4B\u5230\u60A8\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\uFF0C\u8BF7\u89E3\u7981\u540E\u91CD\u8BD5",220034:"\u60A8\u62A2\u5F97\u592A\u9891\u7E41\u5566\uFF0C\u8FD9\u6B21\u5C31\u8BA9\u4E00\u8BA9\u5176\u4ED6\u5C0F\u4F19\u4F34\u5427",2270055:"T\u8C46\u5DF2\u88AB\u62A2\u5149\uFF0C\u4E0B\u6B21\u8981\u773C\u75BE\u624B\u5FEB\u54E6",2270056:"\u6BCF\u4E2A\u70DF\u82B1\u53EA\u80FD\u6361\u4E00\u6B21\u54E6\uFF0C\u53BB\u6C42\u571F\u8C6A\u7EE7\u7EED\u53D1\u5427",2270057:"T\u8C46\u5DF2\u88AB\u62A2\u5149\uFF0C\u4E0B\u6B21\u8981\u773C\u75BE\u624B\u5FEB\u54E6",2270058:"\u5C0F\u4F19\u4F34\u592A\u591A\u6211\u6491\u4E0D\u4F4F\u5566\uFF0C\u5F85\u4F1A\u518D\u6765\u561B",9999990:"\u5173\u6CE8\u6210\u529F"},waitToPlayList:[],isPlayingSwf:!1,initial:function(e){this.tpl=this.requireInstance("encourage/widget/firework/fireworkTemplate"),this.banner_link=PageUnit.load("firework_banner_link"),this.banner_src=PageUnit.load("firework_banner_src"),this.button_link=PageUnit.load("firework_button_link"),this.button_txt=PageUnit.load("firework_button_txt"),this.firework_link=PageUnit.load("firework_firework_link"),this.skinClass=e.skinClass,this.skinConfig=e.skinConfig,this.renderPreFireworks(e.fireworks),this.bindEvents()},renderPreFireworks:function(e){if($.isArray(e))for(var i=0,t=e.length;t>i;i++){var r=this.fireworkManager(e[i].package_id);r?1==r&&this.renderFirework(e[i]):this.showFireworkSwf(e[i])}},bindEvents:function(){var e=this,i=$("body");this.observe("play.firework",function(i,t){t.location_type==e._productType&&t.location_id==e._productId&&e.showFireworkSwf(t)}),this.observe("buy.firework",function(){e.buyFirework()}),this.$btn.on("click",function(){return PageData.user.is_login?e.showFireworkDialog():e.requireInstanceAsync("common/widget/LoginDialog"),!1}),i.on("click",".j_firework_unit",function(){var i=$(this).tbattr("data-firework-id");PageData.user.is_login||e.requireInstanceAsync("common/widget/LoginDialog");var t=function(r){$.tb.post(e._getFireworkUrl,$.extend({package_id:i,forum_name:PageData.forum.forum_name,tbs:PageData.tbs,location_id:e._productId,location_type:e._productType,forum_id:PageData.forum.forum_id},r),function(r){if(0==r.no&&r.data.scores>0)e.removeFirework(i),e.showTdouTip(r);else switch(r.no){case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 220040:e.requireInstanceAsync("common/component/CaptchaDialog",{message:r.data.str_reason,vCode:r.data.captcha_vcode_str,vCodeType:r.data.captcha_code_type,title:"\u83B7\u53D6\u70DF\u82B1\u9A8C\u8BC1\u7801",checkUrl:"/tbmall/submit/giftpkg/checkVcode",vCodeUrl:"/tbmall/submit/giftpkg/getVcode",paramsCallback:function(){return{tbs:PageData.tbs||PageData.user.tbs}}},function(e){e.bind("onclose",function(){e.hide()}),e.bind("onaccept",function(){var i={captcha_input_str:e.getInputValue(),captcha_vcode_str:e.getVCode()};t(i)})});break;default:e.showTdouTip(r),e.removeFirework(i)}},"json")};t()})},showTdouTip:function(e){var i=e.data||{ulike:1,flike:1},t=e.no,r=this.ERROR_TIP_MAP[t]||"\u670D\u52A1\u5668\u62BD\u98CE\u4E86",o=this,a=i.scores,n=i.ulike&&i.flike,s="\u5173 \u95ED",l=this.button_txt,f=$.tb.format(this.tpl.getTdouTipBannerTpl(),{banner_link:this.banner_link,banner_src:this.banner_src});switch(n||(l="\u4E00\u952E\u5173\u6CE8",s="\u6B8B\u5FCD\u62D2\u7EDD",f=this.tpl.getTdouTipAttentionBannerTpl()),String(t)){case"0":r='\u606D\u559C\u4F60\u6361\u5230<span class="got_tdou">'+i.uname+'</span>\u6492\u843D\u7684<span class="got_tdou">'+a+"</span>T\u8C46";break;case"2270055":r="\u624B\u6162\u4E86\uFF0C<span class='got_tdou'>"+i.uname+"</span>\u6492\u843D\u7684T\u8C46\u5DF2\u88AB\u62A2\u5149"}var c=new $.dialog({html:$.tb.format(this.tpl.getTdouTipTpl(),{text:r,username:i.uname,score:a,banner:f,button_link:this.button_link,button_txt:l,close_txt:s}),width:420,noTitle:!0});c.element.find(".j_close_btn").one("click",function(){return c.close(),!1}),n||c.element.find(".j_firework_attention_btn").one("click",function(e){e.preventDefault(),o.likeForumAndUser(i.uname),c.close()})},showFireworkDialog:function(){var e=this;this.dialog=new $.dialog({holderClassName:e.skinClass+"_dialog",title:e.skinConfig.title,width:e.skinConfig.width,height:e.skinConfig.height,html:$.tb.format(e.tpl.getDialogTpl(e.skinClass),{firework_link:this.firework_link})}),this.dialog.element.one("click",".j_preview_btn",function(){return e.dialog.close(),e.showFireworkSwf({user_name:PageData.user.user_name,preview:!0}),e.fire("firework.global_preview"),!1}).one("click",".j_buy_btn",function(){return e.dialog.close(),e.scores<e.FIREWORK_PRICE?e.requireInstanceAsync("common/widget/tcharge_dialog"):e.buyFirework(),!1}),e.renderRank(this.dialog.element)},buyFirework:function(){var e=this;$.tb.post(e._buyFireworkUrl,{location_id:e._productId,location_type:e._productType,gift_pkg_type:e.FIREWORK_TYPE_99,tbs:PageData.tbs,forum_name:PageData.forum.forum_name,forum_id:PageData.forum.forum_id},function(i){0==i.no?(e.fire("firework.global_notice",$.extend({},i.data,{forum_name:PageData.forum.forum_name,location_id:e._productId,location_type:e._productType,scores:5e4,user_name:PageData.user.user_name,portrait:PageData.user.portrait,msg_type:1e4})),e.showFireworkSwf(i.data)):2270005==i.no&&e.requireInstanceAsync("common/widget/tcharge_dialog")},"json")},renderFirework:function(e){function i(e,i){return Math.random()*(i-e)+e}var t,r,o=$(),a=+new Date,n=e.package_id,s=e.end_time,l=this;if(!(n&&this.fireworkManager(n)>1||this.fireworkUnits[n]||a/1e3>s)){for(var f=0,c=this.FIREWORK_UNIT_COUNT;c>f;f++)t=$('<div class="firework_unit j_firework_unit" data-firework-id="'+n+'">'),t.css({marginTop:i(-200,200),marginLeft:i(-300,300)}),o=o.add(t);$("body").append(o),r=setTimeout(function(){l.removeFirework(n)},1e3*s-a),this.fireworkUnits[n]={},this.fireworkUnits[n].elements=o,this.fireworkUnits[n].timeout_id=r}},removeFirework:function(e){this.fireworkUnits[e]&&(this.fireworkUnits[e].elements.remove(),clearTimeout(this.fireworkUnits[e].timeout_id),delete this.fireworkUnits[e],this.fireworkManager(e,2))},fireworkManager:function(e,i){var t=$.parseJSON($.tb.Storage.get("fireworks"));if(t||(t=[]),"undefined"==typeof i){var r=null;return $.each(t,function(i,t){return t.pid==e?(r=t.v,!1):void 0}),r}var o=!1;$.each(t,function(t,r){return r.pid==e?(r.v=i,o=!0,!1):void 0}),o||(t.length>200&&(t=t.slice(-200)),t.push({pid:e,v:i})),$.tb.Storage.set("fireworks",$.json.encode(t),+new Date+31536e6)},closeFlash:function(){$("#firework_swf_ctn").remove(),this.flash=null,this.isPlayingSwf=!1},showFireworkSwf:function(e){var i=this,t=e.end_time,r=+new Date;if(!(e.package_id&&this.fireworkManager(e.package_id)>0||r/1e3>t))if(this.isPlayingSwf)i.waitToPlayList.push(e);else{this.isPlayingSwf=!0;var o=$('<div id="firework_swf_ctn" class="firework_swf_ctn"></div>');$("body").append(o),e.package_id&&this.fireworkManager(e.package_id,1);var a="http://tb2.bdstatic.com/tb/static-encourage/widget/firework/swf/firework_general_83142de.swf";"hallowmas"==i.skinClass&&(a="http://tb2.bdstatic.com/tb/static-encourage/widget/firework/swf/firework_hallowmas_94fe0c1.swf"),this.flash=new $.swf(a,{id:"firework",container:"#firework_swf_ctn",width:980,height:470,vars:{user_name:e.user_name+"\u653E\u7684"+i.skinConfig.item},callBacks:{closeFlash:function(){if(i.closeFlash(),e.preview)setTimeout(function(){i.showFireworkDialog(),i.fire("firework.global_preview_close")},1e4);else{i.renderFirework(e);var t=i.waitToPlayList.shift();t&&i.showFireworkSwf(t)}}}})}},renderRank:function(e){var i=this;$.get("/minigame/rank/getRank",{t:(new Date).getTime()},function(t){if(0==t.no){var r=t.data.fireworks,o=i.tpl.getFireworkRankTpl(),a=baidu.template(o,{rank:r});e.find(".j_firework_rank_body").html(a)}})},likeForumAndUser:function(e){var i=this,t=PageData.tbs,r=PageData.forum.forum_id,o=PageData.forum.forum_name,a=$.tb.post(this._likeForumUrl,{fid:r,fname:o,tbs:t}),n=$.tb.post(this._likeUserUrl,{un:e,tbs:t});$.when(a,n).then(function(){i.showTdouTip({no:"9999990",data:{ulike:1,flike:1}})})}}});
;_.Module.define({path:"encourage/widget/firework/fireworkTemplate",sub:{_dialogTpl:{general:['<div class="firework_sender_dialog">','<div class="firework_img"></div>','<div class="price_wrap">','<span>\u4EF7\u683C\uFF1A <span class="price">99000</span><span class="tdou_txt">T\u8C46</span></span>',"</div> ",'<div class="btn_wrap">','<a href="#" class="ui_btn ui_btn_sub_m preview_btn j_preview_btn">',"<span><em>\u9884\u89C8</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_m buy_btn j_buy_btn">',"<span><em>\u653E\u70DF\u82B1</em></span>","</a>","</div>",'<div class="firework_advantages"></div>',"</div>",'<div class="firework_rank firework_rank_general">','<div class="rank_title">',"<span>\u653E\u70DF\u82B1\u8FBE\u4EBA\u699C</span>","#{firework_link}","</div>",'<div class="rank_body j_firework_rank_body">',"</div>","</div>"].join(""),hallowmas:['<div class="firework_sender_dialog firework_sender_hallowmas_dialog">','<div class="firework_img"></div>','<div class="price_wrap">','<span>\u4EF7\u683C\uFF1A <span class="price">99000</span><span class="tdou_txt">T\u8C46</span></span>',"</div> ",'<div class="btn_wrap hallowmas_btn_wrap">','<a href="#" class="preview_btn j_preview_btn">\u9884\u89C8</a>','<a href="#" class="buy_btn j_buy_btn">\u653E\u5357\u74DC\u706F</a>',"</div>","</div>",'<div class="firework_rank firework_rank_hallowmas">','<div class="rank_title">',"<span>\u653E\u5357\u74DC\u706F\u8FBE\u4EBA\u699C</span>","</div>",'<div class="rank_body j_firework_rank_body">',"</div>","</div>"].join("")},_buyDialogTpl:["<div>","\u6B63\u5728\u8D2D\u4E70","</div>"].join(""),_tdouTipResultTpl:['\u606D\u559C\u4F60\u6361\u5230<span class="got_tdou">#{username}</span>\u6492\u843D\u7684<span class="got_tdou">#{score}</span>T\u8C46'],_tdouTipTpl:['<div class="get_tdou_tip">','<p class="result">#{text}</p>',"#{banner}",'<div class="btn_wrap">','<a href="#{button_link}" locate="\u70DF\u82B1\u5E7F\u544A\u6309\u94AE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="ui_btn ui_btn_m button_link j_firework_attention_btn">',"<span><em>#{button_txt}</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_sub_m j_close_btn">',"<span><em>#{close_txt}</em></span>","</a>","</div>","</div>"].join(""),_tdouTipBannerTpl:['<a href="#{banner_link}" locate="\u70DF\u82B1\u5E7F\u544A\u56FE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="banner_link">','<img src="#{banner_src}" />',"</a>"].join(""),_tdouTipAttentionBannerTpl:['<p class="firework_attention_tip">\u5173\u6CE8\u672C\u5427\u548C\u6492\u94B1\u5927\u58D5\uFF0C\u4F1A\u66F4\u5BB9\u6613\u62A2\u5230\u8C46\u5B50\u54E6</p>'].join(""),_tdouErrorTipTpl:['<div class="get_tdou_tip">','<p class="result">#{text}</p>',"#{banner}",'<div class="btn_wrap">','<a href="#{button_link}" locate="\u70DF\u82B1\u5E7F\u544A\u6309\u94AE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="ui_btn ui_btn_m button_link j_firework_attention_btn">',"<span><em>#{button_txt}</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_m j_close_btn">',"<span><em>#{close_txt}</em></span>","</a>","</div>","</div>"].join(""),_fireworkRankTpl:["<table>",'<tr><td width="55">\u6392\u540D</td><td width="130">\u6635\u79F0</td><td>\u6B21\u6570</td></tr>',"<% for (var i = 0, len = rank.length; i < len; i++) { %>","<tr>","<td><%=i + 1%></td>",'<td><a data-field="<%=$.json.encode({un: rank[i][\'user_name\']})%>" href="/home/main?id=<%=rank[i][\'portrait\']%>" target="_blank"><%=rank[i]["user_name"]%></a></td>','<td><%=rank[i]["win"]%></td>',"</tr>","<% } %>","</table>"].join(""),initial:function(){},getDialogTpl:function(n){return this._dialogTpl[n]},getBuyDialogTpl:function(){return this._buyDialogTpl},getTdouTipTpl:function(){return this._tdouTipTpl},getTdouTipBannerTpl:function(){return this._tdouTipBannerTpl},getTdouTipAttentionBannerTpl:function(){return this._tdouTipAttentionBannerTpl},getTdouErrorTipTpl:function(){return this._tdouErrorTipTpl},getFireworkRankTpl:function(){return this._fireworkRankTpl}}});