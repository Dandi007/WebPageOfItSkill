_.Module.define({path:"common/widget/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",clazz:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=this._option.clazz,_=['<div class="ui_card_wrap '+e+'" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return _},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/flashLcs",requires:[],sub:{initial:function(n){this.options=$.extend({onMessage:function(){}},n),this.initFlash()},bindEvents:function(){},initFlash:function(){var n=!1,t="tblcs.baidu.com";n&&(t=$.tb.location.getHost().split(":")[0]);var o=this,s="http://tb2.bdstatic.com/tb/static-common/widget/flash_lcs/swf/tbLcs_eba73bf.swf";setTimeout(function(){o.communicator=new $.swf(s,{id:"tbLcsSwf",container:"#tbLcsContainer",width:1,height:1,vars:{callTarget:"msgFlashProxy",baiduid:"BAIDU_TIEBA_PC_LIVE_"+$.cookie("BAIDUID"),sbduss:PageData.lcs.sbduss,tabId:(new Date).getTime(),host:t}})},0);var i={log:function(n){try{$.debug&&window.console.log(n)}catch(t){}},onDisconnect:function(){this.log("onDisconnect")},onOnlineSuccess:function(){this.log("onOnlineSuccess")},onOnlineFail:function(){this.log("onOnlineFail")},onSocketConnect:function(){this.log("onSocketConnect")},autoOffLine:function(){this.log("autoOffLine")},onMessage:function(n){this.log("sendMessage",n),o.options.onMessage(n),o.communicator.remote("sendMessage",n)},onData:function(n){this.log("onData",n),this.log(n[n.length-1]),o.options.onMessage(n[n.length-1])},onNotify:function(){}};this.msgFlashProxy=i,window.msgFlashProxy=i}}});F.module("common/widget/eventCenter",function(){return $({})});_.Module.define({path:"common/widget/newMessageSystem",requires:["common/widget/flashLcs","common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85CF",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67E5\u770B\u79C1\u4FE1",unread_count:0,category_href:"http://msg.baidu.com/"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(){this.$el=$(".userbar .u_news");var e=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_menu_wrap u_news_wrap j_news" onclick="return false;"><span></span></a></div>'),t=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,e]);this.$newsTips=e.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(e);var a=baidu.template("u_notify",{portrait:PageData.user.portrait});t.innerContent("top",a),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread_num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){var e=this;e.use("common/widget/flashLcs",{onMessage:function(t){var a=t.ueg;e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a),e.eventCenter.trigger("sysmsg.upmsg",t)}})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,e.renderNotify(t,1),void 0):($.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.renderNotify(a,1),e.notifyData=a,e.setNotifyStorage(a))}),void 0)},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67E5\u770B\u56DE\u590D",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67E5\u770B@\u63D0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67E5\u770B\u597D\u53CB\u7533\u8BF7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67E5\u770B\u65B0\u7C89\u4E1D",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){a[e].category_href="/i/sys/jump?u="+PageData.user.portrait+t.category_href}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template("u_notify_item",{list:e})),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t),this.$newsTips.html(e),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var s=0,n=e.notifyData.length;n>s;s++){var r=e.notifyData[s];if(a.category_id==r.category_id){r.unread_count=parseInt(r.unread_count,10)-1,r.unread_count<0&&(r.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,s=t.content;a&&"undefined"!=typeof s&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(s,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(s.split(",")))}),TbCom.on("msgsystem_listencomplete",function(){}),TbCom.process("User","requestUserMessage",function(t){t&&(e.messageData[0].unread_count=t.msgnum,e.renderNotify(e.messageData,0))}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),s=a.tbattr("data-type");return"favts"===s?(e.clearFavNum(),void 0):(s&&TbCom.process("UserMessage","clearData",s),void 0)})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var s=t.messageData[5];s&&(s.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?(e.apply(t),void 0):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"common/widget/Userbar",requires:["DropDownList","common/widget/Card","common/widget/newMessageSystem"],sub:{_btns:{},_userinfo:null,$root:null,_logoutTimer:null,_product:null,_self:this,_urls:{itb_home:"",my_itb:"",my_club:"",u_split:"",my_space:""},_ddls:{itb:null,club:null,space:null},_userDataRended:{my_forum:!1,club:!1,space:!1},initial:function(t,i,e){i=i||"",TbCom.process("User","init",t,i),this._userinfo=t,this._product=i,this._buildLayout(e),TbCom.process("MsgSystem","init"),TbCom.process("UserMessage","init",i,e)},_bindEvent:function(t){t.delegate(".j_u_xiu8","click",function(){$.stats.track("\u70B9\u51FB\u7EDF\u8BA1","\u6211\u7684\u79C0\u573A")})},_initURLs:function(){this._urls.itb_st_param="st_mod=userbar&fr=tb0_"+this._product,this._urls.itb_home="/i/sys/jump?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":""),this._urls.my_favor=this._urls.itb_home+"&type=storethread&"+this._urls.itb_st_param,this._urls.itb_profile="/home/profile?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":"")},_buildLayout:function(t){var i=this,e="";-1!=$.inArray(this._product,["tbmall","livetool"])&&(e="userbar_theme2"),this.$root=$('<div id="com_userbar" class="userbar '+e+'"></div>');var a=$.getcurzIndex();(null==a||0>=a)&&(a=11e3),this.$root.css({"z-index":a});var s=$(t?t:"body");s.prepend(this.$root),this._btns.bdsearch=$('<a href="http://www.baidu.com">\u767E\u5EA6\u9996\u9875</a>'),this._btns.tbmall=$('<div class="u_menu_item u_menu_tbmall"><a class="u_menu_wrap u_tbmall_wrap" title="\u70B9\u51FB\u5230\u5546\u57CE\u8D2D\u4E70\u9053\u5177" href="http://tieba.baidu.com/tbmall/home" target="_blank"></a></div>'),this._btns.school=$('<a class="j_school" href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com/&school=1" target="_blank" style="color:red;">\u6821\u56ED\u7528\u6237\u6CE8\u518C\u901A\u9053</a>'),this._btns.app=$('<div class="u_menu_item u_menu_app"><a class="u_menu_wrap u_app_wrap" title="\u8D34\u5427\u624B\u673A\u5BA2\u6237\u7AEF" href="http://c.tieba.baidu.com/c/s/download/pc?src=webtbGF" target="_blank"></a></div>'),this._btns.baiduPrivilege=$('<div class="u_menu_item u_menu_baiduPrivilege"><a class="u_menu_wrap u_baiduPrivilege_wrap" href="http://tequan.baidu.com/?sc=tieba" title="\u767E\u5EA6\u7279\u6743" target="_blank"></a></div>'),this._btns.appcenterEntrance=$('<div class="u_menu_item u_menu_appcenterEntrance"><a class="u_menu_wrap u_appcenterEntrance_wrap" href="/f?kw=%D3%A6%D3%C3%D6%D0%D0%C4&fr=userbar" title="\u5E94\u7528\u4E2D\u5FC3" target="_blank">\u5E94\u7528\u4E2D\u5FC3</a></div>'),this._userinfo.is_login?(this._buildLoginLayout(),this._buildWallet(),this._buildNews(),i._buildOfflineCard(),TbCom.process("User","getUserInfoByRequest",function(t){i._initURLs(t),i._buildUsername(t),i._buildUSetting(t),i._buildJoinVip(t),i._buildToHome(t)})):(this._buildLogoutLayout(),this._buildJoinVip(),this._buildToHome()),this._bindEvent(s)},_buildLoginLayout:function(){var t=["<ul>",'<li id="j_u_username" class="u_username"></li>','<li class="u_setting"></li>','<li class="u_wallet"></li>','<li class="u_news"></li>','<li class="u_tbmall"></li> ','<li class="u_app"></li> <li class="split">|</li>','<li class="u_baiduPrivilege"></li> <li class="split">|</li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this.$root.html(t),this._btns.logout=$('<a href="#" >\u9000\u51FA</a>'),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_baiduPrivilege").append(this._btns.baiduPrivilege),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this.$root.find(".u_tshow").append(this._btns.tshow)},_buildLogoutLayout:function(){var t=["<ul>",'<li class="u_login"></li>','<li class="u_reg"></li>','<li class="u_tbmall"></li>','<li class="u_app"></li> <li class="split">|</li>','<li class="u_baiduPrivilege"></li> <li class="split">|</li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this._btns.reg=$('<a href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com?tb_mod=userBar&tb_fr=index" onclick="return false;" >\u6CE8\u518C</a>'),this._btns.login=$('<a href="#" onclick="return false;">\u767B\u5F55</a>'),this.$root.html(t),this.$root.find(".u_reg").append(this._btns.reg),this.$root.find(".u_login").append(this._btns.login),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_baiduPrivilege").append(this._btns.baiduPrivilege),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this._btns.reg.click(function(){TbCom.process("User","buildRegisterFrame","userBar")}),this._btns.login.click(function(){_.Module.use("common/widget/LoginDialog",["","userBar"])})},_buildUsername:function(t){var i=this.$root.find(".u_username"),e=$('<div class="u_menu_item u_menu_username"></div>'),a=t.name_weak,s="",n="";n=t.no_un?"https:/passport.baidu.com/v2/?ucenteradduname&u="+encodeURIComponent(location.href):"http://tieba.baidu.com/home/main?id="+t.portrait+"&fr=userbar";var r="";t.Parr_props&&t.Parr_props.level&&t.Parr_props.level.end_time>Env.server_time/1e3&&(r='style="color:#FF0000;"'),s='<img class="u_username_avatar" src="http://tb.himg.baidu.com/sys/portrait/item/'+t.portrait+'"/>',s='<a href="'+n+'" title="\u70B9\u51FB\u5230\u4E2A\u4EBA\u4E2D\u5FC3" class="u_menu_wrap u_username_wrap">'+s+'<span class="u_username_title" '+r+">"+a+"</span></a>",e.html(s),i.append(e);var l="";if(t.rt_room_id){var o="";for(var _ in t.rt_room_id)_&&(o=_);l='<li class="u_liveroom"><a href="/show/'+o+'" target="_blank">\u6211\u8981\u76F4\u64AD</a></li>'}var u='<ul><li class="u_itieba"><a href="/home/main?id='+t.portrait+'&fr=userbar" >\u6211\u7684\u8D34\u5427</a></li><li class="u_mytbmall"><a href="/tbmall/mymall" target="_blank">\u6211\u7684\u5546\u57CE</a></li><li class="u_favor" location="user_favor_ch"><a href="'+this._urls.my_favor+'" target="_blank">\u6211\u7684\u6536\u85CF</a></li><li class="u_pan"><a href="http://pan.baidu.com/" target="_blank">\u6211\u7684\u7F51\u76D8</a></li><li class="u_game"><a href="/game/index" target="_blank">\u6211\u7684\u6E38\u620F</a></li>'+l+'<li class="u_xiu8"><a class="j_u_xiu8"href="/f?ie=utf-8&kw=%E7%A7%80&fr=search" target="_blank">\u6211\u7684\u79C0\u573A</a></li></ul>',p=this._ddls.uname=this.use("DropDownList",i,e,"uname");p.innerContent("top",u)},_buildUSetting:function(t){var i=this,e=this.$root.find(".u_setting"),a=$('<div class="u_menu_item u_menu_setting"><a class="u_menu_wrap u_setting_wrap" href="#" onclick="return false;"></a></div>');e.append(a);var s=["<ul>",'<li><a href="http://passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0">\u5E10\u53F7\u8BBE\u7F6E</a></li>','<li class="u_tb_profile"><a href="',this._urls.itb_profile,'">\u8D34\u5427\u8BBE\u7F6E</a></li>','<li class="pm_center"><a href="http://tieba.baidu.com/pmc" class="j_pmc-center" target="_blank">\u670D\u52A1\u4E2D\u5FC3</a></li>','<li class="fuwu_center"><a href="http://tieba.baidu.com/helpcenter/index" class="j_help-center" target="_blank">\u5E2E\u52A9\u4E2D\u5FC3</a></li>','<li class="u_logout"></li>',"</ul>"].join(""),n=this._ddls.usetting=this.use("DropDownList",e,a);n.innerContent("top",s),$("body").on("click.helpcenter",".j_help-center",function(){$.stats.track("helpcenter","UEG-track-click","userbar","click")}),t.no_un&&e.find(".u_tb_profile a").click(function(){return TbCom.process("User","buildUnameFrame"),!1}),e.find(".u_logout").append(this._btns.logout),this._btns.logout.click(function(){i._logout()})},_buildWallet:function(){var t=this.$root.find(".u_wallet"),i=$('<div class="u_menu_item u_menu_wallet"><a class="u_menu_wrap u_wallet_wrap j_wallet" title="\u70B9\u51FB\u67E5\u770BT\u8C46\u8D26\u5355" href="#" onclick="return false;"></a></div>');t.append(i),t.find(".j_wallet").on("click",function(t){t.preventDefault(),_.Module.getInstance("common/widget/wallet_dialog",function(t){t.show()})})},_flowRateTest:function(){var t=window.open("");$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1",function(i){i.data&&(t.location.href=i.data)})},_buildJoinVip:function(t){var i=this,e=this.$root.find(".u_joinvip"),a=!1,s="\u4F1A\u5458\u5B98\u7F51";t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time>Env.server_time?(a=!0,s=(t.Parr_props.level.props_id>1?"\u7EED\u8D39\u8D85\u7EA7":"\u5347\u7EA7\u8D85\u7EA7")+"\u4F1A\u5458"):t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time<Env.server_time&&(a=!0,s="\u5F00\u901A\u4F1A\u5458");var n=$('<div class="u_menu_item u_menu_tshow"><a class="u_joinvip_wrap j_btn_getmember" href="javascript:;"  target="_blank">'+s+"</a></div>");e.append(n),e.find(".j_btn_getmember").on("click",function(){if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),!1;if(a)i._flowRateTest();else{window.open("/tbmall/tshow")}return!1})},_buildToHome:function(){var t=this.$root.find(".u_joinvip"),i="\u767E\u5EA6\u9996\u9875",e=$('<div class="u_menu_item j_u_menu_bd_home_link"><a  href="http://www.baidu.com?tn=SE_hldp03480_530ir7bs"  target="_blank">'+i+"</a></div>");t.append(e),t.on("click",".j_u_menu_bd_home_link",function(){$.stats.track("\u53EC\u5524\u5EA6\u5A18\u70B9\u51FB\u91CF","\u7528\u6237\u6761")})},_buildOfflineCard:function(){var t=this,i=1*new Date;i>1408032e6||$.tb.Storage.get("balv_tdou_update")>i||(t.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":1010,right:10,top:30},arrow_pos:{left:70,top:-8},wrap:$("#com_userbar"),card_leave_display:!0}),t.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),t.offline_card._j_card.remove()}),t.offline_card.showCard())},_buildNews:function(){this.use("common/widget/newMessageSystem")},_logout:function(){var t,i=0;try{t=PageData.user?PageData.user.name:PageData.user_info.name}catch(e){t=""}try{i="baidubrowser.tieba"==window.external.GetVersion("version")?!0:null}catch(e){i=null}(!$.cookie("baidu_broswer_setup_"+t)&&!i||"NaN"===$.cookie("baidu_broswer_setup_"+t))&&$.cookie("baidu_broswer_setup_"+t,0),TbCom.process("User","logout")}}}),_.Module.define({path:"common/widget/Userbar/DropDownList",requires:[],sub:{_ite:null,_wrapper:null,key:null,_listWrapper:null,_titWrapper:null,_conWrapper:null,_bottomConWrapper:null,_topConWrapper:null,initial:function(t,i,e){this._wrapper=t,this._ite=i,this.key=e,this._build()},_build:function(){var t=['<div class="u_ddl">','<div class="u_ddl_tit" ></div>','<div class="u_ddl_con">','<div class="u_ddl_con_top" ></div>','<div class="d_ddl_con_bottom"></div>',"</div>","</div>"].join("");this._listWrapper=$(t),this._wrapper.append(this._listWrapper),this._titWrapper=this._listWrapper.find(".u_ddl_tit:first"),this._conWrapper=this._listWrapper.find(".u_ddl_con:first"),this._topConWrapper=this._listWrapper.find(".u_ddl_con_top:first"),this._bottomConWrapper=this._listWrapper.find(".d_ddl_con_bottom:first"),this._bindEvents()},_bindEvents:function(){var t,i=this;i._wrapper.hover(function(){t&&clearTimeout(t),i.expand()},function(){t=setTimeout(function(){i.close()},0)})},_innerTopContent:function(t){"object"==typeof t?this._topConWrapper.append(t):"string"==typeof t&&this._topConWrapper.html(this._topConWrapper.html()+t)},_innerBottomContent:function(t){"object"==typeof t?this._bottomConWrapper.append(t):"string"==typeof t&&this._bottomConWrapper.html(this._bottomConWrapper.html()+t),this._bottomConWrapper.css("display","block")},expand:function(){this._ite.addClass("u_menu_hover");var t=this._ite.position();this._listWrapper.css({display:"block"});var i=this._ite.innerWidth();this.key&&"uname"==this.key&&(i=this._ite.find(".u_username_title").innerWidth());var e=this._conWrapper.width()-i;this._titWrapper.css({width:i,left:e+1}),e=t.left-e,this.key&&"uname"==this.key&&(e+=22),this._listWrapper.css({left:e})},close:function(){this._ite.removeClass("u_menu_hover"),this._listWrapper.css("display","none")},innerContent:function(t,i){"top"==t?this._innerTopContent(i):"bottom"==t&&this._innerBottomContent(i)}}});_.Module.define({path:"common/widget/footer",requires:[],sub:{initial:function(){this._handleEvents()},_handleEvents:function(){var i=$("#btnFroceToPad");i.bind("click",function(){$.cookie("tb_device",null),url=window.location.href.toString(),-1!==url.indexOf("kw")&&-1===url.indexOf("ie=utf-8")&&(url+=-1!==url.indexOf("?")?"&ie=utf-8":"?ie=utf-8"),window.location.href=url})}}});_.Module.define({path:"common/widget/poptip",sub:{_cookieKey:"poptip_0",initial:function(o){o=o||{};var e=$("#common_poptip_html").html(),i=/pv_code=.?(\d+).?/.exec(e);null!=i&&(this._cookieKey="poptip_"+i[1]),this._isShowed(this._cookieKey)||this._show(e,o)},_show:function(o,e){var i=this,t={content:o,arrow_dir:"up",bubble_css:{top:20,right:20,width:null!=e.width?e.width:228},arrow_pos:{right:15},wrap:$("body"),closeBtn:!0,arrowReq:!1},n=new UiBubbleTipBase(t);n.bind("onclose",function(){i._setShowed(i._cookieKey),n.closeBubble()}),n.showBubble()},_setShowed:function(o){$.cookie(o,1,{expires:30})},_isShowed:function(o){return null!=$.cookie(o)}}});_.Module.define({path:"common/widget/AdStats",sub:{adPositionConfig:[{locate:"\u53F3\u4E0A\u65B9button",locateClass:"#search_button",adId:"1"},{locate:"\u53F3\u4FA7\u56FE\u7247",locateClass:"#aside_ad .aside_ad_pic",adId:"2"},{locate:"\u5F39\u7A97",locateClass:"#pop_frame .pop_button_w",adId:"3"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E00",locateClass:".suggestion_list .item_top1",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E8C",locateClass:".suggestion_list .item_top2",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E09",locateClass:".suggestion_list .item_top3",adId:"4"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E00\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(0)",adId:"5"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(1)",adId:"6"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E09\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(2)",adId:"7"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E8C\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(1) a:eq(2)",adId:"8"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E09\u5E27",locateClass:"#carousel_wrap .img_list_1pic a",adId:"9"},{locate:"PC\u9996\u9875\u6735\u6735\u5947\u5427",locateClass:".rcmd_forum_list a",adId:"10"},{locate:"PC\u9996\u9875\u4E3B\u9898\u5427\u63A8\u8350",locateClass:".gr_f_list .good_forum",adId:"11"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5927\u5385\u8F6E\u64AD\u56FE",locateClass:".act_slider_area .good_act_page a",adId:"12"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5E73\u53F0\u63A8\u5E7F\u4F4D",locateClass:"#plat_act_wrapper .platact_lucky",adId:"13"},{locate:"PC\u9996\u9875\u70ED\u95E8\u52A8\u6001\u7B2C\u4E8C\u4F4D\u7F6E",locateClass:"",adId:"14"},{locate:"PC\u9996\u9875\u65B0\u589E\u5165\u9A7B",locateClass:".adide_platform a.pii_img_w, .adide_platform a.h6",adId:"15"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u56FE\u7247",locateClass:"#notice_item a.notice",adId:"16"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u5217\u8868",locateClass:"#notice_item .notice_list a",adId:"16"},{locate:"\u5427\u76AE\u80A4",locateClass:".couplet_left, .couplet_right",adId:"17"},{locate:"\u8D34\u5427\u9876\u90E8\u5934\u56FE",locateClass:".star_banner .j_click_status",adId:"18"},{locate:"\u8D34\u5427\u5DE6\u4FA7\u6D6E\u6807",locateClass:".j_platform_float_content",adId:"19"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6D3B\u52A8\u7EC4\u4EF6",locateClass:".platforum_aside_images .platform_aside_images_img a",adId:"20"},{locate:"\u8D34\u5427\u53F3\u4E0B\u65B9\u89C6\u9891\u7EC4\u4EF6",locateClass:".platform_spread_video a",adId:"21"},{locate:"\u8D34\u5427\u5BFC\u822A\u4E0A\u65B9\u5F3A\u63A8\u5E7F\u6837\u5F0F",locateClass:"",adId:"22"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6587\u5B57\u94FE/\u56FE\u7247\u805A\u5408\u6A21\u5757",locateClass:"",adId:"23"},{locate:"\u8D34\u5427feed\u6D41\u7279\u578B\u62BD\u5956\u8D34",locateClass:".threadlist_detail .platact_lucky",adId:"24"}],adObjType:"\u5E73\u53F0\u5316",adTask:"\u5546\u5E7F\u4F4D\u7EDF\u8BA1",initial:function(){var a=this.adPositionConfig,t=this.adObjType,l=this.adTask;$.each(a,function(){var a=this;this.locateClass&&this.locateClass.length>0&&$("body").on("mousedown",this.locateClass,function(){var e=$(this);$.stats.track(a.locate,l,null,"click",{obj_url:e.tbattr("href")||"-",obj_name:a.adId||"-",obj_type:t})})})}}});var Page={modules:{},checkLoadedModules:function(t){return this.modules[t]?!0:(this.modules[t]=!0,!1)},toQuerystring:function(t){var e="";for(var r in t)e+=r+"="+t[r]+"&";return e.substr(0,e.length-1)},isBaiduDomain:function(t){var e=/^((https:\/\/|http:\/\/|ftp:\/\/|rtsp:\/\/|mms:\/\/)(([0-9a-zA-Z\.\-\_]+\.baidu.com[:8090]*)|(baidu.com))\/)/;return e.test(t)},isAlbumImg:function(t){var e=/^http:\/\/[^\/\?]*?\.baidu\.com[:8090]*\/(\w+)\/([^\/\?]+)\/([^\/\?]+)\/(\w+?)\.(?:webp|jpg)/;return e.test(t)},resizePic:function(t,e,r,a){var n=e||120,i=r||120,s=!1,g=new Image;g.src=t.src;var o=Page.getRightWH(g.width,g.height,n,i);return t.style.width=o[0]+"px",t.style.height=o[1]+"px",t.style.visibility="visible",1==a&&(t.style.marginTop=(r-parseInt(o[1]))/2+"px"),g=null,s},getRightWH:function(t,e,r,a){var n=0,i=t,s=e;switch(t>r&&(n+=1),e>a&&(n+=2),n){case 1:i=r,i=e*r/t;case 2:s=a,i=t*a/e;case 3:s=e/a>t/r?a:e*r/t,i=e/a>t/r?t*a/e:r}return 0!=n&&(need_resize=!0),[i,s]},resizcImg:function(t,e){var r=!1,a=t;if(0==a.width){var n=this,i=arguments;return setTimeout(function(){i.callee.apply(n,i)},100),!1}a.width>e&&(r=!0);var s=Page.getImgRightWH(a.width,a.height,e);return t.style.width=s[0]+"px",t.style.height=s[1]+"px",t.style.visibility="visible",r},getImgRightWH:function(t,e,r){var a=t,n=e;return t>r&&(a=r,n=e*r/t),a=parseInt(a),n=parseInt(n),[a,n]},resetChangedSizeImage:function(t,e){if(t&&e&&"old"==t){if(Page.resizcImg(e,570)){var r=e;Page.isBaiduDomain(r.src)&&(r.style.cursor="pointer",r.title="\u70B9\u51FB\u67E5\u770B\u539F\u56FE",r.onclick=function(t){try{t||(t=window.event);var e=t.target||t.srcElement;NsLogLinker.isOutLink(e.src)&&NsLogLinker.stat(e.src,110),window.open(e.src,"_blank")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/util/util.js",method:"",ln:122}),t}})}return!0}},bindOpenImg:function(){var t,e,r,a,n,i=$("#j_p_postlist"),s=i.find(".j_d_post_content"),g=i.find(".BDE_Image");s.find(".BDE_Smiley[setCursor!=1]").each(function(){var t=$(this);t.width()>570&&t.width(570),t.tbattr("setCursor",1)}),s.find(".BDE_Smiley2[setCursor!=1]").each(function(){var t=$(this);t.width()>570&&t.width(570),t.tbattr("setCursor",1)});for(var o=$.browser.msie&&$.browser.version<=7,u=0,c=g.length;c>u;u++){var l=g[u];l&&(t=$(l),a=t.closest(".l_post"),n=a&&a.getData(),Page.isAlbumImg(l.src)&&"album_pb"!=PageData.pageType&&t.height()>=80&&t.width()>=80&&t.height()*t.width()>=1e4&&(t.click(function(t){try{var a=t.target||t.srcElement,n=1;e=$(a).tbattr("src");var i=$(a).closest(".l_post");i&&(postData=i.getData(),postData.author.user_name!=PageData.thread.author&&(n=0)),r=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."));var s=$(a).closest(".j_d_post_content").find("#j_pb_repost"),g="";if(0==s.length)g="http://tieba.baidu.com/photo/p?kw="+PageData.forum.name_url+"&flux=1&tid="+PageData.thread.thread_id+"&pic_id="+r+"&pn=1&fp=2&see_lz="+n;else{var o=s.getData();g="http://tieba.baidu.com/photo/p?kw="+o.fname+"&flux=1&tid="+o.tid+"&pic_id="+r+"&pn=1&fp=2&see_lz="+n}window.open(g,"_blank"),$.stats.sendRequest("fr=tb0_forum&st_mod=pb&st_type=album_pic&st_value=click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/util/util.js",method:"",ln:184}),t}}),o?$(l).css("cursor","pointer").tbattr("title","\u70B9\u51FB\u8FDB\u5165\u8FDE\u7EED\u770B\u56FE\u6A21\u5F0F"):$(l).css("cursor","url('http://tb2.bdstatic.com/tb/static-pb/img/cur_zin.cur'),pointer")))}},changeNumber:function(t,e){var r=PageData.curr_page_num,a=PageData.all_page_num;if("input"!=e.tagName&&"INPUT"!=e.tagName&&r>0&&a>=r){var n=0,i=PageData.thread_cur_url,s=/&pn=[^&]+/;return s.exec(i)&&(i=RegExp.leftContext+RegExp.rightContext),n=30*(r-1+t),n>=0&&30*(a-1)>=n&&$.tb.location.setHref(i+"&pn="+n),!0}return!1},changeVersion:function(t){var e=PageData.thread_cur_url,r=/&rs1=[^&]+/;r.exec(e)&&(e=RegExp.leftContext+RegExp.rightContext),$.tb.location.setHref(e+"&rs1="+t)},changeVersionPhp:function(t){var e=PageData.thread_cur_url,r=/&v=[^&]+/;r.exec(e)&&(e=RegExp.leftContext+RegExp.rightContext),$.tb.location.setHref(e+"&v="+t)},init:function(){Page.resetChangedSizeImage()},checkErrorImage:function(t){var e=t.parentNode;e.innerHTML="<br><img src='http://yourimgloaderroratbaidu' border='0'/>"},sign_change_img:function(t){t.src="http://tb2.bdstatic.com/tb/static-itieba/img/sign_err.png",t.width=100,t.height=25},login:function(){TbCom.process("User","buildLoginFrame")},isString:function(t){return"string"==typeof t},escapeHTML:function(t){return Page.isString(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):t},getByteLength:function(t){return t.replace(/[^\x00-\xff]/g,"mm").length},subByteFix:function(t,e,r){if(Page.getByteLength(t)<=e)return t;for(var a=Math.floor((e-2)/2),n=t.length;n>a;a++){var i=t.substring(0,a);if(Page.getByteLength(i)==e)return i+(r?r:"");if(Page.getByteLength(i)>e)return t.substring(0,--a)+(r?r:"")}return t}};Page.Date={},Page.Date.lang={},Page.Date.lang.dayNames=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],Page.Date.lang.abbreviatedDayNames=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],Page.Date.lang.shortestDayNames=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],Page.Date.lang.firstLetterDayNames=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],Page.Date.format=function(t,e){var r=t,a=function(t){return 10>t?"0"+t:t};return e.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?/g,function(t){switch(t){case"hh":return a(r.getHours()<13?0===r.getHours()?12:r.getHours():r.getHours()-12);case"h":return r.getHours()<13?0===r.getHours()?12:r.getHours():r.getHours()-12;case"HH":return a(r.getHours());case"H":return r.getHours();case"mm":return a(r.getMinutes());case"m":return r.getMinutes();case"ss":return a(r.getSeconds());case"s":return r.getSeconds();case"yyyy":var e="000"+r.getFullYear();return e.substring(e.length-4);case"yy":return r.toString("yyyy").substring(2);case"dddd":return Page.Date.lang.dayNames[r.getDay()];case"ddd":return Page.Date.lang.abbreviatedDayNames[r.getDay()];case"dd":return a(r.getDate());case"d":return r.getDate().toString();case"MM":return a(r.getMonth()+1);case"M":return r.getMonth()+1}})};_.Module.define({path:"common/widget/confSkin",sub:{conf:{},initial:function(t){this.conf=t,this.$wrap=$("body"),this.$wrap.addClass(t.bodyClass),parseInt(t.couplet.has_couplet)&&this.insertCouplet()},insertCouplet:function(){var t=this.conf.couplet.couplet_info,i=this.conf.isStar?" couplet_star":"",e=['<a href="'+t.url+'" class="j_couplet couplet_left'+i+'" title="'+t.url_title+'" target="_blank" style="background: url('+t.left_pic+') right center no-repeat;"></a>','<a href="'+t.url+'" class="j_couplet couplet_right'+i+'" title="'+t.url_title+'" target="_blank" style="background: url('+t.right_pic+') left center no-repeat;"></a>'].join("");this.$couplets=$(e).appendTo(this.$wrap),this.calWidth(),this.initCoupletEvent()},initCoupletEvent:function(){var t=this;$(window).on("resize",function(){t.calWidth()}),this.$couplets.click(function(){var i=$(this).hasClass("couplet_left")?"\u5DE6\u4FA7":"\u53F3\u4FA7";$.stats.track(i,"\u5427\u76AE\u80A4\u4E24\u4FA7\u5BF9\u8054","","",{skinid:t.conf.couplet.id})})},calWidth:function(){var t=$(window).width(),i=1380>t?(t-980)/2:200;this.$couplets.css("width",i)}}});_.Module.define({path:"common/widget/tbskin",sub:{initial:function(s){var i=["http://tb1",".bdstatic.com/tb/cms/common/tbskin/skins/skin_",s,".css?v=",PageUnit.load("tbskin_version")].join("");$('<link id="css_skin" href="'+i+'" rel="stylesheet">').appendTo("head"),$("body").addClass("skin_"+s)}}});_.Module.define({path:"common/widget/searchHandler",sub:{_staticUrl:{no_key:"http://tieba.baidu.com/","\u8D34\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u5E16\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new",tiebatousu:"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u5427":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u4E3E\u62A5":"http://tieba.baidu.com/tousu/new","\u77E5\u9053\u6295\u8BC9":"http://tousu.baidu.com/zhidao","\u7A7A\u95F4\u6295\u8BC9":"http://tousu.baidu.com/hi","\u767E\u79D1\u6295\u8BC9":"http://tousu.baidu.com/baike",zhidaotousu:"http://tousu.baidu.com/zhidao",kongjiantousu:"http://tousu.baidu.com/hi",baiketousu:"http://tousu.baidu.com/baike"},_sendStatistics:function(t){$.stats.sendRequest("st_mod=search&search_type="+t)},initial:function(){},toStaticUrl:function(t){var e=t.toLowerCase();return this._staticUrl.hasOwnProperty(e)?($.tb.location.setHref(this._staticUrl[e]),!1):void 0},enterBa:function(t,e){if(""==t)return $.tb.location.setHref(this._staticUrl.no_key),!1;this.toStaticUrl(t);var s=[];if(s=t.split(-1!=t.indexOf("\uFF1A")?"\uFF1A":":"),2==s.length){if("\u6807\u7B7E"==s[0])return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1;if(-1!=s[0].indexOf("\u5427\u5185")){var o=s[0].split("\u5427\u5185")[0];if(o)return this._sendStatistics("baneisearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(o))+"&qw="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1}}if(PageData.search_what&&"fromBtn"!=e){if("composite"==PageData.search_what)return this._sendStatistics("compositesearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1;if("forum"==PageData.search_what)return this._sendStatistics("forumsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1}return this._sendStatistics("enterba&from=search",t),$.tb.location.setHref("/f?ie=utf-8&kw="+encodeURIComponent(t)+"&fr=search"),!1},searchPost:function(t){return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("postsearch",t),setTimeout(function(){$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t)))},100),!1},searchPostInBa:function(t,e){var s="/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(e))+"&qw="+encodeURIComponent($.tb.escapeHTML(t));return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("baneisearch",t),setTimeout(function(){$.tb.location.setHref(s)},100),!1},searchPeople:function(t){return this._sendStatistics("peoplesearch",t),$.tb.location.setHref("/f/search/sure?ie=utf-8&only_user=1&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchTag:function(t){return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchForum:function(t){var e="/f/search/fm?ie=UTF-8&";return-1!=t.indexOf("\u6807\u7B7E\uFF1A")?(t=t.substr(t.indexOf("\u6807\u7B7E\uFF1A")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):-1!=t.indexOf("\u6807\u7B7E:")?(t=t.substr(t.indexOf("\u6807\u7B7E:")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):e=e+"qw="+encodeURIComponent($.tb.escapeHTML(t)),$.tb.location.setHref(e),!1}}});_.Module.define({path:"common/widget/suggestion",requires:["common/widget/suggestion/base"],sub:{options:{input:null,maxCount:12,skipTime:50,classes:{expand:"suggestion",expandList:"suggestion_list"}},initial:function(i){this.options=$.extend(this.options,i),this.initSug()},initSug:function(){this.options.input&&this.requireInstance("common/widget/suggestion/base",[this.options])}}});
;_.Module.define({path:"common/widget/suggestion/base",requires:["common/widget/suggestion/events"],sub:{runtime:{disabled:!1},initial:function(t){this.options=t,this.input=this.options.input,this.wrapper=this.options.fixWrapper,this.sug=null,this.dataList=[],this.create()},create:function(){var t=['<div class="#{expand}">','<ul class="#{expandList}">',"</ul>","</div>"].join(""),i=this.input,s=i.offset(),e=i.outerWidth()-2,n=i.outerHeight()+s.top-1,o=s.left,h=this.wrapper?this.wrapper:$("body");this.sug=$($.tb.format(t,this.options.classes)).css({left:o,width:e,top:n}).hide(),h.append(this.sug),this.ableControl(),this.bindEvents()},bindEvents:function(){this.requireInstance("common/widget/suggestion/events",[{input:this.input,sug:this.sug,options:this.options}])},ableControl:function(){var t=$('input.jointb[type="radio"]'),i=$('input.authortb[type="radio"]'),s=$('input.searchtb[type="radio"]');t.length>0&&t.bind("click",this.able()),i.length>0&&i.bind("click",this.able()),s.length>0&&s.bind("click",this.disable()),0!=t.length&&t.tbattr("checked")||this.disable()},able:function(){this.runtime.disabled=!1},disable:function(){this.runtime.disabled=!0,this.sug.hide()}}});
;_.Module.define({path:"common/widget/suggestion/events",requires:["common/widget/suggestion/data"],sub:{skippedType:["operation_title","often_forum_title","relation_forum_title","relation_game_title","more_title"],initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.wrapper=this.options.options.fixWrapper,this.skipTime=this.options.options.skipTime,this.target=null,this.toggleFlag=!1,this.mouseIn=!1,this.query="",this.bindEvents(),this.initRequest()},initRequest:function(){this.data=this.requireInstance("common/widget/suggestion/data",[{input:this.input,sug:this.sug,forumName:this.options.options.forumName,maxCount:this.options.options.maxCount}])},delayRequest:function(){return this.query=this.getQuery(),this.data.delayRequest(this.skipTime,this.query)},bindEvents:function(){if(this.options.searchFixed){var t=this.wrapper.offset().top,i=$(window).scrollTop();this.toggleFlag=t>i,this.fixSize(!0)}$(window).bind("scroll",$.proxy(this.fixSize,this)).bind("resize",$.proxy(this.fixSize,this)),this.input.bind("keyup",$.proxy(this.handleKeyup,this)).bind("keydown",$.proxy(this.handleKeydown,this)).bind("paste",$.proxy(this.handleElseEvents,this)).bind("focusin",$.proxy(this.handleElseEvents,this)).bind("click",$.proxy(this.handleElseEvents,this)).bind("focusout",$.proxy(this.handleFocusout,this)).bind("compositionend",$.proxy(this.handleElseEvents,this)),this.sug.on("mouseenter","li",$.proxy(this.handleMouseenter,this)).on("mouseleave","li",$.proxy(this.handleMouseleave,this)).on("click","li",$.proxy(this.handleFire,this))},handleKeyup:function(t){$.inArray(t.keyCode,[16,17,18,20,37,38,39,40])>=0||13!=t.keyCode&&this.delayRequest()},handleKeydown:function(t){if(!($.inArray(t.keyCode,[16,17,18,20,37,39])>=0))switch(t.keyCode){case 13:return this.handleFire();case 38:return this.prevActive(),!1;case 40:return this.nextActive(),!1;default:this.clearState()}},handleMouseenter:function(t){var i=$(t.currentTarget);this.mouseIn=!0,this.active(i)},handleMouseleave:function(){this.mouseIn=!1},handleFocusout:function(){this.mouseIn||(this.clearState(),this.sug.hide())},handleElseEvents:function(){this.delayRequest()},handleFire:function(){var t=this,i=this.input.getData();if(i&&i.sugUrl){this.clickStats(i);var e=setTimeout(function(){$.tb.location.setHref($.tb.unescapeHTML(i.sugUrl)),t.sug.hide(),clearTimeout(e),e=null},200);return!1}return!0},clickStats:function(t){var i=t.sugType;switch(i){case"game_item":this.clickGameStats(t);break;case"operation_item":this.clickOperationItemStats(t)}},clickGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u70B9\u51FB",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u6E38\u620F"})},clickOperationItemStats:function(t){$.stats.track(t.sugValue,"\u641C\u7D22\u6846\u8FD0\u8425\u914D\u7F6E\u9879\u7EDF\u8BA1","","click",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u5E73\u53F0\u5316"})},fixSize:function(t){var i=this;this.fixTime&&clearTimeout(this.fixTime),this.fixTime=setTimeout(function(){var e=i.wrapper.offset().top,s=$(window).scrollTop(),n=i.input,a=n.offset(),o=n.outerHeight()+a.top-1,u=n.outerWidth()-2,h=a.left;if(e>s===i.toggleFlag){if(!t)return}else i.toggleFlag=e>s,i.sug.hide();i.wrapper.hasClass("search_main_fixed")&&(o=n.outerHeight()+5),i.sug.css({width:u,left:h,top:o})},0)},changeState:function(t){var i=t.getData().sugType,e=t.getData().sugUrl,s=t.getData().sugValue;this.input.bindData({sugType:i,sugUrl:e,sugValue:s})},clearState:function(){this.input.bindData({})},active:function(t){var i=t.getData().sugType,e=this.skippedType.slice(0,-1);return $.inArray(i,e)>-1?void this.clearState():(this.target=t,this.addOn(t),void this.changeState(t))},nextActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.next().length?this.target.next():this.sug.find("ul li").eq(0);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.nextActive()):this.active(i)}},prevActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.prev().length?this.target.prev():this.sug.find("ul li").eq(-1);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.prevActive()):this.active(i)}},addOn:function(t){t.siblings("li").removeClass("on"),t.addClass("on")},getQuery:function(){return this.input.tbattr("value")},setQuery:function(t){return this.input.tbattr("value",t)}}});
;_.Module.define({path:"common/widget/suggestion/data",requires:["common/widget/suggestion/render"],sub:{settings:{url:"/suggestion",isCache:!0,defaultQuery:"DEFAULTQUERY"},initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.forumName=this.options.forumName,this.maxCount=this.options.maxCount||10,this.curCount=0,this.query="",this.dataList=[],this.cache={}},handleResponse:function(t,e){if(0!==e.error)return!1;this.curCount=0,this.query=t;var s=e.query_tips.search_data,i=e.query_match.search_data,a=e.query_tag.search_data,r=e.suggest_game&&e.suggest_game.search_data;this.checkData(s)&&(this.formatData("operation_title"),this.formatOperateData(s)),this.checkData(i)&&(this.checkData(s)&&this.formatData("often_forum_title"),this.formatForumData(i)),this.checkData(r)?(this.formatData("relation_game_title"),this.formatGameData(r)):this.checkData(a)&&(this.formatData("relation_forum_title"),this.formatForumData(a)),!this.checkData(i)&&!this.checkData(a)||this.checkMore(t)||this.formatData("more_title","/f/search/fm?ie=UTF-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),this.renderItems(),this.viewStats()},formatOperateData:function(t){var e,s;for(e=0;e<t.length&&5>e&&this.checkCount();e++)s=t[e],this.dataList.push({sugType:"operation_item",position:e+1,name:s.fname,desc:s.forum_desc,sugUrl:this.replaceAmp(s.forum_url)}),this.curCount++;this.dataList.push({sugType:"operation_item",str:'<li class="bdfengyun" ><a href = "http://top.baidu.com/?fr=bdtb">\u7531\u767E\u5EA6\u641C\u7D22\u98CE\u4E91\u699C\u63D0\u4F9B</a></li> '})},formatGameData:function(t){var e,s,i=[];for(e=0;e<t.length&&this.checkCount();e++)s=t[e],this.dataList.push({sugType:"game_item",name:s.game_name,title:this.highlightForumName(s.game_name),pic:s.icon_url,desc:s.description,sugUrl:s.link_href}),this.curCount++,i.push(s.game_name);i.length>0&&this.viewGameStats(i)},formatForumData:function(t){var e,s;for(e=0;e<t.length&&this.checkCount();e++)s=t[e],s.fname!==this.forumName&&(this.dataList.push({sugType:"forum_item",name:s.fname,title:this.highlightForumName(s.fname+"\u5427"),pic:s.fpic,desc:s.forum_desc?s.forum_desc:s.fclass2?"\u6240\u5C5E\u76EE\u5F55\uFF1A"+s.fclass1+"&nbsp; "+s.fclass2:"",member:s.member_num,thread:s.thread_num,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(s.fname))}),this.curCount++)},queryData:function(){var t=this.query;this.dataList.push({sugType:"reverse_query",name:t,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(t))})},formatData:function(t,e){var s=this.query;this.dataList.push({sugType:t,name:s,sugUrl:e})},getQuery:function(){return this.input.tbattr("value")},clearSuggestion:function(){this.dataList=[]},checkCount:function(){return this.curCount<this.maxCount},checkData:function(t){return $.isArray(t)&&t.length>0},checkMore:function(t){return!t||/^\s+$/.test(t)||t===this.forumName},replaceAmp:function(t){return t&&t.replace(/\&amp;/g,"&")},formatString:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},highlightForumName:function(t){var e="",s="",i=this.query,a=new RegExp(i.replace(/[\/\\]/g,""),"g");return e=$.tb.escapeHTML(t),s=i?e.replace(a,function(t){return'<em class="highlight">'+t+"</em>"}):e},renderItems:function(){var t="",e=this.requireInstance("common/widget/suggestion/render");this.dataList.length>0&&this.queryData(),t=e.renderSuggestion(this.dataList),""!==t?this.sug.show().find("ul").html(t):this.sug.hide(),this.clearSuggestion()},viewStats:function(){},viewGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u5C55\u73B0",{obj_name:this.query,obj_game_name:t,obj_type:"\u6E38\u620F"})},request:function(t){var e=this;t===this.forumName&&(t="");var s=""===t?this.settings.defaultQuery:t;this.settings.isCache&&s in this.cache?this.handleResponse(t,this.cache[s]):(this.queryRequest&&this.queryRequest.abort(),this.queryRequest=$.ajax({url:this.settings.url,data:{query:t,ie:"utf-8"},dataType:"json",type:"get",cache:!1,success:function(s){e.responseSuccess(t,s)}}))},delayRequest:function(t,e){var s=this;this.requestTimer&&clearTimeout(this.requestTimer),this.requestTimer=setTimeout(function(){s.request(e),clearTimeout(s.requestTimer),s.requestTimer=null},t)},responseSuccess:function(t,e){if(this.settings.isCache){var s=""===t?this.settings.defaultQuery:t;this.cache[s]=e}this.handleResponse(t,e),this.queryRequest=null}}});
;_.Module.define({path:"common/widget/suggestion/render",requires:[],sub:{queryTemplate:'<li class="reserve_query" #{info}></li>',titleTemplate:['<li class="break_title #{special}" #{info}>','<span class="break_tip">#{title}</span>',"</li>"].join(""),forumTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}','<span title="\u4F1A\u5458\u6570" class="forum_member">#{member}</span>','<span title="\u5E16\u5B50\u6570" class="forum_thread">#{thread}</span>',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),gameTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),operationTemplate:["<li #{info}>",'<div class="operation_item item_top#{position}">',"<i></i>",'<div class="operation_title">#{name}</div>','<div class="operation_desc">#{desc}</div>',"</div>","</li>"].join(""),initial:function(){},renderQuery:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.queryTemplate,{info:i})},renderTitle:function(e){var i="",t="",r=e.name,s=$.tb.dataField({sugType:e.sugType,sugValue:r,sugUrl:e.sugUrl});switch(e.sugType){case"operation_title":i="\u5927\u4F19\u6B63\u5728\u804A";break;case"often_forum_title":i="\u6700\u8FD1\u5E38\u901B\u7684\u5427\uFF1A";break;case"relation_forum_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u5427\uFF1A";break;case"relation_game_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u6E38\u620F\uFF1A";break;case"more_title":i='\u5728\u8D34\u5427\u4E2D\u641C\u7D22\u66F4\u591A\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u76F8\u5173\u7684\u5427",t="special_title"}return $.tb.format(this.titleTemplate,{info:s,special:t,title:i})},renderForum:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.forumTemplate,e)},renderGame:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl+"&gfr=search_suggestion"});return $.extend(e,{info:i}),$.tb.format(this.gameTemplate,e)},renderOperation:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.operationTemplate,e)},renderSuggestion:function(e){var i,t="",r=null,s=e.length;for(i=0;s>i;i++)switch(r=e[i],r.sugType){case"reverse_query":t+=this.renderQuery(r);break;case"operation_item":t+=r.str?r.str:this.renderOperation(r);break;case"forum_item":t+=this.renderForum(r);break;case"game_item":t+=this.renderGame(r);break;default:t+=this.renderTitle(r)}return t}}});_.Module.define({path:"common/widget/searchBright",requires:["common/widget/searchHandler","common/widget/suggestion"],sub:{_jq_wrap:null,_jq_input:null,_jq_input_box:null,_jq_form:null,_options:{defaultType:"tieba",style:"",forumName:"",page:null},_tip:null,_searchHandler:null,_switchRadios:{},_radioClasses:{tieba:"jointb",itieba:"authortb",post:"searchtb",benba:"nowtb",tag:"searchtag",forum:"searchforum"},_searchTypes:{tieba:1,itieba:2,post:3,benba:4,tag:5,forum:6},_searchFixed:null,initial:function(e,t){if(this._jq_wrap=e,this._jq_form=e.find(".j_search_form"),this._jq_input=e.find("#wd2"),this._jq_input_box=e.find(".j_search_input"),this._tip=PageUnit.load("search_input_tip"),this._searchFixed=t.searchFixed,this._searchWrapper=e.find(".search_main"),this._sugOn=t.sugOn,PageData.searchFixed=this._searchFixed,$.extend(this._options,t),this._initOptPage(),this._searchHandler=this.use("common/widget/searchHandler"),this._setSwitchRadios(),this._setDefaultType(),this._setSearchType(this._options.defaultType),this._initPlaceholder(),this._bindEvents(),$.browser.msie&&parseInt($.browser.version)<=7)return!1;if(this._searchScrollFixed(),"1"==this._sugOn){var t={input:this._jq_input_box,forumName:t.forumName,searchFixed:t.searchFixed,fixWrapper:this._searchWrapper};this.use("common/widget/suggestion",t)}else TbCom.process("Suggestion","createMainSearchSuggestion")},_setSwitchRadios:function(){var e=this;for(var t in this._searchTypes)this._switchRadios[t]=e._jq_wrap.find(".switch_radios ."+e._radioClasses[t]+":first")},_setDefaultType:function(){var e=$.tb.location.getHref();-1!=e.indexOf("/f/search/fm")?this._options.defaultType="forum":-1!=e.indexOf("/f/search/res")?this._options.defaultType="post":-1!=e.indexOf("/f/search/sure")&&(this._options.defaultType="itieba"),"bright_3"==this._options.style&&(this._options.defaultType="benba")},_getSearchType:function(){var e=null;if(this._options.theme&&"bright_pb"==this._options.theme)return e=this._searchTypes.benba;e=this._searchTypes.tieba;for(var t in this._switchRadios){var i=this._switchRadios[t];if(i.tbattr("checked")){e=this._searchTypes[t];break}}return e},_setSearchType:function(e){e in this._switchRadios&&("2"==this._searchTypes[e]&&this._switchRadios.tieba.tbattr("checked",!1),this._switchRadios[e].tbattr("checked",!0))},_bindEvents:function(){var e=this;this._jq_wrap.find("#search_button").on("click",function(){"frs"===PageData.product?$.stats.track("FRS_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"}):"pb"===PageData.product&&$.stats.track("PB_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"})}),this._jq_wrap.find(".j_search_nav a").click(function(){e._changeProduct($(this))}),this._jq_form.submit(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e.submit(),!1}),this._jq_wrap.find(".j_enter_ba").click(function(){return e.submit("fromBtn"),!1}),this._jq_wrap.find(".j_search_post").click(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e._searchPost(),!1}),this._jq_wrap.find(".j_benba_search").click(function(){"bright_pb"==e._options.theme&&e.handleSubmit(e._getSearchType(),e.getSearchWord())}),this._jq_input_box.bind("webkitspeechchange",function(){e.submit()}),$.browser.webkit?this._jq_input_box.click(function(){this.select()}):this._jq_input_box.focus(function(){this.select()})},submit:function(e){var t=this.getSearchWord();return $("#searchtag").tbattr("checked")?this._searchHandler.searchTag(t):this._searchHandler.enterBa(t,e),!1},handleSubmit:function(e,t){var i=!0;switch(e){case this._searchTypes.tieba:i=this._searchHandler.enterBa(t);break;case this._searchTypes.itieba:i=this._searchHandler.searchPeople(t);break;case this._searchTypes.post:i=this._searchHandler.searchPost(t);break;case this._searchTypes.benba:i=this._searchHandler.searchPostInBa(t,this._options.forumName);break;case this._searchTypes.tag:i=this._searchHandler.searchTag(t);break;case this._searchTypes.forum:i=this._searchHandler.searchForum(t);break;default:i=!0}return i},_initOptPage:function(){null==this._options.page&&(/^\w+:\/\/[^\/]+\/(index\.html?)|(i\/\d+)/.test($.tb.location.getHref())?this._options.page="index":/^\w+:\/\/[^\/]+\/tb\/picture\/(index\.html?)/.test($.tb.location.getHref())?this._options.page="picture_index":"itieba3"==PageData.product&&(this._options.page="itieba"))},_changeProduct:function(e){var t=this.getSearchWord(),i=$.tb.unescapeHTML(e.tbattr("href")),s=$.tb.unescapeHTML(e.tbattr("param"));if($.stats.track(e.text(),"pc\u7AEF\u8D34\u5427tab\u9875\u5BFC\u51FA\u7EDF\u8BA1",PageData?PageData.product:"","\u70B9\u51FB"),""==t){var a=i.match(/^(\w+:\/\/[^\/]+)/i),r=i.match(/fr=[^&]+/i),n=[],_="";null!=r&&r.length>0&&n.push(r[0]),n.length>0&&(_="/?"+n.join("&")),e.tbattr("href",a&&a[1]+_)}else if(null!=s&&""!=s){if(i.indexOf("www.baidu.com")>=0){var h="fr=tb01000&";$.tb.location.getHref().match("ftype=guide")&&(h="fr=tb01se0&");var o=i.indexOf("fr=");o>-1?e.tbattr("href",i.substring(0,index)+h):e.tbattr("href",i+h)}var c=e.tbattr("ie");t=null!=c&&null!=c.match(/utf-?8/gi)?encodeURIComponent(t):t.replace(/\%/gi,"%25").replace(/&/gi,"%26").replace(/\+/gi,"%2B").replace(/[\ \u3000]/gi,"%20").replace(/\//gi,"%2F").replace(/\#/gi,"%23").replace(/\=/gi,"%3D");var o=i.indexOf(s+"="),d="UTF-8"==PageData.charset?"&ie=utf-8":"";o>-1?e.tbattr("href",i.substring(0,o)+s+"="+t+d):e.tbattr("href",i+s+"="+t+d)}},_searchPost:function(){var e=this.getSearchWord(),t=$.extend({},this._options);t.defaultType="post",""==e?_.Module.use("common/widget/searchDialog",t):this._searchHandler.searchPost(e)},_initPlaceholder:function(){var e=this;$.inArray(e._options.page,["index","picture_index","itieba"])?"0"==e._tip&&_.Module.use("common/widget/Placeholder",[e._jq_input_box,e._tip,{color:"#bbb","font-size":"13px"}]):e._jq_input.bind("mousedown focus",function(){e._jq_input.val()===e._tip&&(e._jq_input.val(""),e._jq_input_box.val(""))})},_voiceInput:function(){var e=this.getSearchWord(),t=e.indexOf(this._tip);0===t&&(e=e.slice(this._tip.length),this._jq_input.val(e),this._jq_input_box.val(e)),this.submit()},getSearchWord:function(){return this._jq_input_box.val()},isDefaultTip:function(){return this._jq_input_box.val()===this._tip&&this._jq_input_box.hasClass("s_ipt_tip")||""===this._jq_input_box.val()},_searchScrollFixed:function(){if(this._searchFixed){var e=$("#head").find(".search_main"),t=$(".search_main").offset().top,i=$(".app_forum_top_nav").length>0?!0:!1;if(!i){var s=!1;$(window).scroll(function(){setTimeout(function(){var i=$(window).scrollTop();if(i>t){if(s)return;e.addClass("search_main_fixed").hide(),e.fadeIn(100),e.find(".search_form").addClass("search_form_fixed"),e.find(".search_ipt").addClass("search_ipt_fixed"),e.find(".search_btn").addClass("search_btn_fixed"),e.find(".search_btn_enter_ba").addClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").addClass("search_logo_fixed"),e.find("#tb_header_search_form").addClass("j_search_form_fixed"),$("#search_logo_small").addClass("search_logo_fixed"),$("#tb_header_search_form").addClass("j_search_form_fixed"),s=!0}else{if(!s)return;$(".senior-search-link").css({visibility:"visible"}),$("#search_baidu_promote").show(),$("#search_button_wrapper").show(),e.removeClass("search_main_fixed"),e.find(".search_form").removeClass("search_form_fixed"),e.find(".search_ipt").removeClass("search_ipt_fixed"),e.find(".search_btn").removeClass("search_btn_fixed"),e.find(".search_btn_enter_ba").removeClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").removeClass("search_logo_fixed"),e.find("#tb_header_search_form").removeClass("j_search_form_fixed"),s=!1}},1)})}}}}});_.Module.define({path:"encourage/widget/app_forum_top_nav",sub:{initial:function(e){this.page=e.page,this.fname=e.fname,this.wrapper=$(".app_forum_top_nav"),this.rememberLast(e),this.buildJoinVip(PageData.user),this.bindEvent(),this.autoFixed()},rememberLast:function(e){var t=$.json.decode($.tb.Storage.get("app_forum_last")),n=this.fname,o={};if(t){for(var a=0;a<t.length;a++)if(this.orSame(t[a].fname,n,e.recommend,e.category)){o=t[a];break}if(a<t.length){{var r=$('<li class="app_forum_top_nav_item app_forum_top_nav_tab "><a target="_blank" href="http://tieba.baidu.com/f?ie=utf-8&kw='+o.fname+'#app_forum_top"><img class="app_forum_top_nav_icon" src="'+o.icon+'" />'+o.fname+"</a></li>"),i=$(".app_forum_top_nav_tab_active");$(".app_forum_top_nav_tab")}i.length>0?r.insertAfter(i):$(".app_forum_top_nav_tab").length>0?r.insertAfter($(".app_forum_top_nav_tab").eq(0)):r.insertAfter($(".app_forum_top_nav_title"))}}else t=[{fname:n,icon:e.icon},{fname:n,icon:e.icon}];"\u5E94\u7528\u4E2D\u5FC3"!=e.fname&&(e.fname!=t[0].fname&&t.unshift({fname:e.fname,icon:e.icon}),t.length>2&&t.pop(),$.tb.Storage.set("app_forum_last",$.json.encode(t)))},orSame:function(e,t,n,o){if(e==t)return!1;for(var a in n)if(n[a].forum_name==e)return!1;for(a in o)if(o[a].forum_name==t||o[a].forum_name==e)return!1;return!0},autoFixed:function(){$(window).scrollTop($(".search_bright").height());var e=this.wrapper,t=e.offset().top+e.height(),n=this.wrapper.find(".enter_forum");n.find(".j_enter_form_input").val(this.fname);var o,a=this.wrapper.find(".j_join_vip"),r=!1,i=e.find(".app_forum_top_nav_tab").slice(5);return"pb_bright"==this.page?o="app_forum_top_nav_fixed_pb":"new_version"==this.page&&(o="app_forum_top_nav_fixed"),$(window).scroll(function(){if($(window).scrollTop()>t){if(1==r)return;r=!0,e.addClass(o).hide(),i.hide(),a.show(),n.show(),e.fadeIn(500)}else{if(0==r)return;r=!1,a.hide(),n.hide(),i.show(),e.removeClass(o)}}),!1},bindEvent:function(){var e=this,t=$(".app_forum_top_nav_content"),n=t.find("li"),o=t.find("li.app_forum_top_nav_recommend");t.on("click",".app_forum_top_nav_recommend a",function(){$.stats.track("\u6240\u5F00\u901A\u7684\u9876\u90E8\u5BFC\u822A("+o.index($(this).parent())+")","\u5BFC\u822A\u5E94\u7528\u5206\u53D1","frs","click")}),$(".app_forum_top_nav_tab_active").prev().find("a").css({background:"transparent"}),n.on("mouseover",function(){$(this).prev().find("a").css({backgroundPosition:"0 100px"})}).on("mouseout",function(){$(this).prev().find("a").css({backgroundPosition:"right 7px"})}),t.on("mouseover","li.app_forum_top_nav_tab",function(){$(this).hasClass("app_forum_top_nav_tab_active")||$(this).addClass("app_forum_top_nav_tab_hover ")}).on("mouseout","li.app_forum_top_nav_tab",function(){$(this).removeClass("app_forum_top_nav_tab_hover ")}),$(".j_enter_form_input").on("focus",function(){this.select()}),$(".j_enter_forum_form").submit(function(t){return e.jumpForum(),t.preventDefault(),!1})},jumpForum:function(){var e=$(".j_enter_form_input").val();console.log(e),window.open("http://tieba.baidu.com/f?kw="+e+"&ie=utf8")},buildJoinVip:function(e){var t=this,n=this.wrapper.find(".j_join_vip"),o=!1,a="\u4F1A\u5458\u5B98\u7F51";e&&e.Parr_props&&e.Parr_props.level&&1e3*e.Parr_props.level.end_time>Env.server_time?(o=!0,a=(e.Parr_props.level.props_id>1?"\u7EED\u8D39\u8D85\u7EA7":"\u5347\u7EA7\u8D85\u7EA7")+"\u4F1A\u5458"):e&&e.Parr_props&&e.Parr_props.level&&1e3*e.Parr_props.level.end_time<Env.server_time&&(o=!0,a="\u5F00\u901A\u4F1A\u5458"),n.html(a),n.on("click",function(){if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),!1;if(o)t._flowRateTest();else{window.open("/tbmall/tshow")}return!1})},_flowRateTest:function(){var e=window.open("");$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1",function(t){t.data&&(e.location.href=t.data)})}}});_.Module.define({path:"frs/widget/snowflow",sub:{createTimer:-1,checkTimer:-1,options:{},time1:0,time2:0,num:0,height:640,imgSrcArr:[],countCookieName:"snowflow_count",initial:function(t,e,r){try{if("frs"==e&&"rich_poster"==r)return;if($.cookie(this.countCookieName)>1e7)return;var i=$.browser.msie&&"6.0"==$.browser.version,o=PageUnit.load("snowflow_imgs");if(this.imgArray=o.trim().split("|"),this.len=this.imgArray.length,0==this.len||i)return;if(!this.isShoot(t))return;this.$root=$(".j_snowBox"),this.$root[0]||(this.$root=$('<div class="j_snowBox snowBox"></div>'),this.$root.appendTo($("body"))),this.initParentNode(),this.switchOpera(),this.loadImg(),this.setCookie()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"frs:widget/snowflow/snowflow.js",method:"",ln:40}),n}},setCookie:function(){var t=$.cookie(this.countCookieName);t?t++:t=1,$.cookie(this.countCookieName,t,{expires:1,path:"/"})},isShoot:function(t){var e,r,i;for(e=0;e<this.len;e++)if(r=this.imgArray[e].split("=="),r&&2==r.length&&(i=r[0],new RegExp(i).test(t)))return this.img=r[1],!0;return!1},loadImg:function(){var t=this;t.url=PageUnit.load("snowflow_url").trim();var e=new Image;e.src="http://tb1.bdstatic.com/tb/cms/snowflow/png/"+t.img+".png",t.imgSrcArr=new Array,t.imgSrcArr.push(e.src);var r=new Array,i=t.$root;e.onload=function(){t.imgSrcArr.push(e.src),t.snowStart(i,r,t.imgSrcArr)}},snowStart:function(t,e,r){var i=this;i.checkTimer=setInterval(function(){var o=0;o=parseInt(400*Math.random()),i.num<=20?i.createTimer=setTimeout(function(){i.num++,i.createSnow(t,e,r)},o):(clearInterval(i.createTimer),i.createTimer=-2)},200)},createSnow:function(t,e,r){var i=this,o=$("<i/>");i.url&&(o=$("<a/>"),o.tbattr("href",i.url),o.tbattr("target","_blank")),o.tbattr("class","snowflow_i");var n=$("<img/>"),s=Math.floor(Math.random()*r.length);n.tbattr("src",r[s]),o.append(n),o.css({left:parseInt(Math.random()*$(window).width()),top:0});parseInt(200*Math.random());e.push(o),t.append(o);var a=50,h=!0;1==Math.floor(2*Math.random())&&(h=!1),o.timer=setInterval(function(){o.stopped?(clearInterval(o.timer),o.remove()):i.fallDown(o,e,h)},a)},fallDown:function(t,e,r){var i=this;t.speed||(t.speed=Math.floor(16*Math.random())),t.speed<6&&(t.speed+=6);var o=parseInt(t.css("top")),n=parseInt(t.css("left"));if(-1==i.createTimer)return clearInterval(t.timer),void 0;var s=parseInt($(window).width())-50;if(n>=s||0>n||o>i.height)return t.css({display:"none"}),t.stopped=1,void 0;t.css("top",o+t.speed);var a=26,h=Math.sin(a);r||(h=-Math.sin(a)),o>20&&t.css("left",n+2*h)},windBlow:function(t){return parseInt(Math.random())%2==1?Math.sin(t/16):Math.cos(t/16)},switchOpera:function(){var t=this;$(".j_switch").on("click",function(){try{if(t.$root.html("").hide(),"\u5173\u95ED\u52A8\u753B"==$(this).html())$(this).html("\u6253\u5F00\u52A8\u753B"),-2!=t.checkTimer&&clearInterval(t.checkTimer),clearTimeout(t.createTimer),t.createTimer=-1,t.checkTimer=-1,t.num=0;else if("\u6253\u5F00\u52A8\u753B"==$(this).html()){$(this).html("\u5173\u95ED\u52A8\u753B");var e=t.$root,r=new Array;t.snowStart(e,r,t.imgSrcArr),e.show()}}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/snowflow/snowflow.js",method:"",ln:185}),i}})},initParentNode:function(){this.height=screen.height||this.height,this.$root.height(this.height)}}});_.Module.define({path:"comforum/widget/attentionCategoryGame",sub:{initial:function(t,n,e){this.reason=t,this.is_reply=n,this.likeData=e,this._requestData()},_requestData:function(){var t=this,n="/game/getFollowForum?second_class="+PageData.forum.second_class+"&forum_id="+PageData.forum.id;$.get(n).done(function(n){if(""!=n){var n=$.parseJSON(n);t._bindEvent(n)}else{var e=[{id:"752",name:"\u5927\u5929\u4F7F\u4E4B\u5251",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=842&pid=10400200842_879148",srcimg:{type_230_170:"http://tb1.bdstatic.com/tb/zt/tengfei/dts27-_130.jpg"},online:"13\u4E07"},{id:"123",name:"SD\u9AD8\u8FBE",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=752&pid=10400200752_879148",srcimg:{type_200_200:"http://tb1.bdstatic.com/tb/zt/tengfei/wd2.jpg"},online:"12\u4E07"},{id:"123",name:"\u821E\u52A8",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=530&pid=10400200530_879148",srcimg:{type_200_200:"http://tb1.bdstatic.com/tb/zt/tengfei/wd.jpg"},online:"10\u4E07"}];t._bindEvent(e)}}).fail(function(){})},_bindEvent:function(t){var n=this;n._trackData();var e=this._renderAttentionContent(n.reason,n.is_reply,n.likeData,t),i={title:"\u672C\u5427\u63A8\u8350",width:515,height:320},a=$.dialog.open(e,i);$(a.element[0]).find(".dialogJcontent").tbattr("id","attention-game-wraper_dialog"),$(a.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")}),$(a.element[0]).find(".attention_category_game_btn").eq(0).bind("click",function(){n._reloadAndGotop()}),a.bind("onclose",function(){n._reloadAndGotop()})},_renderAttentionContent:function(t,n,e,i){var a=['<div class="attention-game-wraper">','<div class="attention-game-header">',"<p>\u5BA2\u5B98\uFF0C\u4E0B\u9762\u662F\u5C0F\u8D34\u8D34\u4E3A\u60A8\u5949\u4E0A\u672C\u5427\u4E13\u5C5E\u6E38\u620F\uFF0C\u8BF7\u7B11\u7EB3\uFF01</p>","</div>",'<div class="attention-game-content">','<div class="primary-attention-game">','<div class="primary-attention-game-inner">',"<h3>"+i[0].name+"\uFF0C\u8D34\u5427\u4E13\u5C5E\u798F\u5229</h3>",'<div class="primary-attention-game-content">','<img class="primary-attention-game-img" src="'+i[0].srcimg.type_230_170+'">','<div class="over-layer">','<a href="'+i[0].link+'&gfr=attention" target="_blank" class="button">\u7ACB\u5373\u53BB\u73A9</a>',"</div>","</div>","</div>","</div>",'<div class="secondary-attention-game">','<div class="secondary-attention-game-inner">','<h3>\u5176\u4ED6\u5427\u53CB\u8FD8\u73A9<span class="attention-more-game"><a href="http://tieba.baidu.com/game/index" target="_blank">\u67E5\u770B\u66F4\u591A\u6E38\u620F</a></span></h3>','<div class="secondary-attention-game-content">','<div class="attention-game-item clearfix">','<img class="attention-game-item-img" src="'+i[1].srcimg.type_200_200+'">','<div class="attention-game-info">',"<p>"+i[1].name+"</p>","<p>"+i[1].online+"\u5427\u53CB\u5728\u73A9</p>",'<p><a  class="j_item1 button" href="'+i[1].link+'&gfr=attention" target="_blank">\u53BB\u770B\u770B</a></p>',"</div>","</div>",'<div class="attention-game-item clearfix">','<img class="attention-game-item-img" src="'+i[2].srcimg.type_200_200+'">','<div class="attention-game-info">',"<p>"+i[2].name+"</p>","<p>"+i[2].online+"\u5427\u53CB\u5728\u73A9</p>",'<p><a href="'+i[2].link+'&gfr=attention" target="_blank"  class="j_item2 button">\u53BB\u770B\u770B</a></p>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"];return a.join("")},_trackData:function(){$.stats.track("\u6E38\u620F\u7C7B\u76EE\u5427\u5173\u6CE8","\u6E38\u620F\u6D6E\u5C42",null,"view",{obj_type:"\u6E38\u620F"}),$("body").on("click",".primary-attention-game-content button",function(){$.stats.track("\u6E38\u620F\u6D6E\u5C42\u5DE6\u4E00","\u6E38\u620F\u6D6E\u5C42",null,"click",{obj_type:"\u6E38\u620F"})}),$("body").on("click",".j_item1",function(){$.stats.track("\u6E38\u620F\u6D6E\u5C42\u53F3\u4E00","\u6E38\u620F\u6D6E\u5C42",null,"click",{obj_type:"\u6E38\u620F"})}),$("body").on("click",".j_item2",function(){$.stats.track("\u6E38\u620F\u6D6E\u5C42\u53F3\u4E8C","\u6E38\u620F\u6D6E\u5C42",null,"click",{obj_type:"\u6E38\u620F"})})},_reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])}}});_.Module.define({path:"common/widget/ScrollPanel",sub:{dom:null,$content:null,$scrollBar:null,$scrollButton:null,_hasScroll:!1,_scrollStep:50,_scrollTop:0,_maxHeight:0,initial:function(t){this._buildUI(t),this._bindEvents(t),$(t.container).append(this.dom),this.setHeight(t.height||100),t.content&&this.setContent(t.content),t.scrollBarShow&&this.bind("onScrollBarShow",t.scrollBarShow),t.scrollBarHide&&this.bind("onScrollBarHide",t.scrollBarHide)},_buildUI:function(t){this.dom=$('<div class="tbui_scroll_panel"></div>'),this.dom.html(['<div class="tbui_panel_content j_panel_content clearfix"><ul></ul></div>','<div class="tbui_scroll_bar j_scroll_bar">','<div class="tbui_scroll_button j_scroll_button">&nbsp;</div>',"</div>"].join("")),this.$content=this.dom.find(".j_panel_content:first"),this.$scrollBar=this.dom.find(".j_scroll_bar:first"),this.$scrollButton=this.dom.find(".j_scroll_button:first"),t.padding&&this.$content.css("padding",t.padding)},_bindEvents:function(){var t=this,o=t.$content.get(0);this.$scrollButton.on("drag",function(i,l){if(l){var s=l.position;o.scrollTop=s.top/t.$content.height()*o.scrollHeight}}),this.$content.mousewheel(function(o,i){o.preventDefault(),o.stopPropagation(),t._hasScroll&&t.scrollTopTo(t._scrollTop-i*t._scrollStep)})},scrollTopTo:function(t){var o=this,i=o.$content.get(0),t=Math.max(Math.min(t,i.scrollHeight-o.$content.height()),0);t!=o._scrollTop&&(o._scrollTop=t,o.$content.stop(),o.$content.scrollTop(o._scrollTop),o._resizeScroll())},setHeight:function(t){this._maxHeight=t,this._resizeHeight(),this._resizeScroll(),this.$scrollButton.draggable({containment:"parent"})},setContent:function(t){this.$content.html(t),this.$content.get(0).scrollTop=this._scrollTop=0,this._resizeHeight(),this._resizeScroll()},appendContent:function(t){this.$content.append(t),this._resizeHeight(),this.scrollTopTo(2e4)},clearContent:function(){this.setContent("")},_resizeHeight:function(){this.$content.css("height","");var t=this.$content.get(0),o=t.scrollHeight,i=Math.min(o,this._maxHeight);this.$content.css("height",i)},_resizeScroll:function(){var t=this.$content.get(0),o=t.scrollHeight,i=t.scrollTop,l=this.$content.innerHeight();l>=o?(this.$scrollBar.hide(),this.dom.addClass("tbui_no_scroll_bar"),this.trigger("onScrollBarHide"),this._hasScroll=!1):(this.$scrollBar.show(),this.$scrollBar.height(l),this.$scrollButton.height(l/o*l),this.$scrollButton.css("top",i/o*l),this.trigger("onScrollBarShow"),this._hasScroll=!0)}}});_.Module.define({path:"common/component/Captcha",requires:[],sub:{ERROR_MESSAGES:{38:"\u9A8C\u8BC1\u7801\u8F93\u5165\u8D85\u65F6\uFF0C\u8BF7\u60A8\u91CD\u65B0\u8F93\u5165",37:"\u9A8C\u8BC1\u7801\u8F93\u5165\u5931\u6548\uFF0C\u8BF7\u60A8\u91CD\u65B0\u8F93\u5165",40:"\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u91CD\u65B0\u8F93\u5165"},DEFAULT_OPTIONS:{imgUrl:"/cgi-bin/genimg?",audioUrl:"/cgi-bin/genaudio?",checkUrl:"/f/commit/commonapi/checkVcode",vCodeUrl:"/f/commit/commonapi/getVcode",inputFocusClass:"c_captcha_focus",postType:"thread",isAnonymous:!1,template:'<div class="tbui_captcha_component tbui_captcha_normal"><div class="tbui_captcha_tip j_captcha_tip"></div><div><span class="tbui_captcha_title">\u9A8C\u8BC1\u7801</span><span class="tbui_captcha_input_wrap"><input autocomplete="off" size="10" maxlength="4" class="j_captcha_input" ><span class="tbui_captcha_status j_captcha_status"></span></span><span class="j_captcha_content"><span class="tbui_captcha_img_wrap j_captcha_img_wrapper"></span><span class="tbui_captcha_buttons"><a class="j_captcha_img_change">\u770B\u4E0D\u6E05?</a>&nbsp;<a class="c_captcha_a_audio j_captcha_audio_switch" >\u6536\u542C\u9A8C\u8BC1\u7801</a></span><span><img class="j_captcha_audio_icon" src="http://tieba.baidu.com/tb/img/audio.gif" style="display:none;" /><span class="j_captcha_audio_wrapper"></span></span></span></div><div class="tbui_captcha_error j_captcha_err"></div><div class="tbui_captcha_info j_captcha_info"></div></div>',gridTemplate:'<div class="tbui_captcha_component tbui_captcha_grid"><div class="tbui_captcha_tip j_captcha_tip"></div><div class="tbui_captcha_grid_head clearfix"><div class="tbui_captcha_title">\u9A8C\u8BC1\u7801</div><div class="tbui_captcha_input_wrap"><div class="j_captcha_input tbui_captcha_grid_input"><div></div><div></div><div></div><div></div><div class="tbui_captcha_backspace j_captcha_backspace"></div></div><div class="tbui_captcha_status j_captcha_status"></div></div></div><div class="tbui_captcha_grid_content"><div><span class="tbui_captcha_img_wrap j_captcha_img_wrapper"></span><span class="tbui_captcha_buttons"><a class="j_captcha_img_change">\u770B\u4E0D\u6E05?</a></span></div><div class="tbui_captcha_error j_captcha_err"></div><div class="tbui_captcha_help j_captcha_help">\u70B9\u51FB\u6846\u5185\u6587\u5B57\u8F93\u5165\u4E0A\u56FE\u4E2D<span class="ui_text_emphasize">\u6C49\u5B57\u6216\u62FC\u97F3</span>\u5BF9\u5E94\u6C49\u5B57</div><div class="tbui_captcha_grid_buttons clearfix j_captcha_buttons"><a href="#" tabindex="0"><div class="tbui_captcha_btn_0"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_1"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_2"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_3"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_4"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_5"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_6"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_7"></div></a><a href="#" tabindex="0"><div class="tbui_captcha_btn_8"></div></a></div><div class="tbui_captcha_info j_captcha_info"></div></div></div>'},gridStyleSheetTpl:".tbui_captcha_grid_input div, .tbui_captcha_grid_content .tbui_captcha_img_wrap, .tbui_captcha_grid_buttons div {background: url('#{imgSrc}') -500px -500px no-repeat;}",gridPosition:{0:"-3px -41px",1:"-56px -41px",2:"-100px -41px",3:"-3px -90px",4:"-56px -90px",5:"-100px -90px",6:"-3px -138px",7:"-56px -138px",8:"-100px -138px"},gridKeyMap:{0:"00000000",1:"00010000",2:"00020000",3:"00000001",4:"00010001",5:"00020001",6:"00000002",7:"00010002",8:"00020002"},initial:function(t){$.browser.msie&&6==$.browser.version&&document.execCommand("BackgroundImageCache",!1,!0);var a=this;this.options=t,this.options=$.extend({},this.DEFAULT_OPTIONS,t),this.$container=$(this.options.container);var i;i=4==t.vCodeType?$(this.options.gridTemplate):$(this.options.template),this.$input=i.find(".j_captcha_input"),this.$tip=i.find(".j_captcha_tip"),this.$error=i.find(".j_captcha_err"),this.$status=i.find(".j_captcha_status"),this.$imgWrapper=i.find(".j_captcha_img_wrapper"),this.$imgChangeBtn=i.find(".j_captcha_img_change"),this.$switchAudioBtn=i.find(".j_captcha_audio_switch"),this.$info=i.find(".j_captcha_info"),this.$imgChangeBtn.add(this.$imgWrapper).click(function(){return a.reloadCaptchaImg(),!1}),4==t.vCodeType?this._initGridCaptcha(i):this._initNormalCaptcha(i),this.options.message&&this.setTip(this.options.message),this.updateCaptchaImg(this.options.vCode,this.options.vCodeType),this.options.exceptionalAccount&&this.$tip.html('\u60A8\u5728\u5168\u5427\u53D1\u8D34\u65F6\u4F1A\u9047\u5230\u9A8C\u8BC1\u7801\uFF0C<a target="_blank" href="http://tieba.baidu.com/pmc/main" class="ui_text_link">\u70B9\u51FB\u89E3\u9664</a>'),this.$container.append(i),this.$root=i},_initNormalCaptcha:function(t){var a=this;this.$audioIcon=t.find(".j_captcha_audio_icon"),this.$audioWrapper=t.find(".j_captcha_audio_wrapper"),this.$switchAudioBtn.click(function(){return a.loadAudio(),!1}),this.$input.focus(function(){$(this).addClass(a.options.inputFocusClass)}).blur(function(){$(this).removeClass(a.options.inputFocusClass)}).keyup(function(t){13==t.which?a.trigger("captcha_submit"):1==a.vCodeType?/^[\u4e00-\u9fa5]+$/.test(this.value)&&4==this.value.length&&a.checkCaptcha():4==this.value.length?a.checkCaptcha():a.getStatus()&&a.setStatus(!1)})},_initGridCaptcha:function(t){var a=this;a.$help=t.find(".j_captcha_help"),a.inputValue="",a.$inputGrid=a.$input.children(),t.find(".j_captcha_backspace").click(function(){a.backspace()}),t.find(".j_captcha_buttons").on("click","a",function(t){t.preventDefault(),t.stopPropagation();var i=a.inputValue.length;if(4>i){var s=$(this),c=s.index();a.$inputGrid.eq(i).css("background-position",a.gridPosition[c]),a.inputValue+=c,4==a.inputValue.length&&a.checkCaptcha(function(t){0===t.anti_valve_err_no?setTimeout(function(){a.trigger("captcha_submit")},500):4==a.vCodeType&&a.reloadCaptchaImg()})}}),t.keydown(function(t){return t.preventDefault(),t.stopPropagation(),8==t.which&&a.backspace(),!1}),t.keyup(function(t){return t.preventDefault(),t.stopPropagation(),!1}),t.keypress(function(t){return t.preventDefault(),t.stopPropagation(),!1})},getVCode:function(){return this.vCode},getVCodeType:function(){return this.vCodeType},setVCodeType:function(t){this.vCodeType=t,0!=t?this.$switchAudioBtn.hide():this.$switchAudioBtn.show()},setStatus:function(t){this.isValid=t,t?(this.$status.addClass("tbui_captcha_correct"),this.setError("")):t===!1?this.$status.removeClass("tbui_captcha_correct"):(this.$status.removeClass("tbui_captcha_correct"),this.setError(""))},getStatus:function(){return this.isValid},setTip:function(t){this.$tip.text(t)},setError:function(t){4==this.vCodeType&&(""==t?(this.$error.hide(),this.$help.show()):(this.$help.hide(),this.$error.show())),this.$error.text(t)},updateCaptchaImg:function(t,a){this.setStatus(void 0),a&&this.setVCodeType(a),this.vCode=t,4==this.vCodeType?this._updateGridCaptchaImg():this._updateNormalCaptchaImg()},_updateNormalCaptchaImg:function(){this.$input.val("").focus();var t=this.options.imgUrl+this.vCode+"&t="+Math.random();this.$img?this.$img.tbattr("src",t):this.$img=$('<img src="'+t+'" />').appendTo(this.$imgWrapper)},_updateGridCaptchaImg:function(){this.inputValue="",this.$inputGrid.each(function(){$(this).tbattr("style","")});var t=this.options.imgUrl+this.vCode+"&tag=pc&t="+Math.random();this.captchaStyleSheet||(this.captchaStyleSheet=$("<style type='text/css'></style>").appendTo("head")[0]);var a=$.tb.format(this.gridStyleSheetTpl,{imgSrc:t});this.captchaStyleSheet.styleSheet?this.captchaStyleSheet.styleSheet.cssText=a:this.captchaStyleSheet.innerHTML=a},reloadCaptchaImg:function(t){t=t||{};var a=this,i=this.options.paramsCallback?this.options.paramsCallback():{};$.extend(i,{lm:this.options.forumId,word:this.options.forumName,rs10:"thread"==this.options.postType?"1":"0",rs1:this.options.isAnonymous?"1":"0",t:Math.random()}),4==this.vCodeType&&(i.tag=11),$.ajax({url:a.options.vCodeUrl,data:i,success:function(i){i.need_vcode?4==i.captcha_code_type&&4!=a.vCodeType||4!=i.captcha_code_type&&4==a.vCodeType?a.trigger("captcha_type_change",i.captcha_vcode_str,i.captcha_code_type):(a.setTip(i.str_reason),a.setError(t.error||""),a.updateCaptchaImg(i.captcha_vcode_str,i.captcha_code_type)):console.log("Captcha#reloadCaptchaImg: \u7406\u8BBA\u4E0A\u4E0D\u5E94\u8BE5\u770B\u5230\u8BE5\u5206\u652F"),t.success&&t.success.call(this)},type:"post",dataType:"json"})},loadAudio:function(){this.$audioIcon.show();var t=this.options.audioUrl+this.vCode+"&t="+Math.random();document.all?this.$audioWrapper.html('<object height=0 width=0 classid=CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6><param name="AutoStart" value="1"><param NAME="url" value="'+t+'"><param name="PlayCount" value="1">'):this.$audioWrapper.html('<embed src="'+t+'" name="MediaPlayer" type="video/x-ms-wmv" autostart="1" showcontrols="1" allowscan="1" playcount="1" enablecontextmenu="0" height="0" width="0"></object>'),this.$input.focus()},checkCaptcha:function(t){var a=this,i={captcha_vcode_str:this.vCode,captcha_code_type:this.vCodeType,captcha_input_str:this.getInputValue(),fid:this.options.forumId};$.post(this.options.checkUrl,i,function(i){0===i.anti_valve_err_no?a.setStatus(!0):null===i.anti_valve_err_no||""===i.anti_valve_err_no?a.setStatus(void 0):(a.setStatus(!1),a.setError(a.ERROR_MESSAGES[i.anti_valve_err_no]),37==i.anti_valve_err_no&&a.reloadCaptchaImg({error:a.ERROR_MESSAGES[37]})),t&&t(i)},"json")},validate:function(){return 0==this.getInputValue().length?(this.setError("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"),this.focus(),!1):this.isValid||void 0===this.isValid},backspace:function(){if(4==this.vCodeType){var t=this.inputValue.length;this.$inputGrid.eq(t-1).tbattr("style",""),this.inputValue=this.inputValue.substring(0,t-1)}},getInputValue:function(){if(4==this.vCodeType){for(var t=this.inputValue.split(""),a=[],i=0,s=t.length;s>i;i++)a.push(this.gridKeyMap[t[i]]);return a.join("")}return this.$input.val().replace(/\s/g,"")},focus:function(){this.$input.focus()},clear:function(){this.$input.val("")},show:function(){this.$root.show()},hide:function(){this.$root.hide()}}});_.Module.define({path:"common/component/CaptchaDialog",requires:["common/component/Captcha"],sub:{template:["<div class='tbui_captcha_dialog'>","<div class='tbui_captcha_container'></div>",'<div class="j_button_bar"><a href="#" class="ui_btn ui_btn_m j_ok"><span><em>\u786E \u5B9A</em></span></a></div>',"</div>"].join(""),initial:function(t){var a,i=this,c=$(this.template);this.$content=c;var h=t.title||"\u53D1\u8868\u8D34\u5B50",n="undefined"==typeof t.modal?!0:t.modal;this.options=t,t.container=c.find(".tbui_captcha_container"),this.normalCaptcha=null,this.gridCaptcha=null,this.captcha=this._initCaptchaInstance(t);var e=540;4==t.vCodeType?(e=360,this.gridCaptcha=this.captcha):this.normalCaptcha=this.captcha,a=new $.dialog({title:h,width:e,html:c,modal:n});var o=c.find(".j_ok").click(function(t){t.preventDefault(),t.stopPropagation(),i.accept()});4==t.vCodeType&&o.detach(),this.$okButton=o,this.dialog=a},_initCaptchaInstance:function(t){var a=this,i=this.use("common/component/Captcha",t);return i.bind("captcha_submit",function(){a.accept()}),i.bind("captcha_type_change",function(t,i,c){a.updateCaptchaImg(i,c)}),i},bind:function(){this.dialog.bind.apply(this.dialog,arguments)},show:function(){this.dialog.show(),this.captcha.focus()},hide:function(){this.dialog.hide()},getInputValue:function(){return this.captcha.getInputValue()},setTip:function(t){this.options.message=t,this.captcha.setTip(t)},getVCode:function(){return this.captcha.getVCode()},getVCodeType:function(){return this.captcha.getVCodeType()},updateCaptchaImg:function(t,a){4==a&&a!=this.captcha.getVCodeType()?(null==this.gridCaptcha?this.gridCaptcha=this._initCaptchaInstance($.extend(this.options,{vCode:t,vCodeType:a})):this.gridCaptcha.updateCaptchaImg(t,a),this.captcha.hide(),this.gridCaptcha.show(),this.$okButton.detach(),this.captcha=this.gridCaptcha,this.dialog.width(360)):4!=a&&4==this.captcha.getVCodeType()?(null==this.normalCaptcha?this.normalCaptcha=this._initCaptchaInstance($.extend(this.options,{vCode:t,vCodeType:a})):this.normalCaptcha.updateCaptchaImg(t,a),this.captcha.hide(),this.normalCaptcha.show(),this.$content.find(".j_button_bar").append(this.$okButton),this.captcha=this.normalCaptcha,this.dialog.width(540)):this.captcha.updateCaptchaImg(t,a)},reloadCaptchaImg:function(t){this.captcha.reloadCaptchaImg(t)},focus:function(){this.captcha.focus()},clear:function(){this.captcha.clear()},accept:function(){this.captcha.validate()&&(this.dialog.hide(),this.dialog.triggerHandler("onaccept"))}}});_.Module.define({path:"tbmall/component/captcha_payment",requires:["common/component/CaptchaDialog"],sub:{initial:function(a){this.reCommitUrl=a.url,this.data=a.data},showCaptcha:function(a,t){var e=this,o=PageData.tbs||PageData.user.tbs,c=2150040==e.data.no?"\u6B63\u786E\u8F93\u5165\u9A8C\u8BC1\u7801\u540E\uFF0C\u53EF\u7EE7\u7EED\u8D2D\u4E70":"\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";_.Module.use("common/component/CaptchaDialog",{message:e.data.data.captcha_str_reason,vCode:e.data.data.captcha_vcode_str,vCodeType:e.data.data.captcha_code_type,exceptionalAccount:0,title:"T\u8C46\u652F\u4ED8\u9A8C\u8BC1\u7801",message:c,forumName:"",modal:!0,forumId:0,checkUrl:"/tbmall/vcode/safecheckvcode?tbs="+o,vCodeUrl:"/tbmall/vcode/safegetvcode",paramsCallback:function(){return{tbs:o}}},function(e){e.bind("onclose",function(){e.hide(),$.tb.location.reload()}),e.bind("onaccept",function(){var o={};o.captcha_input_str=e.getInputValue(),o.captcha_vcode_str=e.getVCode(),"function"==typeof a&&(t?a.call(t,o):a(o))}),e.show()})}}});_.Module.define({path:"tbmall/widget/paykey_rsa",requires:[],sub:{RSA:{},publicKey:"",setKey:function(){this.publicKey=pkey},getKey:function(){var t=this;$.ajax({url:"/tbmall/pass/getpubkey",type:"get",dataType:"json",success:function(e){PageData.publicKey=e.data.pubkey,t.publicKey=PageData.publicKey}})},vcode:function(t){var e=new this.RSA;return e.setKey(this.publicKey),encodeURIComponent(e.encrypt(t))},initial:function(t){var e=this,i=$.extend({},t);PageData.publicKey||i.publicKey?this.publicKey=PageData.publicKey:this.getKey(),function(t){function e(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function i(){return new e(null)}function r(t,e,i,r,s,n){for(;--n>=0;){var o=e*this[t++]+i[r]+s;s=Math.floor(o/67108864),i[r++]=67108863&o}return s}function s(t,e,i,r,s,n){for(var o=32767&e,h=e>>15;--n>=0;){var a=32767&this[t],u=this[t++]>>15,c=h*a+u*o;a=o*a+((32767&c)<<15)+i[r]+(1073741823&s),s=(a>>>30)+(c>>>15)+h*u+(s>>>30),i[r++]=1073741823&a}return s}function n(t,e,i,r,s,n){for(var o=16383&e,h=e>>14;--n>=0;){var a=16383&this[t],u=this[t++]>>14,c=h*a+u*o;a=o*a+((16383&c)<<14)+i[r]+s,s=(a>>28)+(c>>14)+h*u,i[r++]=268435455&a}return s}function o(t){return Ui.charAt(t)}function h(t,e){var i=Oi[t.charCodeAt(e)];return null==i?-1:i}function a(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function u(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+DV:this.t=0}function c(t){var e=i();return e.fromInt(t),e}function f(t,i){var r;if(16==i)r=4;else if(8==i)r=3;else if(256==i)r=8;else if(2==i)r=1;else if(32==i)r=5;else{if(4!=i)return this.fromRadix(t,i),void 0;r=2}this.t=0,this.s=0;for(var s=t.length,n=!1,o=0;--s>=0;){var a=8==r?255&t[s]:h(t,s);0>a?"-"==t.charAt(s)&&(n=!0):(n=!1,0==o?this[this.t++]=a:o+r>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,o+=r,o>=this.DB&&(o-=this.DB))}8==r&&0!=(128&t[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&e.ZERO.subTo(this,this)}function p(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function l(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,r=(1<<e)-1,s=!1,n="",h=this.t,a=this.DB-h*this.DB%e;if(h-->0)for(a<this.DB&&(i=this[h]>>a)>0&&(s=!0,n=o(i));h>=0;)e>a?(i=(this[h]&(1<<a)-1)<<e-a,i|=this[--h]>>(a+=this.DB-e)):(i=this[h]>>(a-=e)&r,0>=a&&(a+=this.DB,--h)),i>0&&(s=!0),s&&(n+=o(i));return s?n:"0"}function d(){var t=i();return e.ZERO.subTo(this,t),t}function g(){return this.s<0?this.negate():this}function y(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return this.s<0?-e:e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function m(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function b(){return this.t<=0?0:this.DB*(this.t-1)+m(this[this.t-1]^this.s&this.DM)}function T(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function S(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function R(t,e){var i,r=t%this.DB,s=this.DB-r,n=(1<<s)-1,o=Math.floor(t/this.DB),h=this.s<<r&this.DM;for(i=this.t-1;i>=0;--i)e[i+o+1]=this[i]>>s|h,h=(this[i]&n)<<r;for(i=o-1;i>=0;--i)e[i]=0;e[o]=h,e.t=this.t+o+1,e.s=this.s,e.clamp()}function D(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return e.t=0,void 0;var r=t%this.DB,s=this.DB-r,n=(1<<r)-1;e[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)e[o-i-1]|=(this[o]&n)<<s,e[o-i]=this[o]>>r;r>0&&(e[this.t-i-1]|=(this.s&n)<<s),e.t=this.t-i,e.clamp()}function E(t,e){for(var i=0,r=0,s=Math.min(t.t,this.t);s>i;)r+=this[i]-t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r-=t[i],e[i++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=0>r?-1:0,-1>r?e[i++]=this.DV+r:r>0&&(e[i++]=r),e.t=i,e.clamp()}function x(t,i){var r=this.abs(),s=t.abs(),n=r.t;for(i.t=n+s.t;--n>=0;)i[n]=0;for(n=0;n<s.t;++n)i[n+r.t]=r.am(0,s[n],i,n,0,r.t);i.s=0,i.clamp(),this.s!=t.s&&e.ZERO.subTo(i,i)}function w(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var r=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,r,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function K(t,r,s){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=r&&r.fromInt(0),null!=s&&this.copyTo(s),void 0;null==s&&(s=i());var h=i(),a=this.s,u=t.s,c=this.DB-m(n[n.t-1]);c>0?(n.lShiftTo(c,h),o.lShiftTo(c,s)):(n.copyTo(h),o.copyTo(s));var f=h.t,p=h[f-1];if(0!=p){var l=p*(1<<this.F1)+(f>1?h[f-2]>>this.F2:0),d=this.FV/l,g=(1<<this.F1)/l,y=1<<this.F2,v=s.t,b=v-f,T=null==r?i():r;for(h.dlShiftTo(b,T),s.compareTo(T)>=0&&(s[s.t++]=1,s.subTo(T,s)),e.ONE.dlShiftTo(f,T),T.subTo(h,h);h.t<f;)h[h.t++]=0;for(;--b>=0;){var S=s[--v]==p?this.DM:Math.floor(s[v]*d+(s[v-1]+y)*g);if((s[v]+=h.am(0,S,s,b,0,f))<S)for(h.dlShiftTo(b,T),s.subTo(T,s);s[v]<--S;)s.subTo(T,s)}null!=r&&(s.drShiftTo(f,r),a!=u&&e.ZERO.subTo(r,r)),s.t=f,s.clamp(),c>0&&s.rShiftTo(c,s),0>a&&e.ZERO.subTo(s,s)}}}function A(t){var r=i();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(e.ZERO)>0&&t.subTo(r,r),r}function B(t){this.m=t}function U(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function O(t){return t}function V(t){t.divRemTo(this.m,null,t)}function N(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function J(t,e){t.squareTo(e),this.reduce(e)}function I(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function P(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function M(t){var r=i();return t.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),t.s<0&&r.compareTo(e.ZERO)>0&&this.m.subTo(r,r),r}function L(t){var e=i();return t.copyTo(e),this.reduce(e),e}function q(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],r=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,r,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function C(t,e){t.squareTo(e),this.reduce(e)}function H(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function j(){return 0==(this.t>0?1&this[0]:this.s)}function k(t,r){if(t>4294967295||1>t)return e.ONE;var s=i(),n=i(),o=r.convert(this),h=m(t)-1;for(o.copyTo(s);--h>=0;)if(r.sqrTo(s,n),(t&1<<h)>0)r.mulTo(n,o,s);else{var a=s;s=n,n=a}return r.revert(s)}function F(t,e){var i;return i=256>t||e.isEven()?new B(e):new P(e),this.exp(t,i)}function _(){var t=i();return this.copyTo(t),t}function z(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Z(){return 0==this.t?this.s:this[0]<<24>>24}function G(){return 0==this.t?this.s:this[0]<<16>>16}function Y(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function W(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function Q(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),s=c(r),n=i(),o=i(),h="";for(this.divRemTo(s,n,o);n.signum()>0;)h=(r+o.intValue()).toString(t).substr(1)+h,n.divRemTo(s,n,o);return o.intValue().toString(t)+h}function X(t,i){this.fromInt(0),null==i&&(i=10);for(var r=this.chunkSize(i),s=Math.pow(i,r),n=!1,o=0,a=0,u=0;u<t.length;++u){var c=h(t,u);0>c?"-"==t.charAt(u)&&0==this.signum()&&(n=!0):(a=i*a+c,++o>=r&&(this.dMultiply(s),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(i,o)),this.dAddOffset(a,0)),n&&e.ZERO.subTo(this,this)}function te(t,i,r){if("number"==typeof i)if(2>t)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ae,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var s=new Array,n=7&t;s.length=(t>>3)+1,i.nextBytes(s),n>0?s[0]&=(1<<n)-1:s[0]=0,this.fromString(s,256)}}function ee(){var t=this.t,e=new Array;e[0]=this.s;var i,r=this.DB-t*this.DB%8,s=0;if(t-->0)for(r<this.DB&&(i=this[t]>>r)!=(this.s&this.DM)>>r&&(e[s++]=i|this.s<<this.DB-r);t>=0;)8>r?(i=(this[t]&(1<<r)-1)<<8-r,i|=this[--t]>>(r+=this.DB-8)):(i=this[t]>>(r-=8)&255,0>=r&&(r+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==s&&(128&this.s)!=(128&i)&&++s,(s>0||i!=this.s)&&(e[s++]=i);return e}function ie(t){return 0==this.compareTo(t)}function re(t){return this.compareTo(t)<0?this:t}function se(t){return this.compareTo(t)>0?this:t}function ne(t,e,i){var r,s,n=Math.min(t.t,this.t);for(r=0;n>r;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(s=t.s&this.DM,r=n;r<this.t;++r)i[r]=e(this[r],s);i.t=this.t}else{for(s=this.s&this.DM,r=n;r<t.t;++r)i[r]=e(s,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function oe(t,e){return t&e}function he(t){var e=i();return this.bitwiseTo(t,oe,e),e}function ae(t,e){return t|e}function ue(t){var e=i();return this.bitwiseTo(t,ae,e),e}function ce(t,e){return t^e}function fe(t){var e=i();return this.bitwiseTo(t,ce,e),e}function pe(t,e){return t&~e}function le(t){var e=i();return this.bitwiseTo(t,pe,e),e}function de(){for(var t=i(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function ge(t){var e=i();return 0>t?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function ye(t){var e=i();return 0>t?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function me(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function ve(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+me(this[t]);return this.s<0?this.t*this.DB:-1}function be(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Te(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=be(this[i]^e);return t}function Se(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function Re(t,i){var r=e.ONE.shiftLeft(t);return this.bitwiseTo(r,i,r),r}function De(t){return this.changeBit(t,ae)}function Ee(t){return this.changeBit(t,pe)}function xe(t){return this.changeBit(t,ce)}function we(t,e){for(var i=0,r=0,s=Math.min(t.t,this.t);s>i;)r+=this[i]+t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r+=t[i],e[i++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=0>r?-1:0,r>0?e[i++]=r:-1>r&&(e[i++]=this.DV+r),e.t=i,e.clamp()}function Ke(t){var e=i();return this.addTo(t,e),e}function Ae(t){var e=i();return this.subTo(t,e),e}function Be(t){var e=i();return this.multiplyTo(t,e),e}function Ue(){var t=i();return this.squareTo(t),t}function Oe(t){var e=i();return this.divRemTo(t,e,null),e}function Ve(t){var e=i();return this.divRemTo(t,null,e),e}function Ne(t){var e=i(),r=i();return this.divRemTo(t,e,r),new Array(e,r)}function Je(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Ie(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Pe(){}function Me(t){return t}function Le(t,e,i){t.multiplyTo(e,i)}function qe(t,e){t.squareTo(e)}function Ce(t){return this.exp(t,new Pe)}function He(t,e,i){var r=Math.min(this.t+t.t,e);for(i.s=0,i.t=r;r>0;)i[--r]=0;var s;for(s=i.t-this.t;s>r;++r)i[r+this.t]=this.am(0,t[r],i,r,0,this.t);for(s=Math.min(t.t,e);s>r;++r)this.am(0,t[r],i,r,0,e-r);i.clamp()}function je(t,e,i){--e;var r=i.t=this.t+t.t-e;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)i[this.t+r-e]=this.am(e-r,t[r],i,0,0,this.t+r-e);i.clamp(),i.drShiftTo(1,i)}function ke(t){this.r2=i(),this.q3=i(),e.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Fe(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=i();return t.copyTo(e),this.reduce(e),e}function _e(t){return t}function ze(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Ze(t,e){t.squareTo(e),this.reduce(e)}function Ge(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function $e(t,e){var r,s,n=t.bitLength(),o=c(1);if(0>=n)return o;r=18>n?1:48>n?3:144>n?4:768>n?5:6,s=8>n?new B(e):e.isEven()?new ke(e):new P(e);var h=new Array,a=3,u=r-1,f=(1<<r)-1;if(h[1]=s.convert(this),r>1){var p=i();for(s.sqrTo(h[1],p);f>=a;)h[a]=i(),s.mulTo(p,h[a-2],h[a]),a+=2}var l,d,g=t.t-1,y=!0,v=i();for(n=m(t[g])-1;g>=0;){for(n>=u?l=t[g]>>n-u&f:(l=(t[g]&(1<<n+1)-1)<<u-n,g>0&&(l|=t[g-1]>>this.DB+n-u)),a=r;0==(1&l);)l>>=1,--a;if((n-=a)<0&&(n+=this.DB,--g),y)h[l].copyTo(o),y=!1;else{for(;a>1;)s.sqrTo(o,v),s.sqrTo(v,o),a-=2;a>0?s.sqrTo(o,v):(d=o,o=v,v=d),s.mulTo(v,h[l],o)}for(;g>=0&&0==(t[g]&1<<n);)s.sqrTo(o,v),d=o,o=v,v=d,--n<0&&(n=this.DB-1,--g)}return s.revert(o)}function Ye(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var r=e;e=i,i=r}var s=e.getLowestSetBit(),n=i.getLowestSetBit();if(0>n)return e;for(n>s&&(n=s),n>0&&(e.rShiftTo(n,e),i.rShiftTo(n,i));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return n>0&&i.lShiftTo(n,i),i}function We(t){if(0>=t)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var r=this.t-1;r>=0;--r)i=(e*i+this[r])%t;return i}function Qe(t){var i=t.isEven();if(this.isEven()&&i||0==t.signum())return e.ZERO;for(var r=t.clone(),s=this.clone(),n=c(1),o=c(0),h=c(0),a=c(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),i?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(t,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);for(;s.isEven();)s.rShiftTo(1,s),i?(h.isEven()&&a.isEven()||(h.addTo(this,h),a.subTo(t,a)),h.rShiftTo(1,h)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(s)>=0?(r.subTo(s,r),i&&n.subTo(h,n),o.subTo(a,o)):(s.subTo(r,s),i&&h.subTo(n,h),a.subTo(o,a))}return 0!=s.compareTo(e.ONE)?e.ZERO:a.compareTo(t)>=0?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a}function Xe(t){var e,i=this.abs();if(1==i.t&&i[0]<=Vi[Vi.length-1]){for(e=0;e<Vi.length;++e)if(i[0]==Vi[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<Vi.length;){for(var r=Vi[e],s=e+1;s<Vi.length&&Ni>r;)r*=Vi[s++];for(r=i.modInt(r);s>e;)if(r%Vi[e++]==0)return!1}return i.millerRabin(t)}function ti(t){var r=this.subtract(e.ONE),s=r.getLowestSetBit();if(0>=s)return!1;var n=r.shiftRight(s);t=t+1>>1,t>Vi.length&&(t=Vi.length);for(var o=i(),h=0;t>h;++h){o.fromInt(Vi[Math.floor(Math.random()*Vi.length)]);var a=o.modPow(n,this);if(0!=a.compareTo(e.ONE)&&0!=a.compareTo(r)){for(var u=1;u++<s&&0!=a.compareTo(r);)if(a=a.modPowInt(2,this),0==a.compareTo(e.ONE))return!1;if(0!=a.compareTo(r))return!1}}return!0}function ei(){this.i=0,this.j=0,this.S=new Array}function ii(t){var e,i,r;for(e=0;256>e;++e)this.S[e]=e;for(i=0,e=0;256>e;++e)i=i+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[i],this.S[i]=r;this.i=0,this.j=0}function ri(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function si(){return new ei}function ni(t){Ii[Pi++]^=255&t,Ii[Pi++]^=t>>8&255,Ii[Pi++]^=t>>16&255,Ii[Pi++]^=t>>24&255,Pi>=Mi&&(Pi-=Mi)}function oi(){ni((new Date).getTime())}function hi(){if(null==Ji){for(oi(),Ji=si(),Ji.init(Ii),Pi=0;Pi<Ii.length;++Pi)Ii[Pi]=0;Pi=0}return Ji.next()}function ai(t){var e;for(e=0;e<t.length;++e)t[e]=hi()}function ui(){}function ci(t,i){return new e(t,i)}function fi(t,i){if(i<t.length+11)return console.error("Message too long for RSA"),null;for(var r=new Array,s=t.length-1;s>=0&&i>0;){var n=t.charCodeAt(s--);128>n?r[--i]=n:n>127&&2048>n?(r[--i]=63&n|128,r[--i]=n>>6|192):(r[--i]=63&n|128,r[--i]=n>>6&63|128,r[--i]=n>>12|224)}r[--i]=0;for(var o=new ui,h=new Array;i>2;){for(h[0]=0;0==h[0];)o.nextBytes(h);r[--i]=h[0]}return r[--i]=2,r[--i]=0,new e(r)}function pi(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function li(t,e){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16)):console.error("Invalid RSA public key")}function di(t){return t.modPowInt(this.e,this.n)}function gi(t){var e=fi(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPublic(e);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r}function yi(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var s="";++r<i.length;){var n=255&i[r];128>n?s+=String.fromCharCode(n):n>191&&224>n?(s+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(s+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return s}function mi(t,e,i){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16),this.d=ci(i,16)):console.error("Invalid RSA private key")}function vi(t,e,i,r,s,n,o,h){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16),this.d=ci(i,16),this.p=ci(r,16),this.q=ci(s,16),this.dmp1=ci(n,16),this.dmq1=ci(o,16),this.coeff=ci(h,16)):console.error("Invalid RSA private key")}function bi(t,i){var r=new ui,s=t>>1;this.e=parseInt(i,16);for(var n=new e(i,16);;){for(;this.p=new e(t-s,1,r),0!=this.p.subtract(e.ONE).gcd(n).compareTo(e.ONE)||!this.p.isProbablePrime(10););for(;this.q=new e(s,1,r),0!=this.q.subtract(e.ONE).gcd(n).compareTo(e.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var h=this.p.subtract(e.ONE),a=this.q.subtract(e.ONE),u=h.multiply(a);if(0==u.gcd(n).compareTo(e.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(u),this.dmp1=this.d.mod(h),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}}function Ti(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function Si(t){var e=ci(t,16),i=this.doPrivate(e);return null==i?null:yi(i,this.n.bitLength()+7>>3)}function Ri(t){var e,i,r="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),r+=Ci.charAt(i>>6)+Ci.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),r+=Ci.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),r+=Ci.charAt(i>>2)+Ci.charAt((3&i)<<4));(3&r.length)>0;)r+=Hi;return r}function Di(t){var e,i,r="",s=0;for(e=0;e<t.length&&t.charAt(e)!=Hi;++e)v=Ci.indexOf(t.charAt(e)),0>v||(0==s?(r+=o(v>>2),i=3&v,s=1):1==s?(r+=o(i<<2|v>>4),i=15&v,s=2):2==s?(r+=o(i),r+=o(v>>2),i=3&v,s=3):(r+=o(i<<2|v>>4),r+=o(15&v),s=0));return 1==s&&(r+=o(i<<2)),r}var Ei,xi=0xdeadbeefcafe,wi=15715070==(16777215&xi);wi&&"Microsoft Internet Explorer"==navigator.appName?(e.prototype.am=s,Ei=30):wi&&"Netscape"!=navigator.appName?(e.prototype.am=r,Ei=26):(e.prototype.am=n,Ei=28),e.prototype.DB=Ei,e.prototype.DM=(1<<Ei)-1,e.prototype.DV=1<<Ei;var Ki=52;e.prototype.FV=Math.pow(2,Ki),e.prototype.F1=Ki-Ei,e.prototype.F2=2*Ei-Ki;var Ai,Bi,Ui="0123456789abcdefghijklmnopqrstuvwxyz",Oi=new Array;for(Ai="0".charCodeAt(0),Bi=0;9>=Bi;++Bi)Oi[Ai++]=Bi;for(Ai="a".charCodeAt(0),Bi=10;36>Bi;++Bi)Oi[Ai++]=Bi;for(Ai="A".charCodeAt(0),Bi=10;36>Bi;++Bi)Oi[Ai++]=Bi;B.prototype.convert=U,B.prototype.revert=O,B.prototype.reduce=V,B.prototype.mulTo=N,B.prototype.sqrTo=J,P.prototype.convert=M,P.prototype.revert=L,P.prototype.reduce=q,P.prototype.mulTo=H,P.prototype.sqrTo=C,e.prototype.copyTo=a,e.prototype.fromInt=u,e.prototype.fromString=f,e.prototype.clamp=p,e.prototype.dlShiftTo=T,e.prototype.drShiftTo=S,e.prototype.lShiftTo=R,e.prototype.rShiftTo=D,e.prototype.subTo=E,e.prototype.multiplyTo=x,e.prototype.squareTo=w,e.prototype.divRemTo=K,e.prototype.invDigit=I,e.prototype.isEven=j,e.prototype.exp=k,e.prototype.toString=l,e.prototype.negate=d,e.prototype.abs=g,e.prototype.compareTo=y,e.prototype.bitLength=b,e.prototype.mod=A,e.prototype.modPowInt=F,e.ZERO=c(0),e.ONE=c(1),Pe.prototype.convert=Me,Pe.prototype.revert=Me,Pe.prototype.mulTo=Le,Pe.prototype.sqrTo=qe,ke.prototype.convert=Fe,ke.prototype.revert=_e,ke.prototype.reduce=ze,ke.prototype.mulTo=Ge,ke.prototype.sqrTo=Ze;var Vi=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ni=(1<<26)/Vi[Vi.length-1];e.prototype.chunkSize=Y,e.prototype.toRadix=Q,e.prototype.fromRadix=X,e.prototype.fromNumber=te,e.prototype.bitwiseTo=ne,e.prototype.changeBit=Re,e.prototype.addTo=we,e.prototype.dMultiply=Je,e.prototype.dAddOffset=Ie,e.prototype.multiplyLowerTo=He,e.prototype.multiplyUpperTo=je,e.prototype.modInt=We,e.prototype.millerRabin=ti,e.prototype.clone=_,e.prototype.intValue=z,e.prototype.byteValue=Z,e.prototype.shortValue=G,e.prototype.signum=W,e.prototype.toByteArray=ee,e.prototype.equals=ie,e.prototype.min=re,e.prototype.max=se,e.prototype.and=he,e.prototype.or=ue,e.prototype.xor=fe,e.prototype.andNot=le,e.prototype.not=de,e.prototype.shiftLeft=ge,e.prototype.shiftRight=ye,e.prototype.getLowestSetBit=ve,e.prototype.bitCount=Te,e.prototype.testBit=Se,e.prototype.setBit=De,e.prototype.clearBit=Ee,e.prototype.flipBit=xe,e.prototype.add=Ke,e.prototype.subtract=Ae,e.prototype.multiply=Be,e.prototype.divide=Oe,e.prototype.remainder=Ve,e.prototype.divideAndRemainder=Ne,e.prototype.modPow=$e,e.prototype.modInverse=Qe,e.prototype.pow=Ce,e.prototype.gcd=Ye,e.prototype.isProbablePrime=Xe,e.prototype.square=Ue,ei.prototype.init=ii,ei.prototype.next=ri;var Ji,Ii,Pi,Mi=256;if(null==Ii){Ii=new Array,Pi=0;var Li;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var qi=window.crypto.random(32);for(Li=0;Li<qi.length;++Li)Ii[Pi++]=255&qi.charCodeAt(Li)}for(;Mi>Pi;)Li=Math.floor(65536*Math.random()),Ii[Pi++]=Li>>>8,Ii[Pi++]=255&Li;Pi=0,oi()}ui.prototype.nextBytes=ai,pi.prototype.doPublic=di,pi.prototype.setPublic=li,pi.prototype.encrypt=gi,pi.prototype.doPrivate=Ti,pi.prototype.setPrivate=mi,pi.prototype.setPrivateEx=vi,pi.prototype.generate=bi,pi.prototype.decrypt=Si,function(){var t=function(t,r,s){var n=new ui,o=t>>1;this.e=parseInt(r,16);var h=new e(r,16),a=this,u=function(){var r=function(){if(a.p.compareTo(a.q)<=0){var t=a.p;a.p=a.q,a.q=t}var i=a.p.subtract(e.ONE),r=a.q.subtract(e.ONE),n=i.multiply(r);0==n.gcd(h).compareTo(e.ONE)?(a.n=a.p.multiply(a.q),a.d=h.modInverse(n),a.dmp1=a.d.mod(i),a.dmq1=a.d.mod(r),a.coeff=a.q.modInverse(a.p),setTimeout(function(){s()},0)):setTimeout(u,0)},c=function(){a.q=i(),a.q.fromNumberAsync(o,1,n,function(){a.q.subtract(e.ONE).gcda(h,function(t){0==t.compareTo(e.ONE)&&a.q.isProbablePrime(10)?setTimeout(r,0):setTimeout(c,0)})})},f=function(){a.p=i(),a.p.fromNumberAsync(t-o,1,n,function(){a.p.subtract(e.ONE).gcda(h,function(t){0==t.compareTo(e.ONE)&&a.p.isProbablePrime(10)?setTimeout(c,0):setTimeout(f,0)})})};setTimeout(f,0)};setTimeout(u,0)};pi.prototype.generateAsync=t;var r=function(t,e){var i=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(i.compareTo(r)<0){var s=i;i=r,r=s}var n=i.getLowestSetBit(),o=r.getLowestSetBit();if(0>o)return e(i),void 0;o>n&&(o=n),o>0&&(i.rShiftTo(o,i),r.rShiftTo(o,r));var h=function(){(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),(n=r.getLowestSetBit())>0&&r.rShiftTo(n,r),i.compareTo(r)>=0?(i.subTo(r,i),i.rShiftTo(1,i)):(r.subTo(i,r),r.rShiftTo(1,r)),i.signum()>0?setTimeout(h,0):(o>0&&r.lShiftTo(o,r),setTimeout(function(){e(r)},0))};setTimeout(h,10)};e.prototype.gcda=r;var s=function(t,i,r,s){if("number"==typeof i)if(2>t)this.fromInt(1);else{this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ae,this),this.isEven()&&this.dAddOffset(1,0);var n=this,o=function(){n.dAddOffset(2,0),n.bitLength()>t&&n.subTo(e.ONE.shiftLeft(t-1),n),n.isProbablePrime(i)?setTimeout(function(){s()},0):setTimeout(o,0)};setTimeout(o,0)}else{var h=new Array,a=7&t;h.length=(t>>3)+1,i.nextBytes(h),a>0?h[0]&=(1<<a)-1:h[0]=0,this.fromString(h,256)}};e.prototype.fromNumberAsync=s}();var Ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hi="=",ji=ji||{};ji.env=ji.env||{};var ki=ji,Fi=Object.prototype,_i="[object Function]",zi=["toString","valueOf"];ji.env.parseUA=function(t){var e,i=function(t){var e=0;return parseFloat(t.replace(/\./g,function(){return 1==e++?"":"."}))},r=navigator,s={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:r&&r.cajaVersion,secure:!1,os:null},n=t||navigator&&navigator.userAgent,o=$.tb.location,h=o&&o.getHref();return s.secure=h&&0===h.toLowerCase().indexOf("https"),n&&(/windows|win32/i.test(n)?s.os="windows":/macintosh/i.test(n)?s.os="macintosh":/rhino/i.test(n)&&(s.os="rhino"),/KHTML/.test(n)&&(s.webkit=1),e=n.match(/AppleWebKit\/([^\s]*)/),e&&e[1]&&(s.webkit=i(e[1]),/ Mobile\//.test(n)?(s.mobile="Apple",e=n.match(/OS ([^\s]*)/),e&&e[1]&&(e=i(e[1].replace("_","."))),s.ios=e,s.ipad=s.ipod=s.iphone=0,e=n.match(/iPad|iPod|iPhone/),e&&e[0]&&(s[e[0].toLowerCase()]=s.ios)):(e=n.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/),e&&(s.mobile=e[0]),/webOS/.test(n)&&(s.mobile="WebOS",e=n.match(/webOS\/([^\s]*);/),e&&e[1]&&(s.webos=i(e[1]))),/ Android/.test(n)&&(s.mobile="Android",e=n.match(/Android ([^\s]*);/),e&&e[1]&&(s.android=i(e[1])))),e=n.match(/Chrome\/([^\s]*)/),e&&e[1]?s.chrome=i(e[1]):(e=n.match(/AdobeAIR\/([^\s]*)/),e&&(s.air=e[0]))),s.webkit||(e=n.match(/Opera[\s\/]([^\s]*)/),e&&e[1]?(s.opera=i(e[1]),e=n.match(/Version\/([^\s]*)/),e&&e[1]&&(s.opera=i(e[1])),e=n.match(/Opera Mini[^;]*/),e&&(s.mobile=e[0])):(e=n.match(/MSIE\s([^;]*)/),e&&e[1]?s.ie=i(e[1]):(e=n.match(/Gecko\/([^\s]*)/),e&&(s.gecko=1,e=n.match(/rv:([^\s\)]*)/),e&&e[1]&&(s.gecko=i(e[1]))))))),s},ji.env.ua=ji.env.parseUA(),ji.isFunction=function(t){return"function"==typeof t||Fi.toString.apply(t)===_i},ji._IEEnumFix=ji.env.ua.ie?function(t,e){var i,r,s;for(i=0;i<zi.length;i+=1)r=zi[i],s=e[r],ki.isFunction(s)&&s!=Fi[r]&&(t[r]=s)}:function(){},ji.extend=function(t,e,i){if(!e||!t)throw new Error("extend failed, please check that all dependencies are included.");var r,s=function(){};if(s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Fi.constructor&&(e.prototype.constructor=e),i){for(r in i)ki.hasOwnProperty(i,r)&&(t.prototype[r]=i[r]);ki._IEEnumFix(t.prototype,i)}},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var i=t.toString(16);if("-"!=i.substr(0,1))i.length%2==1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{var r=i.substr(1),s=r.length;s%2==1?s+=1:i.match(/^[0-7]/)||(s+=2);for(var n="",o=0;s>o;o++)n+="f";var h=new e(n,16),a=h.xor(t).add(e.ONE);i=a.toString(16).replace(/^-/,"")}return i},this.getPEMStringFromHex=function(t,e){var i=CryptoJS.enc.Hex.parse(t),r=CryptoJS.enc.Base64.stringify(i),s=r.replace(/(.{64})/g,"$1\r\n");return s=s.replace(/\r\n$/,""),"-----BEGIN "+e+"-----\r\n"+s+"\r\n-----END "+e+"-----\r\n"}},KJUR.asn1.ASN1Object=function(){var t="";this.getLengthHexFromValue=function(){if("undefined"==typeof this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+t.length+",v="+this.hV;var e=this.hV.length/2,i=e.toString(16);if(i.length%2==1&&(i="0"+i),128>e)return i;var r=i.length/2;if(r>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);var s=128+r;return s.toString(16)+i},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},KJUR.asn1.DERAbstractString=function(t){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex&&this.setStringHex(t.hex))},ji.extend(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractTime=function(){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(t){utc=t.getTime()+6e4*t.getTimezoneOffset();var e=new Date(utc);return e},this.formatDate=function(t,e){var i=this.zeroPadding,r=this.localDateToUTC(t),s=String(r.getFullYear());"utc"==e&&(s=s.substr(2,2));var n=i(String(r.getMonth()+1),2),o=i(String(r.getDate()),2),h=i(String(r.getHours()),2),a=i(String(r.getMinutes()),2),u=i(String(r.getSeconds()),2);return s+n+o+h+a+u+"Z"},this.zeroPadding=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setByDateValue=function(t,e,i,r,s,n){var o=new Date(Date.UTC(t,e-1,i,r,s,n,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},ji.extend(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractStructured=function(t){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,"undefined"!=typeof t&&"undefined"!=typeof t.array&&(this.asn1Array=t.array)},ji.extend(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object),KJUR.asn1.DERBoolean=function(){KJUR.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},ji.extend(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object),KJUR.asn1.DERInteger=function(t){KJUR.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var i=new e(String(t),10);this.setByBigInteger(i)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.bigint?this.setByBigInteger(t.bigint):"undefined"!=typeof t["int"]?this.setByInteger(t["int"]):"undefined"!=typeof t.hex&&this.setValueHex(t.hex))},ji.extend(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object),KJUR.asn1.DERBitString=function(t){KJUR.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t
},this.setUnusedBitsAndHexValue=function(t,e){if(0>t||t>7)throw"unused bits shall be from 0 to 7: u = "+t;var i="0"+t;this.hTLV=null,this.isModified=!0,this.hV=i+e},this.setByBinaryString=function(t){t=t.replace(/0+$/,"");var e=8-t.length%8;8==e&&(e=0);for(var i=0;e>=i;i++)t+="0";for(var r="",i=0;i<t.length-1;i+=8){var s=t.substr(i,8),n=parseInt(s,2).toString(16);1==n.length&&(n="0"+n),r+=n}this.hTLV=null,this.isModified=!0,this.hV="0"+e+r},this.setByBooleanArray=function(t){for(var e="",i=0;i<t.length;i++)e+=1==t[i]?"1":"0";this.setByBinaryString(e)},this.newFalseArray=function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=!1;return e},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.hex?this.setHexValueIncludingUnusedBits(t.hex):"undefined"!=typeof t.bin?this.setByBinaryString(t.bin):"undefined"!=typeof t.array&&this.setByBooleanArray(t.array))},ji.extend(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object),KJUR.asn1.DEROctetString=function(t){KJUR.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},ji.extend(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ji.extend(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object),KJUR.asn1.DERObjectIdentifier=function(t){var i=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},r=function(t){var r="",s=new e(t,10),n=s.toString(2),o=7-n.length%7;7==o&&(o=0);for(var h="",a=0;o>a;a++)h+="0";n=h+n;for(var a=0;a<n.length-1;a+=7){var u=n.substr(a,7);a!=n.length-7&&(u="1"+u),r+=i(parseInt(u,2))}return r};KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var e="",s=t.split("."),n=40*parseInt(s[0])+parseInt(s[1]);e+=i(n),s.splice(0,2);for(var o=0;o<s.length;o++)e+=r(s[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueName=function(t){if("undefined"==typeof KJUR.asn1.x509.OID.name2oidList[t])throw"DERObjectIdentifier oidName undefined: "+t;var e=KJUR.asn1.x509.OID.name2oidList[t];this.setValueOidString(e)},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.oid?this.setValueOidString(t.oid):"undefined"!=typeof t.hex?this.setValueHex(t.hex):"undefined"!=typeof t.name&&this.setValueName(t.name))},ji.extend(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.DERUTF8String=function(t){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},ji.extend(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNumericString=function(t){KJUR.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},ji.extend(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERPrintableString=function(t){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},ji.extend(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERTeletexString=function(t){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},ji.extend(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERIA5String=function(t){KJUR.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},ji.extend(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERUTCTime=function(t){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex?this.setStringHex(t.hex):"undefined"!=typeof t.date&&this.setByDate(t.date))},ji.extend(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERGeneralizedTime=function(t){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen"),this.hV=stohex(this.s)},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex?this.setStringHex(t.hex):"undefined"!=typeof t.date&&this.setByDate(t.date))},ji.extend(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERSequence=function(t){KJUR.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var t="",e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t+=i.getEncodedHex()}return this.hV=t,this.hV}},ji.extend(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERSet=function(t){KJUR.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.getFreshValueHex=function(){for(var t=new Array,e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t.push(i.getEncodedHex())}return t.sort(),this.hV=t.join(""),this.hV}},ji.extend(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERTaggedObject=function(t){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(t,e,i){this.hT=e,this.isExplicit=t,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,e),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.tag&&(this.hT=t.tag),"undefined"!=typeof t.explicit&&(this.isExplicit=t.explicit),"undefined"!=typeof t.obj&&(this.asn1Object=t.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},ji.extend(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object),function(t){"use strict";var e,i={};i.decode=function(i){var r;if(e===t){var s="0123456789ABCDEF",n=" \f\n\r	 \u2028\u2029";for(e=[],r=0;16>r;++r)e[s.charAt(r)]=r;for(s=s.toLowerCase(),r=10;16>r;++r)e[s.charAt(r)]=r;for(r=0;r<n.length;++r)e[n.charAt(r)]=-1}var o=[],h=0,a=0;for(r=0;r<i.length;++r){var u=i.charAt(r);if("="==u)break;if(u=e[u],-1!=u){if(u===t)throw"Illegal character at offset "+r;h|=u,++a>=2?(o[o.length]=h,h=0,a=0):h<<=4}}if(a)throw"Hex encoding incomplete: 4 bits missing";return o},window.Hex=i}(),function(t){"use strict";var e,i={};i.decode=function(i){var r;if(e===t){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="= \f\n\r	 \u2028\u2029";for(e=[],r=0;64>r;++r)e[s.charAt(r)]=r;for(r=0;r<n.length;++r)e[n.charAt(r)]=-1}var o=[],h=0,a=0;for(r=0;r<i.length;++r){var u=i.charAt(r);if("="==u)break;if(u=e[u],-1!=u){if(u===t)throw"Illegal character at offset "+r;h|=u,++a>=4?(o[o.length]=h>>16,o[o.length]=h>>8&255,o[o.length]=255&h,h=0,a=0):h<<=6}}switch(a){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";case 2:o[o.length]=h>>10;break;case 3:o[o.length]=h>>16,o[o.length]=h>>8&255}return o},i.re=/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,i.unarmor=function(t){var e=i.re.exec(t);if(e)if(e[1])t=e[1];else{if(!e[2])throw"RegExp out of sync";t=e[2]}return i.decode(t)},window.Base64=i}(),function(t){"use strict";function e(t,i){t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=i)}function i(t,e,i,r,s){this.stream=t,this.header=e,this.length=i,this.tag=r,this.sub=s}var r=100,s="\u2026",n={tag:function(t,e){var i=document.createElement(t);return i.className=e,i},text:function(t){return document.createTextNode(t)}};e.prototype.get=function(e){if(e===t&&(e=this.pos++),e>=this.enc.length)throw"Requesting byte offset "+e+" on a stream of length "+this.enc.length;return this.enc[e]},e.prototype.hexDigits="0123456789ABCDEF",e.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},e.prototype.hexDump=function(t,e,i){for(var r="",s=t;e>s;++s)if(r+=this.hexByte(this.get(s)),i!==!0)switch(15&s){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r},e.prototype.parseStringISO=function(t,e){for(var i="",r=t;e>r;++r)i+=String.fromCharCode(this.get(r));return i},e.prototype.parseStringUTF=function(t,e){for(var i="",r=t;e>r;){var s=this.get(r++);i+=128>s?String.fromCharCode(s):s>191&&224>s?String.fromCharCode((31&s)<<6|63&this.get(r++)):String.fromCharCode((15&s)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return i},e.prototype.parseStringBMP=function(t,e){for(var i="",r=t;e>r;r+=2){var s=this.get(r),n=this.get(r+1);i+=String.fromCharCode((s<<8)+n)}return i},e.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,e.prototype.parseTime=function(t,e){var i=this.parseStringISO(t,e),r=this.reTime.exec(i);return r?(i=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4],r[5]&&(i+=":"+r[5],r[6]&&(i+=":"+r[6],r[7]&&(i+="."+r[7]))),r[8]&&(i+=" UTC","Z"!=r[8]&&(i+=r[8],r[9]&&(i+=":"+r[9]))),i):"Unrecognized time: "+i},e.prototype.parseInteger=function(t,e){var i=e-t;if(i>4){i<<=3;var r=this.get(t);if(0===r)i-=8;else for(;128>r;)r<<=1,--i;return"("+i+" bit)"}for(var s=0,n=t;e>n;++n)s=s<<8|this.get(n);return s},e.prototype.parseBitString=function(t,e){var i=this.get(t),r=(e-t-1<<3)-i,s="("+r+" bit)";if(20>=r){var n=i;s+=" ";for(var o=e-1;o>t;--o){for(var h=this.get(o),a=n;8>a;++a)s+=h>>a&1?"1":"0";n=0}}return s},e.prototype.parseOctetString=function(t,e){var i=e-t,n="("+i+" byte) ";i>r&&(e=t+r);for(var o=t;e>o;++o)n+=this.hexByte(this.get(o));return i>r&&(n+=s),n},e.prototype.parseOID=function(t,e){for(var i="",r=0,s=0,n=t;e>n;++n){var o=this.get(n);if(r=r<<7|127&o,s+=7,!(128&o)){if(""===i){var h=80>r?40>r?0:1:2;i=h+"."+(r-40*h)}else i+="."+(s>=31?"bigint":r);r=s=0}}return i},i.prototype.typeName=function(){if(this.tag===t)return"unknown";var e=this.tag>>6,i=(this.tag>>5&1,31&this.tag);switch(e){case 0:switch(i){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+i.toString(16)}case 1:return"Application_"+i.toString(16);case 2:return"["+i+"]";case 3:return"Private_"+i.toString(16)}},i.prototype.reSeemsASCII=/^[ -~]+$/,i.prototype.content=function(){if(this.tag===t)return null;var e=this.tag>>6,i=31&this.tag,n=this.posContent(),o=Math.abs(this.length);if(0!==e){if(null!==this.sub)return"("+this.sub.length+" elem)";var h=this.stream.parseStringISO(n,n+Math.min(o,r));return this.reSeemsASCII.test(h)?h.substring(0,2*r)+(h.length>2*r?s:""):this.stream.parseOctetString(n,n+o)}switch(i){case 1:return 0===this.stream.get(n)?"false":"true";case 2:return this.stream.parseInteger(n,n+o);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(n,n+o);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(n,n+o);case 6:return this.stream.parseOID(n,n+o);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(n,n+o);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(n,n+o);case 30:return this.stream.parseStringBMP(n,n+o);case 23:case 24:return this.stream.parseTime(n,n+o)}return null},i.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},i.prototype.print=function(e){if(e===t&&(e=""),document.writeln(e+this),null!==this.sub){e+="  ";for(var i=0,r=this.sub.length;r>i;++i)this.sub[i].print(e)}},i.prototype.toPrettyString=function(e){e===t&&(e="");var i=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(i+="+"),i+=this.length,32&this.tag?i+=" (constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(i+=" (encapsulates)"),i+="\n",null!==this.sub){e+="  ";for(var r=0,s=this.sub.length;s>r;++r)i+=this.sub[r].toPrettyString(e)}return i},i.prototype.toDOM=function(){var t=n.tag("div","node");t.asn1=this;var e=n.tag("div","head"),i=this.typeName().replace(/_/g," ");e.innerHTML=i;var r=this.content();if(null!==r){r=String(r).replace(/</g,"&lt;");var s=n.tag("span","preview");s.appendChild(n.text(r)),e.appendChild(s)}t.appendChild(e),this.node=t,this.head=e;var o=n.tag("div","value");if(i="Offset: "+this.stream.pos+"<br/>",i+="Length: "+this.header+"+",i+=this.length>=0?this.length:-this.length+" (undefined)",32&this.tag?i+="<br/>(constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(i+="<br/>(encapsulates)"),null!==r&&(i+="<br/>Value:<br/><b>"+r+"</b>","object"==typeof oids&&6==this.tag)){var h=oids[r];h&&(h.d&&(i+="<br/>"+h.d),h.c&&(i+="<br/>"+h.c),h.w&&(i+="<br/>(warning!)"))}o.innerHTML=i,t.appendChild(o);var a=n.tag("div","sub");if(null!==this.sub)for(var u=0,c=this.sub.length;c>u;++u)a.appendChild(this.sub[u].toDOM());return t.appendChild(a),e.onclick=function(){t.className="node collapsed"==t.className?"node":"node collapsed"},t},i.prototype.posStart=function(){return this.stream.pos},i.prototype.posContent=function(){return this.stream.pos+this.header},i.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},i.prototype.fakeHover=function(t){this.node.className+=" hover",t&&(this.head.className+=" hover")},i.prototype.fakeOut=function(t){var e=/ ?hover/;this.node.className=this.node.className.replace(e,""),t&&(this.head.className=this.head.className.replace(e,""))},i.prototype.toHexDOM_sub=function(t,e,i,r,s){if(!(r>=s)){var o=n.tag("span",e);o.appendChild(n.text(i.hexDump(r,s))),t.appendChild(o)}},i.prototype.toHexDOM=function(e){var i=n.tag("span","hex");if(e===t&&(e=i),this.head.hexNode=i,this.head.onmouseover=function(){this.hexNode.className="hexCurrent"},this.head.onmouseout=function(){this.hexNode.className="hex"},i.asn1=this,i.onmouseover=function(){var t=!e.selected;t&&(e.selected=this.asn1,this.className="hexCurrent"),this.asn1.fakeHover(t)},i.onmouseout=function(){var t=e.selected==this.asn1;this.asn1.fakeOut(t),t&&(e.selected=null,this.className="hex")},this.toHexDOM_sub(i,"tag",this.stream,this.posStart(),this.posStart()+1),this.toHexDOM_sub(i,this.length>=0?"dlen":"ulen",this.stream,this.posStart()+1,this.posContent()),null===this.sub)i.appendChild(n.text(this.stream.hexDump(this.posContent(),this.posEnd())));else if(this.sub.length>0){var r=this.sub[0],s=this.sub[this.sub.length-1];this.toHexDOM_sub(i,"intro",this.stream,this.posContent(),r.posStart());for(var o=0,h=this.sub.length;h>o;++o)i.appendChild(this.sub[o].toHexDOM(e));this.toHexDOM_sub(i,"outro",this.stream,s.posEnd(),this.posEnd())}return i},i.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},i.decodeLength=function(t){var e=t.get(),i=127&e;if(i==e)return i;if(i>3)throw"Length over 24 bits not supported at position "+(t.pos-1);if(0===i)return-1;e=0;for(var r=0;i>r;++r)e=e<<8|t.get();return e},i.hasContent=function(t,r,s){if(32&t)return!0;if(3>t||t>4)return!1;var n=new e(s);3==t&&n.get();var o=n.get();if(o>>6&1)return!1;try{var h=i.decodeLength(n);return n.pos-s.pos+h==r}catch(a){return!1}},i.decode=function(t){t instanceof e||(t=new e(t,0));var r=new e(t),s=t.get(),n=i.decodeLength(t),o=t.pos-r.pos,h=null;if(i.hasContent(s,n,t)){var a=t.pos;if(3==s&&t.get(),h=[],n>=0){for(var u=a+n;t.pos<u;)h[h.length]=i.decode(t);if(t.pos!=u)throw"Content size is not correct for container starting at offset "+a}else try{for(;;){var c=i.decode(t);if(0===c.tag)break;h[h.length]=c}n=a-t.pos}catch(f){throw"Exception while decoding undefined length content: "+f}}else t.pos+=n;return new i(r,o,n,s,h)},i.test=function(){for(var t=[{value:[39],expected:39},{value:[129,201],expected:201},{value:[131,254,220,186],expected:16702650}],r=0,s=t.length;s>r;++r){var n=new e(t[r].value,0),o=i.decodeLength(n);o!=t[r].expected&&document.write("In test["+r+"] expected "+t[r].expected+" got "+o+"\n")}},window.ASN1=i}(),ASN1.prototype.getHexStringValue=function(){var t=this.toHexString(),e=2*this.header,i=2*this.length;return t.substr(e,i)},pi.prototype.parseKey=function(t){try{var e=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/,i=e.test(t)?Hex.decode(t):Base64.unarmor(t),r=ASN1.decode(i);if(9===r.sub.length){var s=r.sub[1].getHexStringValue();this.n=ci(s,16);var n=r.sub[2].getHexStringValue();this.e=parseInt(n,16);var o=r.sub[3].getHexStringValue();this.d=ci(o,16);var h=r.sub[4].getHexStringValue();this.p=ci(h,16);var a=r.sub[5].getHexStringValue();this.q=ci(a,16);var u=r.sub[6].getHexStringValue();this.dmp1=ci(u,16);var c=r.sub[7].getHexStringValue();this.dmq1=ci(c,16);var f=r.sub[8].getHexStringValue();this.coeff=ci(f,16)}else{if(2!==r.sub.length)return!1;var p=r.sub[1],l=p.sub[0],s=l.sub[0].getHexStringValue();this.n=ci(s,16);var n=l.sub[1].getHexStringValue();this.e=parseInt(n,16)}return!0}catch(d){return!1}},pi.prototype.getPrivateBaseKey=function(){var t={array:[new KJUR.asn1.DERInteger({"int":0}),new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e}),new KJUR.asn1.DERInteger({bigint:this.d}),new KJUR.asn1.DERInteger({bigint:this.p}),new KJUR.asn1.DERInteger({bigint:this.q}),new KJUR.asn1.DERInteger({bigint:this.dmp1}),new KJUR.asn1.DERInteger({bigint:this.dmq1}),new KJUR.asn1.DERInteger({bigint:this.coeff})]},e=new KJUR.asn1.DERSequence(t);return e.getEncodedHex()},pi.prototype.getPrivateBaseKeyB64=function(){return Ri(this.getPrivateBaseKey())},pi.prototype.getPublicBaseKey=function(){var t={array:[new KJUR.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new KJUR.asn1.DERNull]},e=new KJUR.asn1.DERSequence(t);t={array:[new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e})]};var i=new KJUR.asn1.DERSequence(t);t={hex:"00"+i.getEncodedHex()};var r=new KJUR.asn1.DERBitString(t);t={array:[e,r]};var s=new KJUR.asn1.DERSequence(t);return s.getEncodedHex()},pi.prototype.getPublicBaseKeyB64=function(){return Ri(this.getPublicBaseKey())},pi.prototype.wordwrap=function(t,e){if(e=e||64,!t)return t;var i="(.{1,"+e+"})( +|$\n?)|(.{1,"+e+"})";return t.match(RegExp(i,"g")).join("\n")},pi.prototype.getPrivateKey=function(){var t="-----BEGIN RSA PRIVATE KEY-----\n";return t+=this.wordwrap(this.getPrivateBaseKeyB64())+"\n",t+="-----END RSA PRIVATE KEY-----"},pi.prototype.getPublicKey=function(){var t="-----BEGIN PUBLIC KEY-----\n";return t+=this.wordwrap(this.getPublicBaseKeyB64())+"\n",t+="-----END PUBLIC KEY-----"},pi.prototype.hasPublicKeyProperty=function(t){return t=t||{},t.hasOwnProperty("n")&&t.hasOwnProperty("e")},pi.prototype.hasPrivateKeyProperty=function(t){return t=t||{},t.hasOwnProperty("n")&&t.hasOwnProperty("e")&&t.hasOwnProperty("d")&&t.hasOwnProperty("p")&&t.hasOwnProperty("q")&&t.hasOwnProperty("dmp1")&&t.hasOwnProperty("dmq1")&&t.hasOwnProperty("coeff")},pi.prototype.parsePropertiesFrom=function(t){this.n=t.n,this.e=t.e,t.hasOwnProperty("d")&&(this.d=t.d,this.p=t.p,this.q=t.q,this.dmp1=t.dmp1,this.dmq1=t.dmq1,this.coeff=t.coeff)};var Zi=function(t){pi.call(this),t&&("string"==typeof t?this.parseKey(t):(this.hasPrivateKeyProperty(t)||this.hasPublicKeyProperty(t))&&this.parsePropertiesFrom(t))};Zi.prototype=new pi,Zi.prototype.constructor=Zi;var Gi=function(t){t=t||{},this.default_key_size=parseInt(t.default_key_size)||1024,this.default_public_exponent=t.default_public_exponent||"010001",this.log=t.log||!1,this.key=null};Gi.prototype.setKey=function(t){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new Zi(t)},Gi.prototype.setPrivateKey=function(t){this.setKey(t)},Gi.prototype.setPublicKey=function(t){this.setKey(t)},Gi.prototype.decrypt=function(t){try{return this.getKey().decrypt(Di(t))}catch(e){return!1}},Gi.prototype.encrypt=function(t){try{return Ri(this.getKey().encrypt(t))}catch(e){return console.log(arguments),!1}},Gi.prototype.getKey=function(t){if(!this.key){if(this.key=new Zi,t&&"[object Function]"==={}.toString.call(t))return this.key.generateAsync(this.default_key_size,this.default_public_exponent,t),void 0;this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},Gi.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},Gi.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},Gi.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},Gi.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},t.JSEncrypt=Gi}(e.RSA),e.RSA=e.RSA.JSEncrypt}}});_.Module.define({path:"tbmall/widget/paykey_dialog",requires:["tbmall/widget/paykey_rsa"],sub:{ERROR:{2270018:"",1990005:"\u652F\u4ED8\u5BC6\u7801\u9A8C\u8BC1\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF0C\u60A8\u8FD8\u6709{#NUM#}\u6B21\u8F93\u5165\u673A\u4F1A",2190005:'\u4F60\u5DF2\u8F93\u5165\u5BC6\u7801\u9519\u8BEF5\u6B21\uFF0C\u652F\u4ED8\u5BC6\u7801\u88AB\u9501\u5B9A\uFF0C\u8BF7<a target="_blank" href="/tbmall/pass/set">\u627E\u56DE\u5BC6\u7801</a>'},MAX_ERR_TIME:5,_setTpl:['<div id="paykey_set_dialog" class="paykey_set_dialog clearfix">',"<p>\u8BF7\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801\u540E\u5B8C\u6210\u6D88\u8D39</br>\uFF08\u53EF\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669\uFF0C\u4FDD\u969C\u8D22\u4EA7\u5B89\u5168\uFF09</p>",'<div class="paykey_btn_area clearfix">','<a href="/tbmall/pass/set" target="_blank" class="paykey_set_accept_btn paykey_set_btn" id="paykey_set_accept_btn">\u7ACB\u5373\u8BBE\u7F6E</a>','<a href="#" class="paykey_set_cancel_btn paykey_set_btn" id="paykey_set_cancel_btn">\u4E0B\u6B21\u518D\u8BF4</a>',"</div>","</div>"].join(""),_inputTpl:['<div id="paykey_set_dialog" class="paykey_set_dialog clearfix">','<form id="paykey_set_form">','<div class="paykey_input_area">',"<span>\u8BF7\u8F93\u5165\u652F\u4ED8\u5BC6\u7801</span>",'<input type="password" class="j_paykey_input paykey_input" id="paykey_input"/>','<p id="paykey_input_msg" class="paykey_input_msg">{#ERROR#}</p>',"</div>",'<div class="paykey_btn_area clearfix">','<a class="j_paykey_submit_btn paykey_submit_btn paykey_set_btn" id="paykey_submit_btn">\u63D0\u4EA4</a>','<a href="/tbmall/pass/set" target="_blank" class="j_paykey_cancel_btn  paykey_set_btn" id="paykey_cancel_btn">\u5FD8\u8BB0\u5BC6\u7801</a>',"</div>","</form>","</div>"].join(""),_dialog:null,conf:{},initial:function(a){this.conf=$.extend(this.conf,a),this.RSA=this.use("tbmall/widget/paykey_rsa")},showDialog:function(a,e,t){var i=e;2==arguments.length&&(t=e,i=null),2===this.conf.showType?this.inputPasskeyDialog(a,i,t):1===this.conf.showType?this.setPasskeyDialog(a,i,t):"function"==typeof a&&(t?a.call(t):a())},inputPasskeyDialog:function(a,e,t){var i=this;2==arguments.length&&(t=e);var s=this._inputTpl;if(this.conf.errType&&(s=s.replace("{#ERROR#}",this.ERROR[this.conf.errType])),this.conf.errTime){var n=this.MAX_ERR_TIME-this.conf.errTime;s=s.replace("{#NUM#}",n)}this._dialog=new $.dialog({html:s,title:"\u652F\u4ED8\u5BC6\u7801",draggable:!1,width:420});var l=function(){var e=$("#paykey_input").val();if(!e)return $("#paykey_input_msg").text("\u8BF7\u8F93\u5165\u652F\u4ED8\u5BC6\u7801"),void 0;var s=i.RSA.vcode(e);"function"==typeof a&&(t?a.call(t,{password:s}):a({password:s})),i._dialog.close()};$("#paykey_submit_btn").click(function(a){a.preventDefault(),l()}),$("#paykey_set_form").submit(function(a){a.preventDefault(),l()}),this._dialog.onclose(function(){"function"==typeof e&&(t?e.call(t):e())})},setPasskeyDialog:function(a,e,t){var i=this;2==arguments.length&&(t=e),this._dialog=new $.dialog({html:this._setTpl,title:"\u63D0\u793A",draggable:!1,width:420}),$("#paykey_set_accept_btn").click(function(){i._dialog.close()}),$("#paykey_set_cancel_btn").click(function(){i._dialog.close()}),this._dialog.element.find(".dialogJclose").on("click",function(){"function"==typeof e&&(t?e.call(t,{ignore_set_paypass:1}):e({ignore_set_paypass:1}))})}}});_.Module.define({path:"frs/widget/headSkin",requires:["common/widget/ScrollPanel","tbmall/component/captcha_payment","tbmall/widget/paykey_dialog"],sub:{forumSkinHtml:['<div class="skin_wrapper">','<div class="skin_content">','<h4 class="skin_title">\u96C6\u8D44\u989D\u5EA6\u6EE1\u8DB3\u6761\u4EF6\uFF0C\u77AC\u95F4\u6362\u65B0\u88C5\uFF01\u6211\u7231\u6211\u5427\uFF0C\u6211\u51FA\u529B\uFF01</h4>','<div class="skin_items clearfix"></div>',"</div>",'<div class="skin_rank">','<h4 class="week_rank_title">\u672C\u5468\u8D21\u732E\u6392\u884C</h4>','<div class="skin_rank_items clearfix"></div>',"</div>","</div>"].join(""),skinPurchaseHtml:['<div class="skin_purchase">','<p><b>\u6211\u7684T\u8C46\uFF1A<span class="skin_money_remain">#{user_scores}</span></b></p>','<p class="skin_money_wrapper">\u4F60\u8981\u51FA\u529B\uFF1A<input class="skin_money_purchase" type="text"/> T\u8C46',"</p>",'<p class="skin_money_tip"></p>',"<p>",'<a href="#" class="skin_purchase_btn  purchase_submit"></a>','<a href="#" class="skin_purchase_btn  purchase_cancel"></a>','<div class="skin_purchase_set_pass"><p><a class="skin_purchase_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>',"</p></div>"].join(""),skinPurchaseSuccessHtml:["<p><b>\u51FA\u529B\u6210\u529F\uFF01</b></p>",'<p class="skin_money_wrapper">\u9AD8\u7AEF\u5927\u6C14\u534E\u4E3D\u88C5\u4FEE\u5373\u5C06\u5B8C\u6210\uFF01',"</p>",'<p class="skin_success_timeout"><span></span>\u540E\u5C06\u81EA\u52A8\u56DE\u5230\u672C\u5427',"</p>"].join(""),skinPurchaseErrorHtml:["<p><b>\u51FA\u529B\u5931\u8D25\uFF01</b></p>",'<p class="skin_money_wrapper">#{content}</p>','<p class="skin_success_timeout"><span></span>\u540E\u5C06\u81EA\u52A8\u56DE\u5230\u672C\u5427',"</p>"].join(""),skinMap:{1060001:"/tb/static-frs/img/head_skin/1060001.gif",1060002:"/tb/static-frs/img/head_skin/1060002.gif",1060003:"/tb/static-frs/img/head_skin/1060003.gif",1060004:"/tb/static-frs/img/head_skin/1060004.gif",1060005:"/tb/static-frs/img/head_skin/1060005.gif",1060006:"/tb/static-frs/img/head_skin/1060006.gif",1060007:"/tb/static-frs/img/head_skin/1060007.gif",1060008:"/tb/static-frs/img/head_skin/1060008.gif",1060009:"/tb/static-frs/img/head_skin/1060009.gif",1060010:"/tb/static-frs/img/head_skin/1060010.gif",1060011:"/tb/static-frs/img/head_skin/1060011.gif",1060012:"/tb/static-frs/img/head_skin/1060012.gif"},headSkin:$(".card_top"),initial:function(s){try{this.skinId=0,this.skinNeedScore=0,this.forumId=s.forum_id,this.forumName=s.forum_name,this.skinUsedId=s.skin_used_id,this.skinEndTime=s.skin_end_time,this.userScores=parseInt(s.user_scores)||0,this.skinWrapper=$(this.forumSkinHtml),this.skinItems=this.skinWrapper.find(".skin_items"),this.skinRankItems=this.skinWrapper.find(".skin_rank_items"),this.skinPurchaseHtml=$.tb.format(this.skinPurchaseHtml,{user_scores:this.userScores}),PageData.user.setpass&&(this.skinPurchaseHtml=this.skinPurchaseHtml.replace("skin_purchase_set_pass","skin_purchase_set_none")),this.skinPurchase=$(this.skinPurchaseHtml),this.skinMoney=this.skinPurchase.find(".skin_money_purchase"),this.skinTip=this.skinPurchase.find(".skin_money_tip"),this.initHeadSkin(),this.bindEvent()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:105}),i}},initHeadSkin:function(){var s=this.skinUsedId,i=this.skinEndTime,e=Math.floor((new Date).getTime()/1e3);s&&i>=e&&this.skinMap[s]?this.headSkin.css("backgroundImage","url("+this.skinMap[s]+")"):(this.headSkin.css("backgroundImage",""),s="1060001"),this.initGuide(s)},initGuide:function(s){if("1"!=$.cookie("head_skin_guide")){var i=$('<img class="guide_img" src="'+this.skinMap[s]+'"/>').prependTo(this.headSkin);setTimeout(function(){i.fadeIn(1e3,function(){setTimeout(function(){i.animate({opacity:0,width:"-=978",height:"-=96",left:"+=978"},2e3,function(){i.remove(),$.cookie("head_skin_guide","1",{expires:365})})},1e3)})},1e3)}},initSkinDialog:function(){var s=this;this.skinDialog=new $.dialog({html:this.skinWrapper,title:"\u5427\u88C5\u4FEE",width:693,height:450,top:"28%",left:($(window).width()-705)/2,autoCenter:!1}),$(window).on("resize.skin",function(){s.skinDialog.setPosition(($(window).width()-705)/2,"28%")}),this.skinDialog.bind("onclose",function(){$(window).off("resize.skin"),s.initHeadSkin()}),this.skinWrapper.closest(".dialogJcontent").css("padding","0"),this.acquireSkins(),this.skinDialog.show()},initPurchaseDialog:function(){var s=this;this.purchaseDialog=new $.dialog({html:this.skinPurchase,title:"\u63D0\u793A",width:400,height:180}),this.skinDialog.hide(),this.purchaseDialog.show(),this.skinMoney.val("").focus(),this.purchaseDialog.bind("onclose",function(){s.skinTip.empty(),s.skinDialog.show()})},bindEvent:function(){var s=this;$(".head_skin_btn").bind("click",function(){try{s.initSkinDialog()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:194}),i}}),$("body").delegate(".purchase_skin","click",function(){try{if(!PageData.user.is_login)return s.skinDialog.close(),_.Module.use("common/widget/LoginDialog"),void 0;s.skinId=$(this).getData("data-skinid"),s.skinNeedScore=parseInt($(this).getData("data-skinneedscore")),s.initPurchaseDialog()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:204}),i}}).delegate(".purchase_submit","click",function(){try{s.buySkin($(this))}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:206}),i}}).delegate(".purchase_cancel","click",function(){try{s.purchaseDialog.close()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:208}),i}}),$("body").on("click",".skin_pic_wrapper",function(){try{var i=$(this).tbattr("skinid");i&&s.headSkin.css("background-image","url("+s.skinMap[i]+")")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/head_skin/head_skin.js",method:"",ln:214}),e}})},acquireSkins:function(){var s=this,i=(new Date).getTime();url="tbmall/post/getforumskins?t="+i,this.skinItems.html('<div class="all_skin_loading"></div>'),$.get(url,{forum_id:s.forumId},function(i){return 0!=i.no?!1:(s.addAllSkin(i.data),s.addRankSkin(i.data),void 0)})},addAllSkin:function(s){var i=s.cur_skin,e=s.skin;if(s&&e&&0==e.length)return this.skinItems.html("\u76EE\u524D\u8FD8\u6CA1\u6709\u53EF\u4F9B\u8D2D\u4E70\u7684\u76AE\u80A4\u54E6\uFF01"),void 0;for(var n="",t=['<div class="skin_item">','<div class="skin_pic_wrapper" skinid="#{skin_id}" title="\u70B9\u51FB\u9884\u89C8">','<img class="skin_pic" src="/tb/static-frs/img/head_skin/small_#{skin_id}.png">',"#{showEndTime}","</div>","<p>\u4EF7\u683C\uFF1A","<span>#{scores_need}</span>","T\u8C46/","<span>#{keep_time}</span>","\u5929</p>","<p>\u5F53\u524D\u96C6\u8D44\uFF1A","<span>#{scores_have}</span>","T\u8C46</p>","<p>",'<a onclick="return false;" class="#{already_used_skin}" ','data-skinid="#{skin_id}" data-skinneedscore="#{skin_need_score}">',"<span><em>#{already_used_text}</em></span>","</a></p>","</div>"].join(""),a=0;a<e.length;a++){e[a].keep_time=parseInt(e[a].keep_time/86400)||"1";var r={already_used_skin:"ui_btn ui_btn_s purchase_skin ",already_used_text:"\u6211\u8981\u51FA\u529B",skin_need_score:e[a].scores_need-e[a].scores_have};i&&e[a].skin_id==i.skin_id&&(r={already_used_skin:"ui_btn_disable ui_btn_s_disable already_user_skin",already_used_text:"\u4F7F\u7528\u4E2D",scores_have:0,showEndTime:'<div class="show_end_time">\u5230\u671F\u65F6\u95F4\uFF1A'+this.endTimeFormat(i.end_time)+"</div>"}),n+=$.tb.format(t,$.extend(e[a],r))}this.skinItems.empty(),this.skinScroll&&(this.skinScroll=null),this.skinScroll=this.use("common/widget/ScrollPanel",{container:this.skinItems,height:400,content:n})},endTimeFormat:function(s){var i=new Date(1e3*s),e=[i.getMonth()>9?i.getMonth()+1:"0"+(i.getMonth()+1),"\u6708",i.getDate()>=10?i.getDate():"0"+i.getDate(),"\u65E5 ",i.getHours()>=10?i.getHours():"0"+i.getHours(),":",i.getMinutes()>=10?i.getMinutes():"0"+i.getMinutes()].join("");return e},addRankSkin:function(s){function i(s){return 1e6>s?s:(s/1e4).toFixed(2)+"\u4E07"}var e=this,n=s.week_ranking,t=['<div class="skin_rank_item clearfix">','<span class="rank_index #{index_class}">#{index}</span>','<a href="/home/main?un=#{encode_uname}&ie=utf-8&fr=head_skin" target="_blank" class="rank_user_name">#{user_name}</a>','<span class="rank_t_dou">\u51FA\u529B\uFF1A<span class="t_dou_count">#{t_dou}</span></span>',"</div>"].join(""),a="",r={};if(n&&n.length>0)for(var o=0,c=n.length;c>o;o++)r={},2>=o&&(r.index_class="rank_index_top"),r.index=o+1,r.user_name=n[o].user_name,r.encode_uname=encodeURIComponent(n[o].user_name),r.t_dou=i(n[o].scores),a+=$.tb.format(t,r);else a='<div class="empty_rank_txt">\u8FD8\u6CA1\u6709\u571F\u8C6A\u6765\u51FA\u529B\u5462~</div>';this.skinRankItems.empty(),this.rankScroll&&(this.rankScroll=null),this.rankScroll=e.use("common/widget/ScrollPanel",{container:e.skinRankItems,height:410,content:a})},buySkin:function(s){var i=this,e=this.skinMoney.val(),n="/tbmall/post/raisescore?ie=utf-8",t={101:"*\u8BF7\u586B\u5199T\u8C46\u6570\u91CF",102:'*\u60A8\u7684T\u8C46\u4E0D\u8DB3 <a href="/tbmall/getTdou" target="_blank">\u5982\u4F55\u83B7\u53D6T\u8C46>></a>',103:"*\u60A8\u53EA\u9700\u518D\u51FA "+this.skinNeedScore+"T\u8C46 \u5C31\u53EF\u4EE5\u5B8C\u6210\u96C6\u8D44\uFF01"};if(""==e||!e.match(/^\d*$/g)||0==parseInt(e))return this.skinTip.html(t["101"]).show(),void 0;if(e>this.userScores)return this.skinTip.html(t["102"]).show(),void 0;if(e>this.skinNeedScore)return this.skinMoney.val(this.skinNeedScore),this.skinTip.html(t["103"]).show(),void 0;s.removeClass("purchase_submit").addClass("purchase_submit_over");var a=function(t){var r={};t&&$.extend(r,t),$.extend(r,{forum_id:i.forumId,forum_name:i.forumName,skin_id:i.skinId,scores:parseInt(e),tbs:PageData.tbs}),$.post(n,r,function(e){if(s.closest(".uiDialogWrapper").find(".dialogJtitle").remove(),0==e.no)i.skinPurchase.html(i.skinPurchaseSuccessHtml);else{if(2150040==e.no||360007==e.no){var n=i.use("tbmall/component/captcha_payment",{data:e});return n.showCaptcha(a),void 0}if(2270018==e.no||1990005==e.no||2190005==e.no){e.data=e.data||{};var t=i.use("tbmall/widget/paykey_dialog",{showType:2,errType:e.no,errTime:e.data.wrongtime});return t.showDialog(a,function(){s.removeClass("purchase_submit_over").addClass("purchase_submit")},i),void 0}i.skinPurchaseErrorHandler(e.no)}i.setRelocationTime()})},r=Number(e);if(r>=3e4&&!PageData.user.setpass){var o=i.use("tbmall/widget/paykey_dialog",{showType:1});o.showDialog(a,i)}else a()},skinPurchaseErrorHandler:function(s){/^(2270002|2270005|2270007)$/.test(s)||(s=9999999);var i={2270002:{content:"\u672C\u5427\u4E0D\u652F\u6301\u4F7F\u7528\u5427\u88C5\u4FEE\u3002"},2270005:{content:"T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u3002"},2270007:{content:"\u5F53\u524D\u88C5\u4FEE\u6B63\u5728\u4F7F\u7528\uFF0C\u65E0\u6CD5\u8FDB\u884C\u96C6\u8D44\u3002"},9999999:{content:"\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u3002"}};this.skinPurchase.html($.tb.format(this.skinPurchaseErrorHtml,i[s]))},setRelocationTime:function(){var s=this,i=1,e=s.skinPurchase.find(".skin_success_timeout span").text("1s"),n=setInterval(function(){return 0==i?(clearInterval(n),$.tb.location.reload(),!1):(i-=1,e.text(i+"s"),void 0)},1e3)}}});_.Module.define({path:"tbmall/component/util",sub:{_propCategoryMap:{101:"\u53D1\u8D34\u6C14\u6CE1",102:"",103:"\u4E2A\u6027\u6C34\u5370",104:"\u70AB\u5F69\u5B57\u4F53",105:"",106:"",107:"\u9B54\u6CD5\u5F39",108:"\u8865\u7B7E\u795E\u5668",109:"\u52A8\u6001\u5934\u50CF",110:"\u5934\u50CF\u8FB9\u6846",111:"",112:"\u4E2A\u6027\u94ED\u724C",113:"\u540D\u7247\u80CC\u666F",114:"\u94ED\u724C\u91CD\u94F8\u5361",115:"",116:"\u8D34\u6761\u5361",117:"\u633D\u5C0A\u5361"},_freeUseMap:{1070001:12,1070002:12,1080001:8},_badgeMap:{1:"\u8D34\u5427\u4F1A\u5458",2:"\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},initial:function(){},badgeNameMap:function(e){var a=parseInt(e);return a>105e4&&(a-=105e4),this._badgeMap[a]},getFreeUseCount:function(e){return this._freeUseMap[e]},getMaxLevel:function(e){var a=0,t=(new Date).getTime(),n=e||PageData.user.Parr_props;if(!n||!n.level)return 0;var r=n.level;return 1e3*r.end_time>t&&parseInt(r.props_id,10)>a&&(a=parseInt(r.props_id,10)),a},convertNumber:function(e){return e>99999999?Math.round(e/1e8,2)+"\u4EBF":e>99999?Math.round(e/1e4,2)+"\u4E07":e},formatDate:function(e){function a(e){return e>9?e:"0"+e.toString()}var t=new Date(1e3*e);return t.getFullYear()+"\u5E74"+(t.getMonth()+1)+"\u6708"+t.getDate()+"\u65E5 "+a(t.getHours())+":"+a(t.getMinutes())},hasOwnProp:function(e,a){return PageData.props[e]&&PageData.props[e][a]&&1e3*PageData.props[e][a].end_time>Env.server_time},convertToDay:function(e){return Math.ceil(e/86400)+"\u5929"},getCategoryName:function(e){return this._propCategoryMap[e]},getFreeInfo:function(e){var a=this,t='<div class="free_info">';return"1080002"==e.props_id?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span>'):1==e.props_type&&a.getFreeUseCount(e.props_id)?(t+='<span  title="'+a.badgeNameMap(2)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528',t+='<span class="free_use_count">'+a.getFreeUseCount(e.props_id)+"</span>\u4E2A</span>"):1!=e.props_type&&(t+='<span  title="'+a.badgeNameMap(e.free_user_level)+'" >',t+='<a class="j_tbmall_join_vip_btn strong_txt level'+e.free_user_level+'"><span class="icon"></span>\u5F00\u901A'+(2==e.free_user_level?"\u8D85\u7EA7":"")+"\u4F1A\u5458</a>\u514D\u8D39\u4F7F\u7528</span>"),t+="</div>"},hasUsedProp:function(e,a){return PageData.props[e]&&!!PageData.props[e][a]&&!!parseInt(PageData.props[e][a].open_status,10)},hasBadge:function(){return PageData.props.level&&PageData.props.level.prop_id&&1e3*PageData.props.level.end_time>Env.server_time},shouldHaveProp:function(e){return e>0&&this.hasBadge()&&PageData.props.level.prop_id>=e},getBuyInfo:function(e){var a,t,n=this,r="",s=e.props_category,p=e.props_id,o=e.free_user_level,_=n.hasOwnProp(s,p),i=n.hasUsedProp(s,p),u=n.shouldHaveProp(o);return _?"1"===e.is_default_used&&(i?(t="\u53D6\u6D88\u4F7F\u7528",a="j_cancle_use"):(t="\u4F7F\u7528",a="j_use"),r+=['<a href="#" class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")):(u?(a="j_get_button1",t="\u9886\u53D6"):(a="j_buy_button1",t="\u5151&nbsp;&nbsp;\u6362"),r+=['<a class="ui_btn ui_btn_sub_s '+a+'">',"<span><em>"+t+"</em></span>","</a>"].join("")),r}}});_.Module.define({path:"tbmall/component/Dialog",sub:{initial:function(){},dialog:function(n){var t=this;t.customDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+"</div>",title:"\u63D0\u793A",width:430}),t.customDialog.bind("onclose",function(){t.trigger("onInfoClose")}),$(".charge_bean_interaction_j_charge_btn").click(function(){t.customDialog.close()}),$(".charge_bean_interaction_j_close_dialog").click(function(n){n.preventDefault(),t.customDialog.close()})},info:function(n,t){var i=this;t=t||{};var o=t.button||"\u786E \u5B9A";i.infoDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+'<div class="confirm_wrapper theme_info"><a class="ui_btn ui_btn_m yes"><span><em>'+o+"</em></span></a></div></div>",title:t.title||"\u63D0\u793A",width:t.width||430}),i.infoDialog.element.one("click",".yes",function(n){n.preventDefault(),i.infoDialog.close(),i.trigger("onInfoYes")}),i.infoDialog.bind("onclose",function(){i.trigger("onInfoClose")})},confirm:function(n,t){var i=this,o={button:[{txt:"\u786E \u5B9A",extraclass:""},{txt:"\u53D6 \u6D88"}]};t=$.extend(o,t);var e='<a class="ui_btn ui_btn_m yes '+t.button[0].extraclass+'"><span><em>'+t.button[0].txt+'</em></span></a><a class="ui_btn ui_btn_sub_m no"><span><em>'+t.button[1].txt+"</em></span></a>";i.confirmDialog=new $.dialog({html:'<div class="dialog_ctn_wrapper"> '+n+'<div class="confirm_wrapper">'+e+"</div></div>",title:"\u63D0\u793A",width:t.width||430}),$(i.confirmDialog.getElement()).one("click",".yes",function(n){n.preventDefault(),"function"==typeof t.button[0].callback?t.button[0].callback():i.trigger("yes")}).one("click",".no",function(n){n.preventDefault(),"function"==typeof t.button[1].callback?t.button[1].callback():i.trigger("no")})},getConfirmDialog:function(){return this.confirmDialog},enableYesBtn:function(){this.confirmDialog.element.find(".yes").data("clicked",!1)},close:function(){this.confirmDialog&&this.confirmDialog.close()}}});_.Module.define({path:"common/widget/JoinVipDialog",sub:{_body:null,_agreeKnown:!0,_dataMap:{},_badgeLv:"month_v2",_monthNum:3,_use_left_bean:0,_all_scores:0,_user_scores:0,_packet_id:0,_tbs:"",_price:"0",_dialog:null,_badge1_tpl:['	<div class=" tshow_join_vip_block_btn tshow_join_vip_badge_btn "  data-id="month_v1">','<div class="tshow_join_vip_block_btn_info">','<img class="tshow_join_vip_badge_icon" src="http://tieba.baidu.com/tb/cms/tbmall/jzxz_icon.png" /><span class="badge_lv1 ">\u8D34\u5427\u4F1A\u5458</span></div>',"</div>"].join(""),_badge2_tpl:['<div class="tshow_join_vip_block_btn tshow_join_vip_badge_btn badge_lv2  tshow_join_vip_block_btn_active "  data-id="month_v2">','<div class="tshow_join_vip_block_btn_info">','<img class="tshow_join_vip_badge_icon" src="http://tieba.baidu.com/tb/cms/tbmall/wxxz_icon.png" /><span class="badge_lv1 ">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span>',"</div>",'<div class="tshow_join_vip_recommend_tip"></div>',"</div>"].join(""),initial:function(){this._tbs=PageData.tbs,this._bindEvent()},getMemberDialog:function(){return PageData.user.is_login?(this._flowRateTest(),!1):(_.Module.use("common/widget/LoginDialog"),!1)},_bindEvent:function(){var _=this;$("body").off("click.j_join_vip"),$("body").delegate(".j_tbmall_join_vip_btn","click.j_join_vip",function(){return _.getMemberDialog(),!1}).delegate(".tshow_join_vip_badge_btn","click.j_join_vip",function(){_._badgeBtnClickAction(this)}).delegate(".tshow_join_vip_month_count_btn","click.j_join_vip",function(){_._monthBtnClickAction(this)}).delegate(".j_tshow_join_vip_use_leave","click.j_join_vip",function(){_._useLeftBtnClickAction(this)}).delegate("#j_agree_known","click",function(){_._agreeKnown=$(this)[0].checked,1==_._agreeKnown?$(".tshow_join_vip_open_btn_disable").removeClass("tshow_join_vip_open_btn_disable").addClass("tshow_join_vip_open_btn"):$(".tshow_join_vip_open_btn").removeClass("tshow_join_vip_open_btn").addClass("tshow_join_vip_open_btn_disable")}).delegate(".tshow_join_vip_open_btn_content .tshow_join_vip_open_btn","click.j_join_vip",function(){_._getOrderId()}).delegate(".tshow_join_vip_j_charge_success_btn","click.j_join_vip",function(){_._dialog.close(),_._confirmChargeState()}).delegate(".tshow_join_vip_j_charge_fail_btn","click.j_join_vip",function(){_._dialog.close()})},_badgeBtnClickAction:function(_){_=$(_),$(".tshow_join_vip_badge_btn").removeClass("tshow_join_vip_block_btn_active"),this._badgeLv=_.tbattr("data-id"),$(_).addClass("tshow_join_vip_block_btn_active");var i=this;this._getBadgeInfo("need_bean",function(_){i._updatePriceAction(_)})},_monthBtnClickAction:function(_){_=$(_),$(".tshow_join_vip_month_count_btn").removeClass("tshow_join_vip_block_btn_active"),this._monthNum=_.tbattr("data-id"),$(_).addClass("tshow_join_vip_block_btn_active");var i=this;this._getBadgeInfo("need_bean",function(_){i._updatePriceAction(_)})},_useLeftBtnClickAction:function(){var _=this;_._use_left_bean=$(".tshow_join_vip_use_leave")[0].checked?1:0,this._getBadgeInfo("need_bean",function(i){_._updatePriceAction(i)})},_updatePriceAction:function(_){this._price=_,$(".j_cost_total").html(_);var i;this._use_left_bean=$(".tshow_join_vip_use_leave")[0].checked?1:0,i=this._use_left_bean?Math.max(0,_-this._dataMap.use_scores):_,$(".tshow_join_vip_red").html(Math.ceil(i/1e3))},_initDataMap:function(){var _=this;$.get("/tbmall/bwstshow",function(i){if(0==i.no){_._dataMap=i.data;var t=$(".j_month_content"),o=$(".j_badge_content");$(".j_tshow_join_vip_block_use_scores").html(_._dataMap.use_scores),$(".j_tshow_join_vip_block_all_scores").html(_._dataMap.all_scores);for(var n=0;n<i.data.month_v1.length;n++)t.append('	<div class="tshow_join_vip_block_btn tshow_join_vip_month_count_btn '+(3==n?"tshow_join_vip_block_btn_active":"")+'"  data-id="'+i.data.month_v1[n].month_num+'" >'+i.data.month_v1[n].month_num+"\u4E2A\u6708"+(3==n?'<div class="tshow_join_vip_recommend_tip"></div>':"")+"</div>");_._dataMap.user.Parr_props&&_._dataMap.user.Parr_props.level&&2==_._dataMap.user.Parr_props.level.props_id&&1e3*_._dataMap.user.Parr_props.level.end_time>(new Date).getTime()||o.append(_._badge1_tpl),o.append(_._badge2_tpl),_._use_left_bean=$(".badge_lv2").trigger("click"),$(".tshow_join_vip_month_count_btn").eq(3).trigger("click")}else _._showDialog("\u9519\u8BEF\u63D0\u793A","\u83B7\u53D6\u4FE1\u606F\u5931\u8D25",200)})},_build:function(){var _=['<div id="tshow_join_vip_wrapper">','<div class="tshow_join_vip_block clearfix">','<div class="tshow_join_vip_block_title">\u5F00\u901A\u4F1A\u5458\u7C7B\u578B\uFF1A</div>','<div class="tshow_join_vip_block_content j_badge_content">',"</div>","</div>",'<div class="tshow_join_vip_block clearfix">','<div class="tshow_join_vip_block_title">\u5F00\u901A\u65F6\u957F\uFF1A</div>','<div class="tshow_join_vip_block_content j_month_content">',"</div>","</div>",'<div class="tshow_join_vip_block clearfix">','<div class="tshow_join_vip_block_title tshow_join_vip_block_bottom"></div>','<div class="tshow_join_vip_block_content tshow_join_vip_block_bottom">','<span class="contsigncard_tip"><span class="red_sign">*</span>\u5F00\u901A12\u4E2A\u6708\u8D85\u7EA7\u4F1A\u5458\u8D60\u9001<span class="strong_txt">\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20</span></span>',"</div>","</div>",'<div class="tshow_join_vip_block clearfix">','<div class="tshow_join_vip_block_title tshow_join_vip_block_bottom">\u603B\u4EF7\uFF1A</div>','<div class="tshow_join_vip_block_content tshow_join_vip_block_bottom">','<div class="tshow_join_vip_block_info"><span class="j_cost_total tshow_cost_total">360000</span>T\u8C46 <input type="checkbox" class="tshow_join_vip_use_leave j_tshow_join_vip_use_leave" name="use_leave" /><span class="tshow_join_vip_block_tip" >\u4F7F\u7528T\u8C46\u4F59\u989D(\u53EF\u7528\u4F59\u989D<span class="j_tshow_join_vip_block_use_scores" >\u52A0\u8F7D\u4E2D..</span> \u603B\u4F59\u989D<span  class="j_tshow_join_vip_block_all_scores" >\u52A0\u8F7D\u4E2D..</span>)</span></div >',"</div>","</div>",'<div class="tshow_join_vip_block clearfix">','<div class="tshow_join_vip_block_title tshow_join_vip_block_bottom">\u9700\u8981\u82B1\u8D39\uFF1A</div>','<div class="tshow_join_vip_block_content tshow_join_vip_block_bottom">','<div class="tshow_join_vip_block_info"><span class="tshow_join_vip_info"><span class="tshow_join_vip_red">360</span>\u767E\u5EA6\u70B9\u5238(1\u70B9\u5238 = 1000T\u8C46 = 1\u5143\u4EBA\u6C11\u5E01)</span></div >',"</div>","</div>",'<div class="tshow_join_vip_block tshow_join_vip_open_btn_section">','<div class="tshow_join_vip_open_btn_content clearfix">','<div class="tshow_join_vip_open_btn"><i  class="tshow_join_vip_open_btn_left"></i>\u7ACB\u5373\u5F00\u901A</div>','<div class="tshow_join_vip_open_btn_tip"><input type="checkbox" checked id="j_agree_known" name="agree" /><a href="/tb/tdouprecautions.html" target="_blank">\u540C\u610FT\u8C46\u4F7F\u7528\u987B\u77E5</a></div>',"</div>","</div>","</div>",'<div class="tshow_cont_sign_intro"><div class="question"><span class="question-icon"></span>\u4EC0\u4E48\u662F\u8FDE\u7EED\u7B7E\u5230\u5361</div> <div class="answer">\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361,\u53EF\u628A\u67D0\u4E2A\u5427\u6240\u6709\u7684\u7B7E\u5230\u5929\u6570\u8FDE\u7EED\u5728\u4E00\u8D77!</div></div> '].join("");this._body=$(_),this._showDialog("\u5F00\u901A\u8D34\u5427\u4F1A\u5458",this._body,650)},_chargingDialog:function(){var _="<p class='tshow_join_vip_dialog_content'>\u8BF7\u5728\u65B0\u6253\u5F00\u7684\u9875\u9762\u4E0A\u5B8C\u6210\u5F00\u901A\u4F1A\u5458\u7684\u652F\u4ED8\u64CD\u4F5C</p><p class='tshow_join_vip_dialog_second_content'>\u652F\u4ED8\u5B8C\u6210\u524D&nbsp;&nbsp;&nbsp;&nbsp;\u8BF7\u52FF\u5173\u95ED\u7A97\u53E3</p><div class='tshow_join_vip_dialog_btn_wrap'><a class='tshow_join_vip_charge_btns tshow_join_vip_j_charge_success_btn'>\u652F\u4ED8\u6210\u529F</a><a class='tshow_join_vip_charge_btns tshow_join_vip_j_charge_fail_btn'>\u652F\u4ED8\u5931\u8D25</a></div>";this._showDialog("\u5145\u503CT\u8C46",_,500)},_getBadgeInfo:function(_,i){for(var t=0;t<this._dataMap[this._badgeLv].length;t++)if(this._dataMap[this._badgeLv][t].month_num==this._monthNum){if(!i)return this._dataMap[this._badgeLv][t][_];i(this._dataMap[this._badgeLv][t][_]);break}},_getOrderId:function(){var _=this,i=_._price<=_._dataMap.all_scores&&_._use_left_bean;if(this._dialog.close(),!i){this._chargingDialog();var t=window.open("about:blank")}this._getBadgeInfo("packet_id",function(i){_._packet_id=i});var o={ie:"utf-8",tbs:this._tbs,packet_id:this._packet_id};o.use_left_bean=_._use_left_bean,$.ajax({type:"POST",url:"/tbmall/buytshow",dataType:"json",data:o,success:function(o){switch(o.no){case 0:!i&&o.data.dubi_url?(_._order_id=o.data.order_id,t.location=o.data.dubi_url):_._bubble=_._showBubble("<span class='tshow_join_vip_charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5F00\u901A\u4F1A\u5458",1500,"canClose",function(){$.tb.location.reload()});break;default:_._showDialog("\u64CD\u4F5C\u5931\u8D25",o.no,200)}}})},_confirmChargeState:function(){var _=this,i=6;this._bubble=this._showBubble("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+i+"\u79D2...");var t=setInterval(function(){if(i--,_._bubble.html("\u6B63\u5728\u9A8C\u8BC1\u652F\u4ED8\u4E2D\uFF0C\u8BF7\u7A0D\u5019"+i+"\u79D2..."),i%2==0){var o={ie:"utf-8",tbs:_._tbs,order_id:_._order_id};$.ajax({type:"POST",url:"/tbmall/checkorder",dataType:"json",data:o,success:function(o){switch(o.no){case 0:1e4==o.data.result_code&&(_._closeBubble(_._bubble),_._bubble=_._showBubble("<span class='tshow_join_vip_charge_btns success_bubble_icon' ></span><span class='small_bubble_content'>\u5DF2\u6210\u529F\u5F00\u901A\u4F1A\u5458",1500,"canClose",function(){$.tb.location.reload()}),clearInterval(t)),0>=i&&(_._closeBubble(_._bubble),_._bubble=_._showBubble("<span class='tshow_join_vip_charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,\u5F00\u901A\u4F1A\u5458\u6CA1\u6709\u6210\u529F</span>",1500,"canClose"),clearInterval(t));break;case 1:case 2:default:0>=i&&(_._closeBubble(_._bubble),_._bubble=_._showBubble("<span class='tshow_join_vip_charge_btns fail_bubble_icon' ></span><span class='small_bubble_content'>\u62B1\u6B49,\u7CFB\u7EDF\u51FA\u73B0\u5F02\u5E38,\u8BF7\u5237\u65B0\u9875\u9762\u67E5\u770B\u4EA4\u6613\u8BB0\u5F55</span>",1500,"canClose"),clearInterval(t))}},error:function(){_._bubble.html("<p>\u672A\u77E5\u9519\u8BEF</p>"),clearInterval(t)}})}0>=i&&clearInterval(t)},1e3)},_showDialog:function(_,i,t){this._dialog=new $.dialog({html:i,title:_,width:t,hideOnclose:!1,draggable:!1,closeable:!0})},_showBubble:function(_,i,t,o){var n=$("<div class='small_bubble_block'  ></div>");return n.append(_),$("body").append(n),n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2}),$(window).resize(function(){n.css({left:$(window).width()/2-n.width()/2,top:$(window).height()/2})}),t&&n.click(function(){$(this).remove()}),i?(this._closeBubble(n,i,o),void 0):n},_closeBubble:function(_,i,t){i&&i>0?setTimeout(function(){_.fadeOut("normal",function(){_.remove(),"function"==typeof t&&t()})},i):_.fadeOut("normal",function(){_.remove()})},_flowRateTest:function(){var _=window.open("");$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1",function(i){i.data&&(_.location.href=i.data)})}}});_.Module.define({path:"tbmall/widget/ContSignCard",requires:["tbmall/component/util","tbmall/component/Dialog","common/widget/JoinVipDialog"],sub:{_card_count:0,_tpl:'<div class="header">\u70B9\u51FB\u6211\u5173\u6CE8\u7684\u5427\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361\uFF08<span class="condition">\u6CE8\uFF1A\u4F7F\u7528\u6761\u4EF6\u4E3A\u7D2F\u8BA1\u7B7E\u5230\u5929\u6570\u2265100\u5929\uFF0C\u4EC5\u4F1A\u5458\u53EF\u4EE5\u4F7F\u7528</span>\uFF09\uFF1A</div><div id="j_signable_list" class="signable_list"><img class="loading" src="http://tb1.bdstatic.com/tb/static-tbmall/img/loading.gif"></div><div class="bottom_info"><div class="my_cont_card">\u6211\u6709<span class="j_card_count orange_txt">0</span>\u5F20<span class="orange_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></div><p class="">\u8FDE\u7EED\u7B7E\u5230\u5361\u5C06\u628A\u9009\u4E2D\u5427\u6240\u6709\u7684\u7B7E\u5230\u5929\u6570\u8FDE\u7EED\u5728\u4E00\u8D77\uFF01</p> </div> <div class="free_info"><span title="\u8D85\u7EA7\u8D34\u5427\u4F1A\u5458"><a class="j_tbmall_join_vip_btn strong_txt level2"><span class="icon"></span>\u4E00\u6B21\u5145\u503C12\u4E2A\u6708\uFF0C</a>\u9001\u4E09\u5F20</span> </div>',initial:function(){var t=this;return t.util=t.use("tbmall/component/util"),t.mdialog=t.use("tbmall/component/Dialog"),t.vip=t.use("common/widget/JoinVipDialog"),PageData.user.is_login?(t.build(),t.loadSignableList(),t.bindEvent(),void 0):(_.Module.use("common/widget/LoginDialog"),void 0)},showMemberOnly:function(){var t=this,e=['<div id="sign_tip_forNoMember" class="sign_tip_forNoMember">',"<p><span>\u8FDE\u7EED\u7B7E\u5230\u5361</span>\u662F\u4F1A\u5458\u4E13\u5C5E\u9053\u5177,\u6210\u4E3A\u4F1A\u5458\u5373\u53EF\u4F7F\u7528!</p>",'<a class="ui_btn ui_btn_m j_openMember" href="#"><span><em>\u9A6C\u4E0A\u5F00\u901A</em></span></a>','<p><a class="j_tbmall_join_vip_btn level2_icon" href="#">\u5145\u6EE112\u4E2A\u6708\u8D85\u7EA7\u4F1A\u5458</a>\u9001\u4E09\u5F20</p>',"</div>"].join(""),i=new $.dialog({html:e,title:"\u63D0\u793A",width:430,height:100});$("#sign_tip_forNoMember").delegate(".j_openMember","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()}),$("#sign_tip_forNoMember").delegate(".j_tbmall_join_vip_btn","click",function(e){e.preventDefault(),i.close(),t.vip.getMemberDialog()})},build:function(){var t=this;this._dialog=new $.dialog({title:"\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361",html:t._tpl,width:662,holderClassName:"cont_sign_dialog",fixed:!1}),this._listdom=this._dialog.element.find("#j_signable_list")},loadSignableList:function(){var t=this,e="";$.tb.get("/tbmall/get/getContSignableList",function(i){if(i&&0==i.no){var a=i.data.list;if(a.length){for(var n=0,l=a.length;l>n;n++)e+='<a href="/f?kw='+encodeURIComponent(a[n].forum_name)+'&ie=utf-8" target="_blank" data-fid="'+a[n].forum_id+'" class="signable_ba j_signable_ba">'+$.tb.subByte(a[n].forum_name,11)+'<span class="forum_level lv'+a[n].level_id+'"></span></a> ';t._listdom.html(""),_.Module.use("common/widget/ScrollPanel",[{content:e,container:t._listdom,height:210}])}else e='<div class="no_signable_tip gray_txt">\u6CA1\u6709\u68C0\u6D4B\u5230\u4F60\u6709\u7D2F\u8BA1\u7B7E\u5230\u2265100\u5929\uFF0C\u6216\u8005\u65AD\u7B7E\u7684\u5427\uFF0C\u8BF7\u6838\u5B9E\u540E\u5237\u65B0\u9875\u9762\u3002</div>',t._dialog.element.find("#j_signable_list").height(280).html(e);t._card_count=i.data.card_count,t._dialog.element.find(".j_card_count").text(i.data.card_count)}else e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u5173\u95ED\u7A97\u53E3\u91CD\u65B0\u52A0\u8F7D",t._dialog.element.find("#j_signable_list").html(e)})},bindEvent:function(){var t=this;this._dialog.element.on("click",".j_signable_ba",function(e){return t.util.getMaxLevel()?($(this).hasClass("signed")||(e.preventDefault(),t.showBubble($(this))),void 0):(e.preventDefault(),t._dialog.close(),t.showMemberOnly(),void 0)}),this._dialog.bind("onclose",function(){t._bubble&&t._bubble.closeBubble()})},showBubble:function(t){var e=this;if(!e._isAjaxing){var i=t.data("fid"),a=t.offset(),n={arrow_dir:"up",bubble_css:{top:a.top+37,left:a.left-39,width:172,height:69,zIndex:6e4},arrow_pos:{left:87},wrap:$("body"),closeBtn:!0},l='<div class="card_bubble_content"><span>\u6CA1\u6709<span class="blue_txt">\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a href="/tbmall/propslist?category=108" target="_blank" class="ui_btn ui_btn_sub_s j_buy_card"><span><em>\u7ACB\u5373\u8D2D\u4E70</em></span></a> </div></div>',s='<div class="card_bubble_content"><span>\u9700\u8981\u6D88\u8017<span class="blue_txt">1\u5F20\u8FDE\u7EED\u7B7E\u5230\u5361</span></span><div><a class="ui_btn ui_btn_sub_s j_use_card"><span><em>\u786E \u5B9A</em></span></a> </div></div>',o='<div class="card_bubble_content"><span class="blue_txt">\u5DF2\u7ECF\u6210\u529F\u4F7F\u7528\u8FDE\u7EED\u7B7E\u5230\u5361,\u70B9\u51FB\u5427\u540D\u67E5\u770B</span></div>',_='<div class="card_bubble_content"><span>\u8FDE\u7EED\u7B7E\u5230\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5~</span></div>';e._bubble&&e._bubble.closeBubble(),n.content=e._card_count<1?l:s,e._bubble=new UiBubbleTipBase(n),e._bubble.j_bubble.one("click",".j_buy_card",function(){e._bubble.closeBubble()}).one("click",".j_use_card",function(a){a.preventDefault(),e._isAjaxing=!0,e._bubble.setContent('<div class="card_bubble_content"><img src="http://tb1.bdstatic.com/tb/static-tbmall/img/loading.gif">\u6B63\u5728\u8FDE\u7EED\u7B7E\u5230...</div>'),$.tb.post("/tbmall/post/useContSignCard",{forum_id:i,tbs:PageData.tbs},function(i){e._isAjaxing=!1,i&&0==i.no?(e._card_count--,e._card_count=Math.max(0,e._card_count),e._dialog.element.find(".j_card_count").text(e._card_count),e._bubble.setContent(o),t.addClass("signed")):e._bubble.setContent(_)})}),e._bubble.showBubble()}}}});_.Module.define({path:"ucenter/widget/sign_mod",sub:{_jq_wrap:null,_options:{},initial:function(n,i){this._jq_wrap=n,this._options=$.extend(this._options,i),this.signRank.options=i,this.signRank.sign_init(n,this._options),this.signRank.pvLog()},signRank:{sign_url:"/sign/add",sign_forum:"/sign/info",get_url:"/sign/loadmonth",month_url:"/sign/month",sign_card:null,sign_year:null,sign_month:null,orign_year:null,orign_month:null,rights_tips:[null,null,null,null,null],mouseEventTimer:null,rightsTipsTimer:null,isReplenishing:!1,rplnBubble:null,resign_card_num:0,rpln_available_time:13858272e5,jq_wrap:null,_resignMap:{2280001:"\u60A8\u5C1A\u5728\u9ED1\u540D\u5355\u4E2D\uFF0C\u4E0D\u80FD\u64CD\u4F5C",2280002:"\u4EB2\uFF0C\u60A8\u5DF2\u88AB\u5C01\u7981\uFF0C\u7B7E\u5230\u6210\u529F\uFF0C\u4F46\u65E0\u6CD5\u6DA8\u7ECF\u9A8C\u54E6~",2280003:"\u7B7E\u5230\u592A\u9891\u7E41\u4E86\u70B9\uFF0C\u4F11\u606F\u7247\u523B\u518D\u6765\u5427:)",2280004:"\u5F53\u524D\u7B7E\u5230\u4EBA\u6570\u592A\u591A\uFF0C\u8BF7\u7A0D\u540E\u518D\u7B7E",2280005:"\u7B7E\u5230\u592A\u9891\u7E41\u4E86\u70B9\uFF0C\u4F11\u606F\u7247\u523B\u518D\u6765\u5427:)",2280006:"\u60A8\u5DF2\u7ECF\u7B7E\u8FC7\u5230\u4E86\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u7B7E\u5230^_^",2280007:"\u7B7E\u5230\u670D\u52A1\u5FD9\uFF0C\u8BF7\u91CD\u65B0\u7B7E\u5230",2280008:"\u670D\u52A1\u5668\u6253\u76F9\u4E86\uFF0C\u518D\u7B7E\u4E00\u6B21\u53EB\u9192\u5B83",2280009:"\u8BE5\u7528\u6237\u6CA1\u6709\u7B7E\u5230",2280010:"\u670D\u52A1\u5668\u6253\u76F9\u4E86\uFF0C\u518D\u7B7E\u4E00\u6B21\u53EB\u9192\u5B83",2280011:"\u670D\u52A1\u5668\u6253\u76F9\u4E86\uFF0C\u518D\u7B7E\u4E00\u6B21\u53EB\u9192\u5B83",2280012:"\u8865\u7B7E\u5361\u4E0D\u8DB3\uFF0C\u8BF7\u5148\u8D2D\u4E70\u8865\u7B7E\u5361",2280013:"\u6570\u636E\u5E93\u8BBF\u95EE\u6210\u529F\uFF0C\u4F46\u6570\u636E\u4E0D\u5B58\u5728",2280014:"\u8865\u7B7E\u5361\u4F7F\u7528\u6570\u636E\u91CF\u8D85\u8FC7\u9650\u5236\uFF0C\u8BF7\u660E\u65E5\u7EE7\u7EED"},_client_html:['<div class="sign_card">','<h2 class="sign_card_title">'+PageUnit.load("sign_mod_card_title")+"</h2>",'<div class="sign_card_detail">'+PageUnit.load("sign_mod_card_detail")+"</div>",'<a href="http://c.tieba.baidu.com/c/s/download/pc?src=webtb&t=2&tab=5#img5" target="_blank" class="sign_card_positive_btn">',PageUnit.load("sign_mod_card_positive_btn")+"</a>",'<a href="/home/main?id='+PageData.user.portrait+'#scardsign" target="_blank" class="sign_card_sign_btn">'+PageUnit.load("sign_mod_card_no_txt")+"</a>","</div>"].join(""),sign_init:function(n,i){var e=this,s=this.jq_wrap=n;if("sign_rank"==$.cookie("add_sign")&&(PageData.is_sign_in||e.showCardBeforeSign(),$.cookie("add_sign",null)),"true"==$.cookie("sign_not_now")&&(s.find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing"),setTimeout(function(){s.find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")},1e4)),PageData.is_sign_in)e.sign_resetdate(),e.sign_load_month(0),e.cal_mouseEnterOut(),setInterval(function(){e.refresh_sign_rank()},3e5);else{{var t=new Date(Env.server_time);t.getDay()}s.find(".j_signbtn").addClass("j_cansign")}s.on("click",".j_cont_sign_card",function(n){n.preventDefault();var i=$(".j_sign_succ_keep").text(),s=$(".j_sign_succ_count").text();$(this).hasClass("j_need_judge")&&i==s?e.showAlreadyUsed($(this)):_.Module.use("tbmall/widget/ContSignCard")}),s.on("click",".j_onekey_btn",function(n){PageData.user.is_login||(n.preventDefault(),_.Module.use("common/widget/LoginDialog"))}),s.find(".j_btn_getmember").on("click",function(){return _.Module.use("common/widget/JoinVipDialog",[],function(n){n.getMemberDialog()}),!1}),s.on("click",".j_cansign",function(){PageData.user.is_login?PageData.user.is_black?e.show_block_sign_dialog():e.showCardBeforeSign():_.Module.use("common/widget/LoginDialog",["","",function(){$.cookie("add_sign","sign_rank",{expires:14}),$.tb.location.reload()}])}),s.find(".j_calendar_month_prev").click(function(){var n=new Date(e.sign_year,e.sign_month-1,1),i=new Date(e.orign_year-2,e.orign_month-1,1),s=new Date(2012,6,1);n.getTime()<=i.getTime()||n.getTime()<=s.getTime()||e.set_sign_calendar("",e.sign_year,e.sign_month,-1)}),s.find(".j_calendar_month_next").click(function(){e.sign_year>e.orign_year||e.sign_year==e.orign_year&&e.sign_month>=e.orign_month||e.set_sign_calendar("",e.sign_year,e.sign_month,1)}),PageData.user.is_login&&(s.find(".j_sign_rights").show(),s.find(".j_sign_rights_icon").each(function(n,i){$(i).mouseover(function(){e.rightsTipsTimer=setTimeout(function(){e.sign_right_tips(n)},400)}).mouseout(function(){window.clearInterval(e.rightsTipsTimer),e.rightsTipsTimer=window.setTimeout(function(){null!=e.rights_tips[n]&&e.rights_tips[n].hideBubble()},10)})}));var a=PageData.user,r=a.mPaar_props&&a.mParr_props.level&&a.mParr_props.level.props_id>0&&a.mParr_props.level.end_time>Env.server_time/1e3,o="sign_box_bright_hover";o=i.hasClass?r?"sign_box_member_bright_hover":"sign_box_bright_hover":r?"sign_box_member_bright_noclass_hover":"sign_box_bright_noclass_hover";var l=s.find(".j_sign_box");l.hover(function(){$(this).addClass(o)},function(){$(this).removeClass(o)});var g=s.find(".j_sign_dir_tip"),d=g.html();g.html("");var c={content:d,arrow_dir:"up",bubble_css:{top:-12,left:i.hasClass?4:50,width:i.hasClass?"pb"==i.page?192:200:120,"text-align":"left"},arrow_pos:{right:i.hasClass?30:-9},attr:" id='tb_message_tip_n' ",wrap:g,closeBtn:!1},u=new UiBubbleTipBase(c),m=l.find(".j_signdir");m.bind("mouseenter",function(){g.show(),u.showBubble()}).bind("mouseleave",function(){u.hideBubble()});var p=$(".lack_sign_monthly_tip_card");s.find(".j_lack_sign_monthly_help").on("click",function(n){n.preventDefault(),p.fadeIn("fast")}).on("mouseleave",function(){p.timeout=setTimeout(function(){p.fadeOut("fast")},1e3)}),p.on("mouseenter",function(){clearTimeout(p.timeout),p.fadeIn("fast")}).on("mouseleave",function(){p.fadeOut("fast")}),s.find(".j_sign_tip_1key_icon").on("click",function(){$.stats.track("\u7B7E\u5230_\u4E00\u952E\u7B7E\u5230icon","\u7B7E\u5230\u6539\u9020",{obj_type:"\u7B7E\u5230",obj_url:$(this).tbattr("href")})})},showAlreadyUsed:function(n){this._alreadyUsedBb&&this._alreadyUsedBb.closeBubble();var i={content:"\u672C\u5427\u6240\u6709\u7B7E\u5230\u5DF2\u7ECF\u8FDE\u7EED\uFF0C\u8BF7\u53BB\u522B\u7684\u5427\u770B\u770B",arrow_dir:"down",bubble_css:{top:-40,left:8,width:143,height:53},arrow_pos:{left:70},wrap:n.parent(),closeBtn:!0};this._alreadyUsedBb=new UiBubbleTipBase(i),this._alreadyUsedBb.showBubble()},showCardBeforeSign:function(){var n=this,i=$(".j_signbtn");"1"==$.cookie("showCardBeforeSign")||n.sign_card?n.sign_add():_.Module.use("common/widget/Card",[{content:n._client_html,arrow_dir:"up",card_css:{width:197,top:i.offset().top+i.height()+11,left:i.offset().left},card_leave_hide:!0}],function(i){n.sign_card=i,n.bindCardEvent(),i.showCard(),$.cookie("showCardBeforeSign","1",{expires:1})})},bindCardEvent:function(){var n=this;$(".sign_card_negative_btn").on("click",function(i){i.preventDefault(),n.sign_card&&n.sign_card._j_card.hide(),n.sign_add()})},sign_resetdate:function(){var n=new Date(Env.server_time);this.sign_year=this.orign_year=n.getFullYear(),this.sign_month=this.orign_month=n.getMonth()+1},cal_mouseEnterOut:function(){var n=this,i=this.jq_wrap;i.find(".j_sign_replenish_button").off().on("click",function(e){e.preventDefault(),"none"==i.find(".j_succ_info").css("display")&&(n.orign_year!=n.sign_year||n.orign_month!=n.sign_month)&&(n.sign_resetdate(),n.sign_load_month(0)),window.clearInterval(n.mouseEventTimer),n.mouseEventTimer=setTimeout(function(){i.find(".j_succ_info").stop(!0,!0).show()},400)}),i.find(".j_signbtn,.j_succ_info").die().live({mouseout:function(){window.clearInterval(n.mouseEventTimer),n.mouseEventTimer=window.setTimeout(function(){i.find(".j_succ_info").fadeOut("slow")},200)},mouseover:function(){"none"==i.find(".j_succ_info").css("display")&&(n.orign_year!=n.sign_year||n.orign_month!=n.sign_month)&&(n.sign_resetdate(),n.sign_load_month(0)),window.clearInterval(n.mouseEventTimer),n.mouseEventTimer=setTimeout(function(){i.find(".j_succ_info").stop(!0,!0).show()},400)}})},cal_mouseEventRemove:function(){window.clearInterval(self.mouseEventTimer),this.jq_wrap.find(".j_signbtn,.j_succ_info").die()},sign_add:function(n){var i=this,e={kw:$.tb.escapeHTML(PageData.forum.forum_name),tbs:PageData.tbs,ie:"utf-8"};$.extend(e,n),this.jq_wrap.find(".j_signbtn").removeClass("j_cansign").addClass("signstar_ing"),$.tb.post(i.sign_url,e,function(n){if(!n||0!=n.no&&1104!=n.no)if(n&&40==n.no)_.Module.use("common/component/CaptchaDialog",{message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\u5B8C\u6210\u7B7E\u5230",vCode:n.data.captcha_vcode_str,vCodeType:n.data.captcha_code_type,title:"\u7B7E\u5230",forumName:"",forumId:"",checkUrl:"/sign/checkVcode",vCodeUrl:"/sign/getVcode",paramsCallback:function(){return{tbs:PageData.tbs}}},function(n){n.bind("onaccept",function(){i.sign_add({captcha_input_str:n.getInputValue(),captcha_vcode_str:n.getVCode()})}),n.bind("onclose",function(){i.jq_wrap.find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")}),n.show()});else{setTimeout(function(){i.jq_wrap.find(".j_signbtn").removeClass("signstar_ing").addClass("j_cansign")},1e4);var e=new Date;if(e.setTime(e.getTime()+1e4),$.cookie("sign_not_now",!0,{expires:e}),1007==n.no){var s=i.jq_wrap.find(".j_signbtn");s.removeClass().addClass("j_signbtn signstar_full")}else new $.dialog({html:"<div class='signmod_likeandsign_dialog'>"+i._resignMap[n.no]||n.error+"</div>",holderClassName:"passportDialog",title:"\u7B7E\u5230\u5931\u8D25",draggable:!1,width:338,height:87})}else{var t=n.data.uinfo,a=new Date(t.sign_time);i.sign_year=i.orign_year=a.getFullYear(),i.sign_month=i.orign_month=a.getMonth()+1,i.sign_load_month(1),PageData.userfortune&&PageData.userfortune.has_fortune_bag&&i.handlePrintFlower(t.print_sign_rank,t.print_sign_keep),PageData.is_activity_sign&&$.tb.location.reload()}},"json")},printFlower:function(n,i,e,s){var t=PageData.forum.forum_id,a=PageData.userfortune&&PageData.userfortune.data_fortune_bag&&PageData.userfortune.data_fortune_bag.icon,_='<div class="content_1">\u606D\u559C\u4F60\u8FBE\u6210<span class="notice_color">\u672C\u5427\u4ECA\u65E5\u7B7E\u5230\u4EFB\u52A1</span>\uFF0C\u83B7\u5F97<img class="flower_img" src="'+a+'" width=15 height=15 ><span class="notice_color">+'+n+"</span>\u5956\u52B1</div>",r="";r=s>=i?'<p class="notice_app">\u540C\u65F6\u4F60\u662F\u672C\u5427\u7B7E\u5230\u7B2C'+i+'\u540D\uFF0C\u989D\u5916\u83B7\u5F97<img class="flower_img" src="'+a+'" width=15 height=15 ><span class="notice_color">+'+e+"</span>\u5956\u52B1</p>":'<p class="notice_app">\u5982\u679C\u6210\u4E3A\u672C\u5427\u7B7E\u5230\u524D'+s+"\u540D\uFF0C\u8FD8\u6709\u989D\u5916\u5956\u52B1\u54E6\uFF01</p>";var o='<img class="flower_img" src="'+a+'" width=15 height=15 ><a class="j_print_flower print_flower" href="http://tieba.baidu.com/p/2916765309" target="_blank">\u5370\u82B1\u662F\u4EC0\u4E48\uFF1F</a>',l='<div class="print_button"><a href="#" class="ui_btn ui_btn_m j_print_ok"><span><em>\u597D \u7684</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_tips j_print_no"><span><em>\u4E0D\u518D\u63D0\u793A</em></span></a></div>',g='<div class="frs_stamp_notice">'+_+r+o+l+"</div>",d=$.dialog.open(g,{width:428,noTitle:!0});$.stats.track("stamp_flower_sign","fudai","frs/pb","click"),$(".j_print_ok").click(function(){d.close()}),$(".j_print_no").click(function(){d.close(),$.cookie("bless_sign_"+t,!0,365)}),$(".j_print_flower").click(function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")})},handlePrintFlower:function(n,i){var e=this,s=PageData.forum.forum_id,t=$.cookie("bless_sign_"+s),a=PageData.userfortune,_=a&&a.data_fortune_bag&&a.data_fortune_bag.sign,r=a&&a.data_fortune_bag&&a.data_fortune_bag.sign_order,o=0,l=0,g=0,d=0;for(var c in _)i>=c&&(o=c,l=_[c]);for(var u in r)if(u>=n){g=u,d=r[u];break}var m=0;for(var p in r)m=p;!t&&PageData.userfortune.data_fortune_bag.sign&&e.printFlower(l,n,d,m)},sign_load_month:function(n,i,e){var s=this;$.tb.get(s.get_url,{kw:$.tb.escapeHTML(PageData.forum.forum_name),ie:"utf-8",sign_y:i,sign_m:e,t:Math.random()},function(t){if(t&&0==t.no){s.jq_wrap.find(".j_signin_index").html(t.data.sign_user_info.rank),s.jq_wrap.find(".j_succ_text").html(s.succ_text(PageData.sign_forum_info&&PageData.sign_forum_info.current_rank_info.sign_rank,t.data.sign_user_info.rank,PageData.sign_forum_info.forum_info&&PageData.sign_forum_info.forum_info.level_1_dir_name,t.data.sign_user_info.sign_keep)),s.jq_wrap.find(".j_sign_succ_keep").html(t.data.sign_user_info.sign_keep),s.jq_wrap.find(".j_sign_succ_count").html(t.data.sign_user_info.sign_total),s.setReplenishInfo(t),$(".j_sign_month_lack_days").text(t.data.resign_info.mon_miss_sign_num),i&&e||(s.sign_resetdate(),s.set_sign_calendar(t)),s.signShai(t),s.check_rights_status(t.data.sign_user_info.sign_keep);var a=s.jq_wrap.find(".j_signbtn"),_=s.jq_wrap.find(".j_sign_box");if(_[0]&&_.addClass("sign_box_bright_signed"),a.removeClass().addClass("j_signbtn signstar_signed"),n){var r=t.data.sign_user_info.sign_keep;s.jq_wrap.find(".j_succ_info").show(),a.append('<span class="sign_keep_span">\u8FDE\u7EED'+r+"\u5929</span>"),(30==r||100==r)&&s.sign_100({username:PageData.user.user_name,forumname:PageData.forum.forum_name,memberCount:PageData.memberNumber,memberTitle:PageData.memberTitle,continueSign:r});var o={normal:[2,4],baidubrowser:[3,5],member:[8,10],seniormember:[12,14]},l=r>1?1:0,g="normal";try{g="baidubrowser.tieba"==window.external.GetVersion("version")?"baidubrowser":"normal"}catch(d){}if(PageData.user.mParr_props&&PageData.user.mParr_props.level){var c=PageData.user.mParr_props.level;1e3*c.end_time>+new Date&&(g=2==c.props_id?"seniormember":1==c.props_id?"member":"normal")}var u='<div style="position:absolute;"><div class="sign_plus_two">+'+o[g][l]+" \u7ECF\u9A8C</div></div>";PageData.user.is_like&&!PageData.user.is_block&&(s.jq_wrap.find(".signed_day:last").append(u),setTimeout(function(){$(".sign_plus_two").show().animate({opacity:0,top:"-=20"},2500,function(){$(this).parent().remove()})},1e3)),s.jq_wrap.find(".signed_day:last").removeClass("signed_day").addClass("member"==g||"seniormember"==g?"signed_member_anime":"signed_anime_day")}else s.jq_wrap.find(".j_sign_btn_keep").text(r);s.cal_mouseEnterOut()}},"json")},setReplenishInfo:function(n){var i=this.jq_wrap.find(".j_succ_info"),e=this.jq_wrap.find(".sign_keep_span"),s=0;e.length>0&&e.text("\u8FDE\u7EED"+n.data.sign_user_info.sign_keep+"\u5929");var t=n.data.resign_info;s=this.resign_card_num=t.resign_card_num,$(".rpln_card_wrap").removeClass("rpln_card_wrap_2 rpln_card_wrap_3"),t.resign_card_num<=9||(t.resign_card_num>9&&t.resign_card_num<100?$(".rpln_card_wrap").addClass("rpln_card_wrap_2"):(s="99+",$(".rpln_card_wrap").addClass("rpln_card_wrap_3"))),i.find(".j_rpln_card_count").text(s),0==t.mon_miss_sign_num?this.jq_wrap.find(".j_need_rpln_wrap").text("\u672C\u6708\u5B8C\u7F8E\u7B7E\u5230"):this.jq_wrap.find(".j_need_rpln_wrap").html('\u672C\u6708\u6F0F\u7B7E<span class="j_lack_sign_monthly_count sign_num">'+t.mon_miss_sign_num+"</span>\u6B21")},refresh_sign_rank:function(){var n={kw:$.tb.escapeHTML(PageData.forum.forum_name),ie:"utf-8",tbs:PageData.tbs};$.tb.get(this.sign_forum,n,function(n){var i=!1;try{var e=n}catch(s){i=!0}i||e&&0==e.no&&($(".j_today_signnum").html(e.data.forum_info.current_rank_info.sign_count),$(".j_signrank_index").html(e.data.forum_info.current_rank_info.sign_rank))})},show_block_sign_dialog:function(){var n=new $.dialog({html:"<div class='signmod_likeandsign_dialog'>\u5728\u672C\u5427\u7B7E\u5230\u9700\u8981\u5148\u6210\u4E3A\u4F1A\u5458\u54E6~\u52A0\u5165\u6211\u4EEC\u5427\uFF01</div><div class='signmod_likeandsign_btnzone'><input class='signmod_confirm_btn j_sign_confirm' type='button' value='\u77E5\u9053\u4E86' /></div>",holderClassName:"passportDialog",title:"\u672C\u5427\u7B7E\u5230",draggable:!1,width:338,height:87});$(n.element[0]).find(".j_sign_confirm").click(function(){n.close()})},succ_text:function(n,i,e,s){if(s){if(9==s)return"\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5373\u53EF\u83B7\u5F97\u53D1\u8D34\u5B57\u4F53\u52A0\u7C97\u529F\u80FD\uFF0C\u660E\u5929\u4E0D\u8981\u5FD8\u4E86\u6765\u7B7E\u5230\u54E6\u3002";if(10==s)return"\u606D\u559C\u83B7\u5F97\u53D1\u8D34\u5B57\u4F53\u52A0\u7C97\u529F\u80FD\uFF0C\u53D1\u8D34\u70AB\u8000\u5427\uFF01\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u54E6~";if(19==s)return"\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5373\u53EF\u83B7\u5F97\u53D1\u8D34\u5B57\u4F53\u53D8\u7EA2\u529F\u80FD\uFF0C\u660E\u5929\u4E0D\u8981\u5FD8\u4E86\u6765\u7B7E\u5230\u54E6\u3002";if(20==s)return"\u606D\u559C\u83B7\u5F97\u53D1\u8D34\u5B57\u4F53\u53D8\u7EA2\u529F\u80FD\uFF0C\u53D1\u8D34\u70AB\u8000\u5427\uFF01\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u54E6~";if(29==s)return"\u5DF2\u8FDE\u7EED\u7B7E\u523029\u5929\uFF0C\u660E\u65E5\u7B7E\u5230\u5373\u53EF\u83B7\u5F97ID\u7EA2\u8272\u9AD8\u4EAE\u6548\u679C\uFF0C\u4E0D\u8981\u5FD8\u4E86\u54E6~";if(30==s)return"\u606D\u559C\u4F60\u83B7\u5F97ID\u7EA2\u8272\u9AD8\u4EAE\u6548\u679C\uFF0C\u8D76\u7D27\u53D1\u8D34\u70AB\u8000\u5427\u3002\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u54E6~"}var t;if(10>=i)switch(parseInt(i)){case 1:t="\u606D\u559C\u4F60\u62A2\u5F97\u672C\u5427\u4ECA\u65E5\u7B7E\u5230\u7B2C1\u540D\uFF0C\u8D76\u7D27\u622A\u56FE\u7559\u5FF5\u5427~~";break;case 2:t="\u672C\u5427\u4ECA\u65E5\u7B7E\u5230\u7B2C1\u4EBA\u88AB\u62A2\u8D70\u4E86\u2026\u2026\u660E\u5929\u518D\u6765\u65E9\u4E00\u70B9\u5427~";break;default:t="\u606D\u559C\u4F60\u540D\u5217\u672C\u5427\u4ECA\u65E5\u7B7E\u5230\u524D10\uFF0C\u83B7\u5F97\u201C\u672C\u5427\u5FE0\u8BDA\u5427\u53CB\u201D\u79F0\u53F7~"}else if(100==i)t="\u54A6\uFF0C\u4E00\u4E0D\u5C0F\u5FC3\u5C31\u8E29\u5230100\u4E86\uFF0C\u4ECA\u5929\u4F1A\u6709\u597D\u8FD0\u6C14\u5594~";else if(250==i)t="\u8BF7\u5728\u5FC3\u4E2D\u9ED8\u5FF53\u904D\uFF1A\u6211\u4E0D\u662F250\u6211\u4E0D\u662F250\u6211\u4E0D\u662F250\u2026\u2026";else if(1e3==i)t="\u524D\u9762999\u4EBA\u7684\u7ECF\u8FC7\uFF0C\u53EA\u4E3A\u4E86\u6210\u5168\u4F60\u7684\u5706\u6EE1\u2026\u2026";else if(1e4==i)t="\u80FD\u8E29\u5230\u5982\u6B64\u5927\u6574\u5B9E\u5728\u662F\u4EBA\u54C1\u7206\u68DA\u554A\uFF01\u53EF\u4EE5\u51FA\u95E8\u4E70\u5F69\u7968\u4E86~";else if(100>=n)switch(parseInt(n)){case 1:t="\u672C\u5427\u7B2C\u4E00\u7684\u5730\u4F4D\uFF0C\u53C8\u7A33\u5B9A\u4E86\u7A33\u5B9A\u4E86\u7A33\u5B9A\u4E86\u2026\u2026";break;case 2:t="\u672C\u5427\u79BB\u7B2C\u4E00\u540D\u53C8\u8FD1\u4E86\u4E00\u70B9\u70B9\u70B9\u70B9\uFF0C\u52A0\u6CB9\uFF01";break;case 3:t="\u4FDD\u6301\u524D\u4E09\u540D\u4E0D\u5BB9\u6613\uFF0C\u8BB0\u5F97\u660E\u5929\u8981\u6765\u7B7E\u5230\u54E6~~";break;default:t=10>=n?"\u524D\u5341\u540D\u7ADE\u4E89\u6FC0\u70C8\uFF0C\u8BB0\u5F97\u6BCF\u5929\u90FD\u6765\u7B7E\u5230\u54E6~":30>=n?"\u79BB\u524D\u5341\u540D\u8FD8\u6709\u4E9B\u8DDD\u79BB\uFF0C\u5927\u5BB6\u6765\u5F97\u66F4\u52E4\u5FEB\u4E9B\u5427~":"\u4E00\u767E\u5F3A\u7684\u5730\u4F4D\u9700\u8981\u5927\u5BB6\u7684\u5171\u540C\u52AA\u529B\uFF0C\u52A0\u6CB9\uFF01"}else t="\u8BB0\u5F97\u660E\u5929\u8981\u6765\u7B7E\u5230\u54E6\uFF0C\u5E2E\u672C\u5427\u63D0\u5347\u6392\u540D~";return t},set_sign_calendar:function(n,i,e,s){function t(n){for(var i=n.data.sign_user_info.sign_month,e=["\uFF0C\u7B7E\u5230\u7ECF\u9A8C+2\uFF0C\u8FDE\u7EED\u7B7E\u5230+4","\uFF0C\u624B\u673A\u7B7E\u5230\u7ECF\u9A8C+3\uFF0C\u8FDE\u7EED\u7B7E\u5230+5","\uFF0C\u767E\u5EA6\u6D4F\u89C8\u5668\u7B7E\u5230\u7ECF\u9A8C+3\uFF0C\u8FDE\u7EED\u7B7E\u5230+5","\uFF0C\u767E\u5EA6\u624B\u673A\u6D4F\u89C8\u5668\u7B7E\u5230\u7ECF\u9A8C+4\uFF0C\u8FDE\u7EED\u7B7E\u5230+6","\uFF0C\u7B7E\u5230\u7ECF\u9A8C+6\uFF0C\u8FDE\u7EED\u7B7E\u5230+8","\uFF0C\u4F7F\u7528\u4F1A\u5458\u7B7E\u5230\u7ECF\u9A8C+8\uFF0C\u8FDE\u7EED\u7B7E\u5230+10","\uFF0C\u4F7F\u7528\u9AD8\u7EA7\u4F1A\u5458\u7B7E\u5230\u7ECF\u9A8C+12\uFF0C\u8FDE\u7EED\u7B7E\u5230\u7ECF\u9A8C+14",""],s=0;s<i.length;s++){var t=i[s],a=t.t,o=a.substr(0,a.indexOf(":")),l=a.substr(a.indexOf(":")+1),g="\u4E8E"+o+"\u70B9"+l+"\u5206\uFF0C\u7B2C"+t.rank+"\u4E2A\u7B7E\u5230";"00"==o&&"00"==l&&""==t.rank&&(g="\u989D\uFF0C\u670D\u52A1\u5668\u8FD9\u5929\u6253\u76F9\u4E86\uFF0C\u6CA1\u8BB0\u4F4F\u4F60\u662F\u51E0\u70B9\u7B7E\u5230\u7684\uFF0C\u62B1\u6B49...");var d=parseInt(t.d);r.push(d);var c="signed_day",u=7;switch(t.sign_type){case"pc":u=0,c="signed_day";break;case"mobile":u=1,c="signed_mob_day";break;case"brs":u=2,c="signed_day";break;case"mobile_brs":u=3,c="signed_mob_day";break;case"mobile_client":u=4,c="signed_mob_day";break;case"member":u=5,c="signed_member";break;case"senior_member":u=6,c="signed_member"}var m=g+e[u];PageData.user&&1==PageData.user.is_block&&(c="",m=g+"\uFF0C\u60A8\u5F53\u524D\u5DF2\u88AB\u5C01\u7981\uFF0C\u6682\u65E0\u7B7E\u5230\u7ECF\u9A8C"),t.is_resign&&(c="signed_rpln_day",m="\u8865\u7B7E\u6210\u529F\uFF0C\u8865\u7B7E\u7ECF\u9A8C+"+t.sign_score),n.data.is_detail||(c="sign_gray",m=""),_.find(".j_d_"+d).addClass(c).tbattr({title:m})}}function a(){var n=_.find(".j_canlerdar_days"),i=n.find("td").filter(function(){return!$(this).hasClass("emptyDate")});if(i.each(function(n){var i=new Date(o.sign_year,o.sign_month-1,n+1);$.inArray(n+1,r)<0&&i<o.getEnvInitialTime()&&i>=Math.max(o.rpln_available_time,o.getEnvInitialTime()-2592e6)&&($(this).addClass("unsigned_day"),$.browser.mozilla&&$(this).children(".mozilla_td_hack").length<1&&$(this).append('<div class="mozilla_td_hack" style="position:absolute"></div>'))}),n.off().on("mouseenter",".unsigned_day",function(){$(this).addClass("unsigned_day_hover")}).on("mouseleave",".unsigned_day",function(){$(this).removeClass("unsigned_day_hover"),o.rplnBubble&&o.rplnBubble.closeBubble()}).on("click",".unsigned_day",function(){o.delReplenishSignGuide(),o.replenishSign($(this))}),"1"!==$.cookie("rpln_guide")){var e=i.filter(".unsigned_day").last();if(e.length>0){var s=parseInt(e.text()),t=new Date(o.sign_year,o.sign_month-1,s);t>=o.rpln_available_time&&(e.addClass("rpln_guide_day"),o.setReplenishSignGuide(e.parent().index()),$.cookie("rpln_guide","1",{expires:1e3}))}}}var _=this.jq_wrap,r=[],o=this;(""==i||"undefined"==typeof i)&&(i=this.sign_year),(""==e||"undefined"==typeof e)&&(e=this.sign_month),"undefined"!=typeof s&&(s=parseInt(s),0>s?(e-=1,0==e&&(i-=1,e=12)):s>0&&(e+=1,13==e&&(i+=1,e=1)));var l,g,d,c;l=new Date(i,e-1,1),g=new Date(i,e,0),d=l.getDay(),c=g.getDate(),_.find(".j_5, .j_6").css({display:"none"});for(var u=1;32>u;u++)_.find(".j_d_"+u).removeClass(function(n,i){var e=i.split(" ");return e.shift(),e.join(" ")}).tbattr({title:""});for(var m=0;7>m;m++)_.find(".j_1_"+m+", .j_5_"+m+", .j_6_"+m).html("&nbsp;").addClass("emptyDate");for(var p=1,m=d,u=1;c>0;m++,c--,u++)7==m&&(m=0,p++),5==p&&_.find(".j_5").css({display:""}),6==p&&_.find(".j_6").css({display:""}),_.find(".j_"+p+"_"+m).addClass("j_d_"+u).html(u).removeClass("emptyDate");this.sign_year=i,this.sign_month=e,"undefined"!=typeof n&&""!=n?(t(n),a(n)):$.tb.get(this.get_url,{kw:$.tb.escapeHTML(PageData.forum.forum_name),ie:"utf-8",sign_y:i,sign_m:e},function(n){return n&&0==n.no?(t(n),o.setReplenishInfo(n),a(n),void 0):void alert(n.no)},"json"),String(e).length<2&&(e+="",e="0"+e);var h=i+"\u5E74"+e+"\u6708";if(_.find(".j_calendar_month").html(h),this.sign_month==this.orign_month&&this.sign_year==this.orign_year){var f=_.find(".j_d_"+new Date(Env.server_time).getDate());if(f.hasClass("signed_day")||f.hasClass("signed_mob_day")||f.hasClass("signed_member"));else{var b=$(".j_signin_index").html();f.addClass("signed_day").tbattr({title:"\u4E8E"+new Date(Env.server_time).getHours()+"\u70B9"+new Date(Env.server_time).getMinutes()+"\u5206\uFF0C\u7B2C"+b+"\u4E2A\u7B7E\u5230\uFF0C\u7B7E\u5230\u7ECF\u9A8C+2\uFF0C\u8FDE\u7EED\u7B7E\u5230+4"})}}},setReplenishSignGuide:function(n){if(!this.$guide_mask){this.$guide_mask_close=$('<div class="rpln_guide_close">X</div>'),this.$guide_mask=$('<div class="rpln_guide">'),this.$guide_text=$('<div class="rpln_guide_txt">');var i=this.jq_wrap.find(".sign_succ_calendar");this.$guide_text.css("top",26*(n+1)),i.prepend(this.$guide_text).prepend(this.$guide_mask).prepend(this.$guide_mask_close),this.$guide_mask_close.on("click",$.proxy(this.delReplenishSignGuide,this))}},delReplenishSignGuide:function(){this.$guide_mask_close&&this.$guide_mask_close.remove(),this.$guide_mask&&this.$guide_mask.remove(),this.$guide_text&&this.$guide_text.remove()},getEnvInitialTime:function(){var n=new Date(Env.server_time);return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n},replenishSign:function(n){var i,e,s,t,a,_,r,o,l=this;if(i=parseInt(n.text()),e=new Date(this.sign_year,this.sign_month-1,i),s=l.getEnvInitialTime(),t=(s-e)/864e5,a=0,2>=t)a=1;else if(10>=t)a=2;else if(20>=t)a=3;else{if(!(30>=t))throw"\u53EF\u7B7E\u5230\u5929\u6570\u4E0D\u5E94\u5927\u4E8E30\u5929";a=4}if(l.rplnBubble&&l.rplnBubble.closeBubble(),$.isNumeric(i)&&!(e>s-864e5)){var g={arrow_dir:"down",bubble_css:{top:-50,left:-61,width:143,height:53},arrow_pos:{left:70},wrap:n,closeBtn:!1};o={top:-19,left:-34,width:110,height:20},buy_arrow_pos={left:54},_='<div class="rpln_tip">\u8865\u7B7E\u672C\u6B21\u9700\u6D88\u8017<span class="rpln_card_needed_count">'+a+'\u5F20</span>\u8865\u7B7E\u5361<br><a class="yes_btn">\u786E\u5B9A</a><a class="cancel_btn">\u53D6\u6D88</a></div>',r='<div class="rpln_tip">\u8FD8\u9700\u8981'+parseInt(a-this.resign_card_num)+'\u5F20\u8865\u7B7E\u5361\uFF0C\u53BB<a target="_blank" class="tbmall_link" href="/tbmall/propslist?category=108">\u5546\u57CE\u8D2D\u4E70\u5427</a>>></div>',$.browser.mozilla&&(g.wrap=n.children(".mozilla_td_hack"),g.bubble_css.top=-74,o.top=-43),this.resign_card_num>=a?g.content=_:(g.content=r,g.bubble_css=o,g.arrow_pos=buy_arrow_pos),l.rplnBubble=new UiBubbleTipBase(g),l.rplnBubble.j_bubble.on("click",".yes_btn",function(){l.isReplenishing||(l.isReplenishing=!0,$.tb.post("/sign/resign",{kw:$.tb.escapeHTML(PageData.forum.forum_name),tbs:PageData.tbs,ie:"utf-8",sign_y:l.sign_year,sign_m:l.sign_month,sign_d:i},function(i){l.isReplenishing=!1,n.removeClass("unsigned_day_hover"),i?0==i.no||2280002==i.no?(n.removeClass("unsigned_day unsigned_day_hover").addClass("signed_rpln_anime"),l.rplnBubble.closeBubble(),PageData.user.is_like&&!PageData.user.is_block&&(n.append('<div style="position:absolute;"><div class="sign_plus">+'+5*a+" \u7ECF\u9A8C</div></div>"),n.find(".sign_plus").show().animate({opacity:0,top:"-=20"},2500,function(){$(this).parent().remove()})),n.tbattr("title","\u4E8E"+(new Date(Env.server_time).getMonth()+1)+"\u6708"+new Date(Env.server_time).getDate()+"\u65E5\u8865\u7B7E\u6210\u529F\uFF0C\u8865\u7B7E\u7ECF\u9A8C+"+5*a),l.sign_load_month(0,l.sign_year,l.sign_month)):(l.rplnBubble&&l.rplnBubble.closeBubble(),g.content=l._resignMap[i.no]||"\u54CE\u5440~\u670D\u52A1\u5668\u6253\u76F9\u4E86\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5~",g.bubble_css=o,g.arrow_pos=buy_arrow_pos,l.rplnBubble=new UiBubbleTipBase(g),l.rplnBubble.showBubble()):(l.rplnBubble&&l.rplnBubble.closeBubble(),g.content="\u54CE\u5440~\u670D\u52A1\u5668\u6253\u76F9\u4E86\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5~",g.bubble_css=o,g.arrow_pos=buy_arrow_pos,l.rplnBubble=new UiBubbleTipBase(g),l.rplnBubble.showBubble())}))}).on("click",".cancel_btn",function(){n.removeClass("unsigned_day_hover"),l.rplnBubble.closeBubble()}),l.rplnBubble.showBubble()}},pvLog:function(){$("#sign_music_rank").on("click",function(){$.stats.track("music_rank","\u7B7E\u5230")})},signShai:function(n){var i=this,e=null!=navigator.userAgent.match(/iPad/i);void 0==document.createElement("canvas").getContext||$.browser.mozilla||"frs"!=PageData.product||e||_.Module.use("frs/component/SignShai",["sign_mod",n.data.sign_user_info],function(n){n.bind("startRender",function(){i.cal_mouseEventRemove()}),n.bind("completeRender",function(){i.cal_mouseEnterOut()})})},sign_100:function(n){if(n){var i=new Date,e=i.getFullYear()+"\u5E74"+(i.getMonth()+1)+"\u6708"+i.getDate()+"\u65E5",s="";s="<div class='sign_100_dlg'><div class='sign_100_"+n.continueSign+"'></div><div class='sign_100_text'><div class='sign_100_close'></div><div class='sign_100_title'>\u4EB2\u7231\u7684"+n.username+"</div>",s=100==n.continueSign?s+"<div class='sign_100_content'>\u4ECA\u5929\u662F\u4F60\u5728\u54B1\u4EEC<span class='sign_baname_highlight'>"+n.forumname+"</span>\u5427\u7B7E\u5230\u7684<span class='rank_number'>\u7B2C"+n.continueSign+"\u5929</span>\uFF0C\u503C\u5F97\u7EAA\u5FF5\u7684\u65E5\u5B50\uFF0C\u6709\u6728\u6709\uFF01<br/>\u65F6\u95F4\u8FC7\u5F97\u771F\u5FEB\u54C8\uFF0C\u4ECE\u7B2C\u4E00\u6B21\u7B7E\u5230\u5230\u73B0\u5728\uFF0C\u5DF2\u6709"+n.continueSign+"\u4E2A\u503C\u5F97\u56DE\u5473\u7684\u65E5\u65E5\u591C\u591C\u5728\u8FD9\u91CC\u7559\u5B58\u3002<br/>\u8BA9\u6211\u4EEC\u611F\u5230\u5F00\u5FC3\u7684\u662F\uFF0C\u4F60\u4ECD\u7136\u662F\u54B1\u4EEC<span class='sign_baname_highlight'>"+n.forumname+"</span>\u5427\u7684"+n.memberCount+"\u4E2A<span class='sign_baname_highlight'>"+n.memberTitle+"</span>\u4E2D\u575A\u5B9E\u7684\u4E00\u4EFD\u5B50\u3002<br/>\u4ECA\u5929\uFF0C\u7B7E\u5230"+n.continueSign+"\u5929\uFF1B\u6B64\u540E\uFF0C\u8BA9\u6211\u4EEC\u4F9D\u7136\u5171\u540C\u6210\u957F\uFF0C\u5E76\u5FEB\u4E50\u3002<br/></div>":s+"<div class='sign_100_content'>\u77E5\u9053\u5417\uFF0C\u4ECA\u5929\u662F\u4F60\u5728\u54B1\u4EEC<span class='sign_baname_highlight'>"+n.forumname+"</span>\u5427\u7B7E\u5230\u7684<span class='rank_number'>\u7B2C"+n.continueSign+"\u5929</span>\uFF0C\u6574\u6574\u4E00\u4E2A\u6708\u5566\uFF01<br/>\u65F6\u95F4\u8FC7\u5F97\u633A\u5FEB\u7684\u54C8\uFF0C\u4ECE\u4F60\u7B2C\u4E00\u6B21\u5230\u672C\u5427\u7B7E\u5230\uFF0C\u70B9\u4E0E\u4E0D\u70B9\u95F4\uFF0C\u5728\u8D34\u5427\u5EA6\u8FC7\u4E86"+n.continueSign+"\u4E2A\u7F8E\u597D\u7684\u65E5\u5B50\u3002<br/>\u4ECA\u540E\u7684\u8DEF\u8FD8\u957F\u7740\u5462\uFF0C\u8877\u5FC3\u5E0C\u671B\u4F60\u5728<span class='sign_baname_highlight'>"+n.forumname+"</span>\u5427\u7684\u6BCF\u4E00\u5929\u90FD\u80FD\u5F00\u5FC3\uFF0C\u4E0E\u5168\u4F53\u5427\u53CB\u4EEC\u76F8\u77E5\u76F8\u7231\u3002<br/>\u4ECA\u5929\uFF0C\u7B7E\u5230\u6EE1\u6708\uFF1B\u6B64\u540E\uFF0C\u8BA9\u6211\u4EEC\u4F9D\u7136\u5171\u540C\u6210\u957F\u3002<br/></div>",s=s+"<div class='sign_100_message'><a href='/i/sys/jump?un=%CC%F9%B0%C9%C7%A9%B5%BD%D0%A1%C3%D8%CA%E9' target='_blank'>\u8D34\u5427\u7B7E\u5230\u5C0F\u79D8\u4E66</a><img src='http://tb2.bdstatic.com/tb/img/itieba_vip.gif' title='\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1' class='verified_icon'>&nbsp;&nbsp;&nbsp;&nbsp;"+e+"&nbsp;&nbsp;&nbsp;&nbsp;<button class='j_sign_100_shai sign_100_shai_btn'>&nbsp;</button></div></div></div>";var t=new $.dialog({html:s,holderClassName:"sign_100_wapper",width:"681",showTitle:!1});$(t.element[0]).find(".sign_100_close").click(function(){t.close()});var a=null!=navigator.userAgent.match(/iPad/i);void 0==document.createElement("canvas").getContext||$.browser.mozilla||"frs"!=PageData.product||a||($(".j_sign_100_shai").show(),_.Module.use("ucenter/component/sign100",["dialogJbody",n.continueSign],function(n){n.bind("completeRender",function(){t.close()})}))}},sign_right_tips:function(n){var i=[PageUnit.load("sign_mod_tiptitle1"),PageUnit.load("sign_mod_tiptitle2"),PageUnit.load("sign_mod_tiptitle3"),PageUnit.load("sign_mod_tiptitle4"),PageUnit.load("sign_mod_tiptitle5")],e=[PageUnit.load("sign_mod_tiptext1"),PageUnit.load("sign_mod_tiptext2"),PageUnit.load("sign_mod_tiptext3"),PageUnit.load("sign_mod_tiptext4"),PageUnit.load("sign_mod_tiptext5")],s=[PageUnit.load("sign_mod_tipcondition1"),PageUnit.load("sign_mod_tipcondition2"),PageUnit.load("sign_mod_tipcondition3"),PageUnit.load("sign_mod_tipcondition4"),PageUnit.load("sign_mod_tipcondition5")];$(".j_sign_rights").css("position","relative").css("z-index","1");var t=[43,77,114,145,175],a=n+1,_={icon:"sign_big_icon_"+a,title:i[n],text:e[n],condition:s[n],position_right:13,arr_right:t[n]},r={content:"<div class='sign_rights_tip'><div class='sign_rights_top clearfix'><div class='sign_rights_big_icon "+_.icon+"'></div><div class='sign_rights_text_wapper'><div class='sign_rights_title'>"+_.title+"</div><div class='sign_rights_title_text'>"+_.text+"</div></div></div><div class='sign_rights_popline'></div><div class='sign_rights_condition'>"+_.condition+"</div></div>",arrow_dir:"up",bubble_css:{top:35,right:_.position_right,width:250,"z-index":9999},arrow_pos:{left:_.arr_right},attr:" ",wrap:$(".j_sign_rights"),closeBtn:!1};if(null===this.rights_tips[n]){var o=new UiBubbleTipBase(r);o.showBubble(),this.rights_tips[n]=o}else this.rights_tips[n].showBubble()},check_rights_status:function(n){$(".j_sign_rights_icon:eq(0)").addClass("rights_get"),n>=2&&$(".j_sign_rights_icon:eq(1)").addClass("rights_get"),n>=10&&$(".j_sign_rights_icon:eq(2)").addClass("rights_get"),n>=20&&$(".j_sign_rights_icon:eq(3)").addClass("rights_get"),n>=30&&$(".j_sign_rights_icon:eq(4)").addClass("rights_get")}}}});