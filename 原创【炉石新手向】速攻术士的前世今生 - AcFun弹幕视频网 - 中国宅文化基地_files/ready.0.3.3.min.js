(function(){var __indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};system.func.checkBrowser=function(callback){var fin;fin=function(){var a,arr,_i,_len,_ref;arr=[];_ref=["rgba","borderradius"];for(_i=0,_len=_ref.length;_i<_len;_i++){a=_ref[_i];arr.push(system.browser[a]?a:"no-"+a)}$("html").addClass(arr.join(" "));window.Modernizr=null;delete system.func.checkBrowser;return callback()};if(cache.browser){system.browser=cache.browser;return fin()}else{return $.getScript(system.path.short+"/script/modernizr.min.js",function(){system.browser=cache.browser=window.Modernizr;$.save("cache");return fin()})}};system.func.ready=function(callback){var cache,config,user;config=window.config;user=window.user;cache=window.cache;(function(){var a,b,s;a=(s=window.localStorage)?s.getItem("config"):$.cookie("av.config");if(a){b=$.parseJson(a);if((b!=null?b.ver:void 0)===config.ver){config=$.extend(config,b)}else{$.save("config")}}a=s?s.getItem("user"):$.cookie("av.user");if(a){b=$.parseJson(a);if((b!=null?b.ver:void 0)===user.ver){user=$.extend(user,b)}else{$.save("user")}}user.avatar=$.cookie("ac_userimg")||system.path.short+"/style/image/avatar.jpg";if(s){return function(){var f;f=function(){a=s.getItem("cache");if(a){b=$.parseJson(a);if((b!=null?b.ver:void 0)===cache.ver){return cache=$.extend(cache,b)}else{return $.save("cache")}}};setInterval(f,3e5);return f()}()}})();(function(){var a,b,v,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_results;if(system.url.search(/\?/)!==-1){a=system.url.replace(/.*\?/,"").split("&");for(_i=0,_len=a.length;_i<_len;_i++){v=a[_i];b=[v.replace(/=[\s\S]+/,""),v.replace(/[\s\S]+?=/,"")];if(((_ref=b[0])!=null?_ref.length:void 0)&&((_ref1=b[1])!=null?_ref1.length:void 0)){system.param[b[0]]=b[1].replace(/[\(\)<>\[\]\{\}'":]/g,"")}}}if(window.location.hash){a=window.location.hash.toString().replace(/\#/,"").split(";");_results=[];for(_j=0,_len1=a.length;_j<_len1;_j++){v=a[_j];b=[v.replace(/=[\s\S]+/,""),v.replace(/[\s\S]+?=/,"")];if(((_ref2=b[0])!=null?_ref2.length:void 0)&&((_ref3=b[1])!=null?_ref3.length:void 0)){_results.push(system.hash[b[0]]=b[1].replace(/[\(\)<>\[\]\{\}'":]/g,""))}else{_results.push(void 0)}}return _results}})();(function(){var t,win;win=$$("#win-info");t=win.data().timer;if(win.length){return win.on("mouseenter",function(){return clearTimeout(t)}).on("mouseleave",function(){clearTimeout(t);return t=setTimeout(function(){return win.css({display:"none"})},200)})}else{return $.i("[#win-info]#3")}})();(function(){var area;area=$$("#area-window");if(area.length){return area.delegate("div.win-hint","click",function(){var win;win=$(this);return win.stop(false,true).transition({opacity:0},200,function(){win.css({display:"none"});if(!win.is("#win-hint")){return win.remove()}})})}else{return $.i("[#area-window]#3")}})();(function(){var body,mainer,resize,root,stage;root=$(window);body=$$("body");stage=$$("#stage");mainer=$$("#mainer");root.resize(function(){return $.delay("stageResize",200,resize)});return(resize=function(){(function(){var h;h=mainer.height()+(root.height()||body.height())-stage.height();if(h>0){return mainer.css({"min-height":h})}})();return function(){var elem,inner;elem=$$("#btn-top-shortcut");inner=$$("#footer-inner");if(elem.length){return elem.css({left:inner.offset().left+inner.width()+16})}}()})()})();(function(){var elem;elem=$$("#btn-top-shortcut");if(elem.length){return elem.data({timer:null,viewing:false}).hoverInfo({type:"info"})}})();(function(){var guide,inner,simple,sub,subInner,tabs;guide=$$("#guide");sub=$$("#sub-guide");inner=$$("#guide-inner");subInner=$$("#sub-guide-inner");simple=guide.hasClass("simple")?true||false:void 0;tabs=simple?inner.find("div.l:eq(0)>a:not(.only)"):inner.find("div.b>div.l>a:not(.only)");sub.data({timer:null});tabs.mouseenter(function(){var tab;tab=$(this);clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){var channel,left,unit;tab.addClass("active").siblings(".active").removeClass("active");channel=tab.data().channel;unit=subInner.find("div.channel-"+channel);unit.addClass("active").removeClass("hidden");left=tab.position().left-unit.width()*.2;if(left<0){left=0}unit.css({opacity:0,left:left}).stop(false,true).transition({opacity:1},200).siblings(".active").removeClass("active").addClass("hidden");return sub.addClass("active")},50)}).mouseleave(function(){clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){tabs.filter(".active").removeClass("active");return sub.removeClass("active")},200)});sub.mouseenter(function(){return clearTimeout(sub.data().timer)}).mouseleave(function(){clearTimeout(sub.data().timer);return sub.data().timer=setTimeout(function(){tabs.filter(".active").removeClass("active");return sub.removeClass("active")},200)});(function(){var area,cont,elem,f,hideHint,link,mainer,thumb,win;elem=$$("#a-avatar-guide");win=$$("#win-info-guide");mainer=win.find("div.mainer");cont=mainer.children("div.b");area=$$("#area-user-guide");thumb=$$("#a-avatar-guide");link=thumb.add("#win-info-guide>div.mainer>div.c>a");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};hideHint=function(){return elem.find("p.info-hint").text(0).addClass("hidden")};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f);if($.check("online")){$$("#a-name-guide").text($.parseSafe(user.name));elem.removeClass("hidden").children("img.avatar").attr({src:$.parseSafe(user.avatar)}).removeClass("hidden");$$("#a-logout-guide").attr({href:"/logout.aspx?returnUrl="+$.parseSafe(window.location.href.replace(/\?.*/,"").replace(/#.*/,""))});thumb.click(hideHint);mainer.delegate("div.b a, div.c a","click",hideHint);return $.check("unread",function(){var html,n,url;html="";n=0;url="";if(user.unread.push){html+='<a class="unit" href="/member/#area=push" target="_blank"> <i class="icon grey icon-file"></i> 您有<span class="pts">'+user.unread.push+"</span>条新推送 </a>";n+=parseInt(user.unread.push);url="/member/#area=push"}if(user.unread.fan){html+='<a class="unit" href="/member/#area=followers" target="_blank"> <i class="icon grey icon-user"></i> 您有<span class="pts">'+user.unread.fan+"</span>个新听众 </a>";n+=parseInt(user.unread.fan);url="/member/#area=followers"}if(user.unread.at){html+='<a class="unit" href="/member/#area=mention" target="_blank"> <i class="icon grey icon-exclamation-sign"></i> 您被召唤了<span class="pts">'+user.unread.at+"</span>次 </a>";n+=parseInt(user.unread.at);url="/member/#area=mention"}if(user.unread.mail){html+='<a class="unit" href="/member/#area=mail" target="_blank"> <i class="icon grey icon-envelope"></i> 您有<span class="pts">'+user.unread.mail+"</span>条新私信 </a>";n+=parseInt(user.unread.mail);url="/member/#area=mail"}if(url){link.attr({href:url})}if(!html.length){html='<p class="alert">暂未有任何信息。</p>'}cont.html(html);if(n>0){if(n>99){n="99+"}return elem.find("p.info-hint").text(n).removeClass("hidden")}else{return hideHint()}})}else{return $$("#a-login-guide").removeClass("hidden")}})();(function(){var cont,elem,f,win;elem=$$("#a-history-guide");win=$$("#win-history-guide");cont=win.find("div.mainer>div.b");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){var a,html,i,len,temp,_i,_len,_ref,_ref1,_ref2;html="";if(window.localStorage){len=(_ref=(_ref1=cache.history.views)!=null?_ref1.length:void 0)!=null?_ref:null;if(len){temp='<a class="unit" href="[url]" target="_blank" title="[title]"> <p class="title">[title]</p> <p class="desc">浏览于<span class="time">[time]</span></p> </a>';_ref2=simple?[0,1,2,3]:[0,1,2,3,4,5];for(_i=0,_len=_ref2.length;_i<_len;_i++){i=_ref2[_i];a=cache.history.views[len-i];if(a!=null){html+=$.parseTemp(temp,{url:(a.type&&a.type==="album"?"/a/aa":"/v/ac")+a.aid,title:a.title,time:$.parseTime(a.time)})}}}else{html='<p class="alert warning"> 尚未记录任何历史信息。 </p>'}}else{html='<p class="alert error"> 不支持本地存储(localStorage)的老旧浏览器。 <br> 请将浏览器更新至最新版本，或换用现代浏览器访问。 </p>'}cont.html(html);return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);return win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f)})();(function(){var elem,f,win;elem=$$("#a-post-guide");win=$$("#win-post-guide");elem.data({timer:null});f=function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.stop(false,true).addClass("hidden")},500)};elem.mouseenter(function(){clearTimeout(elem.data().timer);return elem.data().timer=setTimeout(function(){return win.css({opacity:0,top:simple?40:72}).removeClass("hidden").stop(false,true).transition({opacity:1,top:simple?48:80},100)},200)}).mouseleave(f);return win.mouseenter(function(){return clearTimeout(elem.data().timer)}).mouseleave(f)})();return function(){var fold,gh,scroll,shortcut;shortcut=$$("#btn-top-shortcut");gh=simple?48:120;fold=function(){return guide.stop(false,true).transition({top:-gh},200,function(){return guide.removeClass("float").css({top:0}).data().viewing=false})};scroll=function(){var top,wh;top=$(document).scrollTop();wh=$(window).innerHeight();if(top>=gh&&wh>=864&&!system.gate.guideFloatDisabled&&config.globe.guideFloatAllowed){if(top>guide.data().top){if(guide.data().viewing&&!guide.data().hover){fold()}}else{if(!guide.data().viewing){guide.css({top:-gh}).addClass("float").stop(false,true).transition({top:0},200,function(){return guide.data().viewing=true})}$.delay("guideScroll",2e3,function(){if(guide.data().viewing){return fold()}})}}guide.data().top=top;if(top>wh){if(!shortcut.data().viewing){return shortcut.css({opacity:0}).removeClass("hidden").stop(false,true).transition({opacity:1},200,function(){return shortcut.data().viewing=true})}}else{if(shortcut.data().viewing){return shortcut.stop(false,true).transition({opacity:0},200,function(){return shortcut.addClass("hidden").data().viewing=false})}}};guide.data({timer:null,top:0,viewing:true,hover:false}).mouseenter(function(){var _ref;guide.data().hover=true;if((_ref=$.delay.cache)!=null?_ref.guideScroll:void 0){return clearTimeout($.delay.cache.guideScroll.timer)}}).mouseleave(function(){var _ref;guide.data().hover=false;if((_ref=$.delay.cache)!=null?_ref.guideScroll:void 0){return $.delay.cache.guideScroll.timer=setTimeout(function(){if(guide.data().viewing){return fold()}},2e3)}});return $(window).scroll(function(){return $.delay("guideScroll",200,scroll)})}()})();$("#area-search-guide input.ipt-search").one("focus",function(){var dropdown,form,ipt,placeholder;form=$$("#area-search-guide");ipt=form.find("input.ipt-search");dropdown=form.find("ul.menu-search");placeholder=ipt.attr("placeholder")||"搜索";if(ipt.length){form.data({timer:null,port:null});if(!window.Worker){ipt.val(placeholder)}dropdown.css({left:ipt.offset().left-form.offset().left,top:ipt.offset().top-form.offset().top+36,"min-width":ipt.width()+20}).delegate("a","click",function(){var obj;obj=$(this);return ipt.val(obj.find("span.cont").text())});return ipt.focus(function(){if(ipt.val()===placeholder){ipt.val("")}ipt.keyup();return dropdown.css({display:"block",opacity:0}).stop(false,true).transition({opacity:1},200)}).blur(function(){if(!$.trim(ipt.val()).length&&!window.Worker){ipt.val(placeholder)}return dropdown.stop(false,true).transition({opacity:0},200,function(){return dropdown.css({display:"none"})})}).keyup(function(e){var i,obj,temp,val;obj=dropdown.children("li.active");if(e.which===38||e.which===40){e.preventDefault();if(!obj.length){system.tv=e.which===38?"last":"first";dropdown.children("li:"+system.tv).addClass("active")}else{i=e.which===38?obj.index()-1:obj.index()+1;if(i<0){i=dropdown.children("li").length-1}if(i>=dropdown.children("li").length){i=0}obj.removeClass("active");dropdown.children("li:eq("+i+")").addClass("active")}return ipt.val(dropdown.children("li.active").find("span.cont").text())}else{val=$.trim(ipt.val());temp='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';if(val.length){clearTimeout(form.data().timer);return form.data().timer=setTimeout(function(){if(form.data().port){form.data().port.abort()}return form.data().port=$.getScript(system.path.api+"/search/automatch/tag?query="+encodeURI(val)).done(function(){var a,html,v,_i,_len;a=system.tv;if(a.length){html="";for(_i=0,_len=a.length;_i<_len;_i++){v=a[_i];html+='<li><a href="/search.aspx#query='+v.tag+'" target="_blank"><span class="cont">'+v.tag+'</span><span class="hint">约'+$.parsePts(v.refCount)+"个结果</span></a></li>"}}else{html=temp}a=null;return dropdown.html(html)}).fail(function(){return dropdown.html(temp)})},500)}else{return dropdown.html(temp)}}}).val("").focus()}});$.get("/notice.aspx").done(function(data){var a,arr,block,html,i,inner,temp,_i,_len,_ref;if(data.success){if(data.data.registerOn){system.regable=1}arr=data.data.list;if(arr.length){if(!user.notice){user.notice=[]}block=$$("#block-notice-guide");temp=block.children("div.temp").html();inner=block.children("div.inner");html="";inner.data().length=0;for(i=_i=0,_len=arr.length;_i<_len;i=++_i){a=arr[i];if(i<2){if(!(_ref=a.time,__indexOf.call(user.notice,_ref)>=0)){inner.data().length++;html+=$.parseTemp(temp,{text:a.content,time:a.time})}}}if(inner.data().length){inner.delegate("span.close","click",function(){var btn,elem,obj;btn=$(this);elem=btn.closest("div.item");user.notice.unshift(btn.data().time);if(user.notice.length>5){user.notice=user.notice.slice(0,5)}$.save("user");inner.data().length--;obj=inner.data().length?elem:block;return obj.transition({opacity:0,height:0,padding:0},200,function(){return obj.remove()})}).html(html);return block.removeClass("hidden")}}}});$.parseChannel.list=[[1,"动画"],[106,"动画短片"],[107,"MAD·AMV"],[108,"MMD·3D"],[67,"新番连载"],[109,"旧番补档"],[120,"国产动画"],[58,"音乐"],[101,"演唱·乐器"],[102,"宅舞"],[103,"Vocaloid"],[105,"流行音乐"],[104,"ACG音乐"],[59,"游戏"],[83,"游戏集锦"],[84,"实况解说"],[71,"Flash游戏"],[72,"Mugen"],[85,"英雄联盟"],[60,"娱乐"],[86,"生活娱乐"],[87,"鬼畜调教"],[88,"萌宠"],[89,"美食"],[121,"原创网络剧"],[70,"科技"],[90,"科学技术"],[91,"数码"],[92,"军事"],[122,"汽车"],[69,"体育"],[93,"惊奇体育"],[94,"足球"],[95,"篮球"],[68,"影视"],[96,"电影"],[97,"剧集"],[98,"综艺"],[99,"特摄·布袋戏"],[100,"纪录片"],[63,"文章"],[110,"文章综合"],[73,"工作·情感"],[74,"动漫文化"],[75,"漫画·小说"],[76,"页游资料"],[77,"1区"],[78,"21区"],[79,"31区"],[80,"41区"],[81,"文章里区(不审)"],[82,"视频里区(不审)"],[42,"图库"]];$.parseChannel.map={1:[106,107,108,67,109,120],58:[101,102,103,105,104],59:[83,84,71,72,85],60:[86,87,88,89,121],70:[90,91,92,122],69:[93,94,95],68:[96,97,98,99,100],110:[63,73,74,75],0:[76,77,78,79,80,81,82,42]};(function(){var f;if(user.online&&system.url.search(/acfun/)!==-1){(f=function(){return $.get("/online.aspx",{uid:user.uid}).done(function(data){if(data.success){user.level=data.level|0;user.ban=data.isdisabled;return $.save("user")}})})();return setInterval(f,3e5)}})();window._hmt=[];$$("#stage").after('<script src="//hm.baidu.com/hm.js?49129538199e82fd3d7af92141117b9e"></script>');if(user.online&&user.level>1){$("#sub-guide-inner .unit a.hidden").removeClass("hidden")}return system.func.checkBrowser(function(){(function(){var elem,src;elem=$$("#avatar-ac-footer");if(system.browser.borderradius&&elem.length){elem.data().src=function(){return system.path.short+"/umeditor/dialogs/emotion/images/ac/"+$.rnd(1,51)+".gif"};src=elem.data().src();return $.preload(src,function(){var html;html='<img src="'+src+'">';return elem.html(html).one("click",function(){return $.getScript(system.path.short+"/script/require/avatar"+(system.debug?".js":".min.js?date="+parseInt($.now()/864e5)+system.ver.replace(/\./g,"")))}).removeClass("hidden")})}})();if(system.debug){$.require("debug")}delete system.func.ready;return typeof callback==="function"?callback():void 0})}}).call(this);