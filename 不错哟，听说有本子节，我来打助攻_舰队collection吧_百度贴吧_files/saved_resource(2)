_.Module.define({path:"frs/widget/medal",sub:{_card_op:{width:230,height:78},initial:function(){try{this._createMedalDialog(),this._handleEvent(),this._setMedalMap()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/medal/medal.js",method:"",ln:17}),t}},_handleEvent:function(){var t=this;$("#forum_medal").find("a").hover(function(){t._showMedalDialog($(this))},function(){}),$("#forum_medal").hover(function(){},function(){setTimeout(function(){t._medalShowing===!1&&t._medalDialog&&t._medalDialog.hide()},50)})},_setMedalMap:function(){this.medalMap={medal1:{url:"http://tieba.baidu.com/p/2510950726",title:"\u65B0\u79C0\u8D34\u5427\u51B2\u523A\u8D5B\u83B7\u80DC\u5427",intro:"\u4E13\u5C5E\u5C0F\u578B\u5427\u7684\u52A9\u63A8\u6D3B\u52A8\uFF0C\u5171\u6709133\u4E2A\u5427\u6210\u529F\u51B2\u523A"},medal2:{url:"http://tieba.baidu.com/p/2576294729",title:"\u5343\u4E07\u52A9\u63A8\u8BA1\u5212\u52A9\u63A8\u8D34\u5427",intro:"\u5427\u4E3B\u5343\u4E07\u52A9\u63A8\u8BA1\u5212\uFF0C\u6276\u6301\u767E\u4E07\u5427\u4E3B\u548C\u8D34\u5427\u6210\u957F"},medal3:{url:"http://tieba.baidu.com/p/2559913135",title:"\u725B\u5427\u8054\u8D5B\u201C\u8D85\u5427\u676F\u201D",intro:"\u4E89\u593A\u725B\u5427\u5E2D\u4F4D\uFF0C\u4E0D\u505A\u4E8C\u6D41\u8D34\u5427\uFF0C\u8DFB\u8EAB\u8D85\u4E00\u6D41\u8D34\u5427\uFF01"},medal4:{url:"http://tieba.baidu.com/p/2559913135",title:"\u725B\u5427\u8054\u8D5B\u201C\u51A0\u519B\u5956\u201D",intro:"\u4E89\u593A\u725B\u5427\u5E2D\u4F4D\uFF0C\u4E0D\u505A\u4E8C\u6D41\u8D34\u5427\uFF0C\u8DFB\u8EAB\u8D85\u4E00\u6D41\u8D34\u5427\uFF01"},medal5:{url:"http://tieba.baidu.com/p/2559913135",title:"\u725B\u5427\u8054\u8D5B\u201C\u4E9A\u519B\u5956\u201D",intro:"\u4E89\u593A\u725B\u5427\u5E2D\u4F4D\uFF0C\u4E0D\u505A\u4E8C\u6D41\u8D34\u5427\uFF0C\u8DFB\u8EAB\u8D85\u4E00\u6D41\u8D34\u5427\uFF01"},medal6:{url:"http://tieba.baidu.com/p/2559913135",title:"\u725B\u5427\u8054\u8D5B\u201C\u5B63\u519B\u5956\u201D",intro:"\u4E89\u593A\u725B\u5427\u5E2D\u4F4D\uFF0C\u4E0D\u505A\u4E8C\u6D41\u8D34\u5427\uFF0C\u8DFB\u8EAB\u8D85\u4E00\u6D41\u8D34\u5427\uFF01"},medal7:{url:"http://tieba.baidu.com/p/2559913135",title:"\u725B\u5427\u8054\u8D5B\u201C\u4F18\u79C0\u5956\u201D",intro:"\u4E89\u593A\u725B\u5427\u5E2D\u4F4D\uFF0C\u4E0D\u505A\u4E8C\u6D41\u8D34\u5427\uFF0C\u8DFB\u8EAB\u8D85\u4E00\u6D41\u8D34\u5427\uFF01"},medal8:{url:"http://tieba.baidu.com/p/2478431219",title:"\u6E38\u620F\u6700\u5F3A\u5427\u51A0\u519B",intro:"\u6700\u5177\u6E38\u620F\u8303\u513F\u3001\u6700\u591A\u6E38\u620F\u8FBE\u4EBA\u805A\u96C6\u7684\u6E38\u620F\u6700\u5F3A\u5427"},medal9:{url:"http://tieba.baidu.com/p/2478431219",title:"\u6E38\u620F\u6700\u5F3A\u5427\u4E9A\u519B",intro:"\u6700\u5177\u6E38\u620F\u8303\u513F\u3001\u6700\u591A\u6E38\u620F\u8FBE\u4EBA\u805A\u96C6\u7684\u6E38\u620F\u6700\u5F3A\u5427"},medal10:{url:"http://tieba.baidu.com/p/2478431219",title:"\u6E38\u620F\u6700\u5F3A\u5427\u5B63\u519B",intro:"\u6700\u5177\u6E38\u620F\u8303\u513F\u3001\u6700\u591A\u6E38\u620F\u8FBE\u4EBA\u805A\u96C6\u7684\u6E38\u620F\u6700\u5F3A\u5427"},medal11:{url:"http://tieba.baidu.com/p/2478431219",title:"\u6E38\u620F\u6700\u5F3A\u542720\u5F3A",intro:"\u6700\u5177\u6E38\u620F\u8303\u513F\u3001\u6700\u591A\u6E38\u620F\u8FBE\u4EBA\u805A\u96C6\u7684\u6E38\u620F\u6700\u5F3A\u5427"},medal12:{url:"http://tieba.baidu.com/p/2794801701",title:"\u4EBA\u6C14\u8D34\u5427\u7535\u53F0",intro:"\u6821\u56ED\u660E\u661FDJ\u9009\u62D4\u8D5B\u4E2D\u4EBA\u6C14\u7206\u68DA\u5427"},medal13:{url:"http://tieba.baidu.com/p/2794801701",title:"\u9B45\u529B\u8D34\u5427\u7535\u53F0",intro:"\u6821\u56ED\u660E\u661FDJ\u9009\u62D4\u8D5B\u4E2D\u6700\u5177\u9B45\u529B\u7684\u8D34\u5427"},medal14:{url:"http://tieba.baidu.com/p/2794801701",title:"\u660E\u661F\u8D34\u5427\u7535\u53F0",intro:"\u6821\u56ED\u660E\u661FDJ\u9009\u62D4\u8D5B\u4E2D\u8363\u83B7\u524D\u4E09\u7532\u7684\u5B9E\u529B\u8D34\u5427"}}},_createMedalDialog:function(){var t,i=this;t=['<div class="ui_card_wrap forum_medal_card" id="forum_medal_card">','<div class="ui_card_content medal-w">','<a class="medal-img-w" target="_blank" href=""></a>','<div class="medal-info-w">','<a class="medal-info-title medal-link" id="medal_title" target="_blank" href=""></a>','<p class="medal-intro"></p>',"</div>","</div>",'<span class="j_ui_white_arrow arrow ui_white_down"></span>',"</div>"].join(""),this._medalDialog=$(t),this._medalDialog.hide(),$("body").append(this._medalDialog),this._medalDialog.hover(function(){i._medalShowing=!0,i._medalDialog.show()},function(){i._medalShowing=!1,i._medalDialog.hide()})},_showMedalDialog:function(t){var i,a=this,e=t.tbattr("class"),l=this.medalMap[e];i=l.title,this._medalDialog.find(".medal-img-w").tbattr("href",l.url)[0].className="medal-img-w "+e,this._medalDialog.find("#medal_title").text(i).tbattr("href",l.url),this._medalDialog.find(".medal-intro").text(l.intro),this._medalDialog.find("#medal_link").text(l.link).tbattr("href",l.url);var d=t.offset();this._medalDialog.css({top:d.top-a._card_op.height-14,left:d.left-a._card_op.width/2+13}).show(),a._medalShowing=!1}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar;var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:69}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:72}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:88}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:91}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:92}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no}]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});
;_.Module.define({path:"frs/widget/forum_card",sub:{initial:function(){try{this.delay=150,this.$title=$(".card_title_location"),this.$locations=$(".card_locations"),this.$num=$(".card_num"),this._resizeWidth(),this._handleEvent()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/forum_card_main.js",method:"",ln:17}),t}},localDisplay:function(){var t=this;return setTimeout(function(){t.$title.parent().addClass("card_title_location_wrapper_sel"),t.$num.addClass("card_num_fix"),t.$locations.removeClass("card_nor").addClass("card_sel")},t.delay)},localHidden:function(){var t=this;return setTimeout(function(){t.$title.parent().removeClass("card_title_location_wrapper_sel"),t.$num.removeClass("card_num_fix"),t.$locations.removeClass("card_sel").addClass("card_nor")},t.delay)},_handleEvent:function(){var t,e=this;this.$title.on("mouseenter",function(){clearTimeout(t),t=e.localDisplay()}).on("mouseleave",function(){clearTimeout(t),t=e.localHidden()}),this.$locations.on("mouseenter",function(){clearTimeout(t),t=e.localDisplay()}).on("mouseleave",function(){clearTimeout(t),t=e.localHidden()}),this.$locations.delegate("a","mousedown",function(){$.stats.sendRequest("fr=tb0_forum&st_mod=difangba&difangba_down")})},_resizeWidth:function(){var t=this.$locations.find("a").length;t=t%2===0?t:t+1;var e=t/2*60+20*(t/2-1)+15+"px";this.$locations.css("width",e)}}});_.Module.define({path:"common/widget/PadstyleNav",requires:[],sub:{data:{is_good:!1,forum_name:"",user_islogin:!1,domNav:null,domNavFake:null,objFixer:null},initial:function(a,s,e){this.data.is_good="good"===s?!0:!1,this.data.is_album="album"===s?!0:!1,this.data.forum_name=a,this.data.user_islogin=e,this.data.domNav=$("#frs_nav"),this._showType(),this._handleEvents()},_showType:function(){this.data.is_good&&($("#frs_nav_good").removeClass("frs_nav_item_normal").addClass("frs_nav_item_selected"),$("#frs_nav_main").removeClass("frs_nav_item_selected").addClass("frs_nav_item_normal")),this.data.is_album&&($("#frs_nav_album").removeClass("frs_nav_item_normal").addClass("frs_nav_item_selected"),$("#frs_nav_main").removeClass("frs_nav_item_selected").addClass("frs_nav_item_normal"))},_handleEvents:function(){var a=this;a.data.domNav.on("click","#nav_post",function(){}),a.data.domNav.on("click","#nav_refresh",function(){$.tb.location.setHref($.tb.unescapeHTML($.tb.location.getHref()))})},_focusOnEditor:function(a){this.data.user_islogin?$(a).focus():LoginInstance.show()}}});_.Module.define({path:"common/widget/frs_version",sub:{initial:function(){}}});_.Module.define({path:"common/widget/tbnav_bright/tbnav_search",requires:["common/widget/search_handler"],sub:{_searchHandler:null,_jq_wrap:null,_jq_input:null,_options:{forumName:""},initial:function(e,t){var i=this;this._searchHandler=this.use("common/widget/search_handler"),this._jq_wrap=e,this._jq_input=e.find(".j_search_internal_input"),this._options=$.extend(this._options,t),this._jq_wrap.find(".j_search_internal_form").submit(function(){return i._searchInternal(),!1}),this._initPlaceHolder(),this._addTabIcon()},_addJump:function(){$(".qiangzuo_trigger").length>0&&$(".qiangzuo_trigger").on("click",function(){window.open("/game/worldcup/index")})},_addTabIcon:function(){$("#tb_nav").find(".icon_world_cup").closest(".space").css("position","relative"),$("#tb_nav").find(".icon_world_cup").closest(".space").append($("<i class='word_cup_sp_icon'></i>"))},_searchInternal:function(){var e=this._getSearchWord();this._searchHandler.searchPostInBa(e,this._options.forumName)},_getSearchWord:function(){return this._jq_input.val()},_initPlaceHolder:function(){var e=this,t=this._jq_wrap.find(".j_search_internal_placeholder"),i=this._jq_input;""!=e._getSearchWord()&&t.hide(),i.focus(function(){t.hide()}).blur(function(){""==e._getSearchWord()&&t.show()}),t.click(function(){i.focus()})}}}),_.Module.define({path:"common/widget/tbnav_bright",requires:["common/widget/tbnav_bright/tbnav_search"],sub:{_jq_wrap:null,_nav_wrap:null,initial:function(e,t){this._jq_wrap=e,this._nav_wrap=$("#tb_nav"),this.use("common/widget/tbnav_bright/tbnav_search",t.jq_search,t),this._bindNavDropDownList(),this._initStats(),this._initWanleTip()},_bindNavDropDownList:function(){var e=this;this._nav_wrap.find(".j_tbnav_list").on("mouseenter",function(t){t.preventDefault();var i=$(t.currentTarget);i.addClass("nav_list_over"),e._nav_wrap.find(".j_nav_list").css("overflow","visible"),$("#star_class_nav").css("overflow","visible")}).on("mouseleave",function(e){e.preventDefault();var t=$(e.currentTarget);t.removeClass("nav_list_over")})},_initStats:function(){var e=this._nav_wrap.find(".j_nav_list"),t="\u5BFC\u822A\u680Ftab\u7EDF\u8BA1";e.find("a").on("click",function(){var e=$(this).text().split("\uFF08")[0];$.stats.track(e,t)})},_initWanleTip:function(){var e=PageUnit.load("tbnav_bright_wanle_type");if(1!=e)return!1;var t=new Date,i=t.getTime(),n=new Date(t.getTime()+864e5-1e3*(60*t.getHours()*60+60*t.getMinutes()+t.getSeconds())),a=$.cookie("wanleTipCircle");if(a){if(i>a+1728e5)return $.cookie("wanleTipCircle",0),void 0;if(0==a)return}else $.cookie("wanleTipCircle",i);var o=this._nav_wrap.find("#j_navtab_wanle");if(o.on("click",function(){$.stats.track("tab\u5BFC\u6D41","\u8D34\u5427PC\u76D6\u697C\u6D3B\u52A8","","click"),r.hide(),$.cookie("wanleTipHide",1,{expires:n})}),1!=$.cookie("wanleTipHide")){var s=['<div class="wanle_tab_tip">','<a class="jump_tip" href="/f?ie=utf-8&kw='+encodeURIComponent("\u4E50\u6B64\u4E0D\u75B2")+'" target="_self"></a>','<a class="close_tip" href="#" onclick="return false;"></a>',"</div>"].join(""),r=$(s);o.closest(".space").append(r),r.on("click","a",function(){r.hide(),$.cookie("wanleTipHide",1,{expires:n})}),r.on("click",".jump_tip",function(){$.stats.track("tab\u5BFC\u6D41","\u8D34\u5427PC\u76D6\u697C\u6D3B\u52A8","","click")})}}}}),_.Module.define({path:"common/widget/often_forum_bright",sub:{_wrapId:null,_jqWrap:null,_imgPostParams:null,oftengo_bubble:null,isLoaded:!1,isLeave:!0,isRequest:!1,initial:function(e,t){this._wrapId=e,this._imgPostParams=t,this.initialUserForumList()},initialUserForumList:function(){var e=this;$("#often_forum").mouseenter(function(){e.isLoaded||(e.isRequest?($("#often_forum").addClass("btn_select"),$("#nav_forum_loading").show()):(e.renderLoading(),e.reqUserForumList().done(function(t){0===t.errno&&(e._imgPostParams.user.user_forum_list=t.data,e.oftenGoForum(),$("#nav_forum_loading").hide(),e.isLoaded=!0,e.isLeave&&$("#often_forum").trigger("click"))})),e.isRequest=!0)}).mouseleave(function(){e.isLeave=!1,e.isLoaded||($("#often_forum").removeClass("btn_select"),$("#nav_forum_loading").hide())})},reqUserForumList:function(e){var t=this._imgPostParams.user.id,e="/p/getLikeForum";return $.ajax({url:e,dataType:"json",type:"GET",data:{uid:t}})},renderLoading:function(){var e=['<div id="nav_forum_loading" class="nav_forum_loading">','<img src="/tb/static-ihome/img/loading2.gif">',"\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...",'<div class="nav_forum_loading_inherit"></div>',"</div>"];$loading=$(e.join("")),this.$loading=$loading,$("body").append($loading),this.loadingPos()},oftenGoForum:function(){var e=this._imgPostParams.user.user_forum_list?this._imgPostParams.user.user_forum_list.info:null,t=$("#often_forum"),i=this;if(t.length>0){var n=null,a=null;i.renderForumMenu(e);var o=i.j_menu;if(!o)return;t.click(function(){return i.fixedPosition(),t.addClass("btn_select"),o.slideDown(100),clearTimeout(n),!1}),PageData.is_ipad||(t.mouseenter(function(){return clearTimeout(a),"none"!=o.css("display")?!1:(n=setTimeout(function(){i.fixedPosition(),t.addClass("btn_select"),o.slideDown(100)},300),void 0)}),t.mouseleave(function(){clearTimeout(n),a=setTimeout(function(){t.removeClass("btn_select"),o.hide()},50)}),o.mouseenter(function(){clearTimeout(a)}),o.mouseleave(function(){a=setTimeout(function(){t.removeClass("btn_select"),o.hide()},50)})),o.find(".j_often_go_fname").mousedown(function(){if($.stats.hive("of_click"),$.stats.sendRequest("fr="+PageData.product+"&st_mod=oftenforum&st_type=forumclick&uid="+PageData.user.id),PageData&&PageData.forum&&PageData.product){if($(this).hasClass("ui_text_desc"))return;var e={st_mod:"nav_oftenforum_bar",st_type:"enterba",st_from:encodeURIComponent(PageData.product),st_uid:PageData.user.id,st_benba:encodeURIComponent(PageData.forum.name),st_goto:encodeURIComponent($(this).text())};$.tb.Stats.sendRequest("http://tb1.bdstatic.com/tb/img/hive.gif",e)}}),o.find(".j_often_go_more").mousedown(function(){$.stats.hive("of_more"),$.stats.sendRequest("fr="+PageData.product+"&st_mod=oftenforum&st_type=forummoreclick&uid="+PageData.user.id)})}},renderForumMenu:function(e){var t=this.genericForumMenu(e);if(t){{var i=$(t);$("#often_forum"),$("#"+this._wrapId)}$("body").append(i),this.j_menu=i}},genericForumMenu:function(e){if(e&&e.length>0){for(var t='<div id="nav_forum_menu" class="nav_forum_menu"><div class="n_menu_wrap clearfix"><ul class="n_menu_content clearfix">',i=PageData.is_ipad?"n_menu_item_ipad":"n_menu_item",n=0,a=e.length;a>n;n++){var o=e[n],s="";if(!(7>n||7==n&&8==a)){s='<li class="'+i+'"><a href="http://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'&fr=tbnav" target="_blank" class="j_often_go_more nav_g_more">\u66F4\u591A&gt;&gt;</a></li>',t+=s;break}s='<li class="'+i+'"><a class="j_often_go_fname" title="'+o.forum_name+'" href="/f?ie=utf-8&kw='+encodeURIComponent(o.forum_name)+'" target="_blank">'+$.tb.subByte(o.forum_name,12,"..")+"</a></li>",t+=s}return t+='</ul></div> <div class="btn_inherit">&nbsp;</div></div>'}return null},fixedPosition:function(){var e=this.j_menu,t=$("#often_forum"),i=$("#"+this._wrapId);t.removeClass("btn_select"),i.addClass("nav_position");var n=(t.position(),t.offset()),a=i.height();i.removeClass("nav_position");var o=e.find("li.n_menu_item"),s=o.length;1==s?(o.width(94),e.width(111),e.find(".btn_inherit").css("left","0px"),e.css({top:n.top+a-14,left:n.left})):(e.find(".btn_inherit").css("left","80px"),e.css({top:n.top+a-14,left:n.left-t.width()+5}))},loadingPos:function(){var e=this.$loading,t=$("#often_forum"),i=$("#"+this._wrapId);t.removeClass("btn_select"),i.addClass("nav_position");var n=(t.position(),t.offset()),a=i.height();i.removeClass("nav_position"),e.css({top:n.top+a-12,left:n.left-t.width()+5}),t.addClass("btn_select")}}});_.Module.define({path:"common/component/FakeGif",requires:[],sub:{version:"0.1",_options:{interval:100,autoStart:!1,frameNumber:0,spacingLength:0,width:0,height:0,url:"",alt:"GIF",x:0,y:0,container:"body"},currentFrame:1,timer:null,_template:['<div style="display: block; overflow: hidden; width: #{width}px; height: #{height}px; position: relative;"><img style="width: #{width}px; position: absolute; top: #{y}px; left: #{x}px;" src="#{url}" alt="#{alt}"/></div>'].join(""),initial:function(t){this.options=$.extend(this._options,t),0==this.options.height&&(this.options.height=this.options.spacingLength),this.renderElement(),this.options.autoStart&&this.letsGif()},renderElement:function(){this.$element=$($.tb.format(this._template,this.options)),this.$element.appendTo(this.options.container),this.$img=this.$element.find("img"),this.$element.hide()},letsGif:function(){var t=this,i=this.$img,e=this.options.x,n=this.options.interval,o=this.options.frameNumber,s=this.options.spacingLength,h=function(){i.css("top",e-t.currentFrame*s),t.currentFrame=(t.currentFrame+1)%o,t.timer=setTimeout(arguments.callee,n)};this.$element.show(),clearTimeout(this.timer),h()},stopGif:function(){clearTimeout(this.timer)}}});_.Module.define({path:"platform/widget/platformAuth",requires:[],sub:{initial:function(){this.bindEvents()},bindEvents:function(){}}});_.Module.define({path:"common/widget/RollNumber",sub:{_defaultOption:{numberString:"0",zeroArray:[],needComma:!1,theme:"black",dom:$("body")},_addEasingFunction:function(){jQuery.extend(jQuery.easing,{rollNumber:function(n,t,i,o,r){return(t/=r/2)<1?o/2*t*t*t*t*t+i:o/2*((t-=2)*t*t*t*t+2)+i}})},initial:function(n){this._addEasingFunction(),this._option=$.extend({},this._defaultOption,n),this._init(this._option.numberString)},_init:function(n){this._option.numberString=n,this._option.zeroArray=this._getZeroArray(n.length,this._option.needComma),this._option.length=this._option.zeroArray.length,this._render(),this._roll()},_getZeroArray:function(n,t){var i=new Array(n+1).join(0);return t?this._addComma(i).split(""):i.split("")},_addComma:function(n){for(var t=[],i=n.length;i>0;)t.unshift(n.substring(i-=3,i+3));return t.join(",")},_render:function(){for(var n="",t=this._option.zeroArray,i="roll_number_wrapper roll_number_"+this._option.theme,o=0,r=t.length;r>o;o++)n+=","==t[o]?'<div class="num_obg num_break"><span class="num_icon"></span></div>':'<div class="num_obg"><span class="num_icon"></span></div>';this._option.dom.addClass(i).html(n)},_reRender:function(){var n=this._option.zeroArray.length-this._option.length,t=new Array(n+1).join('<div class="num_obg"><span class="num_icon"></span></div>');this._option.dom.prepend(t),this._option.length=this._option.zeroArray.length},_roll:function(){var n,t=this,i=this._option.numberString,o=this._option.needComma?this._addComma(i).split(""):i.split(""),r=this._option.dom.find(".num_icon");$.each(o,function(i,o){n=-27*Number(o-0)?-27*Number(o-0):-270,t._changeNum(r.eq(i),{t:0,pos_y:n,d:100,b:0})})},_rollTo:function(n){for(var t=this._option.numberString,i=this._option.needComma?this._addComma(t).split(""):t.split(""),o=this._option.needComma?this._addComma(n).split(""):n.split(""),r=this._option.dom.find(".num_icon"),e=o.length-1;e>=0&&o[e]!=i[e];e--)r.eq(e).animate({"background-position-y":-27*o[e]+"px"},500,"rollNumber");this._option.numberString=n},refresh:function(n){this._option.zeroArray=this._getZeroArray(n.length,this._option.needComma),this._reRender(),this._rollTo(n)},_changeNum:function(n,t){var i=this;n.css("background-position","0px "+this._transition(t.t,t.pos_y,t.d,t.b)+"px"),t.t++,t.t<=t.d&&setTimeout(function(){i._changeNum(n,t)},20)},_transition:function(n,t,i,o){return(n/=i/2)<1?t/2*n*n*n+o:t/2*((n-=2)*n*n+2)+o}}});_.Module.define({path:"frs/widget/cheerForGEFC",requires:["common/widget/RollNumber"],sub:{tpls:{block:'<div class="cfgefc_dialog"><p>\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\uFF0C\u65E0\u6CD5\u53C2\u52A0\u6D3B\u52A8\u3002</p><a href="#" class="ui_btn ui_btn_m j_close"><span><em>\u786E\u5B9A</em></span></a></div>',notlike:'<div class="cfgefc_dialog"><p>\u53C2\u4E0E\u6D3B\u52A8\u9700\u8981\u5148\u5173\u6CE8\u672C\u5427\u54E6~</p><a href="#" class="ui_btn ui_btn_m j_dolike"><span><em>\u5173\u6CE8\u672C\u5427</em></span></a></div>',noreason:'<div class="cfgefc_dialog"><p>\u7CFB\u7EDF\u53D1\u751F\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\u8BD5\u5427~</p><a href="#" class="ui_btn ui_btn_m j_close"><span><em>\u786E\u5B9A</em></span></a></div>',sofast:'<div class="cfgefc_dialog"><p>\u54C7\u54E6~\u6211\u4EEC\u90FD\u5DF2\u7ECF\u611F\u53D7\u5230\u4F60\u7684\u70ED\u60C5\u4E86\uFF01\u8BF7\u4F11\u606F\u4E00\u4F1A\u513F\u518D\u6765\u5427\uFF01</p><a href="#" class="ui_btn ui_btn_m j_close"><span><em>\u786E\u5B9A</em></span></a></div>',goodcheer:'<div class="cfgefc_dialog_leftbg"><p class="cfgefc_orange" style="font-size:14px;margin-bottom:10px;">\u5DF2\u4E3A\u6052\u5927\u52A9\u653B\uFF0C\u62D2\u7EDD\u6050\u97E9\uFF0C\u4E3A\u4E2D\u56FD\u52A0\u6CB9\uFF01</p><p>\u5DF2\u6709<span class="cfgefc_orange">#{val}</span>\u540D\u7403\u8FF7\u4E0E\u60A8\u4E00\u8D77\u4E3A\u6052\u5927\u52A9\u653B</p><p>#{autolike}\u5DF2\u83B7\u5F97\u62BD\u5956\u8D44\u683C&nbsp;&nbsp;<a href="#{dialogurl}" target="_blank">#{dialogurlword}</a></p></div><a href="#" class="ui_btn ui_btn_m j_close"><span><em>\u6211\u77E5\u9053\u4E86</em></span></a></div>'},sending:!1,initial:function(e){try{var o=this;o.dialogurl=e,$.getJSON("/gcf/getVote?forum_id="+PageData.forum.forum_id+"&t="+(new Date-0),function(e){if(0==e.no){$(".cfgefc_wrapper").show();var a="string"==typeof e.data?Number(e.data):0;o.number=a+1,_.Module.use("common/widget/RollNumber",{numberString:a.toString(),dom:$("#cfgefc_rollnumber_wrapper")},function(e){o.roll=e}),o.bindEvents()}})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/cheerForGEFC/cheerForGEFC.js",method:"",ln:30}),a}},bindEvents:function(){var e=this;$(".j_cfgefc_bigbtn").on("click",function(o){try{o&&o.preventDefault(),PageData.user.is_login?PageData.user.balv.is_block||PageData.user.is_black||PageData.user.fobidden&&PageData.user.fobidden.isForbid?e.showBasicDialog("block"):PageData.user.is_like?e.sendCheer():e.sendLikeCheer():_.Module.use("common/widget/LoginDialog")}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"frs:widget/cheerForGEFC/cheerForGEFC.js",method:"",ln:44}),o}}).on("mouseover",function(){$(".cfgefc_bubble").show()}).on("mouseleave",function(){$(".cfgefc_bubble").hide()})},showBasicDialog:function(e,o){var a,i=this;_html=this.tpls[e],"goodcheer"==e&&(a=i.number++,i.roll.refresh(a.toString()),_html=$.tb.format(_html,{val:a,dialogurl:i.dialogurl,dialogurlword:"0"==i.dialogurl?"":"\u67E5\u770B\u62BD\u5956\u89C4\u5219",autolike:o?"\u540C\u65F6\u6B22\u8FCE\u4F60\u6210\u4E3A\u5E7F\u5DDE\u6052\u5927\u8DB3\u7403\u4FF1\u4E50\u90E8\u7684\u4F1A\u5458\uFF0C\u5E76":"\u60A8"})),this.timer=setTimeout(function(){switch(i.dialog&&i.dialog.close(),i.dialog=new $.dialog({html:_html,width:435}),e){case"notlike":i.dialog.element.on("click",".j_dolike",function(e){try{e.preventDefault(),i.dialog.close(),Balv.dolike(),$.stats.track("like_from_cheerForGEFC","platforum_activity")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/cheerForGEFC/cheerForGEFC.js",method:"",ln:77}),e}});break;case"goodcheer":i.dialog.element.addClass("pat-noTitle");default:i.dialog.element.on("click",".j_close",function(e){try{e.preventDefault(),i.dialog.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/cheerForGEFC/cheerForGEFC.js",method:"",ln:85}),e}}).on("onclose",function(){o&&$.tb.location.reload(),i.sending=!1})}i.timer=null},600)},sendCheer:function(e){var o=this,a={forum_id:PageData.forum.forum_id,tbs:PageData.tbs};o.sending||(o.sending=!0,$.post("/gcf/vote",a,function(a){0==a.no?o.showBasicDialog("goodcheer",e):20003==a.no?o.showBasicDialog("notlike"):20005==a.no?o.showBasicDialog("block"):20006==a.no?o.showBasicDialog("sofast"):o.showBasicDialog("noreason")},"json"))},sendLikeCheer:function(){var e=this,o={fid:PageData.forum.forum_id,fname:PageData.forum.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post("/f/like/commit/add",o,function(o){0==o.no||221==o.no?($.stats.track("like_from_cheerForGEFC","platforum_activity"),e.sendCheer(!0)):8==o.no||9==o.no||220==o.no?e.showBasicDialog("block"):e.showBasicDialog("noreason")},"json")}}});_.Module.define({path:"frs/widget/PlatformWeal",sub:{initial:function(a){try{this.dataObj=a,this.forumInfo=this.dataObj.forum_info,this.wealNum="",this._bindEvents(),this._initBubble(),jx=this}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/platform_weal/platform_weal.js",method:"",ln:18}),e}},_bindEvents:function(){var a=this,e=(a.dataObj,a.forumInfo.forum_mis_info),t=$.tb.location.getHash(),l=null,s=['<img src="/tb/static-frs/img/weal_welcome.png" alt="\u7FA4\u62A2\u4F18\u60E0\u5238" class="weal_wel_img">','<p class="weal_wel_tip">\u672C\u5427\u6B63\u5728\u53D1\u9001\u4F18\u60E0\u5238\u54DF~\u4E0D\u6765\u4E00\u4EFD\u4E48>_<</p>','<a href="#" id="weal_trigger_link" class="weal_trigger_link">\u6211\u8981\u9886\u53D6</a>'];"#getweal"==t&&(l=new $.dialog({html:s.join(""),showTitle:!0,draggable:!1,closeable:!0,width:418,holderClassName:"weal_wel_holder"})),$("#weal_trigger_link").click(function(){try{$("#btn_getweal").trigger("click"),l.close()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_weal/platform_weal.js",method:"",ln:46}),a}}),$("#btn_getweal").on("click",function(t){try{if(t.preventDefault(),a._closeBubble(),$.stats.track("\u672C\u5427\u798F\u5229\u6309\u94AE","\u5E73\u53F0\u5316\u5427\u7EDF\u8BA1\u62A5\u8868","","click"),1==PageData.user.is_login){if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;e&&e.weal_id?"1"==PageData.user.is_like?a._postWealData():a._postLikeData().always(function(){a._postWealData()}):"1"==PageData.user.is_like?a._showWealDialog(2):a._postLikeData()}else TbCom.process("User","buildLoginFrame",null,null,null,this.key||"");return!1}catch(l){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:l.message||l.description,path:"frs:widget/platform_weal/platform_weal.js",method:"",ln:83}),l}}),$("#wealtip_wrap").on("click",".wealtip_link",function(){try{$.stats.track("\u672C\u5427\u798F\u5229\u6D6E\u5C42\u94FE\u63A5","\u5E73\u53F0\u5316\u5427\u7EDF\u8BA1\u62A5\u8868","","click")}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_weal/platform_weal.js",method:"",ln:86}),a}})},_postLikeData:function(){var a=this,e=a.forumInfo.forum_mis_info,t={fid:PageData.forum.forum_id,fname:PageData.forum.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},l=$.post("/f/like/commit/add",t,function(t){var l=$.parseJSON(t);if(l)switch(l.no){case 0:$.stats.track("\u901A\u8FC7\u672C\u5427\u798F\u5229\u559C\u6B22\u672C\u5427","\u5E73\u53F0\u5316\u5427\u7EDF\u8BA1\u62A5\u8868","","view"),e&&e.weal_id||a._showWealDialog(1);break;case 8:case 9:case 220:a._showErrorTip(l.no);break;default:a._showErrorTip()}else a._showErrorTip()});return l},_postWealData:function(){var a=this,e=a.forumInfo.forum_id,t=a.forumInfo.forum_mis_info;$.post("/gcf/receive",{forum_id:e,weal_id:t.weal_id,tbs:PageData.tbs}).always(function(e){var t=$.parseJSON(e);switch(null!==t.data&&(a.wealNum=t.data),t.no){case 0:a._showWealDialog(1);break;case 20008:a._showWealDialog(2);break;case 20001:TbCom.process("User","buildLoginFrame",null,null,null,this.key||"");break;case 20003:a._postLikeData();break;case 20004:case 20005:case 20006:case 20007:case 20009:a._showErrorTip(t.no);break;case 20010:a._showWealDialog(3)}})},_showErrorTip:function(a){var e="";switch(a){case 8:case 9:e="\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C";break;case 220:e="\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C";break;case 20005:e="\u7528\u6237\u88AB\u5C01\u7981";break;case 20006:case 20007:e="\u64CD\u4F5C\u592A\u9891\u7E41\u4E86\uFF0C\u8BF7\u7A0D\u4F5C\u6B47\u606F\uFF0C\u8FC7\u4F1A\u513F\u518D\u6765";break;case 20009:e="\u9886\u53D6\u5931\u8D25\uFF0C\u8BF7\u518D\u8BD5\u4E00\u6B21\u5427";break;default:e="\u670D\u52A1\u5668\u51FA\u9519\u5566~\u8BF7\u518D\u8BD5\u4E00\u6B21\u5427"}var t=new Array;t.push('<div style="text-align:center;color:#333333;font-size:14px;padding:10px 10px 0;">'+e+"</div>");new $.dialog({html:t.join(""),showTitle:!0,draggable:!1,width:300,height:40})},_showWealDialog:function(a){var e=this,t=e.forumInfo.forum_mis_info,l=t.weal_dialog_text,s=t.weal_dialog_pic,i=t.weal_dialog_link,o=t.weal_dialog_tip1,r=t.weal_dialog_tip3,n=new Array;$.stats.track("\u672C\u5427\u798F\u5229\u6D6E\u5C42","\u5E73\u53F0\u5316\u5427\u7EDF\u8BA1\u62A5\u8868","","view"),n.push('<p id="wealtip_wrap" class="wealtip_wrap wealtip_wrap_theme'+a+'">'),""!=s&&(""!=i?(n.push('<a class="wealtip_link" href="'+i+'" target="_blank">'),n.push('<img src="'+s+'">'),n.push("</a>")):n.push('<img src="'+s+'">')),""!=l&&(""!=i?(n.push('<a class="wealtip_txt_link" href="'+i+'" target="_blank">'),n.push(l),n.push("</a>")):n.push('<span class="wealtip_txt_title">'+l+"</span>")),"1"!=PageData.user.is_like&&n.push('<span class="weal_status_tip">'+o+"</span>"),3==a?n.push('<span class="weal_num_wrap">'+r+"</span>"):""!=e.wealNum&&n.push('<span class="weal_num_wrap">\u4F60\u7684\u798F\u5229\uFF1A<em class="weal_num">'+e.wealNum+"</em></span>"),n.push("</p>");var _=new $.dialog({html:n.join(""),showTitle:!0,title:"\u63D0\u793A",draggable:!1,width:360,height:"auto",holderClassName:"weal_dialog_holder"});1==a&&_.bind("onclose",function(){$.tb.location.reload()})},_initBubble:function(){var a={content:"\u70B9\u51FB\u8FD9\u91CC\u9886\u53D6\u672C\u5427\u798F\u5229\uFF0C\u4E0D\u8981\u9519\u8FC7\u54E6\uFF01",arrow_dir:"down",bubble_css:{top:-5,right:-4,width:220},arrow_pos:{left:160},attr:" id='platform_weal_bubble' ",wrap:$(".btn_getweal_wrap"),closeBtn:!0},e=this;"1"!=$.cookie("plat_weal_bubb_"+PageData.forum.forum_id)&&(this._bubble=new UiBubbleTipBase(a),this._bubble.showBubble(),this._bubble.bind("onclose",$.proxy(e._closeBubble,e)))},_closeBubble:function(){$.cookie("plat_weal_bubb_"+PageData.forum.forum_id,"1"),this._bubble&&this._bubble.closeBubble()}}});_.Module.define({path:"frs/widget/platform_attention_recommend",sub:{initial:function(t){try{$.stats.track("platform_like_dialog_show","platform_like_recommend"),this.tbs=PageData.tbs,this.uid=t.uid,this.frs_access=t.frs_access,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.is_forum_manage=0,this.getList()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:20}),a}},getList:function(){var t=this,a={forum_id:PageData.forum.forum_id,tbs:t.tbs},e="";$.post("/gcf/getpop",a,function(a){if(a&&0==a.no){var i=a.data.list.length,n=a.data.list;t.is_forum_manage=a.data.is_manage;for(var s=0;s<Math.min(i,9);s++){var o="<li class='att_list'><a href='/f?ie=utf-8&kw="+encodeURIComponent(n[s].forum_name)+"' target='_blank'><img src="+n[s].avatar+" width=60 height=60></a>",r="";1==n[s].is_official&&(r="<span class='att_v'></span>"),list_top=o+r+"<div class='att_abs'><a class='recommend_forum_name' href='/f?ie=utf-8&kw="+encodeURIComponent(n[s].forum_name)+"' target='_blank'><p class='att_name'>"+$.tb.subByte(n[s].forum_name,8)+"\u5427</p></a>";var m="";m=0==n[s].is_like?$.tb.format('<a href="#" data-fid="#{forum_id}" data-fname="#{forum_name}" class="att_btn att_btn_able j_recommend"></a>',{forum_id:n[s].forum_id,forum_name:n[s].forum_name}):$.tb.format('<a href="#" data-fid="#{forum_id}" data-fname="#{forum_name}" class="att_btn att_btn_disable"></a>',{forum_id:n[s].forum_id,forum_name:n[s].forum_name});var d="";d=list_top+m+"</div></li>",e+=d}t.renderList(e)}else{var l="\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B";t.showAlert(l)}},"json")},renderList:function(t){var a="";a=1==this.is_forum_manage?"<div class='title'><img class='title_img' src='"+this.avatar+"' width=60 height=60><div class='title_txt'>HI~"+PageData.forum.forum_name+"\u5427\u5411\u5927\u5BB6\u63A8\u8350\u4EE5\u4E0B\u8FD9\u4E9B\u8D34\u5427\u54E6\uFF0C\u5927\u5BB6\u4E5F\u53EF\u4EE5\u5173\u6CE8\u770B\u770B\uFF1A</div></div>":"<div class='title'><img class='title_img' src='"+this.avatar+"' width=60 height=60><div class='title_txt'>HI~\u5173\u6CE8\u4E86\u6211\u7684\u5427\u53CB\u5927\u90E8\u5206\u8FD8\u5173\u6CE8\u4E86\u8FD9\u4E9B\u5427\u54E6\uFF0C\u5927\u5BB6\u4E5F\u53EF\u4EE5\u5173\u6CE8\u4ED6\u4EEC\uFF1A</div></div>";var e="<div class='content_wrapper content_view'><ul class='list_info'>"+t+"</ul></div>",i="";this.is_forum_fourth_manager&&(i="<div class='manage_txt'><a href='#' class='manage_forum j_manage'>\u7BA1\u7406\u672C\u5427\u63A8\u8350</a></div>");var n="<div class='recommend_info'>"+a+e+i+"</div>",s={title:"\u5173\u6CE8\u672C\u5427\u7684\u5427\u53CB\u8FD8\u5173\u6CE8",width:524},o=$.dialog.open(n,s);o.bind("onclose",function(){$.tb.location.reload()}),this.frs_access&&this.isManage(),this.initHandleEvents()},isManage:function(){$(".dialogJtxt").text("\u7BA1\u7406\u672C\u5427\u63A8\u8350"),$(".content_wrapper").removeClass("content_view"),$(".att_list").append("<span class='att_close j_close'></span>"),$(".att_btn").removeClass("j_recommend").removeClass("att_btn_disable").addClass("att_btn_able"),$(".title").html("<div class='title_set'><p>\u672C\u5427\u63A8\u8350\u7684\u5427\uFF1A</p><p class='set_notice'>\u8BBE\u7F6E\u540E\u5C06\u4F1A\u5BF9\u5173\u6CE8\u672C\u5427\u7684\u65B0\u7C89\u4E1D\u63A8\u8350\u8FD9\u4E9B\u8D34\u5427\u3002</p></div>"),$(".manage_txt").addClass("manage_set"),$(".manage_txt").html("<div class='add_info'><input class='input_text' type='text' placeholder='\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5427\u540D'><a href='#' class='add_btn j_add'></a><span class='att_notice_info'>\u6700\u591A\u53EA\u80FD\u6DFB\u52A0\u4E5D\u4E2A\u5427</span></div><div class='att_manage_btn'><a href='#' class='save_btn j_save'></a><a href='#' class='cancle_btn j_cancle'></a></div>"),1!=this.is_forum_manage&&$(".list_info").html(""),this.isNineForum()},isNineForum:function(){var t=$(".att_list").length;9==t&&($(".add_info").css("display","none"),$(".manage_set").css("height","49px"))},initHandleEvents:function(){var t=this;$(".content_wrapper").delegate(".j_close","click",function(t){try{$(this).parent().remove();var a=$(".att_list").length;9>a&&($(".add_info").css("display","block"),$(".manage_set").css("height","98px"))}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:117}),t}}),$(".j_manage").click(function(a){try{t.isManage()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:120}),a}}),$(".recommend_info").delegate(".j_add","click",function(a){try{""==$(".input_text").val()?t.showAlert("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5427\u540D"):t.checkForum()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:127}),a}}),$(".recommend_info").delegate(".j_recommend","click",function(a){try{var e=$(this).tbattr("data-fid"),i=$.tb.unescapeHTML($(this).tbattr("data-fname")),n={fid:e,fname:i,uid:t.uid,ie:"utf-8",tbs:t.tbs},s=$(this);$.post("/f/like/commit/add",n,function(a){if(a&&0==a.no)$.stats.track("platform_like_recommend","platform_like_recommend"),s.addClass("att_btn_disable").removeClass("att_btn_able").removeClass("j_recommend");else{var e="";e=8==a.no||9==a.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==a.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==a.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t.showAlert(e)}},"json")}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:152}),a}}),$(".recommend_info").delegate(".j_cancle","click",function(t){try{t.preventDefault(),$.tb.location.reload(!0)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:156}),t}}),$(".recommend_info").delegate(".j_save","click",function(a){try{t.saveForumSet()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_attention_recommend/platform_attention_recommend.js",method:"",ln:159}),a}})},checkForum:function(){var t=this,a=$(".input_text").val(),e=PageData.forum.forum_id;data={forum_id:e,forum_name:a,tbs:this.tbs},$.post("/gcf/getfinfo",data,function(a){if(a&&0==a.no){var e=new Array;if($(".att_btn").each(function(){var t=$(this).tbattr("data-fid");t>0&&e.push(parseInt(t))}),-1!=$.inArray(a.data.forum_id,e))t.showAlert("\u6B64\u5427\u5DF2\u5728\u63A8\u8350\u5217\u8868\u4E2D");else if(a.data.forum_id==PageData.forum.forum_id)t.showAlert("\u8BF7\u63A8\u8350\u9664\u4E86\u672C\u5427\u4EE5\u5916\u7684\u5427\u54E6");else{var i="";1==a.data.is_official&&(i="<span class='att_v'></span>");var n="<li class='att_list'><img src='"+a.data.avatar+"' width=60 height=60> "+i+"<div class='att_abs'><p class='att_name'>"+$.tb.subByte(a.data.forum_name,8)+"\u5427</p><a href='#' data-fid='"+a.data.forum_id+"' data-fname='"+a.data.forum_name+"' class='att_btn att_btn_able'></a></div><span class='att_close j_close'></span></li>";$(".list_info").append(n)}t.isNineForum()}else{var s="\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5427\u540D";t.showAlert(s)}},"json"),$(".input_text").val("")},saveForumSet:function(){{var t=this,a=new Array,e=$(".att_btn");e.length}$(".att_btn").each(function(){var t=$(this).tbattr("data-fid");t>0&&a.push(parseInt(t))}),0==a.length&&a.push(0);var i={forum_id:PageData.forum.forum_id,forum_ids:a,tbs:t.tbs};$.post("/gcf/setpop",i,function(a){if(a&&0==a.no)t.showSuccess("\u4FDD\u5B58\u6210\u529F"),$.tb.location.reload(!0);else{var e="\u63D0\u4EA4\u672A\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5";t.showAlert(e)}},"json")},showSuccess:function(t){var a='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(a,{title:"\u64CD\u4F5C\u6210\u529F",width:380})},showAlert:function(t){var a='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(a,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})}}});_.Module.define({path:"frs/widget/PlatformHead",requires:["common/component/FakeGif"],sub:{_forumHeadAddTpl:['<div class="forum_head_add_container">','<ul class="forum_head_add_ul clearfix">',"<li>",'<img src=http://tb2.bdstatic.com/tb/static-frs/widget/platform_head/img/platform_head_dialog_trans_bg_beb3141.png data-upload="#{head_pic}" class="image_wrapper image_head_pic" d-class="head_pic" width="90" height="90">','<div class="pic_info">','<div class="accept_pic_size">150&times;150\u50CF\u7D20</div>','<div class="forum_head_add_tips"></div>',"</div>",'<div class="add_pic">\u4E0A\u4F20\u5934\u50CF','<div class="upload_container"></div>',"</div>","</li>","<li>",'<img src=http://tb2.bdstatic.com/tb/static-frs/widget/platform_head/img/platform_head_dialog_trans_bg_beb3141.png data-upload="#{background_pic}" class="image_wrapper image_head_bg" d-class="head_bg" width="90" height="90">','<div class="pic_info">','<div class="accept_pic_size">980&times;180\u50CF\u7D20</div>','<div class="forum_head_add_tips"></div>',"</div>",'<div class="add_pic">\u4E0A\u4F20\u5934\u56FE','<div class="upload_container"></div>',"</div>","</li>","<li>",'<img src=http://tb2.bdstatic.com/tb/static-frs/widget/platform_head/img/platform_head_dialog_trans_bg_beb3141.png data-upload="#{wrap1}" class="image_wrapper image_background_pic" d-class="background_pic" width="90" height="90">','<div class="pic_info">','<div class="accept_pic_size">1800&times;1000\u50CF\u7D20</div>','<div class="forum_head_add_tips"></div>',"</div>",'<div class="add_pic">\u4E0A\u4F20\u80CC\u666F','<div class="upload_container j_add_background"></div>',"</div>","</li>","</ul>",'<div class="forum_head_add_submit_area">','<a href="#" class="ui_btn ui_btn_s forum_head_add_submit"><span><em>\u786E\u8BA4\u63D0\u4EA4</em></span></a>',"</div>","</div>"].join(""),initial:function(t){try{this.data=t,this.$dialogContent=null,this.head_pic=$(".plat_card_top ").find(".j_plat_picbox img"),this.head_bg=$(".j_platform_banner").find(".plat_head_bg"),this.background_pic=$("body").find(".wrap1"),this._bindEvents(),this.initLikeTips(),this.initModuleStat(),this._playGif(),"\u7279\u65AF\u62C9\u6C7D\u8F66"==PageData.forum.forum_name&&this.teslaHandler()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/platform_head/platform_head.js",method:"",ln:69}),a}},_bindEvents:function(){{var t=$(".platform_top_edit_btn").on("click",$.proxy(this._initDialog,this)).on("mouseover",$.proxy(this._playGif,this));setTimeout(function(){var a=1,i=7,e=setInterval(function(){i>a?t.css("background-position","0px -"+20*a++ +"px"):clearInterval(e)},200)},300)}},_initDialog:function(t){t&&t.preventDefault();var a,i=this,e=$(".j_platform_banner").getData();this.$dialogContent=$($.tb.format(this._forumHeadAddTpl,e)),a=new $.dialog({html:this.$dialogContent,title:"\u7533\u8BF7\u66F4\u6539\u56FE\u7247",width:488}),a.element.addClass("platform_head_edit_dialog").on("click",".forum_head_add_submit",function(t){try{t&&t.preventDefault();var e={forum_id:i.data.fid,tbs:i.data.tbs,module_id:1,m1_bigPic:a.element.find("[d-class=head_bg]").tbattr("data-upload").unescapeHTML(),m1_portrait:a.element.find("[d-class=head_pic]").tbattr("data-upload").unescapeHTML(),m1_headBg:a.element.find("[d-class=background_pic]").tbattr("data-upload").unescapeHTML()};$.tb.post("/gcf/commit?ie=utf-8",e,function(t){0==t.no?$.tb.alert({heading:"",width:300,title:"\u63D0\u793A",message:"\u7F16\u8F91\u6210\u529F,\u65B0\u63D0\u4EA4\u7684\u56FE\u7247\u5C06\u5728\u4E00\u4E2A\u5DE5\u4F5C\u65E5\u5185\u5BA1\u6838~",buttons:[{text:"\u77E5\u9053\u4E86",callback:function(){a.close(),$.tb.location.reload()}}]}).element.find(".dialogJclose").bind("click",function(){try{a.close(),$.tb.location.reload()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_head/platform_head.js",method:"",ln:132}),t}}):$.dialog.alert("\u6DFB\u52A0\u5931\u8D25")},"json")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_head/platform_head.js",method:"",ln:137}),t}}).find(".upload_container").each(function(){var t=$(this);t.hasClass("j_add_background")&&!i.data.isAuth?t.on("click",function(t){try{$.dialog.alert("\u4E0D\u597D\u610F\u601D\uFF0C\u60A8\u6682\u65E0\u6B64\u6743\u9650\u3002")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_head/platform_head.js",method:"",ln:143}),t}}):i._loadUploader(t)})},_loadUploader:function(t){var a=this;_.Module.use("common/widget/image_uploader_manager",[{container:t,width:t.width(),height:t.height(),isAutoUp:!0,isFlash:!0}],function(i){i.bind("onStartUpload",function(){a._showUploadTips("")}),i.bind("onComplete",function(i,e){var s=e.imageList[0].response;s&&0==s.error_code?a._resuletHandler(s.info,t.closest("li").find(".image_wrapper")):a._showUploadTips(0,"\u4E0A\u4F20\u5931\u8D25!",t.closest("li"))}),i.bind("onError",function(i,e){a._showUploadTips(0,e.errorMessage,t.closest("li"))})})},_resuletHandler:function(t,a){var i={background_pic:{width:1800,height:1e3},head_pic:{width:150,height:150},head_bg:{width:980,height:180}},e=a.tbattr("d-class")||"head_pic",s=i[e].width,d=i[e].height,o=s/d,n=t.fullpic_width,l=t.fullpic_height,c="http://imgsrc.baidu.com/forum/pic/item/"+t.pic_id_encode+".jpg";if(n/l==o&&n>=s&&l>=d||n==s&&l==d)switch(this._showUploadTips(1,"\u4E0A\u4F20\u6210\u529F\uFF01",a.parent()),a.tbattr("data-upload",c),a.addClass("upload_success"),e){case"head_pic":this.head_pic.tbattr("src",c);break;case"head_bg":this.head_bg.tbattr("src",c);break;case"background_pic":this.background_pic.css("background","url("+c+") center 91px no-repeat")}else a.css("background-color",""),this._showUploadTips(0,"\u5C3A\u5BF8\u4E0D\u7B26\uFF01",a.parent()),a.removeClass("upload_success")},_showUploadTips:function(t,a,i){var e=i.find(".forum_head_add_tips");1===t?(e.removeClass("forum_head_add_error_tips"),e.addClass("forum_head_add_success_tips")):0===t&&(e.removeClass("forum_head_add_success_tips"),e.addClass("forum_head_add_error_tips")),e.html(a)},initLikeTips:function(){"#dolike"==$.tb.location.getHash()&&1!=PageData.user.is_like&&_.Module.use("ucenter/widget/Balv",[{}],function(t){if(t.user.balv&&1!=t.user.balv.is_liked){var a=$.tb.alert({heading:"\u6B22\u8FCE\u6765\u5230"+t.forum.forum_name+"\u5427",message:"\u5173\u6CE8\u6210\u4E3A\u672C\u5427\u4F1A\u5458\uFF0C\u798F\u5229\u591A\u591A\u54E6\uFF01",buttons:[{text:"\u7ACB\u5373\u5173\u6CE8",callback:function(a,i){t.dolike(),i.close()}},{text:"\u4E0B\u6B21\u518D\u8BF4",callback:function(t,a){a.close()}}]}),i=$(a.getElement());i.find(".tb_alert_title").css("text-align","center"),i.find(".tb_alert_message").css("text-align","center"),i.find(".tb_alert_btn_group .ui_btn").css("margin-right",10).last().removeClass("ui_btn_m").addClass("ui_btn_sub_m").css("margin-right",0)}})},initModuleStat:function(){var t=$(".star_collect_time_axis_body"),a=$(".plat_forum_gallery"),i=$(".platforum_aside_images"),e=$(".platforum_aside_videos");t.length&&t.on("mousedown",".j_link",function(){$.stats.track("timeaxis","platform_module_stats")}),a.length&&a.on("mousedown","li a",function(){$.stats.track("gallery","platform_module_stats")}),i.length&&i.on("mousedown","a",function(){$.stats.track("images","platform_module_stats")}),e.length&&e.on("mousedown","a",function(){$.stats.track("video","platform_module_stats")})},teslaHandler:function(){var t="33629",a="/gcf/pv?forum_id="+PageData.forum.forum_id,i=$.cookie("userFirstExperience");$.getJSON(a,function(a){"0"==a.no&&(t=a.data.length<6?"0"+a.data:a.data),_.Module.use("common/widget/RollNumber",[{numberString:t,dom:$(".tesla_pv_container")}])}),i||($.cookie("userFirstExperience",1,{expires:3650}),$("#tesla_iframe").tbattr("src","/tb/static-frs/swf/tesla/tour_tieba.html"))},_playGif:function(){var t=this;t.playGif?t.playGif.letsGif():t.playGif=this.use("common/component/FakeGif",{interval:150,autoStart:!0,frameNumber:7,spacingLength:20,width:27,height:20,url:"http://tb2.bdstatic.com/tb/static-frs/img/platform_top_edit_f0093cb.png",alt:"GIF",x:0,y:0,container:".platform_top_edit_btn"})}}});_.Module.define({path:"frs/widget/Timeaxis",sub:{initial:function(e,t){try{"undefined"!=typeof PDC&&PDC.mark("c_timeaxisavi"),this.data=t,this.tabKey=e.tabKey,this.fid=e.fid,this.fname=e.fname,this.tbs=e.tbs,this.isManager=e.isManager,this.isPm=e.isPm,this.isGConforum=e.isGConforum,this.timeLineLength=e.timeLineLenght,this._initTimeAxis()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:29}),i}},_initTimeAxis:function(){var e=this;e.timeAxisIndex=0,e.timeAxisMode="view";var t=e.data.timeline_pass_len;if((e.isPm||e.isManager)&&(t=e.data.timeline_pass_mag_len),e.isGConforum&&(t=e.timeLineLength),!(4>t)||e.isPm||e.isManager){var i,s,a,o,r;i=$("#star_collect_time_axis_body"),i.size()>0?(s=4,a=!1,o=2e3,r=null):(i=$("#star_time_axis_body_small"),s=1,a=!0,o=!1,r=5e3),e.timeAxisParams={$timeAxisContainer:i,showNumber:s,circular:a,hoverScroll:o,auto:r},e._rebuildTimeAxis(t,0,!0),$("#time_axis_slide_button_wrapper").click(function(){try{var t=$(this),s=$(".star_nav_wrap");t.is(".tx_slide_state_down")?($.browser.msie&&$.browser.version<8?(i.hide(),s.css("position","static"),setTimeout(function(){s.css("position","relative")},10)):i.slideUp(),t.removeClass("tx_slide_state_down").addClass("tx_slide_state_up"),$.cookie("time_axis_slide_up",1,{expires:7,path:"/"}),$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_slide_up")):($.browser.msie&&$.browser.version<8?(i.show(),e._reloadAndRebuildTimeAxis(),s.css("position","static"),setTimeout(function(){s.css("position","relative")},10)):i.slideDown(function(){e._reloadAndRebuildTimeAxis()}),t.removeClass("tx_slide_state_up").addClass("tx_slide_state_down"),$.cookie("time_axis_slide_up",0,{expires:7,path:"/"}),$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_slide_down"))}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:122}),a}}),$("#platform_time_axis_wrapper").click(function(){try{var t=$(this),s=$(".star_nav_wrap");t.is(".platform_star_time_axis_hide")?($.browser.msie&&$.browser.version<8?(i.hide(),s.css("position","static"),setTimeout(function(){s.css("position","relative")},10)):i.slideUp(),t.removeClass("platform_star_time_axis_hide").addClass("platform_star_time_axis_show"),t.tbattr("title","\u5C55\u5F00\u65F6\u5149\u8F74"),$.cookie("time_axis_slide_up",1,{expires:7,path:"/"}),$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_slide_up")):($.browser.msie&&$.browser.version<8?(i.show(),e._reloadAndRebuildTimeAxis(),s.css("position","static"),setTimeout(function(){s.css("position","relative")},10)):i.slideDown(function(){e._reloadAndRebuildTimeAxis()}),t.removeClass("platform_star_time_axis_show").addClass("platform_star_time_axis_hide"),t.tbattr("title","\u6536\u8D77\u65F6\u5149\u8F74"),$.cookie("time_axis_slide_up",0,{expires:7,path:"/"}),$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_slide_down"))}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:170}),a}}),"main"==e.tabKey&&(e.isManager||e.isPm)&&setInterval(function(){e._reloadAndRebuildTimeAxis(e.timeAxisIndex)},3e5)}},render:function(e){this.timeAxisParams.$timeAxisContainer.html('<div class="star_time_axis_prev prev_disabled"></div><div class="star_time_axis_carousel"><ul class="star_time_axis clearfix"></ul></div><div class="star_time_axis_next"></div><div class="star_time_axis_arrow"></div>');for(var t=this.timeAxisParams.$timeAxisContainer.find(".star_time_axis"),i=0,s=e.length;s>i;i++){var a=this._buildTimeAxisItem(e[i]);t.append(a)}},_rebuildTimeAxis:function(e,t,i){var s=this;this.timeAxisIndex=t||0;var a=0;i?a=e:(a=e.length,this.render(e)),t+4>a&&(t=a-4,t=t>0?t:0);var o=this.timeAxisParams.$timeAxisContainer.find(".star_time_axis_carousel");if(t>0&&o.prev().removeClass("prev_disabled"),4>=a-t&&o.next().addClass("next_disabled"),"main"==this.tabKey&&(s.isManager||s.isPm)){var r=['<div id="star_collect_time_axis_add" class="star_collect_time_axis_add" title="\u6DFB\u52A0\u5185\u5BB9" style="display: none;"></div>','<div id="star_time_mode_change" class="star_time_mode_change">','   <div class="time_axis_button time_axis_mode_edit" data-mode="edit">\u7F16\u8F91\u6A21\u5F0F<i></i></div>','   <div class="time_axis_button time_axis_mode_view" data-mode="view">\u6D4F\u89C8\u6A21\u5F0F<i></i></div>',"</div>",'<div class="time_axis_approve_number_wrap"></div>','<a class="star_time_axis_advice" href="http://tieba.baidu.com/p/2055416079" target="_blank">\u65F6\u5149\u8F74\u610F\u89C1\u53CD\u9988</a>'].join("");s.timeAxisParams.$timeAxisContainer.append(r);var n=$("#star_collect_time_axis_add");"edit"==s.timeAxisMode&&0==s.timeAxisIndex&&n.show(),$("#star_time_mode_change").on("click",function(e){try{var t=$(e.target).data("mode");s.timeAxisMode=t;var i=$(this).parent();"view"==t?i.removeClass("time_axis_edit_mode").addClass("time_axis_view_mode"):i.removeClass("time_axis_view_mode").addClass("time_axis_edit_mode"),s._reloadAndRebuildTimeAxis()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:245}),e}}),n.click(function(){try{s._showTimeAxisAddDialog()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:248}),e}}),s.showTimeAxisApproveNumber()}0!=a&&(s.timeAxisParams.$timeAxisContainer.find(".star_time_axis_prev").hover(function(){$(this).addClass("star_time_axis_prev_hover")},function(){$(this).removeClass("star_time_axis_prev_hover")}),s.timeAxisParams.$timeAxisContainer.find(".star_time_axis_next").hover(function(){$(this).addClass("star_time_axis_next_hover")},function(){$(this).removeClass("star_time_axis_next_hover")}),o.jCarouselLite({lazyLoadImg:!0,btnNext:o.next(),btnPrev:o.prev(),visible:s.timeAxisParams.showNumber,circular:s.timeAxisParams.circular,auto:s.timeAxisParams.auto,hoverScroll:s.timeAxisParams.hoverScroll,start:t,afterEnd:function(e){s.timeAxisIndex=e.first().index(),"edit"==s.timeAxisMode&&(0==s.timeAxisIndex?$("#star_collect_time_axis_add").show():$("#star_collect_time_axis_add").hide())}}),o.on({mouseenter:function(){$(this).addClass("time_axis_item_hover")},mouseleave:function(){$(this).removeClass("time_axis_item_hover")}},"li").on("click",".j_delete",function(e){try{var t="/frsstar/cm/timeline/del";if(s.isGConforum&&(t="/frsstar/cm/timeline/delGcon"),e.preventDefault(),e.stopPropagation(),confirm("\u786E\u8BA4\u8981\u5220\u9664\u5417\uFF1F")){var i=$(this).closest("li");$.tb.post(t,{fid:s.fid,tbs:s.tbs,source:i.data("source"),thread_id:i.data("threadId"),resource_id:i.tbattr("data-resource-id")},function(){s._reloadAndRebuildTimeAxis(s.timeAxisIndex)});var a=i.data("resourceType"),o=i.data("source");$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_delete&st_value=resource_type_"+a+"&st_value2=source_"+o)}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:319}),e}}).on("click",".j_set_top",function(e){try{var t="/frsstar/cm/timeline/settop";if(s.isGConforum&&(t="/frsstar/cm/timeline/settopGcon"),e.preventDefault(),e.stopPropagation(),confirm("\u786E\u8BA4\u8981\u7F6E\u9876\u5417\uFF1F")){var i=$(this).closest("li");$.tb.post(t,{fid:s.fid,tbs:s.tbs,source:i.data("source"),resource_id:i.tbattr("data-resource-id")},function(){s._reloadAndRebuildTimeAxis(s.timeAxisIndex)})}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:338}),e}}).on("click",".j_cancel_top",function(e){try{var t="/frsstar/cm/timeline/canceltop";if(s.isGConforum&&(t="/frsstar/cm/timeline/canceltopGcon"),e.preventDefault(),e.stopPropagation(),confirm("\u786E\u8BA4\u8981\u53D6\u6D88\u7F6E\u9876\u5417\uFF1F")){var i=$(this).closest("li");$.tb.post(t,{fid:s.fid,tbs:s.tbs,source:i.data("source"),resource_id:i.tbattr("data-resource-id")},function(){s._reloadAndRebuildTimeAxis(s.timeAxisIndex)})}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:357}),e}}).on("click",".j_approve",function(e){try{e.preventDefault(),e.stopPropagation();var t=$(this).closest("li"),i=t.data("itemData");s._showTimeAxisApproveDialog(i)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:364}),e}}).on("click",".j_link",function(e){try{e.preventDefault(),e.stopPropagation();var t=$(this).closest("li");if("0"==t.data("audit"))s._showTimeAxisApproveDialog(itemData);else{var i=t.data("threadId"),a=t.data("resourceType"),o=t.data("source");$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_click&st_value=resource_type_"+a+"&st_value2=source_"+o),window.open("/p/"+i)}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:379}),e}}))},showTimeAxisApproveNumber:function(){var e=this;$.tb.get("/frsstar/api/getalltimeline?fid="+this.fid+"&_t="+(new Date).getTime(),function(t){if(0==t.no){var i=t.data.no_audit.length,s=$.cookie("time_axis_remind_bubble");if(0!=t.data.remind_mag&&"1"!=s){var a="\u5DF2\u67096\u5929\u6CA1\u6709\u66F4\u65B0\u65F6\u5149\u8F74\u4E86,\u6765\u66F4\u65B0TA\u7684\u52A8\u6001\u5427 ^_^ ~";2==t.data.remind_mag&&(a="\u5DF2\u8D85\u8FC77\u5929\u6CA1\u6709\u66F4\u65B0\u65F6\u5149\u8F74,\u5427\u53CB\u770B\u4E0D\u5230\u5185\u5BB9\u4E86 T_T ~");var o={content:a,arrow_dir:"down",bubble_css:{top:0,left:-30,width:310},arrow_pos:{left:80},attr:"id='time_axis_remind_bubble'",wrap:$("#star_collect_time_axis_body").find(".time_axis_approve_number_wrap"),closeBtn:!0},r=new UiBubbleTipBase(o);r.bind("onclose",function(){$.cookie("time_axis_remind_bubble",1,{expires:1,path:"/"})},!0),r.showBubble(),$("#time_axis_remind_bubble").show()}else if(i>0){var n=t.data.no_audit[0],d=$.cookie("time_axis_approve_bubble_"+e.fid);if(null==d||n.sort_time>d){var _={content:"\u8FD8\u6709<span class='j_approve_number' style='color: #FF7F3E;'>"+i+"</span>\u6761\u672A\u5BA1\u6838\u7684\u65F6\u5149\u8F74",arrow_dir:"down",bubble_css:{top:0,left:-20,width:150},arrow_pos:{left:70},attr:"id='time_axis_approve_number_bubble'",wrap:$("#star_collect_time_axis_body").find(".time_axis_approve_number_wrap"),closeBtn:!0},m=new UiBubbleTipBase(_);m.bind("onclose",function(){$.cookie("time_axis_approve_bubble_"+e.fid,n.sort_time,{expires:3,path:"/"})},!0),m.showBubble(),$("#time_axis_approve_number_bubble").show()}}}})},_reloadData:function(e){var t=this;$.tb.get("/frsstar/bw/index",{fid:t.fid,frsinfo:1,rforum:1},function(t){t&&0==t.no&&e(t)})},_reloadAndRebuildTimeAxis:function(e,t){var i=this;i._reloadData(function(s){var a=s.data.timeline_pass;(i.isPm||i.isManager)&&(a="edit"==i.timeAxisMode?s.data.timeline:s.data.timeline_pass_mag),i._rebuildTimeAxis(a,e),t&&t()})},_buildTimeAxisItem:function(e){var t={1:"music",2:"mv",4:"video",5:"video",6:"video",7:"video",11:"video"};e.type=t[e.resource_type]||"";var i=new Date;e.time_show=e.is_top?"\u7F6E\u9876":this._formatTimeAxisTime(e.sort_time,i),0==e.source&&(e.source_show="\u5427\u4E3B\u7F16\u8F91"),e.title_show="main"==this.tabKey?12!=e.resource_type||null!=e.show_pic_url&&0!=e.show_pic_url.length?$.tb.getByteLength(e.title)>40?$.tb.subByte(e.title,40):e.title:$.tb.getByteLength(e.title)>56?$.tb.subByte(e.title,56):e.title:$.tb.getByteLength(e.title)>60?$.tb.subByte(e.title,60):e.title,e.show_pic_url=e.pic_url;var s=$($.tb.format($("#timeAxisItemTpl").html(),e));return(null==e.source_show||0==e.source_show.length)&&s.find(".time_axis_source").remove(),12!=e.resource_type||null!=e.show_pic_url&&0!=e.show_pic_url.length||(s.find("h6").prepend("<em>\u65B0\u95FB</em>"),s.addClass("time_axis_icon_item")),"main"==this.tabKey&&(0==e.is_audit?(this.isPm||this.isManager)&&s.find(".time_axis_desc").append('<div class="time_axis_manager"><span class="j_approve time_axis_strong">\u5F85\u5BA1\u6838</span></div> '):this.isPm?e.is_top?s.find(".time_axis_desc").append('<div class="time_axis_manager"><span class="j_cancel_top">\u53D6\u6D88\u7F6E\u9876</span><span class="j_delete">\u5220</span></div> '):s.find(".time_axis_desc").append('<div class="time_axis_manager"><span class="j_set_top">\u9876</span><span class="j_delete">\u5220</span></div> '):this.isManager&&s.find(".time_axis_desc").append('<div class="time_axis_manager"><span class="j_delete">\u5220</span></div> ')),s.data("itemData",e),s},_formatTimeAxisTime:function(e,t){var i=parseInt(t.getTime()/1e3),s=parseInt(i-e);if(60>s)return 1>s&&(s=1),s+"\u79D2\u524D";if(s=parseInt(s/60),60>s)return s+"\u5206\u949F\u524D";if(s=parseInt(s/60),24>s)return s+"\u5C0F\u65F6\u524D";var a=new Date(1e3*e),o=a.getMonth()+1,r=a.getDate();return o=o>9?o:"0"+o,r=r>9?r:"0"+r,a.getFullYear()+"-"+o+"-"+r},_showTimeAxisApproveDialog:function(e){var t=this,i=$($.tb.format($("#timeAxisApproveDialogTpl").html(),e));i.find(".time_axis_approve_btn").click(function(s){try{s.preventDefault(),s.stopPropagation();var a={fid:t.fid,tbs:t.tbs,source:e.source,resource_id:e.resource_id};if(a.title=i.find("[name='title']").val(),a.pass=i.find("[name='result']:checked").val(),a.title!=e.title&&$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=title_change"),"2"==a.pass){var o=0;i.find("[name='reason']:checked").each(function(){o+=this.value-0,$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_approve_rj_reason_"+this.value)}),a.nopass_msg=o,$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_approve_reject")}else $.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_approve_pass");$.post("/frsstar/cm/timeline/audit",a,function(e){0==e.no?t._reloadAndRebuildTimeAxis(t.timeAxisIndex,function(){$.dialog.close()}):alert("\u5BA1\u6838\u5931\u8D25")},"json")}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:654}),s}}),i.find("[name='result']").change(function(){"2"==this.value?i.find(".j_approve_reasons").show():i.find(".j_approve_reasons").hide()});var s=new $.dialog({html:i,title:"\u5F85\u5BA1\u6838\u5185\u5BB9",draggable:!1,width:550});s.show()},_showTimeAxisAddDialog:function(){var e=this,t=$($("#timeAxisAddDialogTpl").html()),i=window.onFlashUploadComplete,s=window.onFlashStartUpload;this.isGConforum&&t.find(".platform_style").hide(),window.onFlashUploadComplete=function(i){var s;try{s=$.json.parseJSON(i)}catch(a){alert("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u3002")}var o=$("#star_time_axis_pic_form");if(0==s.error_code){o.find(".time_axis_add_table_tip").hide().next().removeClass("time_axis_em_tip").html("\u4E0A\u4F20\u6210\u529F");var r="http://imgsrc.baidu.com/forum/pic/item/"+s.info.pic_id_encode+".jpg";t.find("[name='pic_url']").val(r),$.post("frsstar/cm/timeline/upload",{tbs:e.tbs,fid:e.fid,pic_url:r},function(e){t.find("[name='pic_id']").val(e.data.pid)},"json")}else o.find(".time_axis_add_table_tip").hide().next().addClass("time_axis_em_tip").html("\u4E0A\u4F20\u5931\u8D25")},window.onFlashStartUpload=function(){},t.find("[name='title']").keyup(function(){$.tb.getByteLength(this.value)>40&&(this.value=$.tb.subByte(this.value,40,""))}),t.find("[name='source_url']").blur(function(){0==this.value.length&&$(this).next().show()}).focus(function(){$(this).next().hide()}),t.find(".time_axis_placeholder").text("http://").click(function(){try{$(this).hide().prev().focus()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:724}),e}}),t.find(".time_axis_add_submit").click(function(a){try{a.preventDefault(),a.stopPropagation();var o=t.find("[name='title']"),r=t.find("[name='pic_url']"),n=t.find("[name='pic_id']"),d=t.find("[name='source_url']"),_=o.val(),m=r.val(),l=n.val(),c=d.val();if(null==m||0==m.length)return r.parent().find(".time_axis_add_table_tip").hide().next().addClass("time_axis_em_tip").html("\u8BF7\u4E0A\u4F20\u56FE\u7247"),void 0;if(null==_||0==_.length)return o.next().find(".time_axis_add_table_tip").hide().next().html("\u8BF7\u586B\u5199\u6807\u9898"),void 0;if(o.next().find(".time_axis_add_table_tip").show().next().hide(),null==c||0==c.length)return d.parent().next().find(".time_axis_add_table_tip").hide().next().html("\u8BF7\u586B\u5199\u8D34\u5B50\u94FE\u63A5").show(),void 0;if(0==/^http:\/\/tieba.baidu.com\/p\/\d+/.test(c))return d.parent().next().find(".time_axis_add_table_tip").show().addClass("time_axis_em_tip").next().hide(),void 0;d.parent().next().find(".time_axis_add_table_tip").show().removeClass("time_axis_em_tip").next().hide();var p=$(this).hide().next().show().end();e._postTimeAxisItem(_,c,m,l,function(e){0!=e.no&&(p.show().next().hide(),window.onFlashUploadComplete=i,window.onFlashStartUpload=s)})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/timeaxis/timeaxis.js",method:"",ln:767}),a}});var a=new $.dialog({html:t,title:"\u6DFB\u52A0\u65F6\u5149\u8F74\u4FE1\u606F",draggable:!1,width:418,onclose:function(){window.onFlashUploadComplete=i,window.onFlashStartUpload=s}});a.show();var o=$("#star_time_axis_pic_form").find("button");new $.swf("/tb/editor/v2/tedupload.swf",{container:"#time_axis_pic_upload_container",width:o.outerWidth(),height:o.outerHeight(),params:{wmode:"transparent"},vars:{upload_url:"http://upload.tieba.baidu.com/upload/pic?tbs=ca6a6f4abb0c3aff013546920930125500_1"}})},_postTimeAxisItem:function(e,t,i,s,a){var o=this,r="/frsstar/cm/timeline/add",n={fid:o.fid,tbs:o.tbs,title:e,pic_url:i,pic_id:s,source_url:t,show_pic_url:i};this.isGConforum&&(r="/frsstar/cm/timeline/addGcon"),$.stats.sendRequest("fr=tb0_forum&st_mod=star_top&st_type=time_axis_submit"),$.post(r,n,function(e){if(0==e.no)setTimeout(function(){o._reloadAndRebuildTimeAxis(o.timeAxisIndex,function(){$.dialog.close()}),a&&a(e)},1e3);else{var t,i={150005:"\u4EC5\u652F\u6301\u8D34\u5427\u8D34\u5B50\u94FE\u63A5",150008:"\u8BE5\u8D34\u5B50\u5DF2\u6DFB\u52A0",150017:"\u8BE5\u8D44\u6E90\u5DF2\u5B58\u5728"};t=i[e.no],null==t&&(t="\u6DFB\u52A0\u5931\u8D25"),$.dialog.alert(t),a&&a(e)}},"json")}}});_.Module.define({path:"frs/widget/PlatformGallery",sub:{_forumIntroAddTpl:['<div class="forum_intro_add_container">','<table class="forum_intro_add_table">',"<tr>",'<th valign="top">\u6587\u5B57\u7B80\u4ECB\uFF1A</th>','<td><textarea class="content"></textarea>','<div class="forum_intro_add_normal_tip">\u6700\u591A\u586B\u5199130\u4E2A\u5B57</div>',"</td></tr></table>",'<div class="forum_add_submit_area">','<span class="forum_intro_add_error_tips"></span>','<a href="#" class="ui_btn ui_btn_s forum_intro_add_submit">',"<span><em>\u786E\u8BA4\u63D0\u4EA4</em></span></a>","</div></div>"].join(""),_forumGalleryAddTpl:['<div class="forum_gallery_add_container">','<ul class="forum_gallery_add_ul clearfix">',"<li>",'<div class="gallery_pic"><div class="accept_pic_size">125*90</div></div>','<div class="add_pic">\u56FE\u7247\u4F4D1<div class="upload_container"></div></div>',"</li>","<li>",'<div class="gallery_pic"><div class="accept_pic_size">125*90</div>','</div><div class="add_pic">\u56FE\u7247\u4F4D2<div class="upload_container"></div></div>',"</li>","<li>",'<div class="gallery_pic"><div class="accept_pic_size">125*90</div></div>','<div class="add_pic">\u56FE\u7247\u4F4D3<div class="upload_container"></div></div>',"</li>","<li>",'<div class="gallery_pic"><div class="accept_pic_size">125*90</div></div>','<div class="add_pic">\u56FE\u7247\u4F4D4<div class="upload_container"></div></div>',"</li>","</ul>",'<table class="forum_gallery_add_table">','<tr class="gallery_info_title">',"<th>\u56FE\u7247\u4F4D1\uFF1A</th>",'<td><div class="forum_gallery_add_normal_tip tip_1"></div></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u540D\u79F0\uFF1A</td>",'<td><input class="gallery_name" data-index="tip_1"/></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u5730\u5740\uFF1A</td>",'<td><input class="gallery_link" data-index="tip_1"/></td>',"</tr>",'<tr class="gallery_info_title">',"<th>\u56FE\u7247\u4F4D2\uFF1A</th>",'<td><div class="forum_gallery_add_normal_tip tip_2"></div></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u540D\u79F0\uFF1A</td>",'<td><input class="gallery_name" data-index="tip_2"/></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u5730\u5740\uFF1A</td>",'<td><input class="gallery_link" data-index="tip_2"/></td>',"</tr>",'<tr class="gallery_info_title">',"<th>\u56FE\u7247\u4F4D3\uFF1A</th>",'<td><div class="forum_gallery_add_normal_tip tip_3"></div></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u540D\u79F0\uFF1A</td>",'<td><input class="gallery_name" data-index="tip_3"/></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u5730\u5740\uFF1A</td>",'<td><input class="gallery_link" data-index="tip_3"/></td>',"</tr>",'<tr class="gallery_info_title">',"<th>\u56FE\u7247\u4F4D4\uFF1A</th>",'<td><div class="forum_gallery_add_normal_tip tip_4"></div></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u540D\u79F0\uFF1A</td>",'<td><input class="gallery_name" data-index="tip_4"/></td>',"</tr>","<tr>","<td>\u94FE\u63A5\u5730\u5740\uFF1A</td>",'<td><input class="gallery_link" data-index="tip_4"/></td>',"</tr>","</table>",'<div class="forum_add_submit_area">','<span class="forum_gallery_add_error_tips"></span>','<a href="#" class="ui_btn ui_btn_s forum_gallery_add_submit">',"<span><em>\u786E\u8BA4\u63D0\u4EA4</em></span>","</a>","</div>","</div>"].join(""),initial:function(t){try{this.data=t,this.fid=t.fid,this.fname=t.fname,this.tbs=t.tbs,this.focus_is_hide=0,this.intro=$("."+t.root).find(".plat_intro_txt").text(),this.$dialogContent=null,this._initForumIntroAdd(),this._initForumGalleryAdd()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/platform_gallery/platform_gallery.js",method:"",ln:116}),i}},_initForumIntroAdd:function(){var t=this,i=$(".forum_intro_add");i.bind("click",function(i){try{i.preventDefault(),i.stopPropagation(),t._showForumIntroAddDialog()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/platform_gallery/platform_gallery.js",method:"",ln:124}),i}})},_showForumIntroAddDialog:function(){var t=$(this._forumIntroAddTpl),i=t.find(".content"),a=t.find(".forum_intro_add_error_tips"),l={tbs:this.tbs,forum_id:this.fid,module_id:3,m3_desc:""};t.find(".content").keyup(function(){a.html(""),$.tb.getByteLength(this.value)>260&&(this.value=$.tb.subByte(this.value,260,""))}),t.find(".forum_intro_add_submit").click(function(t){try{t.preventDefault(),t.stopPropagation();var r=i.val();null==r||0==r.replace(/\s/g,"").length||(l.m3_desc=r.replace(/[\r\n]/g," ")),$.tb.post("/gcf/commit?ie=utf-8",l,function(t){0==t.no?($.dialog.close(),$.tb.location.reload()):a.html("\u6DFB\u52A0\u5931\u8D25")},"json")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/platform_gallery/platform_gallery.js",method:"",ln:168}),t}});var r=new $.dialog({html:t,title:"\u6587\u5B57\u7B80\u4ECB\u4FEE\u6539",draggable:!0,width:418});$(".dialogJcontent").css("padding","0"),i.val(this.intro),r.show()},_initForumGalleryAdd:function(){var t=this,i=$(".forum_gallery_add");i.bind("click",function(i){try{i.preventDefault(),i.stopPropagation(),t._showForumGalleryAddDialog()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/platform_gallery/platform_gallery.js",method:"",ln:187}),i}})},_showForumGalleryAddDialog:function(){var t=this,i=$(this._forumGalleryAddTpl);this.$dialogContent=i;var a=i.find(".forum_gallery_add_error_tips"),l=i.find(".gallery_pic"),r=i.find(".gallery_name"),d=i.find(".gallery_link"),e={tbs:this.tbs,forum_id:this.fid,module_id:4,m4_data:[]};i.find(".forum_gallery_add_submit").click(function(o){try{if(i.find(".forum_gallery_add_normal_tip").html(""),o.preventDefault(),o.stopPropagation(),t._forumGalleryInfoValidate()){e.focus_is_hide=t.focus_is_hide;for(var n=0;4>n;n++){var s={};s.pic=l.eq(n).tbattr("data-url").unescapeHTML(),s.title=r.eq(n).val(),s.link=d.eq(n).val(),e.m4_data.push(s)}$.tb.post("/gcf/commit?ie=utf-8",e,function(t){0==t.no?($.dialog.close(),$.tb.location.reload()):a.html("\u6DFB\u52A0\u5931\u8D25")},"json")}}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"frs:widget/platform_gallery/platform_gallery.js",method:"",ln:243}),o}});var o=new $.dialog({html:i,title:"\u56FE\u7247\u4F4D\u8BBE\u7F6E",draggable:!0,width:418});o.show(),$(".dialogJcontent").css("padding","10px 0 0 0"),$(".plat_forum_gallery li").each(function(t){var i=$(this).find("a").tbattr("href").unescapeHTML(),a=$(this).find("img").tbattr("src").unescapeHTML(),e=$(this).find(".inner").text();l.eq(t).html("").tbattr("data-url",a).append($('<img class="image_wrapper"/>').tbattr("src",a)),r.eq(t).val(e),d.eq(t).val(i)}),i.find(".upload_container").each(function(){t._forumGalleryUpload($(this))})},_forumGalleryInfoValidate:function(){var t=this,i=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/i,a=!0;return 1==a&&this.$dialogContent.find(".gallery_pic").each(function(){var i=$(this).tbattr("data-url");tip=t.$dialogContent.find(".forum_gallery_add_error_tips");var a=/frs_head_falut_img/;return a.test(i)?(t.focus_is_hide=1,void 0):void 0}),1==a&&this.$dialogContent.find(".gallery_name").each(function(){return $.tb.getByteLength($(this).val())>20?(t._forumGalleryInfoError($(this),"name_overflow"),a=!1,!1):void 0}),1==a&&this.$dialogContent.find(".gallery_link").each(function(){if(""==$(this).val()&&(t.focus_is_hide=1),0==$(this).val());else if(!i.test($(this).val()))return t._forumGalleryInfoError($(this),"link_forbid"),a=0,!1}),a},_forumGalleryInfoError:function(t,i){var a=t.tbattr("data-index"),l=this.$dialogContent.find("."+a),r={name_overflow:"\u94FE\u63A5\u540D\u79F0\u6700\u591A10\u4E2A\u6C49\u5B57",link_empty:"\u8BF7\u586B\u5199\u94FE\u63A5\u5730\u5740",link_forbid:"\u94FE\u63A5\u5730\u5740\u4E0D\u5408\u6CD5\u8BF7\u91CD\u65B0\u586B\u5199\uFF0C\u5982\uFF1Ahttp://tieba.baidu.com"};r[i]&&l.html(r[i])},_forumGalleryUpload:function(t){var i=this,a=this.$dialogContent.find(".forum_gallery_add_error_tips");_.Module.use("common/widget/image_uploader_manager",[{container:t,width:t.width(),height:t.height(),isAutoUp:!0,isFlash:!0}],function(l){l.bind("onComplete",function(a,l){var r=l.imageList[0].response,d=t.closest("li").find(".gallery_pic");i._forumGalleryUploadResultHandler(r,d)}),l.bind("onError",function(t,i){a.html(i.errorMessage)})})},_forumGalleryUploadResultHandler:function(t,i){if(!t)return!1;var a=125,l=90,r="http://imgsrc.baidu.com/forum/pic/item/",d=t.error_code,e=t.info.pic_id_encode,o=t.info.fullpic_width,n=t.info.fullpic_height,s="",_=this.$dialogContent.find(".forum_gallery_add_error_tips");if(0==d){if(o!=a||n!=l)return _.html("\u8BF7\u4E0A\u4F20125*90\u5C3A\u5BF8\u7684\u56FE\u7247"),void 0;s=r+e+".jpg",i.html("").tbattr("data-url",s).append($('<img class="image_wrapper"/>').tbattr("src",s)),_.html("")}else _.html("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25")}}});_.Module.define({path:"common/widget/myOftenForum",sub:{_wrapId:null,_jqWrap:null,_imgPostParams:null,oftengo_bubble:null,isLoaded:!1,isLeave:!0,isRequest:!1,initial:function(e,t){this._wrapId=e,this._imgPostParams=t,this.initialUserForumList()},initialUserForumList:function(){var e=this;$("#often_forum").mouseenter(function(){e.isLoaded||(e.isRequest?($("#often_forum").addClass("btn_select"),$("#nav_forum_loading").show()):(e.renderLoading(),e.reqUserForumList().done(function(t){0===t.errno&&(e._imgPostParams.user.user_forum_list=t.data,e.oftenGoForum(),$("#nav_forum_loading").hide(),e.isLoaded=!0,e.isLeave&&$("#often_forum").trigger("click"))})),e.isRequest=!0)}).mouseleave(function(){e.isLeave=!1,e.isLoaded||($("#often_forum").removeClass("btn_select"),$("#nav_forum_loading").hide())})},reqUserForumList:function(e){var t=this._imgPostParams.user.id,e="/p/getLikeForum";return $.ajax({url:e,dataType:"json",type:"GET",data:{uid:t}})},renderLoading:function(){var e=['<div id="nav_forum_loading" class="nav_forum_loading">','<img src="/tb/static-ihome/img/loading2.gif">',"\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...",'<div class="nav_forum_loading_inherit"></div>',"</div>"];$loading=$(e.join("")),this.$loading=$loading,$("body").append($loading),this.loadingPos()},oftenGoForum:function(){var e=this._imgPostParams.user.user_forum_list?this._imgPostParams.user.user_forum_list.info:null,t=$("#often_forum"),o=this;if(t.length>0){var i=null,n=null;o.renderForumMenu(e);var s=o.j_menu;if(!s)return;t.click(function(){return o.fixedPosition(),t.addClass("btn_select"),s.slideDown(100),clearTimeout(i),!1}),PageData.is_ipad||(t.mouseenter(function(){return clearTimeout(n),"none"!=s.css("display")?!1:(i=setTimeout(function(){o.fixedPosition(),t.addClass("btn_select"),s.slideDown(100)},300),void 0)}),t.mouseleave(function(){clearTimeout(i),n=setTimeout(function(){t.removeClass("btn_select"),s.hide()},50)}),s.mouseenter(function(){clearTimeout(n)}),s.mouseleave(function(){n=setTimeout(function(){t.removeClass("btn_select"),s.hide()},50)})),s.find(".j_often_go_fname").mousedown(function(){if($.stats.hive("of_click"),$.stats.sendRequest("fr="+PageData.product+"&st_mod=oftenforum&st_type=forumclick&uid="+PageData.user.id),PageData&&PageData.forum&&PageData.product){if($(this).hasClass("ui_text_desc"))return;var e={st_mod:"nav_oftenforum_bar",st_type:"enterba",st_from:encodeURIComponent(PageData.product),st_uid:PageData.user.id,st_benba:encodeURIComponent(PageData.forum.name),st_goto:encodeURIComponent($(this).text())};$.tb.Stats.sendRequest("http://tb1.bdstatic.com/tb/img/hive.gif",e)}}),s.find(".j_often_go_more").mousedown(function(){$.stats.hive("of_more"),$.stats.sendRequest("fr="+PageData.product+"&st_mod=oftenforum&st_type=forummoreclick&uid="+PageData.user.id)})}},renderForumMenu:function(e){var t=this.genericForumMenu(e);if(t){{var o=$(t);$("#often_forum"),$("#"+this._wrapId)}$("body").append(o),this.j_menu=o}},genericForumMenu:function(e){if(e&&e.length>0){for(var t='<div id="nav_forum_menu" class="nav_forum_menu"><div class="n_menu_wrap clearfix"><ul class="n_menu_content clearfix">',o=PageData.is_ipad?"n_menu_item_ipad":"n_menu_item",i=0,n=e.length;n>i;i++){var s=e[i],a="";if(!(7>i||7==i&&8==n)){a='<li class="'+o+'"><a href="http://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'&fr=tbnav" target="_blank" class="j_often_go_more nav_g_more">\u66F4\u591A&gt;&gt;</a></li>',t+=a;break}a='<li class="'+o+'"><a class="j_often_go_fname" title="'+s.forum_name+'" href="/f?ie=utf-8&kw='+encodeURIComponent(s.forum_name)+'" target="_blank">'+$.tb.subByte(s.forum_name,12,"..")+"</a></li>",t+=a}return t+='</ul></div> <div class="btn_inherit">&nbsp;</div></div>'}return null},fixedPosition:function(){var e=this.j_menu,t=$("#often_forum"),o=$("#"+this._wrapId);t.removeClass("btn_select"),o.addClass("nav_position");var i=(t.position(),t.offset()),n=o.height();o.removeClass("nav_position");var s=e.find("li.n_menu_item"),a=s.length;1==a?(s.width(94),e.width(111),e.find(".btn_inherit").css("left","0px"),e.css({top:i.top+n-14,left:i.left})):(e.find(".btn_inherit").css("left","80px"),e.css({top:i.top+n-14,left:i.left-t.width()+5}))},loadingPos:function(){var e=this.$loading,t=$("#often_forum"),o=$("#"+this._wrapId);t.removeClass("btn_select"),o.addClass("nav_position");var i=(t.position(),t.offset()),n=o.height();o.removeClass("nav_position"),e.css({top:i.top+n-12,left:i.left-t.width()+5}),t.addClass("btn_select")}}});_.Module.define({path:"frs/widget/StarNav",sub:{is_star_official:!1,initial:function(t,a){try{this.is_star_official=a,this.initEventHandler(),this._loadGoodVoiceJS(t),this._showTimeAxisBtn()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/star_nav/star_nav.js",method:"",ln:10}),e}},_loadGoodVoiceJS:function(t){t&&$.JsLoadManager.use(["http://tb1.bdstatic.com/tb/static-frs/js/goodvoice.js"],function(){window._mbox_hsy.init()})},initEventHandler:function(){var t=this;$("#bless_btn").on("click",function(){try{if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame",null,null,null,"send_wish"),!1;var a="/frsstar/cm/apply/bless",e={fid:PageData.forum.forum_id,tbs:PageData.tbs,isAdd:1};return $.tb.post(a,e,function(a){if(a)if(0==a.no){var e=$("#add_effect"),s=$("#bless_num span"),i=parseInt(s.html())+1;s.html(i),e.show().animate({top:"-26px"},600,function(){$(this).hide()})}else 16e4==a.no?t._showBlessDialog("<p>"+PageUnit.load("star_nav_voted")+"</p>"):160002==a.no?t._showBlessDialog("<p>\u65F6\u95F4\u5DF2\u8FC7</p>"):t._showBlessDialog("\u7CFB\u7EDF\u5FD9~\u8BF7\u518D\u8BD5\u4E00\u6B21\uFF01");else t._showBlessDialog("\u7CFB\u7EDF\u5FD9~\u8BF7\u518D\u8BD5\u4E00\u6B21\uFF01")}),!1}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/star_nav/star_nav.js",method:"",ln:52}),s}}),$("#bless_num").bind("mouseover",function(){var a=$(this).data("no"),e=$(this).data("before"),s=$(this).data("after"),i=parseInt(a);popTitle=-1==e?$.tb.format(PageUnit.load("star_nav_tipfirst"),{1:i+1,2:s}):-1==s?$.tb.format(PageUnit.load("star_nav_tiplast"),{1:i-1,2:e}):$.tb.format(PageUnit.load("star_nav_tipmiddle"),{1:i-1,2:e,3:i+1,4:s});var o=popTitle.match(/\d/g).length,n=$.tb.getByteLength(popTitle)-o,r=7*o+6*n;popLeft=$(this).offset().left,popTop=$(this).offset().top,bubble=t._makePoptip(popTitle,r,popLeft,popTop+20),bubble.showBubble()}).bind("mouseout",function(){bubble.closeBubble()}),$("#star_class_nav").on("mousedown","a",function(){if($.stats.track("star_index_nav","nav_test"),t.is_star_official){var a=$(this).text();$.stats.track("tab_"+a,"\u660E\u661F\u5B98\u65B9\u5427_\u5206tab\u70B9\u51FB")}}),$(".star_nav_qa").on("click","a",function(t){try{$.stats.track("KnowTabClick","coopwithiknow")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/star_nav/star_nav.js",method:"",ln:84}),t}})},_showBlessDialog:function(t){new $.dialog({html:'<div style="font-size:14px;margin-top:20px;text-align:center;">'+t+"</div>",draggable:!1,width:300,height:60})},_makePoptip:function(t,a,e,s){var i={content:t,arrow_dir:"up",bubble_css:{top:s,left:e,width:a,"text-align":"left"},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("body"),closeBtn:!1};return bubble=new UiBubbleTipBase(i)},_showTimeAxisBtn:function(){$("#star_collect_time_axis_body").size()>0&&($("#time_axis_slide_arrow").show(),$("#time_axis_slide_button_wrapper").show())}}});_.Module.define({path:"common/widget/Upload",sub:{flashPath:"/tb/static-common/swf/upload.swf",config:{width:70,height:22,id:"upload",uploadUrl:"http://upload.tieba.baidu.com/upload/pic",filter:"\u56FE\u7247(jpg,png,gif)|*.png;*.gif;*.jpg;*.jpeg;*.jpe;",maxLength:1,limiteUploadSize:3,limiteAcceptSize:2e3,limiteCompressSize:80,compressedWidth:1200,compressQuality:90,isSingleton:!1,isDebug:!1,isPreview:!1,blackTypes:"",btnRect:"0,0,70,22",prevRect:"0,30,100,100",size:"120000,120000"},initial:function(e){var i=this,e=$.extend(this.config,e);this.flash=new $.swf(i.flashPath,{width:e.width,height:e.height,container:e.container,id:e.id,callBacks:{onFlashInitComplete:function(e){i.trigger("flashInitComplete",{id:e})},onFlashUploadStart:function(e){i.trigger("uploadStart",{id:e})},onFlashUploadComplete:function(e,t,o){i.trigger("uploadComplete",{id:e,no:t,data:o})},onFlashUploadError:function(e,t,o,r){i.trigger("uploadError",{id:e,no:t,data:o,size:r})},onFlashProgressListener:function(e,t){i.trigger("progressListener",{id:e,status:t})},onFlashUploadButtonClick:function(e){i.trigger("clicked",{id:e})},onFlashError:function(e,t){i.trigger("error",{id:e,msg:t})},onFlashDebug:function(e,t){i.trigger("debug",{id:e,isDebug:t})},onFlashPreviewComplete:function(e){i.trigger("previewComplete",{id:e}),i.flash.object.uploadStart()},onFlashPreviewError:function(e){i.trigger("previewError",{id:e})},onFlashPreviewStart:function(e){i.trigger("previewStare",{id:e})}},vars:{id:e.id,uploadUrl:e.uploadUrl,tbs:e.tbs,maxLength:e.maxLength,filter:e.filter,limiteUploadSize:e.limiteUploadSize,limiteCompressSize:e.limiteCompressSize,limiteAcceptSize:e.limiteAcceptSize,compressedWidth:e.compressedWidth,compressQuality:e.compressQuality,isDebug:e.isDebug,isPreview:e.isPreview,btnRect:e.btnRect,prevRect:e.prevRect,blackTypes:e.blackTypes,size:e.size,isSingleton:e.isSingleton}})},setParameter:function(e,i){e&&(i=void 0==i?"":i,this.flash.object.setParameter(e,i))},removeFile:function(e){void 0!=e&&this.flash.object.removeFile(e)}}});_.Module.define({path:"frs/widget/FormEditor/Upload",requires:["common/widget/Upload"],sub:{initial:function(i){try{this.config=i=$.extend({$cnt:null,name:"",url:"/tb/editor/v2/tedupload.swf",width:90,height:25,imgWidth:53,imgHeight:53,byteSize:100,vars:{upload_url:"http://upload.tieba.baidu.com/upload/pic"},desc:""},i);var t=this;this.$content=i.$content.html('<div class="ui_img_upload"></div><div class="ui_img_cnt" data-imgSize="'+i.imgSize+'" data-w="'+i.imgWidth+'" data-h="'+i.imgHeight+'">'+i.imgSize+"</div>"),this.fid=i.fid,this.imgSize=i.imgSize,this.name=i.name,this.flashCnt=i.$content.find(".ui_img_upload"),this.imgCnt=i.$content.find(".ui_img_cnt"),this.desc=i.desc,this.acceptWidth=i.imgWidth,this.acceptHeight=i.imgHeight,this.upload=t.use("common/widget/Upload",{width:i.width,height:i.height,btnRect:"0,0,"+i.width+","+i.height,tbs:i.tbs,uploadUrl:"http://upload.tieba.baidu.com/upload/pic",filter:"\u56FE\u7247(jpg,png)|*.png;*.jpg;*.jpeg;*.jpe;",container:this.flashCnt,id:i.name,blackTypes:".gif",limiteAcceptSize:i.byteSize,limiteCompressSize:100,isSingleton:!0}),this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/form_editor/upload.js",method:"",ln:48}),e}},inited:!1,bindEvents:function(){var i=this;i.waitToFlashInit=setTimeout(function(){i.error({no:900002})},4e3),i.upload.bind("flashInitComplete",function(){clearTimeout(i.waitToFlashInit),i.inited||(i.inited=!0,i.flashCnt.append("<span>"+i.desc+"</span>"))}),i.upload.bind("uploadComplete",function(t,e){var n=$.parseJSON(e.data);0==n.error_code&&0==n.info.err_no?(n=n.info,n.fullpic_width!=i.acceptWidth||n.fullpic_height!=i.acceptHeight?(i.error({no:900004}),i.imgCnt.html(i.imgSize).css("color","red")):(i.error({no:1}),i.__val__="http://imgsrc.baidu.com/forum/pic/item/"+n.pic_id_encode+".jpg",i.imgCnt.html('<img height="54px" width="'+54*n.fullpic_width/n.fullpic_height+'px" src="'+i.__val__+'" />'))):(alert("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\u3002"),i.error({no:900003}))}),i.upload.bind("uploadError",function(t,e){"fileType"==e.no?i.error({no:900005}):"fileSize"==e.no?e.size>=500?i.error({no:900006}):i.error({no:900007}):i.error({no:900003})}),i.upload.bind("uploadStart",function(){i.imgCnt.html('<img style="margin-top: 10px;width: 22px; height: 22px;" src="/tb/static-frs/img/star_reg/loading.gif" />')})},fix:function(i){i?(this.__val__=i,this.$content.children(".ui_img_cnt").html('<img src="'+i+'" />')):(this.__val__=null,this.$content.children(".ui_img_cnt").html(this.imgSize||""))},val:function(){return this.__val__},error:function(i){this.trigger("error",i.no||900001)}}});
;_.Module.define({path:"frs/widget/FormEditor/Radios",sub:{initial:function(i){try{this.$content=i.$content,i.list&&(i.reserve?this.reList(i.list):this.list(i.list)),i.value?this.fix(i.value):i.index?this.val(index):this.val(0),this.__bindEvt__()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/form_editor/radios.js",method:"",ln:21}),t}},index:0,list:function(i){this.cache=i;for(var t,e=0,s=[];e<i.length;)t=this.index===e?"ui_selected":"",s.push('<a class="ui_radios '+t+'" data-index="'+e+'">'+i[e].desc+"</a>"),++e;return this.$content.html(s.join("")),this},reList:function(i){this.cache=i;for(var t,e=i.length,s=[];e;)--e,t=this.index===e?"ui_selected":"",s.push('<a class="ui_radios '+t+'" data-index="'+e+'">'+i[e].desc+"</a>");return this.$content.html(s.join("")),this},val:function(i){return this.cache?void 0!==i?(this.index=0>i?this.cache.length+i:i,this.$content.find(".ui_radios").eq(this.index).click(),this):this.cache[this.index]:null},fix:function(i){for(var t=0,e=this.cache.length;e>t;){if(this.cache[t].desc.match(new RegExp(i)))return this.val(t);++t}this.val(--e)},__bindEvt__:function(){var i=this;i.$content.delegate(".ui_radios","click",function(t){try{$(this).addClass("ui_radios_selected").siblings().removeClass("ui_radios_selected"),i.index=$(this).index()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/form_editor/radios.js",method:"",ln:74}),t}})}}});
;_.Module.define({path:"frs/widget/FormEditor/Selector",sub:{initial:function(e){try{this.$content=e.$content.html(['<input type="text" class="ui_selector_handle" maxlength="10" autocomplete="off" />','<ul class="ui_selector_group hide"></ul>'].join("")),this.$handle=this.$content.find(".ui_selector_handle"),this.$group=this.$content.find(".ui_selector_group"),e.list&&(e.reserve?this.reList(e.list):this.list(e.list)),e.value?this.fix(e.value):e.index?this.val(e.index):this.val(0),this.__bindEvt__()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/form_editor/selector.js",method:"",ln:27}),t}},index:0,on:function(e,t){return this.$handle.bind(e,t),this},follow:function(e,t,i){e.on(t,i)},list:function(e){this.cache=e;for(var t,i=e.length,s=[];i;)--i,t=this.index===i?"ui_selected":"",s.push('<li class="ui_selector_item '+t+'" data-index="'+i+'">'+e[i].desc+"</li>");return this.$group.html(s.join("")),this},reList:function(e){this.cache=e;for(var t,i=0,s=[];i<e.length;)t=this.index===i?"ui_selected":"",s.push('<li class="ui_selector_item '+t+'" data-index="'+i+'">'+e[i].desc+"</li>"),++i;return this.$group.html(s.join("")),this},val:function(e){return this.cache&&this.cache.length?void 0!==e?(this.index=0>e?this.cache.length+e:e,this.$handle.val(this.val().desc),this):this.cache[this.index]:{desc:"",value:""}},fix:function(e){for(var t=0,i=this.cache.length;i>t;){if(this.cache[t].desc.match(new RegExp(e)))return this.val(t);++t}this.val(--i)},__bindEvt__:function(){var e=this;e.$handle.bind({click:function(t){try{return e.$group.toggleClass("hide"),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/form_editor/selector.js",method:"",ln:88}),t}},keyup:function(){e.$group.removeClass("hide")},blur:function(){return e.$group.addClass("hide"),e.fix($(this).val()),!1}}),e.$group.bind({mousedown:function(e){return e.target.setCapture&&e.target.setCapture(),!1},mouseup:function(e){return e.target.releaseCapture&&e.target.releaseCapture(),!1}}).delegate(".ui_selector_item","click",function(t){try{e.$handle.val($(this).html()).trigger("change"),e.index=$(this).data("index"),e.$group.addClass("hide")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/form_editor/selector.js",method:"",ln:115}),t}}).delegate(".ui_selector_item","hover",function(){$(this).toggleClass("ui_selector_item_hover")})}}});
;_.Module.define({path:"frs/widget/FormEditor/FormEditor",requires:["Selector","Radios","Upload"],sub:{initial:function(e){try{this.dialog=new $.dialog({html:['<ul class="star_super_form clearfix" id="names"></ul>','<ul class="star_super_form clearfix">','<li class="star_super_item star_super_birth"><label>\u751F\u65E5\uFF1A</label>','<div class="ui_selector ui_selector_year" id="year"></div>','<div class="ui_selector ui_selector_month" id="month"></div>','<div class="ui_selector ui_selector_day" id="day"></div>',"</li>",'<li class="star_super_item star_super_sex"><label>\u6027\u522B\uFF1A</label><div id="sex" ></div></li>','<li class="star_super_upload">','<div id="upload_bg"  class="ui_img_box"></div>','<div id="upload_icon" class="ui_img_box"></div>','<div id="upload_music" class="ui_img_box"></div>','<div id="upload_video" class="ui_img_box"></div>','<div id="upload_image" class="ui_img_box"></div>','<div id="upload_mv" class="ui_img_box"></div>',"</li>",'<li class="star_super_error"><span class="error"></span></li>','<li class="star_super_submit clearfix">','<a id="submit" href="#" onclick="return false;" class="ui_submit">\u786E\u8BA4\u63D0\u4EA4</a>','<a id="preview" href="#" onclick="return false;" class="ui_preview">\u9884\u89C8\u6548\u679C</a>',"</li>","</ul>"].join(""),holderClassName:" starReg ",title:e.title,draggable:!0,width:450,minHeight:125,hideOnclose:!0,show:!1}),this.$content=this.dialog.element,this.$names=this.$content.find("#names"),this.action="/frsstar/cm/apply/open",this.prevAction="/frsstar/cm/apply/preview",e.edit&&(this.action="/frsstar/cm/apply/edit"),this.__initBirth__(e),this.__initSex__(e),this.__initUpload__(e),this.postData={fid:e.fid,tbs:e.tbs},this.__bindEvt__()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/form_editor/form_editor_main.js",method:"",ln:61}),i}},errs:{0:"\u64CD\u4F5C\u6210\u529F",1:"",100001:"\u975E\u6CD5\u8BBF\u95EE",100002:"\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55",100003:"\u62B1\u6B49\uFF0C\u4F60\u6CA1\u6709\u6743\u9650",100004:"\u7CFB\u7EDF\u9519\u8BEF",100005:"\u62B1\u6B49\uFF0C\u4F60\u4EEC\u5427\u5728\u5B9A\u5236\u7248\u6682\u672A\u5F00\u542F",14e4:"\u7F16\u8F91\u65F6\u672A\u5F00\u901A\u8FD9\u4E2A\u6A21\u5757",140001:"\u8BF7\u786E\u5B9A\u5DF2\u4E0A\u4F20\u6240\u6709\u56FE\u7247",140002:"\u56FE\u7247url\u592A\u957F",140003:"\u4F60\u5FD8\u8BB0\u586B\u5199\u660E\u661F\u59D3\u540D\u5566",140004:"\u660E\u661F\u540D\u5B57\u592A\u957F",140005:"\u4F60\u5FD8\u8BB0\u586B\u5199\u660E\u661F\u6635\u79F0\u5566",140006:"\u660E\u661F\u5462\u79F0\u592A\u957F",140007:"\u6027\u522B\u63D0\u4EA4\u683C\u5F0F\u6709\u8BEF",140008:"\u751F\u65E5\u65F6\u95F4\u6709\u8BEF",140009:"\u60A8\u5DF2\u7ECF\u5F00\u542F\uFF0C\u4E0D\u53EF\u518D\u6B21\u7533\u8BF7",900001:"\u7CFB\u7EDF\u51FA\u9519\u4E86\uFF0C\u5237\u65B0\u770B\u770B\u5427",900002:"",900003:"\u4E0D\u7ED9\u529B\u554A\uFF0C\u4E0A\u4F20\u5931\u8D25\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u4E0B",900004:"\u8BF7\u4E25\u683C\u6309\u7167\u89C4\u5B9A\u7684\u56FE\u7247\u5927\u5C0F\u5C3A\u5BF8",900005:"\u62B1\u6B49\uFF0C\u4E0D\u652F\u6301gif\u683C\u5F0F",900006:"\u62B1\u6B49\uFF0C\u5934\u90E8\u80CC\u666F\u5927\u56FE\u4E0D\u80FD\u8D85\u8FC7500kb\uFF0C\u7167\u987E\u4E00\u4E0B\u7F51\u901F\u4E0D\u7ED9\u529B\u7684\u5427\u53CB~",900007:"\u62B1\u6B49\uFF0C\u5934\u90E8\u80CC\u666F\u5927\u56FE\u4E0D\u80FD\u8D85\u8FC7100kb\uFF0C\u7167\u987E\u4E00\u4E0B\u7F51\u901F\u4E0D\u7ED9\u529B\u7684\u5427\u53CB~"},error:function(e){e||this.dialog.element.find(".error").empty(),140003==e||140004==e?this.dialog.element.find("#starName").next().tbattr("class","status errorInput"):(140005==e||140006==e)&&this.dialog.element.find("#nickName").next().tbattr("class","status errorInput"),this.dialog.element.find(".error").html(this.errs[e])},__initBirth__:function(e){var i=this,t=i.use("Selector",{$content:i.$content.find("#year"),list:i.list(1893,(new Date).getFullYear(),"\u5E74"),value:e.year||!1}),a=i.use("Selector",{$content:i.$content.find("#month"),list:i.list(1,12,"\u6708"),value:e.month||!1}),s=i.use("Selector",{$content:i.$content.find("#day"),list:i.list(1,new Date(e.year||t.val().value,e.month||a.val().value,0).getDate(),"\u65E5"),value:e.day||!1}),r=function(){i.error();var e=s.val().value,r=new Date(t.val().value,a.val().value,0).getDate();s.reList(i.list(1,r,"\u65E5")),e>=r&&s.val(-1)};s.follow(a,"blur.change",r),s.follow(a,"change",r),s.follow(t,"blur.change",r),s.follow(t,"change",r),this.year=t,this.month=a,this.day=s},__initSex__:function(e){this.sex=this.use("Radios",{$content:this.$content.find("#sex"),list:[{value:"male",desc:"\u7537"},{value:"female",desc:"\u5973"},{value:"group",desc:"\u7EC4\u5408"}],group:"sex",index:e.sexIndex||0})},__initUpload__:function(e){var i=this,t=function(e,t){i.error(t)};$.ajax({url:"http://tieba.baidu.com/dc/common/imgtbs",dataType:"json"}).done(function(a){0===Number(a.no)?(i.bgImg=i.use("frs/widget/FormEditor/Upload",{$content:i.$content.find("#upload_bg"),fid:e.fid,tbs:a.data.tbs,width:200,height:25,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 980X260",byteSize:500,imgWidth:980,imgHeight:260,name:"bgImg",desc:"\u4E0A\u4F20\u5934\u90E8\u80CC\u666F\u5927\u56FE"}),i.bgImg.bind("error",t),i.icon=i.use("Upload",{$content:i.$content.find("#upload_icon"),fid:e.fid,tbs:a.data.tbs,width:120,height:25,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 156X156",imgWidth:156,imgHeight:156,name:"icon",desc:"\u4E0A\u4F20\u660E\u661F\u5934\u50CF"}),i.icon.bind("error",t),i.music=i.use("frs/widget/FormEditor/Upload",{$content:i.$content.find("#upload_music"),fid:e.fid,tbs:a.data.tbs,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 95X70",imgWidth:95,imgHeight:70,name:"music",desc:"\u97F3\u4E50\u4EE3\u8868\u56FE"}),i.music.bind("error",t),i.video=i.use("frs/widget/FormEditor/Upload",{$content:i.$content.find("#upload_video"),fid:e.fid,tbs:a.data.tbs,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 95X70",imgWidth:95,imgHeight:70,name:"video",desc:"\u89C6\u9891\u4EE3\u8868\u56FE"}),i.video.bind("error",t),i.image=i.use("frs/widget/FormEditor/Upload",{$content:i.$content.find("#upload_image"),fid:e.fid,tbs:a.data.tbs,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 95X70",imgWidth:95,imgHeight:70,name:"photo",desc:"\u56FE\u7247\u4EE3\u8868\u56FE"}),i.image.bind("error",t),i.mv=i.use("frs/widget/FormEditor/Upload",{$content:i.$content.find("#upload_mv"),fid:e.fid,tbs:a.data.tbs,imgSize:"\u56FE\u7247\u5C3A\u5BF8: 95X70",imgWidth:95,imgHeight:70,name:"mv",desc:"MV\u4EE3\u8868\u56FE"}),i.mv.bind("error",t)):i.error({no:900001})}).fail(function(){i.error({no:900001})})},list:function(e,i,t){var a=[];for(t=t||"";i>=e;)a.push({desc:e+t,value:e}),++e;return a},tpl:['<li class="star_super_item star_super_name"><label>\u660E\u661F\u59D3\u540D\uFF1A</label>','<input type="text" class="starname" value="#{starName}" #{readyonly} id="starName" name="starName" />','<span class="status"></span>',"</li>",'<li class="star_super_item star_super_nick"><label>\u6635\u79F0\uFF1A</label>','<input type="text" class="starname" value="#{nickName}" id="nickName" name="nickName" />','<span class="status"></span>',"</li>"].join(""),__render__:function(e){e=$.extend({starName:"",nickName:"",year:2012,month:11,day:1,sex:0,bgImg:"",icon:"",edit:!1,music:"",video:"",image:"",mv:""},e),e.edit&&this.$content.find(".star_super_birth").hide(),this.cache=e,this.$names.html($.tb.format(this.tpl,{starName:e.starName,nickName:e.nickName,readyonly:e.edit?'readonly="readonly"':""})),this.year.fix(e.year),this.month.fix(e.month),this.day.fix(e.day),this.sex.val(e.sex),this.bgImg.fix(e.bgImg),this.icon.fix(e.icon),this.music.fix(e.music),this.video.fix(e.video),this.image.fix(e.image),this.mv.fix(e.mv)},show:function(e){this.__render__(e||{}),this.dialog.show()},hide:function(){this.dialog.hide()},__ajax__:function(e,i,t,a){var s=this;$.tb[e](i,t,function(e){return 0==e.no?a(e.data):(140009==e.no?s.trigger("hasReg"):s.error(e.no),void 0)})},__check__:function(){var e=this,i=e.$names.find("#starName").val(),t=e.$names.find("#nickName").val(),a=e.year.val().value,s=e.month.val().value,r=e.day.val().value,n=+new Date(a,s-1,r)/1e3,o=e.sex.index,c=e.bgImg.val(),d=e.icon.val(),l=e.music.val(),m=e.video.val(),h=e.image.val(),u=e.mv.val();return i?t?a&&s&&r&&n?c&&d&&l&&m&&h&&u?(this.cache=$.extend(this.cache,{starName:i,nickName:t,year:a,month:s,day:r,sex:o,bgImg:c,icon:d,music:l,video:m,image:h,mv:u}),!0):(e.error(140001),!1):(e.error(140008),!1):(e.error(140005),!1):(e.error(140003),!1)},__bindEvt__:function(){var e=this;e.dialog.element.delegate("#starName","blur.starName",function(){$(this).val($.tb.subByte($.trim($(this).val()),40,"")),$(this).val()?$(this).next().tbattr("class","status rightInput"):($(this).next().tbattr("class","status errorInput"),e.error(140003)),e.error()}).delegate("#nickName","blur.nickName",function(){$(this).val($.tb.subByte($.trim($(this).val()),40,"")),$(this).val()?$(this).next().tbattr("class","status rightInput"):($(this).next().tbattr("class","status errorInput"),e.error(140005)),e.error()}).delegate(".ui_preview","click.preview",function(i){try{if(!e.__check__())return;e.__ajax__("post",e.prevAction,$.extend(e.postData,{name:e.cache.starName,nick:e.cache.nickName,birthday:+new Date(e.cache.year,e.cache.month-1,e.cache.day)/1e3,gender:e.cache.sex,pic_top:e.cache.bgImg,pic_head:e.cache.icon,pic_music:e.cache.music,pic_video:e.cache.video,pic_album:e.cache.image,pic_mv:e.cache.mv}),function(e){var i=$.tb.location,t=/Chrome\/(\d+)/.exec(window.navigator.userAgent);t=t?t[1]:null;var a="//"+i.getHost()+i.getPathname()+i.getSearch()+"&p=1&id="+e.id;setTimeout(function(){null===t?$('<a href="'+a+'" target="_blank"></a>').appendTo("body")[0].click():t>20?i.setHref(a):window.open(a,"preview")},10)})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/form_editor/form_editor_main.js",method:"",ln:419}),i}}).delegate(".ui_submit","click.submit",function(i){try{if(!e.__check__())return;e.__ajax__("post",e.action,$.extend(e.postData,{name:e.cache.starName,nick:e.cache.nickName,birthday:+new Date(e.cache.year,e.cache.month-1,e.cache.day)/1e3,gender:e.cache.sex,pic_top:e.cache.bgImg,pic_head:e.cache.icon,pic_music:e.cache.music,pic_video:e.cache.video,pic_album:e.cache.image,pic_mv:e.cache.mv}),function(){e.trigger("successd")})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/form_editor/form_editor_main.js",method:"",ln:435}),i}})}}});_.Module.define({path:"frs/widget/StarHead",requires:["common/widget/Card"],sub:{initial:function(t,a){try{this.data=a,this.paramsObj=t,this.tabKey=t.tabKey,this.fid=t.fid,this.fname=t.fname,this.tbs=t.tbs,this.isOfficial=t.isOfficial,this.background_pic=t.background_pic,this.background_color=t.background_color,this.deadline_pic=t.deadline_pic,this.deadline_color=t.deadline_color,this.summary=t.summary,this.preview=t.preview,this._initData(),this._toStarOfficial(),this._initIconTip(),this._getHeadPicClickStatus()}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/star_head/star_head.js",method:"",ln:38}),s}},_initData:function(){var t=this;t.preview?$.tb.get("/frsstar/api/preview",{fid:t.fid,id:t.preview},function(a){a&&0==a.no?(t.data=a.data,t._render()):$("#container .star_banner,#container .star_collect").hide()}):t.data?t._render():$("#container .star_banner,#container .star_collect").hide()},_render:function(){var t="",a="0",s="#container";this.paramsObj.showFansNo,this._initRemindBubble(),this.preview&&this._showBanner(),this.isOfficial&&("pb"==PageData.product?(a="98px",s=".wrap2"):(a="0",s="#container"),$(".platform_countdown_head_wrap").length>0?(t=this.deadline_color+" url("+this.deadline_pic+") no-repeat 50% "+a,$(".star_head_official").css({border:"none","padding-top":0}),$(".content").css({border:"none",background:"none"}),$(s).css("background",t)):(t=this.background_color+" url("+this.background_pic+") no-repeat 50% "+a,$(".star_head_official").css("border","none"),$(".content").css({border:"none",background:"none"}),$(s).css("background",t))),this._bindEvents()},_showBanner:function(){var t=$("#container .star_banner img"),a=$("#container .j_star_picbox"),s=new Image,e=new Image;$(s).bind("load",function(){t.tbattr("src",s.src).css({margin:"0",width:980,height:260})});var i="main"==this.tabKey?156:32;this.isOfficial&&(i=45),$(e).bind("load",function(){a.find("img").tbattr("src",e.src).css({margin:"0",width:i,height:i})}),s.src=this.data.top,e.src=this.data.head},_initFansno:function(){var t=this,a=this.data.fans,s=$("#star_nums .j_fans_wrapper");if(a.open)a.is_get?t._showFansNum(a):t._getFansNum();else{var e=a.open_time-this.data.cur_time;if(e>0&&36e4>e){t._initCountdown(),t._showCountdown(e);var i=setInterval(function(){e--,e>0?t._showCountdown(e):(clearInterval(i),t._getFansNum())},1e3)}else{var n=new Date(1e3*a.open_time),r={content:"\u5468"+["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][n.getDay()]+"\uFF08"+$.dateFormat(n,"MM\u6708dd\u65E5")+"\uFF09 "+$.dateFormat(n,"HH:mm")+"\u51C6\u70B9\u5F00\u62A2\uFF0C\u4E00\u5B9A\u8BB0\u5F97\u6765\u62A2\u4E2A\u597D\u53F7\u54E6~",arrow_dir:"up",bubble_css:{top:30,right:-51,width:223,"text-align":"left"},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#star_nums"),closeBtn:!1},o=new UiBubbleTipBase(r),c=s.find(".j_fans_content");c.css({display:"block"}),c.bind("mouseover",function(){o.showBubble(),$.stats.sendRequest("fr=tb0_forum&st_type=star_fans")}).bind("mouseout",function(){o.hideBubble()})}}},_getFansNum:function(){var t=this,a=$("#star_nums .j_fans_content"),s=$("#star_nums .j_fans_countdown");s.hide(),a.removeClass("fans_countdown_title").addClass("fans_content fans_num_get").html("\u70B9\u51FB\u9886\u53D6\u5168\u7403\u552F\u4E00\u7C89\u4E1D\u7F16\u53F7").css({display:"block"}).on("click",function(){try{return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","buildUnameFrame"),!1):(t._getDataOfFansNum(),!1):(TbCom.process("User","buildLoginFrame",null,null,null,"star_fans"),!1)}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/star_head/star_head.js",method:"",ln:227}),a}})},_getDataOfFansNum:function(){var t=this,a=PageData.user.balv||{};a.is_block||PageData.user.forbidden&&PageData.user.forbidden.isForbid?t._showErrorTip(8):a.is_black||PageData.user.is_black?t._showErrorTip(220):a.has_liked||PageData.user.is_like?t._postFansData():t._postLikeData()},_showFansNum:function(t){var a=$("#star_nums"),s=new Array,e=$.dateFormat(new Date(1e3*t.get_time),"yyyy\u5E74MM\u6708dd\u65E5HH\u65F6mm\u5206"),i=a.find(".j_fans_content");i.removeClass("fans_num_get").css({display:"block"}).html("\u6211\u7684\u7C89\u4E1D\u7F16\u53F7\uFF1A"+this._getNo(t.num)),"main"==this.tabKey?s.push('<div class="fansnum_smalltip">'):s.push('<div class="fansnum_smalltip fansnum_smalltip_up">'),s.push('<p class="smalltip_title">'+$.tb.subByte(this.fname,12,"..")+"\u5168\u7403\u552F\u4E00\u7C89\u4E1D\u7F16\u53F7</p>"),s.push('<div class="smalltip_content">'),s.push('<a class="smalltip_head" target="_blank" href="/home/main?id='+PageData.user.portrait+'&fr=frs"><img src="http://tb.himg.baidu.com/sys/portrait/item/'+this.data.fans.portrait+'" width="40" height="40" onload="resizePic_temp(this, 40, 40,false);"/></a>'),s.push('<div class="smalltip_name">'+$.tb.subByte(PageData.user.user_name,16,"..")+"</div>"),s.push('<div class="smalltip_num">');for(var n=this._getNo(t.num),r=0;r<n.length;r++)s.push("<span>"+n.charAt(r)+"</span>");s.push("</div>"),s.push('<p class="smalltip_time">\u4E8E'+e+"\u83B7\u5F97</p>"),s.push("</div>"),s.push("</div>");var o=$(s.join(""));a.append(o),i.unbind().bind("mouseover",function(){o.show()}).bind("mouseout",function(){o.hide()})},_getNo:function(t){var a="0000000";return t+="",a.substr(0,a.length-t.length)+t},_initCountdown:function(){var t=$("#star_nums .j_fans_wrapper"),a=t.find(".j_fans_content"),s=t.find(".j_fans_countdown");a.removeClass("fans_content").addClass("fans_countdown_title").html("\u7C89\u4E1D\u7F16\u53F7\u5F00\u62A2\u5012\u8BA1\u65F6\uFF1A");var e={0:"\u4ED6",1:"\u5979",2:"TA"},i=e[this.data.gender]||"TA",n="\u6BCF\u4E00\u4E2A"+this.fname+"\u7684\u7C89\u4E1D\u7F16\u53F7\uFF0C\u90FD\u4EE3\u8868\u7740\u5BF9"+i+"\u72EC\u4E00\u4EFD\u7684\u7231";s.tbattr("title",n).show()},_showCountdown:function(t){var a=Math.floor(t/3600),s=Math.floor(t%3600/60),e=t%60,i=$("#star_nums .j_fans_wrapper"),n=i.find(".j_countdown_h"),r=i.find(".j_countdown_m"),o=i.find(".j_countdown_s");a=10>a?"0"+a:a,s=10>s?"0"+s:s,e=10>e?"0"+e:e,n.html(a),r.html(s),o.html(e)},_postLikeData:function(){var t=this,a={fid:PageData.forum.forum_id,fname:PageData.forum.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs};$.tb.post("/f/like/commit/add",a,function(a){if(a)switch(a.no){case 0:t._postFansData();break;case 8:case 9:case 220:t._showErrorTip(a.no);break;default:t._showErrorTip()}else t._showErrorTip()})},_postFansData:function(){var t=this,a="/frsstar/cm/fans/get",s={fid:t.fid,tbs:t.tbs};$.tb.post(a,s,function(a){a?0==a.no?t.isInvite?(t.starInvite._showInviteSuccessTip(a.data),t.starInvite._addInviteUser()):t._showSuccessTip(a.data):t._showErrorTip(a.no):t._showErrorTip()})},_initRemindBubble:function(){var t,a,s,e,i=this;e="main"==i.tabKey?$("#star_class_nav .star_class_tip"):$("#star_class .star_class_tip");for(var n=0;n<e.length;n++){s=$(e[n]),a=parseInt(s.html()),t=s.parents("li").getData();var r=$.cookie("STAR_TAB_TIP")||"",o=t.tab+",";a>0&&r.indexOf(o)<0?s.show():s.remove(),a>0&&"video"==i.tabKey&&i.tabKey==t.tab&&i._showVideoBubble(r,a)}},_showVideoBubble:function(t,a){if(t.indexOf("video_tip")<0){var s=$("#content_tip_wrapper"),e=s.find(".content_tip_txt");e.html(a),s.show(),t+="video_tip,",$.cookie("STAR_TAB_TIP",t,{expires:1/3})}},_bindEvents:function(){var t=this;$("#star_class").on("mouseenter",".j_star_tab",function(){$(this).removeClass("star_class_normal").addClass("star_class_hover")}).on("mouseleave",".j_star_tab",function(){$(this).removeClass("star_class_hover").addClass("star_class_normal")}).on("click",".j_star_tab",function(){try{if($(this).hasClass("star_class_active"))return;return $("#star_class").find(".star_class_active").removeClass("star_class_active").addClass("star_class_normal"),$(this).removeClass("star_class_hover").addClass("star_class_active"),t._doClickEvent($(this)),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/star_head/star_head.js",method:"",ln:445}),a}})},_doClickEvent:function(t){var a=t.find(".star_class_tip"),s=t.getData();if("main"!=this.tabKey&&setTimeout(function(){$.tb.location.setHref(s.url)},200),a[0]){a.remove();var e=$.cookie("STAR_TAB_TIP")||"";e=e+s.tab+",",$.cookie("STAR_TAB_TIP",e,{expires:1/3})}},_showSuccessTip:function(t){var a=this,s=new Array;s.push('<div class="success_tip_wrapper"></div>'),s.push('<p class="success_tip_name">\u606D\u559C\u4F60\u83B7\u5F97'+$.tb.subByte(this.fname,14,"..")+"\u5168\u7403\u552F\u4E00</p>"),s.push('<p class="success_tip_num">');for(var e=this._getNo(t.num),i=0;i<e.length;i++)s.push('<span class="fansnum_'+e.charAt(i)+'"></span>');s.push("</p>"),s.push('<p class="success_tip_welcome">\u540C\u65F6\u6B22\u8FCE\u4F60\u6210\u4E3A'+$.tb.subByte(this.fname,14,"..")+"\u5427\u7684\u4F1A\u5458</p>"),s.push('<a href="#" class="success_tip_close"></a>');var n=new $.dialog({html:s.join(""),showTitle:!1,draggable:!1,width:350,height:265,holderClassName:"fansnum_bigtip"}),r=setTimeout(function(){a._showFansNum(t),n.close(),$.tb.location.reload()},8e3);$("a.success_tip_close").bind("click",function(){try{return clearTimeout(r),a._showFansNum(t),n.close(),$.tb.location.reload(),!1}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/star_head/star_head.js",method:"",ln:503}),s}})},_showErrorTip:function(t){var a="";switch(t){case 8:case 9:a="\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C";break;case 220:a="\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C";break;case 120002:a="\u5DF2\u9886\u53D6\u6210\u529F\uFF0C\u5237\u65B0\u9875\u9762\u770B\u770B\u5457";break;default:a="\u989D\uFF0C\u62B1\u6B49\u670D\u52A1\u5668\u597D\u50CF\u62BD\u98CE\u4E86\uFF0C\u8BF7\u4F60\u518D\u70B9\u4E00\u4E0B\u4E0B"}var s=new Array;s.push('<div class="error_tip_text">'+a+"</div>"),s.push('<a class="error_tip_btn" href="#">\u5237\u65B0\u672C\u9875</a>');new $.dialog({html:s.join(""),showTitle:!1,draggable:!1,width:244,height:113});$("a.error_tip_btn").bind("click",function(){try{return $.tb.location.reload(),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/star_head/star_head.js",method:"",ln:537}),t}})},_toStarOfficial:function(){$(".j_join_fans_memeber").bind("click",function(){try{$.stats.track("\u5934\u56FE\u52A0\u5165\u7C89\u4E1D\u56E2","\u660E\u661F\u5B98\u7F51","frs","\u70B9\u51FB")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/star_head/star_head.js",method:"",ln:545}),t}})},_initIconTip:function(){var t=this,a=(PageData.forum.name,t.summary);$(".j_star_info_icon").hover(function(){t._tip_card=t.use("common/widget/Card",{content:a,card_css:{width:150},arrow_pos:{left:61},auto_positon:!0,event_target:$(this),attr:" id='star_official_icon_tip' "}),t._tip_card.showCard()},function(){t._tip_card.closeCard()})},_getHeadPicClickStatus:function(){var t=$(".star_banner"),a={obj_type:"\u5E73\u53F0\u5316"};t.on("click",".j_click_status",function(){try{$.stats.track("\u5427\u5934\u56FE","\u5427\u5934\u56FE\u7EDF\u8BA1",void 0,"click",a)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/star_head/star_head.js",method:"",ln:580}),t}})}}});_.Module.define({path:"pb/component/Pager",sub:{initial:function(e,t){try{this.jumpPage=$("#"+t),this.jump(e),this.bindPageNum(e),this.pagerWrap=$("#"+e),this.pageCheckLogin()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:component/pager/pager.js",method:"",ln:15}),a}},jump:function(e){var t=this.jumpPage.tbattr("theme"),a=$("#pager_go"+t),n=this;this.jumpPage.bind("keydown",function(t){n._go(t,e)}),a.click(function(){try{n._go("click",e)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:component/pager/pager.js",method:"",ln:30}),t}})},_go:function(e,t){var a=this.jumpPage;totalPage=a.tbattr("max-page"),inPageNum=a.val(),("click"===e||13===e.keyCode)&&(/^(-?)(\d+)$/.test(inPageNum)?(inPageNum=Math.max(1,Math.min(inPageNum,totalPage)),this.sendRequest("pb_jump_page",t),this.jumpToPage(inPageNum)):a.val(""))},jumpToPage:function(e){var t=$.tb.location.getHref(),a=t.indexOf("#");a>=0&&(t=t.substr(0,a)),-1==t.indexOf("pn")?t+=-1==t.indexOf("?")?"?pn="+e:t.indexOf("?")==t.toString().length-1?"pn="+e:"&pn="+e:t=t.replace(/(.*pn=)(\d+)?/,function(t,a){return a+""+e}),t.length>0&&(PageData.user.is_login?$.tb.location.setHref(t):window.open("/f/user/passport?jumpUrl="+t+"&statsInfo=pb_pager#login_anchor"))},bindPageNum:function(e){var t=this;$("#"+e).delegate("a","mousedown",function(){return $(this).hasClass("pager_disabled")?!1:(t.sendRequest("pb_fanye_page",e),void 0)})},sendRequest:function(e,t){$.tb.Stats.sendRequest("http://tb1.bdstatic.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"pb",st_type:e,st_value:t})},pageCheckLogin:function(){var e=this;e.pagerWrap.find(".l_pager a").on("click",function(){try{if(PageData.user.is_login)return;var e="http://tieba.baidu.com"+$.tb.unescapeHTML($(this).tbattr("href"));return window.open("/f/user/passport?jumpUrl="+e+"&statsInfo=pb_pager#login_anchor"),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:component/pager/pager.js",method:"",ln:106}),t}})}}});var bds_config={snsKey:{tsina:"2285628874",tqq:"801209366"}};document.getElementById("bdshell_js").src="http://share.baidu.com/static/js/shell_v2.js?t="+(new Date).getHours();_.Module.define({path:"common/widget/verifyManagerPhone",requires:[],sub:{_hasNextTimeButton:null,_template:{_confirmDialog:["<h2>","#{title}","</h2>","<p>","#{text}","</p>"].join(""),_changeBind:["<div>* \u5982\u60A8\u9700\u8981\u6362\u7ED1\u60A8\u7684\u624B\u673A\u540E\u518D\u8FDB\u884C\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C\u8BF7<a target='_blank' href='#{href}'>\u70B9\u6B64\u6362\u7ED1</a>\u3002</div>"].join(""),_complain:["<div>* \u5982\u679C\u60A8\u7533\u8BC9\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u95EE\u9898\u5BFC\u81F4\u65E0\u6CD5\u9A8C\u8BC1\uFF0C\u8BF7<a target='_blank' href='#{href}'>\u70B9\u6B64\u4E13\u8D34</a>\u53CD\u9988\u3002</div>"].join("")},_url:{nextTime:"/bawu2/checkphone/commitActsctrl",getPopPassData:"/bawu2/checkphone/getPhoneToken",verifyDone:"/bawu2/checkphone/commitCheckTime"},initial:function(t){var e=this;e._hasNextTimeButton=!t,e._title=null,e._text=null,t?(e._title="\u5C0A\u656C\u7684\u8D34\u5427\u5427\u4E3B\u7528\u6237",e._text="\u4E3A\u4E86\u60A8\u7684\u8D26\u53F7\u5B89\u5168\uFF0C\u8BF7\u60A8\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C<br/>\u4EE5\u9632\u8D26\u53F7\u88AB\u76D7\u9020\u6210\u635F\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uFF08\u8BBE\u7F6E\u6210\u529F\u540E\u4E0D\u518D\u63D0\u793A\uFF09</span>"):(e._title="\u5C0A\u656C\u7684\u8D34\u5427\u5427\u4E3B\u7528\u6237\uFF1A",e._text="\u4E3A\u4E86\u60A8\u7684\u8D26\u53F7\u5B89\u5168\uFF0C\u5F3A\u70C8\u5EFA\u8BAE\u60A8\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C<br/>\u4EE5\u9632\u8D26\u53F7\u88AB\u76D7\u9020\u6210\u635F\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uFF08\u8BBE\u7F6E\u6210\u529F\u540E\u4E0D\u518D\u63D0\u793A\uFF09</span>"),e._popConfirmDialog()},_startVerify:function(){var t=this;t._getPopPassData(function(e){t._popPassDialog(e.hasBind?"verify":"bind",e.token)},function(){t._onVerifyFail()})},_onVerifyFail:function(t){var e=this;t||(t="\u9A8C\u8BC1\u5931\u8D25~ T_T \u8BF7\u91CD\u8BD5~~");var n={message:"<h2>\u9A8C\u8BC1\u624B\u673A\u5931\u8D25\uFF1A</h2><p>"+t+"</p>",holderClassName:"verify_manager_phone_dialog",buttons:[{text:"\u91CD\u8BD5",callback:function(){e._startVerify()}},{text:"\u53D6\u6D88"}]};n.buttons[0]["class"]="ui_btn_m btn_left",n.buttons[1]["class"]="ui_btn_sub_m",$.tb.alert(n)},_popConfirmDialog:function(){function t(){n._startVerify()}function e(){n._informServerNextTime()}var n=this,a={text:"\u4E0B\u6B21\u518D\u8BF4",callback:e};a["class"]="ui_btn_sub_m";var i={text:"\u7ACB\u5373\u8BBE\u7F6E",callback:t};i["class"]="ui_btn_m btn_left";var o=[i];n._hasNextTimeButton&&o.push(a),$.tb.alert({message:$.tb.format(n._template._confirmDialog,{title:n._title,text:n._text}),holderClassName:"verify_manager_phone_dialog",buttons:o})},_getPopPassData:function(t,e){var n=this;$.ajax({url:n._url.getPopPassData,dataType:"json",success:function(n){n&&0===n.errno?t(n.data):e()},error:e})},_popPassDialog:function(t,e){function n(t){o._informServerVerifyDone(t)}function a(){o._informServerVerifyDone()}function i(){o._onVerifyFail()}var o=this;"verify"===t?o._showMobileVerify(e,a,i):o._showMobileBind(e,n,i)},_showMobileVerify:function(t,e,n){var a=this;$.JsLoadManager.use(["http://passport.baidu.com/passApi/js/uni_forceverify_wrapper.js?cdnversion="+a._getTimeStamp(),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.initForceverify({token:t,curType:"mobile",onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(t);var i=$($.tb.format(a._template._changeBind,{href:"http://passport.baidu.com/v2/accountsecurity?act=rebindmobile"}));n.prepend(i);var o=$($.tb.format(a._template._complain,{href:"http://tieba.baidu.com/p/3472422906"}));n.prepend(o);var r=n.html(),s=r.lastIndexOf("<br>");n.html(r.substring(0,s))},onSubmitSuccess:e,onGetapiError:n,onSubmitFailure:n});i.show()},!0,"utf-8")},_showMobileBind:function(t,e,n){var a=this;$.JsLoadManager.use(["http://passport.baidu.com/passApi/js/uni_armorwidget_wrapper.js?cdnversion="+a._getTimeStamp(),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.ArmorWidget("bindmobile",{token:t,onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(this);var i=$($.tb.format(a._template._complain,{href:"http://tieba.baidu.com/p/3472422906"}));n.prepend(i);var o=n.html(),r=o.lastIndexOf("<br>");n.html(o.substring(0,r))},successCountdown:0,onSubmitSuccess:function(t){e(t.bindid)},onInitFail:n});i.show()},!0,"utf-8")},_informServerNextTime:function(){var t=this;$.ajax(t._url.nextTime)},_informServerVerifyDone:function(t){var e=this,n=function(){$.tb.alert({message:"<h2>\u8BBE\u7F6E\u6210\u529F\uFF01</h2>",holderClassName:"verify_manager_phone_dialog",onclose:function(){location.reload()},buttons:[{text:"\u786E\u8BA4"}]})},a=function(){e._onVerifyFail()},i=e._url.verifyDone;t&&(i+="?bindid="+t),$.ajax({url:i,dataType:"json",success:function(t){t&&0===t.errno?n():a()},error:a})},_getTimeStamp:function(){var t=(new Date).getTime();return Math.floor(t/6e4)},_updatePassDialogZIndex:function(t){var e=$(t.getById("mask")),n=$(t.getById("wrapper"));e.css("zIndex",5e4+parseInt(e.css("zIndex"))),n.css("zIndex",5e4+parseInt(n.css("zIndex")))}}});!function(){var e=!1;_.Module.define({path:"common/widget/detectManagerBlock",requires:["common/widget/verifyManagerPhone"],sub:{initial:function(){},setBlockState:function(n){e=n},getBlockState:function(){return e},doOnNotBlocked:function(n,o){void 0===o&&(o=!0),e?o&&this.requireInstance("common/widget/verifyManagerPhone",[!0]):n()},doOnBlocked:function(n){e&&n()}}})}();_.Module.define({path:"common/widget/blockUser",requires:["common/widget/detectManagerBlock"],sub:{template:'<div class="block_user_wrapper"> <ul class="b_u_items">   <li class="b_u_items_outer">  <label>\u7528\u6237\u540D</label><div class="b_username" ></div> </li>  <li class="b_u_items_outer">    <label>\u5C01\u7981\u65F6\u957F:</label>  <div class="b_block_time"> <span class="b_fixed_time">1\u5929</span>   <select class="b_select_time"> <option data-info="1">1\u5929</option> <option data-info="3">3\u5929</option><option data-info="10">10\u5929</option>  </select>  </div>   </li>  <li class="b_u_items_outer"> <label>\u5C01\u7981\u539F\u56E0:</label> <div class="b_reason_box"><ul class="b_reason_ul">   <li class="b_reason_item" data-prefix="1."></li><li class="b_reason_item" data-prefix="2."></li> <li class="b_reason_item" data-prefix="3."></li>  <li class="b_reason_item" data-prefix="4."></li>  <li class="b_reason_item" data-prefix="5."></li> <li class="b_reason_item" data-prefix="6."></li>  </ul><div class="b_reason_content">    <div class="b_reason_top">   <div class="b_top_mod_bar" > <div class="b_mod_bar"><span></span>\u4FEE\u6539</div>  <div class="b_del_bar"><span></span>\u5220\u9664</div>   </div><div class="b_top_save_bar">  <div class="b_save_bar"><span></span>\u4FDD\u5B58</div> <div class="b_cancel_bar"><span></span>\u53D6\u6D88</div></div>     </div>   <div class="b_reason_textarea">  <label for="b_user_textarea" class="b_label_tips">\u62B1\u6B49\uFF0C\u4F60\u7684\u53D1\u8D34\u64CD\u4F5C\u6216\u53D1\u8868\u8D34\u5B50\u7684\u5185\u5BB9\u8FDD\u53CD\u4E86\u672C\u5427\u7684\u5427\u89C4\uFF0C\u5DF2\u7ECF\u88AB\u5C01\u7981\uFF0C\u5C01\u7981\u671F\u95F4\u4E0D\u80FD\u5728\u672C\u5427\u7EE7\u7EED\u53D1\u8A00\u3002</label><textarea id="b_user_textarea" class="b_textarea"></textarea>      </div>    </div>   </div>   </li>   </ul>   <div class="block_btns">  <div class="block_tips"></div> <div class="b_id_btn">\u5C01\u7981ID</div> <div class="b_fixed_tips"></div>  </div> </div>',errTemplate:'<div class="block_response_info"></div> ',initial:function(e,t,a,o,n){var i=this,s=i.requireInstance("common/widget/detectManagerBlock",[]);s.doOnNotBlocked(function(){i._block(e,t,a,o,n)})},_block:function(e,t,a,o,n){this.config={block_reason_list:"/pmc/tpl",add_block_reason:"/pmc/tpl",modify_block_reason:"/pmc/tpl",del_block_reason:"/pmc/tpl",save_block_id:"/pmc/blockid"},this.blockList=$.extend(!0,[],e),this.power=t,this.forum=a,this.tbs=o,this.sucCallback=n,this.user_num=this.blockList.length,this.add_new_temp="<span>+</span>\u65B0\u5EFA\u6A21\u677F",this.textarea_maxlength=200,this.curr_pattern="",this.$blockPopWinHtml=$(this.template),this.$responseBlockInfo=$(this.errTemplate),this.paramValidate(),this.setBlockDefaultInfo(),this.textareaKeyupEvtBind(),this.blockIDbtnEvtBind(),this.tabSwitchEvtBind(),this.textareaFocusEvtBind(),this.textareaBlurEvtBind(),this.logicalControl(),this.blockDialog.show(),this.trigger("show")},duplicateRemoval:function(e){for(var t={},a=[],o=e.length,n=0;o>n;n++)t[e[n]]||(a.push(e[n]),t[e[n]]=!0);return a},paramValidate:function(){var e=this;null===e.power.ban_id||null===e.power.ban_ip||""===e.power.ban_id||""===e.power.ban_ip?(this.blockDialog=new $.dialog({title:"\u5C01\u7981\u63D0\u793A",width:"556",html:this.$responseBlockInfo}),e.$responseBlockInfo.find(".block_response_info").html("\u4F60\u6CA1\u6709\u5C01\u7981\u64CD\u4F5C\u6743\u9650\uFF01")):e.blockDialog=new $.dialog({title:"\u5C01\u7981\u64CD\u4F5C",width:"556",html:this.$blockPopWinHtml}),e.blockDialog.bind("onclose",function(){e.user_num>1&&$.tb.location.reload()}),e.blockDialog.bind("onhide",function(){e.user_num>1&&$.tb.location.reload()})},insertDefaultNewTemp:function(){var e=this,t=0,a=0,o=!1;if($(".b_reason_ul .b_reason_item").each(function(e,o){$(o).hasClass("b_add_new_reason")||($(o).data("reasonId")&&""!=$(o).data("reasonId")&&$(o).data("isBuiltinTpl")===!1&&t++,a++)}),6>t){$(".b_reason_ul .b_reason_item").each(function(t,n){o&&$(".b_reason_ul .b_reason_item").eq(t).remove(),""!==$(n).html().trim()||o||($(n).tbattr("data-is-builtin-tpl",!1).tbattr("data-prefix",a),$(n).addClass("b_add_new_reason").append(e.add_new_temp),o=!0)});var n=$(".b_reason_ul .b_add_new_reason").length;0==n&&$(".b_reason_ul").append('<li class="b_reason_item b_add_new_reason" data-is-builtin-tpl="false" data-prefix="'+(a+1)+'.">'+e.add_new_temp+"</li>")}},setTextareaVal:function(){var e=this;0!=e.$blockPopWinHtml.find(".b_reason_curr").length||e.$blockPopWinHtml.find(".b_reason_item").eq(0).hasClass("b_add_new_reason")||e.$blockPopWinHtml.find(".b_reason_item").eq(0).addClass("b_reason_curr");var t=e.$blockPopWinHtml.find(".b_reason_curr");if(t.hasClass("b_add_new_reason"))e.$blockPopWinHtml.find(".b_textarea").val("");else if(t.html()){var a=t.html(),o=2;t.data("prefix")>=10&&(o=3),e.$blockPopWinHtml.find(".b_textarea").val(a.substr(o,a.length))}},noReasonCantModify:function(){var e=0,t=this;t.$blockPopWinHtml.find(".b_reason_item").each(function(t,a){"undefined"!=typeof $(a).tbattr("data-reason-id")&&e++}),0==e&&(t.$blockPopWinHtml.find(".b_add_new_reason").removeClass("b_reason_curr"),t.$blockPopWinHtml.find(".b_reason_top").hide(),""==t.$blockPopWinHtml.find(".b_textarea").val()&&t.$blockPopWinHtml.find(".b_label_tips").show())},setBlockReasonList:function(){var e=this,t=!1;$.ajax({url:e.config.block_reason_list,type:"POST",dataType:"json",data:{fid:e.forum.forum_id,tbs:e.tbs},success:function(a){if("0"==a.errno){var o=a.data;if(0==o.length)e.$blockPopWinHtml.find(".b_label_tips").show(),e.$blockPopWinHtml.find(".b_textarea").val(""),e.noReasonCantModify(),e.$blockPopWinHtml.find(".b_reason_item").each(function(e,t){$(t).removeAttr("data-reason-id").html("")}),e.$blockPopWinHtml.find(".b_reason_item").removeClass("b_reason_curr");else{var n=e.$blockPopWinHtml.find(".b_reason_item").length,i=o.length,s=i-n;if(s>0){for(var l=n,r="";s>0;)r+='<li class="b_reason_item" data-prefix="'+(l+1)+'." ></li>',l++,s--;$(".b_reason_ul").append(r)}e.$blockPopWinHtml.find(".b_reason_item").each(function(a,n){0==a&&(e.curr_pattern="undefined"!=typeof o[a]?"modify":"add"),"undefined"!=typeof o[a]?$(n).html(a+1+"."+o[a].template_text).tbattr("data-reason-id",o[a].template_id).tbattr("data-is-builtin-tpl",o[a].is_builtin_tpl).tbattr("data-prefix",a+1):$(n).html(""),$(n).hasClass("b_add_new_reason")&&!t&&($(n).removeClass("b_add_new_reason"),t=!0)}),e.$blockPopWinHtml.find(".b_reason_item").each(function(t,a){""==$(a).html()&&e.$blockPopWinHtml.find(".b_reason_item").eq(t).remove(),$(a).hasClass("b_reason_curr")&&($(a).data("isBuiltinTpl")?$(".b_top_mod_bar .b_del_bar").hide():$(".b_top_mod_bar .b_del_bar").show())})}(e.power.ban_id&&e.power.ban_ip||e.power.can_filter_id&&e.power.can_filter_ip)&&e.insertDefaultNewTemp(),e.setTextareaVal()}else e.setResponseTips(2,"\u83B7\u53D6\u5C01\u7981\u539F\u56E0\u5217\u8868\u5931\u8D25!")},error:function(t){e.setNewDialogRespTips(2,t)}})},setBlockDefaultInfo:function(){for(var e=this,t=[],a=0;a<e.blockList.length;++a)-1===$.inArray(e.blockList[a].username,t)&&t.push(e.blockList[a].username);t=t.join(),e.$blockPopWinHtml.find(".b_username").html($.tb.subByte(t,30,"\u2026")),e.setBlockReasonList()},textareaKeyupEvtBind:function(){var e=this;e.$blockPopWinHtml.find(".b_textarea").on("keyup",function(){var t=$(this).val(),a=$.tb.getByteLength(t),o=e.$blockPopWinHtml.find(".block_tips");o.css({display:"block"}),e.textarea_maxlength-a>0?($(this).hasClass("input_right_pattern")||$(this).addClass("input_right_pattern"),$(this).removeClass("input_error_pattern"),o.html("\u8FD8\u53EF\u8F93\u5165"+parseInt((e.textarea_maxlength-a)/2)+"\u5B57").addClass("b_green")):($(this).hasClass("input_error_pattern")||$(this).addClass("input_error_pattern"),$(this).removeClass("input_right_pattern"),o.removeClass("b_green").addClass("b_red").html("\u5DF2\u8D85\u51FA"+parseInt(parseInt((a-e.textarea_maxlength)/2)+1)+"\u5B57"))})},textareaFocusEvtBind:function(){var e=this;e.$blockPopWinHtml.on("focus.showEditor",".b_textarea",function(){e.curr_pattern="add",e.toogleToolBar(),e.$blockPopWinHtml.find(".block_tips").html("").removeClass("b_red,b_green"),e.$blockPopWinHtml.find(".b_label_tips").css({display:"none"}),e.power.ban_id&&e.power.ban_ip||e.power.can_filter_id&&e.power.can_filter_ip?e.$blockPopWinHtml.find(".b_reason_top").show():e.$blockPopWinHtml.find(".b_reason_top").hide()})},textareaBlurEvtBind:function(){var e=this;e.$blockPopWinHtml.on("click",function(t){var a=$(t.target);if(0==a.closest(".b_reason_box").length){e.curr_pattern="modify",e.toogleToolBar(),0==e.$blockPopWinHtml.find(".b_reason_curr").length&&e.$blockPopWinHtml.find(".b_reason_top").hide();var o="undefined"==e.power.can_filter_id?!e.power.ban_id||!e.power.ban_ip:!e.power.can_filter_id||!e.power.can_filter_ip;o&&(""==e.$blockPopWinHtml.find(".b_textarea").val()?e.$blockPopWinHtml.find(".b_label_tips").show():e.$blockPopWinHtml.find(".b_label_tips").hide()),e.$blockPopWinHtml.find(".block_tips").html(""),e.noReasonCantModify()}})},modifyTextareaCon:function(){var e=this;e.$blockPopWinHtml.find(".b_mod_bar").on("click",function(){e.$blockPopWinHtml.find(".b_textarea").trigger("focus")})},deleteTextareaCon:function(){var e=this;e.$blockPopWinHtml.find(".b_del_bar").on("click",function(){if("undefined"==typeof e.$blockPopWinHtml.find(".b_reason_curr").tbattr("data-reason-id")||e.$blockPopWinHtml.find(".b_reason_curr").hasClass("b_add_new_reason")||e.$blockPopWinHtml.find(".b_reason_curr").data("isBuiltinTpl"))return!1;var t={op:"del",id:e.$blockPopWinHtml.find(".b_reason_curr").tbattr("data-reason-id"),fid:e.forum.forum_id,tbs:e.tbs};$.ajax({url:e.config.del_block_reason,type:"POST",dataType:"json",data:t,success:function(t){"0"==t.errno?(e.$blockPopWinHtml.find(".b_reason_curr").removeAttr("data-reason-id"),e.setBlockReasonList(),e.setResponseTips(1,"\u5220\u9664\u6210\u529F\uFF01")):e.setResponseTips(2,"\u5220\u9664\u5931\u8D25!")},error:function(t){e.setNewDialogRespTips(2,t)}})})},toogleToolBar:function(){var e=this;e.power.ban_id&&e.power.ban_ip||e.power.can_filter_id&&e.power.can_filter_ip?(e.$blockPopWinHtml.find(".b_reason_top").css({display:"block"}),"modify"==this.curr_pattern?(e.$blockPopWinHtml.find(".b_top_mod_bar").css({display:"block"}),e.$blockPopWinHtml.find(".b_top_save_bar").css({display:"none"})):"add"==this.curr_pattern&&(e.$blockPopWinHtml.find(".b_top_mod_bar").css({display:"none"}),e.$blockPopWinHtml.find(".b_top_save_bar").css({display:"block"}))):e.$blockPopWinHtml.find(".b_reason_top").css({display:"none"})},saveTextareaCon:function(){var e,t=this,a={},o=t.$blockPopWinHtml.find(".b_textarea");t.$blockPopWinHtml.find(".b_save_bar").on("click",function(){if(!t.checkCanbeBlocked())return!1;var n=t.$blockPopWinHtml.find(".b_reason_curr").hasClass("b_add_new_reason")||0==t.$blockPopWinHtml.find(".b_reason_curr").length;n?(a={op:"add",tbs:t.tbs,fid:t.forum.forum_id,ie:"gbk",text:$.tb.escapeHTML(o.val())},e=t.config.add_block_reason):(a={op:"update",tbs:t.tbs,fid:t.forum.forum_id,ie:"gbk",text:$.tb.escapeHTML(t.$blockPopWinHtml.find(".b_textarea").val()),id:t.$blockPopWinHtml.find(".b_reason_curr").tbattr("data-reason-id")},e=t.config.modify_block_reason),$.ajax({url:e,type:"POST",dataType:"json",data:a,success:function(e){t.curr_pattern="modify",t.toogleToolBar(),"0"==e.errno?(t.setBlockReasonList(),t.setResponseTips(1,"\u4FDD\u5B58\u6210\u529F\uFF01"),n?$.stats.track("AddReasonItem","uegCount","bawuAppeal","success"):$.stats.track("modifyReasonItem"+$(".b_reason_curr").index(),"uegCount","bawuAppeal","success")):t.setResponseTips(2,"\u4FDD\u5B58\u5931\u8D25!")},error:function(e){t.setNewDialogRespTips(2,e)}})})},cancelTextareaCon:function(){var e=this;e.$blockPopWinHtml.find(".b_cancel_bar").on("click",function(){e.setTextareaVal(),e.curr_pattern="modify",e.toogleToolBar(),e.$blockPopWinHtml.find(".b_reason_curr").hasClass("b_add_new_reason")&&e.$blockPopWinHtml.find(".b_reason_item").siblings().removeClass("b_reason_curr").end().eq(0).addClass("b_reason_curr")})},getSavesData:function(e){var t=this,a={};a.day="block"===t.$blockPopWinHtml.find(".b_fixed_time").css("display")?"1":t.$blockPopWinHtml.find(".b_select_time").find("option:selected").tbattr("data-info"),a.fid=t.forum.forum_id,a.tbs=t.tbs,a.ie="gbk",a.user_name=[],a.pid=[];for(var o=0;o<t.blockList.length;++o){var n=t.blockList[o];-1===$.inArray(n.username,a.user_name)&&a.user_name.push($.tb.escapeHTML(n.username)),n.pid&&a.pid.push(n.pid)}var i=t.$blockPopWinHtml.find(".b_textarea"),s=0;return t.$blockPopWinHtml.find(".b_reason_item").each(function(e,t){"undefined"==typeof $(t).tbattr("data-reason-id")&&s++}),a.reason=6==s&&""===i.val().trim()?t.$blockPopWinHtml.find(".b_label_tips").html():t.$blockPopWinHtml.find(".b_textarea").val(),a.reason=$.tb.escapeHTML(a.reason),2===e&&(a.ip="1"),a},checkCanbeBlocked:function(){var e=this,t=e.$blockPopWinHtml.find(".b_textarea"),a=0;return t.hasClass("input_error_pattern")||""===t.val().trim()?(e.$blockPopWinHtml.find(".b_reason_item").each(function(e,t){"undefined"==typeof $(t).tbattr("data-reason-id")&&a++}),6==a?!0:(e.$blockPopWinHtml.find(".b_textarea").trigger("focus"),t.hasClass("input_error_pattern")?e.setResponseTips(2,"\u5C01\u7981\u539F\u56E0\u4E0D\u80FD\u8D85\u51FA100\u5B57"):e.setResponseTips(2,"\u5C01\u7981\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"),!1)):!0},blockIDbtnEvtBind:function(){var e=this;e.$blockPopWinHtml.find(".b_id_btn").on("click",function(){if(!e.checkCanbeBlocked())return!1;var t=e.getSavesData(1),a=function(o){t=o?$.extend(t,o):t,$.ajax({url:e.config.save_block_id,type:"POST",dataType:"json",data:t,success:function(t){"0"==t.errno?(e.setNewDialogRespTips(1,"\u5C01\u7981\u6210\u529F\uFF01"),(e.sucCallback||"function"==typeof e.sucCallback)&&e.sucCallback()):224011==t.errno?e.getCaptcha(t,a,e):e.setNewDialogRespTips(2,"\u5C01\u7981\u5931\u8D25\uFF01")},error:function(t){e.setNewDialogRespTips(2,t)}})};a()})},getCaptcha:function(e,t,a){var o=this;a=a||o;var n=PageData.forum_name||(PageData.forum?PageData.forum.forum_name:""),i=PageData.forum_id||(PageData.forum?PageData.forum.forum_id:"");this.requireInstanceAsync("common/component/CaptchaDialog",[{title:"\u5C01\u7981",message:"\u5C01\u7981\u4E86\u90A3\u4E48\u591A\u4EBA\uFF0C\u8F93\u4E2A\u7801\u9A8C\u8BC1\u4E0B\u8EAB\u4EFD\u5427~",vCode:e.res.captcha_vcode_str,vCodeType:e.res.captcha_code_type,forumName:n,forumId:i,postType:"thread",paramsCallback:function(){return{}}}],function(e){o.captchaDialog=e,e.bind("onclose",function(){return e.hide(),!1}),e.bind("onaccept",function(){var o={vcode:e.getInputValue(),vcode_md5:e.getVCode()};t.call(a,o)}),e.show()})},setResponseTips:function(e,t){var a=this,o=a.$blockPopWinHtml.find(".block_tips");1==e?o.removeClass("b_red").addClass("b_green").html(t):o.removeClass("b_green").addClass("b_red").html(t),window.setTimeout(function(){o.hasClass("b_green")&&o.html("")},2e3)},setNewDialogRespTips:function(e,t){var a=this,o=a.$blockPopWinHtml;o.html(a.$responseBlockInfo),1==e?o.find(".block_response_info").removeClass("b_red").addClass("b_green").html(t):o.find(".block_response_info").removeClass("b_green").addClass("b_red").html(t),window.setTimeout(function(){a.blockDialog.hide(),a.user_num>1&&$.tb.location.reload(),a.trigger("hide")},2e3)},tabSwitchEvtBind:function(){var e=this;e.$blockPopWinHtml.on("click",".b_reason_item",function(){return $(this).data("isBuiltinTpl")?$(".b_top_mod_bar .b_del_bar").hide():$(".b_top_mod_bar .b_del_bar").show(),"undefined"!=typeof $(this).tbattr("data-reason-id")||$(this).hasClass("b_add_new_reason")?("none"==e.$blockPopWinHtml.find(".b_reason_top").css("display")&&e.$blockPopWinHtml.find(".b_reason_top").css({display:"block"}),$(this).siblings(".b_reason_item").removeClass("b_reason_curr").end().addClass("b_reason_curr"),$(this).hasClass("b_add_new_reason")?(e.curr_pattern="add",e.$blockPopWinHtml.find(".b_textarea").trigger("focus")):(e.curr_pattern="modify",$.stats.track("reasonItem"+$(this).index(),"uegCount","bawuAppeal","click")),e.setTextareaVal(),e.toogleToolBar(),void 0):!1})},logicalControl:function(){var e=this,t=e.$blockPopWinHtml.find(".b_fixed_time"),a=e.$blockPopWinHtml.find(".b_select_time");e.$blockPopWinHtml.find(".b_reason_item").eq(0).addClass("b_reason_curr"),e.power.ban_id&&e.power.ban_ip||e.power.can_filter_id&&e.power.can_filter_ip?(e.$blockPopWinHtml.find(".b_fixed_tips").html("\u63D0\u793A\uFF1A\u5927\u5427\u4E3B\u53EF\u7F16\u8F91\u539F\u56E0\u6A21\u7248\uFF0C\u4FDD\u5B58\u540E\u5C0F\u5427\u4E3B\u53EF\u76F4\u63A5\u4F7F\u7528\u6587\u6848~"),e.user_num>1?(t.css({display:"block"}),a.css({display:"none"})):1==e.user_num&&(t.css({display:"none"}),a.css({display:"block"})),e.$blockPopWinHtml.find(".b_reason_top,.b_top_mod_bar").css({display:"block"}),e.modifyTextareaCon(),e.deleteTextareaCon(),e.saveTextareaCon(),e.cancelTextareaCon()):(e.$blockPopWinHtml.find(".b_fixed_tips").html("\u63D0\u793A\uFF1A\u539F\u56E0\u6A21\u7248\u53EA\u6709\u5927\u5427\u4E3B\u53EF\u4EE5\u7F16\u8F91\uFF0C\u5C0F\u5427\u4E3B\u4E5F\u53EF\u76F4\u63A5\u5728\u8F93\u5165\u6846\u4E2D\u5199\u4E0A\u5185\u5BB9\u5E76\u5B8C\u6210\u5C01\u7981~"),t.css({display:"block"}),a.css({display:"none"}))}}});_.Module.define({path:"pb/widget/Admin/ThreadManage",sub:{initial:function(){try{this.jdom=$("#j_quick_thread"),this._bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/admin/threadManage.js",method:"",ln:13}),e}},_bindEvents:function(){var e=this;if(this.jdom){this.jdom.delegate("a","click",function(){try{switch(this.className){case"j_thread_setgood":e.set_good();break;case"j_thread_disgood":e.unset_good();break;case"j_thread_settop":e.set_top();break;case"j_thread_distop":e.unset_top();break;case"j_thread_settopic":e.set_topic();break;case"j_thread_distopic":e.unset_topic();break;case"j_thread_setpictopic":e.set_pictopic();break;case"j_thread_dispictopic":e.unset_pictopic();break;case"j_thread_setmembertop":e.set_membertop();break;case"j_thread_dismembertop":e.unset_membertop()}return!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/admin/threadManage.js",method:"",ln:51}),t}}),$("a.j_thread_delete").live("click",function(){try{return e.del(),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/admin/threadManage.js",method:"",ln:56}),t}});var t=$("#d_post_manage"),a=this.jdom;a.children().length>0&&(t.show(),t.hover(function(){a.show()},function(){a.hide()}))}},showMessage:function(e,t,a){if(e){var s=this;s.message?s.message.showMessage(e,t,a):_.Module.getInstance("pb/widget/Message",function(n){s.message=n,s.message.showMessage(e,t,a)})}},del:function(){var e=$.dialog.confirm('<div class="d_messager_txt">\u786E\u8BA4\u5220\u9664\u8FD9\u6761\u4E3B\u9898\u5417\uFF1F</div>',{showTitle:!1,buttonAcceptValue:" \u786E\u8BA4 ",buttonCancelValue:" \u53D6\u6D88 "}),t=this;e.bind("onaccept",function(){t.execute_delete()})},execute_delete:function(e){var t=this,a={commit_fr:"pb",ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};e&&(a=$.extend(a,t._captcha)),PostHandler.execute("threadDelete",a,function(e){var a="";switch(e.no){case 2501:if("undefined"!=typeof TbSafe){var s=TbSafe.getEnvState();"risk"==s?TbSafe.showRiskTip():"uninstall"==s?TbSafe.showInstallTip("\u6267\u884C\u5220\u8D34\u64CD\u4F5C"):TbSafe.showSidErrorTip();break}case 2502:if("undefined"!=typeof TbSafe){TbSafe.showSidErrorTip();break}case 2503:if("undefined"!=typeof TbSafe){TbSafe.showRiskTip();break}case 0:$.tb.location.setHref("/f?kw="+PageData.forum.name_encode);break;case 12:case 13:Thread_add_result.resultNo=e.no,a=Thread_add_result.getMessage();break;case 34:a="\u4EB2\u7231\u7684\u5C0F\u4F19\u4F34\uFF0C\u4F60\u4ECA\u5929\u7684\u5220\u8D34\u6570\u91CF\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u9650\u989D("+e.data.reason+"\u6761/\u5929\uFF09\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 4009:a="\u4EB2\uFF0C\u7531\u4E8E\u672C\u8D34\u5B50\u7684\u5185\u5BB9\u975E\u5E38\u8D5E\u6240\u4EE5\u88AB\u4FDD\u62A4\u8D77\u6765\u5566\uFF0C\u60F3\u8981\u5220\u9664\u7684\u8BDD\u8BF7\u8054\u7CFB\u697C\u4E3B\u672C\u4EBA\u54E6~";break;case 871:a="\u62B1\u6B49\uFF0C\u4ECA\u5929\u5DF2\u8FBE\u60A8\u5220\u8D34\u7684\u6700\u5927\u9650\u989D\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 4011:t._getCaptcha.call(t,e);break;case 899:a="\u5BF9\u4E0D\u8D77\uFF0C\u4F60\u6CA1\u6709\u6743\u9650\u5220\u9664\u8BE5\u8D34\u5B50";break;default:a="\u5220\u9664\u4E3B\u9898\u64CD\u4F5C\u5931\u8D25"}""!=a&&t.showMessage(a,"",!1)})},_captcha:{},_getCaptcha:function(e){var t=this;_.Module.use("common/component/CaptchaDialog",{title:"\u5220\u9664\u8D34\u5B50",message:"\u5220\u4E86\u90A3\u4E48\u591A\u8D34\u5B50\uFF0C\u8F93\u4E2A\u7801\u9A8C\u8BC1\u4E0B\u8EAB\u4EFD\u5427~",vCode:e.data.vcode.captcha_vcode_str,vCodeType:e.data.vcode.captcha_code_type,forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,postType:"thread",paramsCallback:function(){return{}}},function(e){t.captchaDialog=e,e.bind("onclose",function(){return e.hide(),!1}),e.bind("onaccept",function(){t._captcha.vcode=e.getInputValue(),t._captcha.vcode_md5=e.getVCode(),t.execute_delete.call(t,1)}),e.show()})},set_good:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,cid:0};$.get("/f/center/goodclass?kw="+PageData.forum.name_encode,function(a){var s=[];if(s.push('<div style="width:90%;margin:0 auto; line-height:25px;padding-top:20px">'),s.push("<p>\u5C06\u8BE5\u5E16\u5B50\u5206\u7C7B\u81F3\uFF1A"),s.push('<select class="j_thread_classes">'),s.push('<option value="0" selected>\u672A\u5206\u7C7B</option>'),a)for(var n=0;n<a.length;n++)s.push('<option value="'+a[n].class_id+'">'+a[n].class_name+"</option>");s.push("</select>"),s.push("</p>"),s.push("<p>\u63D0\u793A\uFF1A\u60A8\u53EF\u4EE5\u5230\u5427\u52A1\u7BA1\u7406\u9875\u4E2D\u6DFB\u52A0/\u4FEE\u6539\u5206\u7C7B</p>"),s.push('<div style="text-align:center">'),s.push('<input type="button" value="\u63D0\u4EA4" class="j_thread_classes_confirm"><input type="button" value="\u53D6\u6D88" class="j_thread_classes_cancel">'),s.push("</div>"),s.push("</div>");var i=new $.dialog({html:s.join(""),title:"\u8BBE\u7F6E\u7CBE\u534E\u8D34",width:400,height:140});$("select.j_thread_classes").bind("change",function(){t.cid=this.options[this.selectedIndex].value}),$("input.j_thread_classes_confirm").bind("click",function(){try{PostHandler.execute("goodAdd",t,function(t){var a="";switch(t.no){case 0:a="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:a=Thread_add_result.getMessage();break;default:a="\u8BBE\u4E3A\u7CBE\u534E\u8D34\u64CD\u4F5C\u5931\u8D25"}i.close(),e.showMessage(a,"",!1)})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/admin/threadManage.js",method:"",ln:256}),a}}),$("input.j_thread_classes_cancel").bind("click",function(){try{i.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/admin/threadManage.js",method:"",ln:260}),e}})},"json")},unset_good:function(){function e(e){$.JsLoadManager.use(["http://passport.baidu.com/passApi/js/uni_forceverify_wrapper.js?cdnversion="+(new Date).getTime()],function(){var a=passport.pop.initForceverify({token:e,title:"\u53D6\u6D88\u7CBE\u54C1\u8D34",msg:"\u4E3A\u4E86\u9632\u6B62\u76D7\u53F7\u9020\u6210\u8BEF\u64CD\u4F5C\uFF0C\u53D6\u6D88\u7CBE\u54C1\u8D34\u524D\u8BF7\u5148\u8FDB\u884C\u5B89\u5168\u9A8C\u8BC1",onSubmitSuccess:function(){t.unset_good()}});a.show()},!0,"utf-8")}var t=this,a={ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};PageData.user.mobilephone?PostHandler.execute("goodCancel",a,function(a){var s="";switch(a.no){case 0:s="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:s=Thread_add_result.getMessage();break;case 41:e(a.data.token);break;default:s="\u8BBE\u4E3A\u7CBE\u534E\u8D34\u64CD\u4F5C\u5931\u8D25"}t.showMessage(s,"",!1)}):$.dialog.alert("\u4EB2\u7231\u7684\u5427\u4E3B\uFF0C\u6211\u4EEC\u68C0\u6D4B\u5230\u60A8\u5F53\u524D\u672A\u7ED1\u5B9A\u624B\u673A\uFF0C\u8BF7\u524D\u5F80\u5B89\u5168\u4E2D\u5FC3\u7ED1\u5B9A\u624B\u673A\u53F7\u540E\uFF0C\u518D\u8FDB\u884C\u76F8\u5173\u64CD\u4F5C\uFF1B\u5982\u679C\u4E0D\u7ED1\u5B9A\u624B\u673A\u53F7\uFF0C\u5219\u5B58\u5728\u88AB\u76D7\u53F7\u6216\u88AB\u76D7\u53F7\u8005\u62C6\u5427\u7684\u98CE\u9669\u54E6",{title:"\u53D6\u6D88\u7CBE\u54C1\u8D34"})},set_top:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};PostHandler.execute("threadTopAdd",t,function(t){var a="";switch(t.no){case 0:a="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:a=Thread_add_result.getMessage();break;case 21:a="\u8BE5\u8D34\u4E3A\u4F1A\u5458\u4E13\u5C5E\u7F6E\u9876\u8D34\uFF0C\u65E0\u6CD5\u8FDB\u884C\u666E\u901A\u7F6E\u9876\u64CD\u4F5C";break;default:a="\u7F6E\u9876\u4E3B\u9898\u64CD\u4F5C\u5931\u8D25"}e.showMessage(a,"",!0)})},unset_top:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};PostHandler.execute("threadTopCancel",t,function(t){var a="";switch(t.no){case 0:a="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:a=Thread_add_result.getMessage();break;case 21:a="\u8BE5\u8D34\u4E3A\u4F1A\u5458\u7F6E\u9876\u8D34\uFF0C\u8BF7\u70B9\u51FB\u53D6\u6D88\u4F1A\u5458\u4E13\u5C5E\u7F6E\u9876\u8D34\u64CD\u4F5C";default:a="\u53D6\u6D88\u7F6E\u9876\u64CD\u4F5C\u5931\u8D25"}e.showMessage(a,"",!0)})},set_topic:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:$.tb.escapeHTML(PageData.forum.forum_name),fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,type:3};PostHandler.execute("threadTopicAdd",t,function(t){var a="";switch(t.no){case 0:a="\u8BDD\u9898\u8D34\u8BBE\u7F6E\u6210\u529F\uFF0C\u6709\u6548\u671F\u81F3"+t.data.expire_time+"\uFF0C\u8FC7\u671F\u81EA\u52A8\u5931\u6548\u54E6~";break;case 12:case 13:a=Thread_add_result.getMessage();break;default:a="\u518D\u8BD5\u4E00\u4E0B\uFF0C\u670D\u52A1\u5668\u53EF\u80FD\u5F00\u5C0F\u5DEE\u4E86"}e.showMessage(a,"",!1)})},unset_topic:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:$.tb.escapeHTML(PageData.forum.forum_name),fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};PostHandler.execute("threadTopicCancel",t,function(t){var a="";switch(t.no){case 0:a="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:a=Thread_add_result.getMessage();break;default:a="\u53D6\u6D88\u8BDD\u9898\u8D34\u64CD\u4F5C\u5931\u8D25"}e.showMessage(a,"",!0)})},set_pictopic:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:$.tb.escapeHTML(PageData.forum.forum_name),fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,type:4};PostHandler.execute("threadTopicAdd",t,function(t){var a="";switch(t.no){case 0:a="\u8BDD\u9898\u8D34\u8BBE\u7F6E\u6210\u529F\uFF0C\u6709\u6548\u671F\u81F3"+t.data.expire_time+"\uFF0C\u8FC7\u671F\u81EA\u52A8\u5931\u6548\u54E6~";break;case 12:case 13:a=Thread_add_result.getMessage();break;default:a="\u518D\u8BD5\u4E00\u4E0B\uFF0C\u670D\u52A1\u5668\u53EF\u80FD\u5F00\u5C0F\u5DEE\u4E86"}e.showMessage(a,"",!1)})},unset_pictopic:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:$.tb.escapeHTML(PageData.forum.forum_name),fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};PostHandler.execute("threadTopicCancel",t,function(t){var a="";switch(t.no){case 0:a="\u64CD\u4F5C\u6210\u529F";break;case 12:case 13:a=Thread_add_result.getMessage();break;default:a="\u53D6\u6D88\u56FE\u7247\u8BDD\u9898\u8D34\u64CD\u4F5C\u5931\u8D25"}e.showMessage(a,"",!0)})},set_membertop:function(){var e=this;if(!PageData.user.Parr_props||!PageData.user.Parr_props.level||1e3*PageData.user.Parr_props.level.end_time<(new Date).getTime()){var t=new $.dialog({html:"",title:"\u4F7F\u7528\u7F6E\u9876\u5361",draggable:!1,width:415,height:162});return e.setMtopDialogContent(t,{msg:'<p>\u60A8\u5C1A\u672A\u5F00\u901A\u8D34\u5427\u9AD8\u7EA7\u4F1A\u5458<i class="icon_top_badge"></i>\uFF0C\u65E0\u6CD5\u4F7F\u7528\u7F6E\u9876\u7279\u6743</p><p class="small_tip">\u73B0\u5728\u5F00\u901A\uFF0C\u6BCF\u6708\u514D\u8D39\u8D60\u90018\u5F20\u7F6E\u9876\u5361</p>',btnTrue:"\u7ACB\u5373\u5F00\u901A",btnCancel:"\u53D6 \u6D88"}),t.bind("true",function(){_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()}),t.close()}),t.bind("cancel",function(){t.close()}),void 0}var a=['<div id="membertop_dialog_container" class="membertop_dialog_container">','<div class="md_right">','<p class="info">\u786E\u8BA4\u5BF9\u672C\u8D34\u4F7F\u7528\u7F6E\u9876\u5361</p>','<div class="count_section">\u4F7F\u7528\u5F20\u6570\uFF1A<input type="text" class="j_count ui_textfield" value="1"/>\u5F20</div>','<p class="left_section">\u5269\u4F59\u5F20\u6570\uFF1A<span class="orange_text">#{count}</span> \u5F20</p>','<div class="btn_section">','<a href="#" class="ui_btn ui_btn_m j_true">',"<span><em>\u786E \u5B9A</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_sub_m j_cancel">',"<span><em>\u53D6 \u6D88</em></span>","</a>","</div>","</div>",'<div class="md_left">','<i class="icon_top_card"></i>','<p class="buy_tips">\u5269\u4F59\u4E0D\u591A\uFF1F<a href="/tbmall/propslist?category=118" target="_blank">\u5FEB\u53BB\u8D2D\u4E70\u5427>></a></p>',"</div>","</div>"].join(""),s=0;PageData.user.Parr_props&&PageData.user.Parr_props["118"]&&PageData.user.Parr_props["118"]["1180001"]&&(s=PageData.user.Parr_props["118"]["1180001"].left_num);var n=$.tb.format(a,{count:s}),i=new $.dialog({html:n,title:"\u4F7F\u7528\u7F6E\u9876\u5361",draggable:!1,width:415,height:162}),o=i.element.find("#membertop_dialog_container"),r={forum_id:PageData.forum.forum_id,thread_id:PageData.thread.thread_id,tbs:PageData.tbs};$.tb.get("/tbmall/get/top",r,function(e){if(0==e.no&&e.data&&e.data.end_time&&1e3*e.data.end_time>(new Date).getTime()){var t='<p class="counttime_section">\u5269\u4F59\u7F6E\u9876\u65F6\u95F4\uFF1A#{time}</p>',a="",s=1e3*e.data.end_time-(new Date).getTime();if(0>s)a="<span>0</span>\u5C0F\u65F6<span>0</span>\u5206";else{var n=Math.floor(s/36e5),i=Math.floor((s-36e5*n)/6e4);a="<span>"+n+" </span>\u5C0F\u65F6<span> "+i+"</span>\u5206"}var r=$.tb.format(t,{time:a}),c=o.find(".count_section");$(r).insertBefore(c),o.parent("#dialogJbody").css("height",200)}}),0==s&&o.find(".j_true").tbattr("class","ui_btn_disable ui_btn_m_disable j_true"),o.find(".j_count").on("keydown",function(e){var t=e.which,a=!1;return e.shiftKey&&(9==t&&(a=!0),a=!1),(57>=t&&t>=48||37==t||39==t||8==t||9==t||46==t||105>=t&&t>=96||229==t)&&(a=!0),a}).on("keyup change paste",function(){var e=$.trim($(this).val()),t=o.find(".j_true");e&&(e=e.replace(/\D/g,""),$(this).val(e)),0==e.length||0==e||parseInt(e,10)>parseInt(s,10)?t.tbattr("class","ui_btn_disable ui_btn_m_disable j_true"):t.tbattr("class","ui_btn ui_btn_m j_true")}),o.find(".j_true").on("click",function(t){try{if(t.preventDefault(),$(this).hasClass("ui_btn_disable"))return;var a=o.find(".j_count").val(),s={tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,num:a,props_id:1180001};$.tb.post("/f/commit/thread/top/madd",s,function(t){switch(parseInt(t.err_code,10)){case 0:e.setMtopDialogContent(i,{msg:"\u4F1A\u5458\u7F6E\u9876\u6210\u529F",btnTrue:"\u786E \u5B9A"}),i.bind("true",function(){$.tb.location.reload()});break;case 2270020:e.setMtopDialogContent(i,{msg:'<p>\u60A8\u5C1A\u672A\u5F00\u901A\u8D34\u5427\u9AD8\u7EA7\u4F1A\u5458<i class="icon_top_badge"></i>\uFF0C\u65E0\u6CD5\u4F7F\u7528\u7F6E\u9876\u7279\u6743</p><p class="small_tip">\u73B0\u5728\u5F00\u901A\uFF0C\u6BCF\u6708\u514D\u8D39\u8D60\u90018\u5F20\u7F6E\u9876\u5361</p>',btnTrue:"\u7ACB\u5373\u5F00\u901A",btnCancel:"\u53D6 \u6D88"}),i.bind("true",function(){_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()}),i.close()}),i.bind("cancel",function(){i.close()});break;case 2270022:e.setMtopDialogContent(i,{msg:"\u8BE5\u8D34\u5DF2\u7ECF\u8BBE\u7F6E\u4E3A\u7F6E\u9876\u8D34\uFF0C\u65E0\u6CD5\u88AB\u8BBE\u7F6E\u4E3A\u4F1A\u5458\u4E13\u5C5E\u7F6E\u9876\u8D34",btnTrue:"\u786E \u5B9A"}),i.bind("true",function(){i.close()});break;default:e.setMtopDialogContent(i,{msg:"\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u9519\u8BEF\u7801\uFF1A"+t.err_code,btnTrue:"\u786E \u5B9A"}),i.bind("true",function(){i.close()})}})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/admin/threadManage.js",method:"",ln:668}),t}}),o.find(".j_cancel").on("click",function(e){try{e.preventDefault(),i.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/admin/threadManage.js",method:"",ln:672}),e}})},unset_membertop:function(){var e=this;if(!PageData.user.Parr_props||!PageData.user.Parr_props.level||1e3*PageData.user.Parr_props.level.end_time<(new Date).getTime()){var t=new $.dialog({html:"",title:"\u4F7F\u7528\u7F6E\u9876\u5361",draggable:!1,width:415,height:162});return e.setMtopDialogContent(t,{msg:'<p>\u60A8\u5C1A\u672A\u5F00\u901A\u8D34\u5427\u9AD8\u7EA7\u4F1A\u5458<i class="icon_top_badge"></i>\uFF0C\u65E0\u6CD5\u4F7F\u7528\u7F6E\u9876\u7279\u6743</p><p class="small_tip">\u73B0\u5728\u5F00\u901A\uFF0C\u6BCF\u6708\u514D\u8D39\u8D60\u90018\u5F20\u7F6E\u9876\u5361</p>',btnTrue:"\u7ACB\u5373\u5F00\u901A",btnCancel:"\u53D6 \u6D88"}),t.bind("true",function(){_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()}),t.close()}),t.bind("cancel",function(){t.close()}),void 0}var a={tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id};$.tb.post("/f/commit/thread/top/mcancel",a,function(t){var a=new $.dialog({html:"",title:"\u4F7F\u7528\u7F6E\u9876\u5361",draggable:!1,width:415,height:162});switch(parseInt(t.err_code,10)){case 0:e.setMtopDialogContent(a,{msg:"\u53D6\u6D88\u4F1A\u5458\u7F6E\u9876\u6210\u529F",btnTrue:"\u786E \u5B9A"}),a.bind("true",function(){a.close()});break;case 2270020:e.setMtopDialogContent(a,{msg:'<p>\u60A8\u5C1A\u672A\u5F00\u901A\u8D34\u5427\u9AD8\u7EA7\u4F1A\u5458<i class="icon_top_badge"></i>\uFF0C\u65E0\u6CD5\u4F7F\u7528\u7F6E\u9876\u7279\u6743</p><p class="small_tip">\u73B0\u5728\u5F00\u901A\uFF0C\u6BCF\u6708\u514D\u8D39\u8D60\u90018\u5F20\u7F6E\u9876\u5361</p>',btnTrue:"\u7ACB\u5373\u5F00\u901A",btnCancel:"\u53D6 \u6D88"}),a.bind("true",function(){_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()}),a.close()}),a.bind("cancel",function(){a.close()});break;case 2270024:e.setMtopDialogContent(a,{msg:"\u53EA\u6709\u4F1A\u5458\u7F6E\u9876\u5E16\u624D\u53EF\u4EE5\u88AB\u53D6\u6D88",btnTrue:"\u786E \u5B9A"}),a.bind("true",function(){a.close()});break;default:e.setMtopDialogContent(a,{msg:"\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u9519\u8BEF\u7801\uFF1A"+t.err_code,btnTrue:"\u786E \u5B9A"}),a.bind("true",function(){a.close()})}})},setMtopDialogContent:function(e,t){var a=['<div id="membertop_rst_container" class="membertop_rst_container">','<div class="tips">#{msg}</div>','<div class="btn">#{btns}</div>',"</div>"].join(""),s=['<a href="#" class="ui_btn ui_btn_m j_rst_true">',"<span><em>#{btnTrue}</em></span>","</a>"].join(""),n=['<a href="#" class="ui_btn ui_btn_sub_m j_rst_cancel">',"<span><em>#{btnCancel}</em></span>","</a>"].join(""),i="";t.btnTrue&&(i+=$.tb.format(s,t)),t.btnCancel&&(i+=$.tb.format(n,t)),t.btns=i;var o=$.tb.format(a,t);e.setContent(o),e.element.find(".j_rst_true").on("click",function(t){try{t.preventDefault(),e.triggerHandler("true")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/admin/threadManage.js",method:"",ln:792}),t}}),e.element.find(".j_rst_cancel").on("click",function(t){try{t.preventDefault(),e.triggerHandler("cancel")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/admin/threadManage.js",method:"",ln:796}),t}})}}});
;_.Module.define({path:"pb/widget/Admin",requires:["pb/widget/Admin/ThreadManage","common/widget/BlockUser"],sub:{initial:function(){try{}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/admin/admin_main.js",method:"",ln:14}),a}},loadThreadManage:function(){PageData.is_thread_admin&&this.requireInstance("pb/widget/Admin/ThreadManage",[])},loadAdmin:function(a,e,t){var n=a.find("ul.p_mtail");n.append(this._getAdminOplistHtml(e,t)),PageData.power.lz_del&&!PageData.user.forbidden.isForbid&&2==t.post_no&&this._showVipdelTip(n)},loadLzlAdmin:function(a){for(var e=a.find("li.j_lzl_s_p"),t=null,n=null,i=null,o=0,s=e.length;s>o;o++)t=$(e[o]),n=t.find("span.j_lzl_o_l"),i=t.getData(),n.html(this._getLzlAdminOplistHtml(i)),n.show()},_getAdminOplistHtml:function(a,e){var t=new Array,n="&nbsp;|";return e.is_anonym?PageData.power.can_filter_ip&&t.push('<li><a class="p_post_ban_anonym" href="#">\u5C01</a>'+n+"</li>"):PageData.power.can_filter_id&&t.push('<li><a class="p_post_ban" href="#">\u5C01</a>'+n+"</li>"),1!=e.post_no&&(PageData.power.can_mask_delete||PageData.power.lz_del&&!PageData.user.forbidden.isForbid&&!PageData.user.is_black)&&t.push('<li><a class="p_post_del" href="#">\u5220\u9664</a>'+n+"</li>"),PageData.power.can_super&&!e.is_anonym&&t.push('<li><a class="p_tieba_manage" href="/f?ct=503316480&cm=6000&tn=bdUserManager&un='+encodeURIComponent(a.name)+'" target="_blank">\u8D34\u5427\u7BA1\u7406</a>&nbsp;|</li>'),t.join("")},_getLzlAdminOplistHtml:function(a){var e=new Array,t="&nbsp;|&nbsp;";(PageData.power.can_filter_ip||PageData.power.can_filter_id)&&e.push('<a href="#" class="j_lzl_ban">\u5C01</a>'+t),(PageData.power.can_mask_delete||PageData.power.lz_del&&!PageData.user.forbidden.isForbid&&!PageData.user.is_black)&&e.push('<a href="#" class="j_lzl_del">\u5220\u9664</a>'+t),PageData.power.can_super&&e.push('<a href="/f?ct=503316480&cm=6000&tn=bdUserManager&un="'+a.user_name+' class="j_lzl_manage p_tieba_manage" target="_blank">\u8D34\u5427\u7BA1\u7406</a>'+t);var n=e.join("");return $.browser.msie&&"6.0"==$.browser.version&&!$.support.style&&(n+="&nbsp;"),n},_showVipdelTip:function(a){var e=$.cookie("VIP_TIP_USERS")||"|",t="|"+PageData.user.user_id+"|";if(!(e.indexOf(t)>=0)){e+=PageData.user.user_id+"|",$.cookie("VIP_TIP_USERS",e);var n=$('<div id="vip_del_tip" class="vip_del_tip"></div>');a.append(n);var i=0,o=0;o=0,i=-112;var s={content:"\u60A8\u53EF\u4EE5\u5220\u9664\u81EA\u5DF1\u4E3B\u9898\u8D34\u4E2D\u7684\u56DE\u590D",arrow_dir:"down",bubble_css:{top:o,right:i,width:180},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#vip_del_tip"),closeBtn:!0},r=new UiBubbleTipBase(s);r.showBubble()}},bindAdminEvents:function(){var a=this,e=null,t=null;$("a.p_post_ban_anonym,.p_post_ban").live("click",function(){try{return e=$(this).parents("div.l_post"),t=e.getData(),a.use("common/widget/BlockUser",[{username:t.author.user_name,pid:t.content.post_id}],{ban_ip:PageData.power.can_filter_ip,ban_id:PageData.power.can_filter_id},{forum_name:PageData.forum.forum_name,forum_id:PageData.forum.forum_id},PageData.tbs),!1}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/admin/admin_main.js",method:"",ln:163}),n}}),$("a.p_post_del").live("click",function(){try{e=$(this).parents("div.l_post"),t=e.getData();var n={author_name:t.author.user_name,content_id:t.content.post_id};return a._del_post_confirm(n,0),!1}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/admin/admin_main.js",method:"",ln:174}),i}})},bindLzlAdminEvents:function(){var a=this,e=null,t=null;$("a.j_lzl_ban").live("click",function(){try{return e=$(this).parents("li.j_lzl_s_p "),t=e.getData(),a.use("common/widget/BlockUser",[{username:t.user_name,pid:t.spid||t.pid}],PageData.power,{forum_id:PageData.forum.forum_id,forum_name:PageData.forum.forum_name},PageData.tbs),!1}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/admin/admin_main.js",method:"",ln:195}),n}}),$("a.j_lzl_del").live("click",function(){try{return e=$(this).parents("li.j_lzl_s_p"),t=e.getData(),a._del_post_confirm(t,1),!1}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/admin/admin_main.js",method:"",ln:202}),n}})},_del_post_confirm:function(a,e){var t=this,n=$.dialog.confirm('<div style="margin:15px auto 0;text-align:center;">\u786E\u8BA4\u5220\u9664\u8FD9\u6761\u56DE\u590D?<div>',{showTitle:!1});n.bind("onaccept",function(){t._del_post(a,e)})},_del_post:function(a,e,t){var n=this,i={commit_fr:"pb",ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,is_vipdel:PageData.power.lz_del?1:0};e?(i.pid=a.spid,i.is_finf=1):(i.pid=a.content_id,i.is_finf=!1),t&&(i=$.extend(i,n._captcha)),window.PostHandler.execute("postDelete",i,function(t){var i="";switch(t.no){case 2501:if("undefined"!=typeof window.TbSafe){var o=window.TbSafe.getEnvState();"risk"==o?window.TbSafe.showRiskTip():"uninstall"==o?window.TbSafe.showInstallTip("\u6267\u884C\u5220\u8D34\u64CD\u4F5C"):window.TbSafe.showSidErrorTip()}break;case 2502:"undefined"!=typeof window.TbSafe&&window.TbSafe.showSidErrorTip();break;case 2503:"undefined"!=typeof window.TbSafe&&window.TbSafe.showRiskTip();break;case 0:$.tb.location.reload(!0);break;case 12:case 13:i=window.Thread_add_result.getMessage();break;case 871:i="\u62B1\u6B49\uFF0C\u4ECA\u5929\u5DF2\u8FBE\u60A8\u5220\u8D34\u7684\u6700\u5927\u9650\u989D\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 34:i="\u4EB2\u7231\u7684\u5C0F\u4F19\u4F34\uFF0C\u4F60\u4ECA\u5929\u7684\u5220\u8D34\u6570\u91CF\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u9650\u989D("+t.data.reason+"\u6761/\u5929\uFF09\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 4009:i="\u4EB2\uFF0C\u7531\u4E8E\u672C\u8D34\u5B50\u7684\u5185\u5BB9\u975E\u5E38\u8D5E\u6240\u4EE5\u88AB\u4FDD\u62A4\u8D77\u6765\u5566\uFF0C\u60F3\u8981\u5220\u9664\u7684\u8BDD\u8BF7\u8054\u7CFB\u697C\u4E3B\u672C\u4EBA\u54E6~";break;case 4011:n._getCaptcha.call(n,t,a,e);break;default:i="\u62B1\u6B49\uFF0C\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8D34\u5B50\u5220\u9664\u5931\u8D25\u3002"}""!=i&&(n.message?n.message.showMessage(i,"",!1):_.Module.getInstance("pb/widget/Message",function(a){n.message=a,a.showMessage(i,"",!1)}))})},_captcha:{},_getCaptcha:function(a,e,t){var n=this;n.requireInstanceAsync("common/component/CaptchaDialog",{title:"\u5220\u9664\u8D34\u5B50",message:"\u5220\u4E86\u90A3\u4E48\u591A\u8D34\u5B50\uFF0C\u8F93\u4E2A\u7801\u9A8C\u8BC1\u4E0B\u8EAB\u4EFD\u5427~",vCode:a.data.vcode.captcha_vcode_str,vCodeType:a.data.vcode.captcha_code_type,forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,postType:"thread",paramsCallback:function(){return{}}},function(a){n.captchaDialog=a,a.bind("onclose",function(){return a.hide(),!1}),a.bind("onaccept",function(){n._captcha.vcode=a.getInputValue(),n._captcha.vcode_md5=a.getVCode(),n._del_post.call(n,e,t,1)}),a.show()})}}});!function(){window.Path={map:function(t){return this.routes.defined[t]||(this.routes.defined[t]=new this.Route(t)),this.routes.defined[t]},listened:!1,listen:function(){this.listened=!0,this.supported=!(!window.history||!window.history.pushState),this.oldIE=navigator.userAgent.toLowerCase().search("msie")>0&&(!document.documentMode||document.documentMode<8);var t,e,n=$.tb.location;this.supported?(t=function(){Path.dispatch(n.getPathname()+n.getSearch())},window.onpopstate=t,e=n.getPathname()+n.getSearch()):(e=this.getHash(),this.oldIE?(t=function(){Path.dispatch(Path.getHash(Path.iframe.location))},this.iframe=document.createElement('<iframe src="javascript:0" tabindex="-1">'),this.iframe.style.display="none",document.body.insertBefore(this.iframe,document.body.firstChild),this.iframe=this.iframe.contentWindow,this.iframe.document.open().close(),this.iframe.location.hash=e,setInterval(t,1e4)):(t=function(){Path.dispatch(n.getHash().replace("#",""))},window.onhashchange=t),""!==e&&this.execute(e)),this.routes.current=e},nav:function(t){if(this.listened){if(/pn=1$/.test(t)){var e=$.tb.location.getHref(),n=/pn=\d+/g,i=n.test(e)?e.replace(n,"pn=1"):"/p/"+PageData.thread.thread_id+"?pn=1";return $.tb.location.setHref(i),void 0}this.supported?(window.history.pushState(null,null,t),this.dispatch(t)):this.oldIE?(this.iframe.document.open().close(),this.iframe.location.hash=t):$.tb.location.setHash(t)}},refresh:function(){this.execute(this.routes.current,!0)},setDefaultAction:function(t){this.defaultAction=t},Route:function(t){this.action=null,this.path=t},routes:{current:null,defined:{}},dispatch:function(t){t!==this.routes.current&&(this.routes.current=t,this.oldIE&&$.tb.location.setHash(t),this.execute(t))},execute:function(t,e){""===t&&(t=$.tb.location.getPathname()+$.tb.location.getSearch());var n,i;for(var a in Path.routes.defined)if(n=Path.routes.defined[a],i=Path.match(n.path,t))return n.action.call(n,i[0],i[1],e),void 0;"function"==typeof this.defaultAction&&this.defaultAction.call(this,t,!0)},match:function(t,e){var n=[e];if(t=t.split("/"),e=e.split("/"),t.length!==e.length)return!1;for(var i,a=0,o=t.length;o>a;a++)if(i=t[a].search(":"),-1!==i){if(t[a].slice(0,i)!==e[a].slice(0,i))return!1;n.push(e[a].slice(i))}else if(t[a]!==e[a])return!1;return n},getHash:function(t){var e="";return e=t?t.href.match(/#(.*)$/):$.tb.location.getHref().match(/#(.*)$/),e?e[1]:""},clean:function(){this.routes.current=null,this.routes.defined={}}},Path.Route.prototype={to:function(t){this.action=t}}}(),_.Module.define({path:"pb/widget/NoRefresh",sub:{initial:function(t,e){function n(){$(".pb_list_pager").off("click").on("click",function(t){try{var e,n,i,a=$.tb.location,o=t.target;if(!PageData.user.is_login)return n="http://tieba.baidu.com"+$.tb.unescapeHTML($(o).tbattr("href")),window.open("/f/user/passport?jumpUrl="+n+"&statsInfo=frs_pager#login_anchor"),!1;if(i=$(this).parents(".p_thread"),i.find(".loading-tip").css({top:i.offset().top+i.height()+20+"px",left:i.offset().left+$(".left_section").width()/2-35+"px"}).show(),m&&m.start_event(),"a"===o.tagName.toLowerCase())return e=o.getAttribute("href",2).replace(a.getProtocol()+"//"+a.getHost(),""),d||(e="/pn="+e.match(/\d+$/)),Path.nav(e),t.preventDefault(),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/no_refresh_pager/no_refresh_pager.js",method:"",ln:191}),t}}),$(".jump_input_bright").off("keypress").on("keypress",function(t){var e=$(this);m&&m.start_event(),13==t.keyCode&&h(t,e)}),$(".jump_btn_bright").off("click").on("click",function(t){try{var e=$(this).prev(".jump_input_bright");m&&m.start_event(),h(t,e)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/no_refresh_pager/no_refresh_pager.js",method:"",ln:203}),t}})}function i(){bdShareTb.fn?bdShareTb.fn.init():_.Module.use("common/widget/bd_share",null,function(){bdShareTb.fn.init()})}function a(){mbox.player&&mbox.player.stop(),mbox.player&&mbox.player.dispose()}function o(o,s,h){var c;if(-1!==o.indexOf("#")&&o.slice(0,o.indexOf("#")),c=d?o+"&ajax=1&t="+(new Date).getTime():t+s+"&ajax=1&t="+(new Date).getTime(),h&&(c+="&refresh=true"),l){if(f===s)return;l.abort()}a(),f=s,m&&m.start_send(),l=$.get(c,function(t){l=null,m&&m.transfer_time(),e||r(),setTimeout(function(){var e=$(t),a=e.slice(1),o=e.find("#j_p_postlist"),r=e.find("#ajax-up"),s=e.find("#ajax-down"),h=e.find("#ajax-title .core_title_txt");buttons=e.find("#ajax-title .core_title_btns"),script=e.find("#ajax-script"),$("#j_p_postlist").empty().html(o.html()),$(".p_thread:first").replaceWith(r.html()),$(".p_thread:last").replaceWith(s.html()),$(".core_title_txt").replaceWith(h),$(".core_title_btns").empty().html(buttons.html()),$("body").append(a),u.fire("noRefreshFinish"),n(),i(),PageData.pager.total_page=parseInt(r.find(".jump_input_bright").tbattr("max-page"))||1,PageData.pager.cur_page=parseInt(f,10)||1,m&&m.view_time(),m&&m.ready()},0)},"html")}function r(){var t=$(window).scrollTop();t>0&&($("body").animate({scrollTop:1},"medium"),setTimeout(function(){window.scrollTo(0,0)},500))}function s(t){var e=$.tb.location.getPathname()+$.tb.location.getSearch(),n=e.indexOf("#");return n>=0&&(e=e.substr(0,n)),-1==e.indexOf("pn")?e+=-1==e.indexOf("?")?"?pn="+t:e.indexOf("?")==e.toString().length-1?"pn="+t:"&pn="+t:e=e.replace(/(.*pn=)(\d+)?/,function(e,n){return n+""+t}),e}function h(t,e){var n,i=e,a=i.val(),o=i.tbattr("max-page");return d?/^(-?)(\d+)$/.test(a)?($pthread=i.parents(".p_thread"),$pthread.find(".loading-tip").css({top:$pthread.offset().top+$pthread.height()+20+"px",left:$pthread.offset().left+$(".left_section").width()/2-35+"px"}).show(),a=Math.max(1,Math.min(a,o)),n=s(a),d||(n="/pn="+a),Path.nav(n),t.preventDefault(),!1):(i.val(""),!1):/^(-?)(\d+)$/.test(a)?(Path.nav("/pn="+a),$pthread=i.parents(".p_thread"),$pthread.find(".loading-tip").css({top:$pthread.offset().top+$pthread.height()+20+"px",left:$pthread.offset().left+$(".left_section").width()/2-35+"px"}).show(),!1):void 0}function c(){$("#container").on("mousedown",".pb_list_pager a",function(){var t=$(this).parents(".p_thread").tbattr("id");return $(this).hasClass("pager_disabled")?!1:(p("pb_fanye_page",t),void 0)})}function p(t,e){$.tb.Stats.sendRequest("http://tb1.bdstatic.com/tb/img/pv.gif",{fr:"tb0_forum",st_mod:"pb",st_type:t,st_value:e})}try{var f,d=!(!window.history||!window.history.pushState),u=this,l=null;if("undefined"!=typeof AJAX_MONITOR){AJAX_MONITOR.PDC.init({product_id:14,sample:1,max:5});var m=AJAX_MONITOR.PDC.createInstance(13)}n(),c(),Path.map(d?t+":num":"/pn=:num").to(function(t,e,n){o(t,e,n)}),Path.setDefaultAction(function(t,e){if(""===t.replace("#","")||e){var n=t.match(/&pn=(\d+)/i);n=n?n[1]:void 0===f?0:f,o(n,e)}}),Path.listen(),window.refreshPage=o}catch(g){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:g.message||g.description,path:"pb:widget/no_refresh_pager/no_refresh_pager.js",method:"",ln:417}),g}}}});_.Module.define({path:"common/widget/messenger",requires:["common/widget/messenger/messengerProcesser","common/widget/messenger/messengerTarget"],sub:{initial:function(e,n){if(!e)throw new Error("Messenger name must be asigned");var s=n||"[PROJECT_NAME]";this.name=e,this.prefix=s.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("common/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,n){this.targets[n]=this.requireInstance("common/widget/messenger/messengerTarget",[this.prefix,e,n])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var n=0;for("string"==typeof e&&(e=[e]),n;n<e.length;n++)this.origins.push(e[n])},send:function(e){var n,s=this.targets;for(n in s)s.hasOwnProperty(n)&&s[n].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,n=function(n){var s="";if("object"==typeof n){if(!n.data||"string"!=typeof n.data)return window.console&&console.warn("The received message is not type of string"),void 0;if(s=n.data,/^ignoredProject/.test(s))return;if(s.substring(0,e.prefix.length)!==e.prefix)return window.console&&console.warn("The msg type is not avaliable in project "+e.prefix),void 0;if(n.origin&&!e._checkOrigin(n.origin))return window.console&&console.warn("The post origin is not avaliable in project "+e.prefix),void 0}else if(s=n,/^ignoredProject/.test(s))return;s=s.slice(e.prefix.length),s=e._escapeHTML(s);try{s=$.parseJSON(s)}catch(i){throw new Error("The JSON string is not valid")}var r=e.processer.process(s)||{};s.command&&s.shake&&s.shake_id&&e.send($.json.encode({command:s.command+"@"+s.shake_id+"@success",shake:!0,shake_id:s.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var n=0,s=this.origins.length;for(n;s>n;n++)if(this.origins[n]===e)return!0;return!1}}});
;_.Module.define({path:"common/widget/messenger/messengerProcesser",requires:[],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(o){this.checkExistCommand(o)&&(this.commandMap=$.extend(this.commandMap,o)),this.processFailCommand(o)},checkExistCommand:function(o){var n;for(n in o)if(o.hasOwnProperty(n)&&n in this.commandMap)return window.console&&console.warn('The command "'+n+'" is already exist'),void 0;return!0},processFailCommand:function(o){var n;for(n in o){var i=this._failCommandCacheList[n];o.hasOwnProperty(n)&&i&&this.process(i)}},process:function(o){if(!(o.command&&o.command in this.commandMap))return this._failCommandCacheList[o.command]=o,window.console&&console.warn("Please check or register the data processing command"),void 0;var n=this.commandMap[o.command];return n(o.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstanceAsync("common/widget/LoginDialog",[],function(){})},common_register:function(o){var n=o.return_url||"http://tieba.baidu.com",i="https://passport.baidu.com/v2/?reg&tpl=tb&u="+n;window.open(i)},exception_all:function(){throw new Error("Processing data exception")}}});
;_.Module.define({path:"common/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,t,r){var i="";if(arguments.length<3?i="Target error: target and name are both requied":"object"!=typeof t?i="Target error: target itself must be window object":"string"!=typeof r&&(i="Target error: target name must be string type"),i)throw new Error(i);this.prefix=e,this.target=t,this.name=r},send:function(e){var t="postMessage"in window;if(t)this.target.postMessage(this.prefix+e,"*");else{var r=window.navigator[this.prefix+this.name];if("function"!=typeof r)throw new Error("Target error: target callback function is not defined");var i=$.tb.location,o={origin:i.getProtocol()+"//"+i.getHost(),data:this.prefix+e};r(o,window)}}}});_.Module.define({path:"comforum/widget/gamePlay",requires:["common/widget/messenger"],sub:{initial:function(e){this.forumID=e.forumID||0,this.threadID=e.threadID||0,this.gameID=e.gameID||0,this.isRankGame=e.isRankGame||!1,this.isLogin=e.user.is_login||!1,this.isNoName=e.user.no_un||!1,this.isH5=e.isH5||0,this.screenHeight=$(window).height(),this.updateGamePlayed(),this.initialPlay()},initialPlay:function(){this.gameWrapper=$(".game_play_wrapper"),this.gameArea=$(".game_play"),this.gameShadow=$(".game_play_shadow");var e=$.browser.msie&&parseInt($.browser.version,10)<9;this.isH5&&e?this.addFailArea("\u975E\u5E38\u62B1\u6B49\uFF0C\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668"):this.getGameInfo()},initMessenger:function(){var e=this.gameIframe[0].contentWindow,a=this.requireInstance("common/widget/messenger",["tiebaIframe","tiebaGame"]);a.addTarget(e,"gameIframe"),a.registerOrigin(this.getMessengerWhitelist()),this.messenger=a},getMessengerWhitelist:function(){var e=0,a=[],s=PageUnit.load("game_play_messenger_whitelist"),t=s.length;for(e;t>e;e++)a.push(s[e][0]);return a=a.length?a:["http://end.baidu.com"]},bindEvents:function(){var e=this;$(window).bind("resize",function(){e.gameArea.is(".fullScreen")||e.locateArea()}),this.gameArea.on("click",".replay",$.proxy(this.replay,this)).on("click",".beFullScreen",$.proxy(this.beFullScreen,this)).on("click",".checkRank",$.proxy(this.checkRank,this)).on("click",".beOutFullScreen",$.proxy(this.beOutFullScreen,this)).on("click",".turnOffLight",$.proxy(this.turnOffLight,this)).on("click",".turnOnLight",$.proxy(this.turnOnLight,this)).on("click",".support",$.proxy(this.support,this)).on("click",".displayHelp",$.proxy(this.toggleHelp,this)),this.messenger.registerCommand({comforum_game_score:$.proxy(this.postRank,this)}),this.gameArea.find(".strategy").on("click","li",function(){var e=$(this).index();$.stats.track("\u5751\u7239\u6E38\u620F\u653B\u7565_"+(e+1),"\u4E50\u6B64\u4E0D\u75B2\u5427\u73A9\u6E38\u620F\u533A\u57DF","","click")})},getGameInfo:function(){var e=this,a="/game/browse/gameForum";$.post(a,{thread_id:this.threadID,game_id:this.gameID},function(a){a&&0===a.no&&a.data?(e.addPlayArea(a.data),e.bindEvents()):e.addFailArea("\u975E\u5E38\u62B1\u6B49\uFF0C\u6E38\u620F\u51FA\u95EE\u9898\u4E86\uFF0C\u8BF7\u5237\u65B0\u9875\u9762")},"json")},addPlayArea:function(e){if(e.game){this.gameContent=this.gameArea.find(".iframe_container");var a=e.game.link;if(a){var s=PageData.user.user_name;PageData.user.is_login&&this.isNoName&&TbCom.process("User","buildUnameFrame"),this.gameLink=a,this.isRankGame&&(a=a+"&game_id="+this.gameID+"&username="+s),this.gameIframe=this.gameContent.find("iframe").tbattr("src",a),this.initMessenger()}this.gameHelp=this.gameArea.find(".help_section");var t=e.game.help;t&&this.fillHelpSection(t)}this.gameFoot=this.gameArea.find(".foot"),this.gameSupportNum=this.gameFoot.find(".support_number");var i=parseInt(e.times);isNaN(i)||this.gameSupportNum.find("span").html(i),this.locateArea(!0)},addFailArea:function(e){this.gameWrapper.addClass("game_play_wrapper_fail").find(".fail_container").html(e)},beFullArea:function(){this.gameArea.offset({left:0,top:0}),this.scrollValue=$(window).scrollTop(),$(window).scrollTop(0),$(".fullScreen .play_section .iframe_container").height(this.screenHeight-45)},locateArea:function(e){var a=this.gameWrapper.offset();this.scrollValue&&$(window).scrollTop(this.scrollValue),this.gameArea.offset({left:a.left+4,top:a.top+4}).show(),e&&$(window).one("load",function(){var e=this,s=setTimeout(function(){$(e).scrollTop(a.top),clearTimeout(s),s=null},500)}),this.gameContent.height(480)},fillHelpSection:function(e){e.operateHelp&&this.gameHelp.find(".desc .container").append(this.formatHelpInfo(e.operateHelp)),e.startWay&&this.gameHelp.find(".start .container").append(this.formatHelpInfo(e.startWay)),e.gameTarget&&this.gameHelp.find(".target .container").append(this.formatHelpInfo(e.gameTarget))},formatHelpInfo:function(e){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-/=,.;'[]",s={},t=0,i="",n={mouseleft:'<span class="keyboard_spec mouseleft"></span>',mouseright:'<span class="keyboard_spec mouseright"></span>',ctrl:'<span class="keyboard_spec ctrl"></span>',tab:'<span class="keyboard_spec tab"></span>',end:'<span class="keyboard_spec end"></span>',esc:'<span class="keyboard_spec esc"></span>',home:'<span class="keyboard_spec home"></span>',enter:'<span class="keyboard_spec enter"></span>',shift:'<span class="keyboard_spec shift"></span>',space:'<span class="keyboard_spec space"></span>',up:'<span class="keyboard_spec up"></span>',down:'<span class="keyboard_spec down"></span>',left:'<span class="keyboard_spec left"></span>',right:'<span class="keyboard_spec right"></span>'};for(t;t<a.length;t++)i=a[t],s[i]='<span class="keyboard_base">'+i+"</span>";return $.extend(s,n),$.tb.format(e,s)},replay:function(){var e=$.json.encode({command:"comforum_game_replay",data:{}});this.messenger&&this.messenger.targets.gameIframe.send(e)},beFullScreen:function(){var e=$.json.encode({command:"comforum_game_fullscreen",data:{}});this.messenger&&this.messenger.targets.gameIframe.send(e),this.gameArea.addClass("fullScreen"),this.beFullArea(),this.gameHelp.is(".hide_help")||this.toggleHelp()},beOutFullScreen:function(){var e=$.json.encode({command:"comforum_game_outfullscreen",data:{}});this.messenger&&this.messenger.targets.gameIframe.send(e),this.gameArea.removeClass("fullScreen"),this.locateArea()},scrollToRank:function(){if($("#game_thread_rank_wrapper")){var e=$("#game_thread_rank_wrapper").offset().top-100;e&&$(window).scrollTop(e)}},refreshRank:function(){$("#game_thread_rank_wrapper .j_score_value").html(this.score),$("#game_thread_rank_wrapper .j_score_value_span").show(),$("#game_thread_rank_refresh").html(this.score),$("#game_thread_rank_refresh").trigger("click")},noUnError:function(){new $.dialog({html:"\u63D0\u4EA4\u5206\u6570\u5931\u8D25\uFF0C\u8BF7\u5B8C\u5584\u7528\u6237\u540D\uFF01",title:"\u63D0\u793A",draggable:!1})},checkRank:function(){this.scrollToRank()},postRank:function(e){PageData.user.is_login||this.scrollToRank();var a=this;if(e.score&&e.code&&e.cp_id){this.score=e.score;var s="/game/setUserGameScore",t={score:e.score,code:e.code||"",cp_id:e.cp_id||0,game_id:a.gameID,forum_id:a.forumID,tbs:PageData.tbs||""};this.isNoName?a.noUnError():(this.scrollToRank(),$.post(s,t,function(e){e=$.parseJSON(e),"110000"==e.no||("2260104"==e.no?a.noUnError():a.refreshRank())}))}},toggleHelp:function(){this.gameHelp.toggleClass("hide_help")},turnOnLight:function(){this.gameShadow.hide(),this.gameArea.removeClass("offLight")},turnOffLight:function(){this.gameShadow.show(),this.gameArea.addClass("offLight")},support:function(){if(!this.alreadyPost){var e=this,a="/game/clickZan";if(!this.isLogin)return this.requireInstanceAsync("common/widget/LoginDialog"),void 0;if(this.isNoName)return TbCom.process("User","buildUnameFrame"),void 0;this.alreadyPost=!0,$.post(a,{forum_id:this.forumID,thread_id:this.threadID},function(a){e.handleSupport(a),e.alreadyPost=!1},"json")}},handleSupport:function(e){var a="",s={220034:"\u60A8\u4ECA\u5929\u201C\u9876\u201D\u7684\u673A\u4F1A\u5DF2\u7ECF\u7528\u5B8C\u5566\uFF0C\u8BF7\u660E\u5929\u518D\u6765\u5427\uFF01",220012:"\u60A8\u5728\u5F53\u524D\u5427\u5DF2\u88AB\u5C01\u7981",220013:"\u60A8\u5728\u5F53\u524D\u5427\u5DF2\u88AB\u5C01\u7981",230889:"\u60A8\u5DF2\u88AB\u52A0\u5165\u9ED1\u540D\u5355",elseTip:"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01"};if(0===e.no){var t=this.gameSupportNum.find("span"),i=parseInt(t.html());t.html(i+1),this.scoreAnimate(t)}else a=e.no in s?s[e.no]:s.elseTip,$.dialog.assert(a,{time:2e3,title:"\u8D34\u5427\u63D0\u793A"})},scoreAnimate:function(e){var a=e.offset().left,s=e.offset().top;$('<p class="support_number_animation">+1</p>').appendTo("body").css({left:a,top:s}).animate({top:"-=50",left:"+=20",opacity:.2},1e3,function(){$(this).remove()})},updateGamePlayed:function(){if(this.isLogin){var e="/game/setHistoryGame",a={game_id:this.gameID,tbs:PageData.tbs||""};$.post(e,a)}}}});_.Module.define({path:"common/component/force_login",sub:{_config:{apiOpt:{staticPage:"http://"+$.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",product:"pctb_3",charset:PageData&&PageData.charset?PageData.charset:"GBK",u:"",memberPass:!0,safeFlag:0},cache:!1,img:"",onLoginSuccess:function(t){t.returnValue=!1,$.stats.sendRequest("st_type=login_succeed&fr=tb0&st_pos="),$.tb.location.reload()},onSubmitStart:function(){$.stats.sendRequest("st_type=login_click&fr=tb0&st_pos=")},registerLink:"https://passport.baidu.com/v2/?reg&tpl=tieba&u=http://tieba.baidu.com",tangram:!0},initial:function(t,e,s,a,c){var i=this,p=1,o="string"==typeof s&&""!==s?s:"dialog";if(i._config.apiOpt.u="string"==typeof t&&""!=t?t:$.tb.location.getHref(),"page"===o)return void $.tb.location.setHref("/f/user/passport?jumpUrl="+i._config.apiOpt.u+"&statsInfo="+a);switch(a){case"pb_lzl_more":$.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web");break;case"pb_see_lz":$.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web")}if("string"==typeof e){switch(e){case"userBar":p=1;break;case"editor1":case"lzl":p=2;break;case"editor":p=3;break;case"lzonly":p=4;break;case"ilike":p=5;break;default:p=1}i._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+p+".png"}else i._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+p+".png";PageData&&(i._config.apiOpt.isQuickUser=PageData.is_quick_user||0),i._config.onLoginSuccess=c?function(t){switch(a){case"pb_lzl_more":$.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u767B\u5F55\u6210\u529F","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web");break;case"pb_see_lz":$.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u767B\u5F55\u6210\u529F","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web")}t.returnValue=!1,c(),setTimeout(function(){$.tb.location.setHref(i._config.apiOpt.u)},500)}:function(t){switch(a){case"pb_lzl_more":$.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u767B\u5F55\u6210\u529F","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web");break;case"pb_see_lz":$.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u767B\u5F55\u6210\u529F","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","view","pc_web")}t.returnValue=!1,setTimeout(function(){$.tb.location.setHref(i._config.apiOpt.u)},500)},arguments.length>4&&(i._config.apiOpt.product=arguments[4]),function(t){var e="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();t.JsLoadManager.use(["http://passport.bdimg.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(e/6e4),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(e/6e4)],function(){t.passPopInstance||(t.passPopInstance=passport.pop.init(i._config)),t.passPopInstance.show();var e=setInterval(function(){var s=t("#passport-login-pop");0!==s.length&&(s.find(".pass-login-pop-img img").tbattr("src",i._config.img),s.find(".pass-reglink").click(function(){switch(a){case"pb_lzl_more":t.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u7ACB\u5373\u6CE8\u518C","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web");break;case"pb_see_lz":t.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u7ACB\u5373\u6CE8\u518C","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web")}}),s.find(".pass-fgtpwd").click(function(){switch(a){case"pb_lzl_more":t.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u5FD8\u8BB0\u5BC6\u7801","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web");break;case"pb_see_lz":t.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u5FD8\u8BB0\u5BC6\u7801","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web")}}),s.find(".pass-button-submit").click(function(){switch(a){case"pb_lzl_more":t.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u767B\u5F55","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web");break;case"pb_see_lz":t.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u767B\u5F55","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web")}}),s.find(".close-btn").click(function(){switch(a){case"pb_lzl_more":t.stats.track("PB\u9875\u70B9\u51FB\u697C\u4E2D\u697C\u67E5\u770B\u66F4\u591A\u767B\u5F55\u5F39\u7A97_\u5173\u95ED","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web");break;case"pb_see_lz":t.stats.track("PB\u9875\u70B9\u51FB\u53EA\u770B\u697C\u4E3B\u767B\u5F55\u5F39\u7A97_\u5173\u95ED","PC\u7AEF\u5F3A\u5236\u767B\u5F55\u7EDF\u8BA1","pb","click","pc_web")}}),clearInterval(e))},200);setTimeout(function(){t("#passport-login-pop").find("input.pass-button-submit").tbattr("alog-alias","login")},1e3)},!0,"utf-8")}(window.jQuery)}}});_.Module.define({path:"ucenter/widget/LikeTip",sub:{initial:function(e,s,i){var t=this;if(i&&i.like_no&&i.like_no>=1){var a=$.dialog.alert('<img src="'+PageData.staticDomain+'tb/static-frs/img/like_back.png">',{width:320,height:131,acceptValue:"\u77E5\u9053\u4E86"});$(a.element[0]).find(".dialogJcontent").css("padding-bottom","0px"),$(a.element[0]).find(".dialogJanswers").css("padding-top","0px"),a.bind("onaccept",function(){t.reloadAndGotop()}).bind("onclose",function(){t.reloadAndGotop()})}else{var r=this.getTipContent(e,s,i),l={title:"\u6210\u529F\u63D0\u793A",width:418,modal:!e};this.isSuperMember()&&(l.width=535);var a=$.dialog.open(r,l);e&&$(a.element[0]).css("padding","2px"),$(a.element[0]).find(".dialogJcontent").tbattr("id","balv_first_like_dialog"),$(a.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")}),$(a.element[0]).find(".lvlup_pop_btn").eq(0).bind("click",function(){t.reloadAndGotop()}),$(a.element[0]).on("click",".userlike_supermember_btn",function(){window.open("/tbmall/mall/forumMember"),t.reloadAndGotop()}),a.bind("onclose",function(){t.reloadAndGotop()})}},getTipContent:function(e,s,i){var t=PageData,a=t.user.level_id?t.user:t.user.balv,r="<span>";e&&(r+=e+"\uFF0C"),r+="\u606D\u559C\u4F60\u6210\u4E3A\u672C\u5427\u7B2C</span>",r+="<span class='tip_font_orange'>"+i.index+"</span>",r+="<span>\u4F4D\u4F1A\u5458</span>";var l="";l+='<div class="userlike_tip_join" id="userlike_tip_join">',l+='<div class="userlike_tip_info" id="userlike_tip_info">'+r+"</div>",e?l+='<div class="user_rights_msg"><span class="user_rights_msg_gray">\u83B7\u5F97\u5934\u8854&nbsp;</span><img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'<span class="user_rights_msg_gray">&nbsp;\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<span><a class="user_rights_msg_link" target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u4F1A\u5458\u6743\u5229</a></div>':1==a.level_id?l+='<div class="user_rights_msg">\u83B7\u5F97\u5934\u8854&nbsp;<img class="user_rights_msg_img" src="/tb/static-frs/img/balv/lv_join.png">&nbsp;'+a.level_name+'\uFF0C\u5347\u7EA7\u4EAB\u7279\u6743\uFF0C<a target="_blank" href="/f/like/level?kw='+t.forum.name_url+'">\u67E5\u770B\u5347\u7EA7\u79D8\u7C4D</a></div>':(l+='<div class="user_rights_msg">\u6839\u636E\u4F60\u5728\u672C\u5427\u7684\u6D3B\u8DC3\u8868\u73B0\uFF0C\u76F4\u63A5\u6388\u4E88<img src="http://tb2.bdstatic.com/tb/static-member/img/badges/'+a.level_id+'.png">&nbsp;'+a.level_name+"\uFF0C\u7ED9\u529B\uFF01</div>",l+='<div class="userlike_tip_span">\u672C\u5427\u767E\u5B9D\u7BB1\u5BF9\u4F60\u5F00\u653E\u4E86\uFF0C<a target="_blank" href="/imall/mall?kw='+t.forum.name_url+'">\u53BB\u767E\u5B9D\u7BB1\u770B\u770B\u6709\u54EA\u4E9B\u7279\u6743\u548C\u5B9D\u8D1D</a></div>'),this.isSuperMember()&&(l+=this.getSuperMemberHtml()),l+='<div class="lvlup_tip_btnzone">';var n="";return this.isSuperMember()&&(l+='<input class="userlike_supermember_btn userlike_sm_btn_style" type="button" value="\u8BE6\u7EC6\u4E86\u89E3\u7279\u6743"/>',n="userlike_sm_btn_style"),l+='<input class="lvlup_pop_btn '+n+'" type="button" value="\u77E5\u9053\u4E86"/>',e&&(l+='<a class="userlike_tip_cancel" target="_blank" href="/home/forum?id='+t.user.portrait+"&fr="+t.product+'">\u5982\u4F55\u53D6\u6D88\u4F1A\u5458</a>'),l+="</div></div>"},reloadAndGotop:function(){$.tb.location.setHref($.tb.location.getHref().split("#")[0])},getSuperMemberHtml:function(){var e=[],s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{},i=PageData.forum.name||PageData.forum.forum_name;return e.push('<div class="userlike_supermember">'),e.push('<div class="userlike_sm_up clearfix">'),e.push('<div class="userlike_sm_up_gift"></div>'),e.push('<div class="userlike_sm_up_info">'),e.push('<h3>\u5C0A\u8D35\u7684<span class="userlike_sm_up_icon">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span></h3>'),e.push("<h2>\u60A8\u5DF2\u6210\u529F\u83B7\u5F97<b>\u3010"+i+"\u5427\u7279\u6743\u5305\u3011</b></h2>"),e.push("<p>\u6709\u6548\u671F\u81F3"+this.getFormatZhTime(1e3*s.end_time)+"</p>"),e.push("</div>"),e.push("</div>"),e.push('<div class="userlike_sm_down clearfix">'),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7EA2\u8272\u6807\u9898</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_1"></div>'),e.push("</div>"),e.push('<div class="userlike_sm_down_item">'),e.push('<div class="userlike_sm_down_title">\u7ECF\u9A8C\u52A0\u901F</div>'),e.push('<div class="userlike_sm_down_pic userlike_sm_down_pic_2"></div>'),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},isSuperMember:function(){var e=PageUnit.load("like_tip_svip_black_list");if(e)return!1;var s=PageData.user?PageData.user.Parr_props?PageData.user.Parr_props.level?PageData.user.Parr_props.level:{}:{}:{};return 1e3*s.end_time>1*new Date&&2===s.props_id&&!PageData.forum.is_star},getFormatZhTime:function(e){return"number"!=typeof e?"":(e=new Date(e),[e.getFullYear()+"\u5E74",parseInt(e.getMonth()+1)+"\u6708",e.getDate()+"\u65E5"].join(""))}}});